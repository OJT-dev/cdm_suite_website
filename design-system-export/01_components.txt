
// ==========================================
// File: components/about/about-hero.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Image from "next/image";

const AboutHero = () => {
  return (
    <section className="relative py-32 bg-gradient-to-r from-primary to-primary/80 text-white overflow-hidden">
      <div className="section-container relative z-10">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <motion.div
            initial={{ opacity: 0, x: -30 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8 }}
          >
            <h1 className="text-5xl md:text-6xl font-bold mb-6">
              About <span className="text-yellow-300">CDM Suite</span>
            </h1>
            <p className="text-xl leading-relaxed mb-8">
              Founded in 2020, CDM Suite brings proven expertise from complex, multi-billion dollar 
              infrastructure programs to deliver enterprise-grade digital solutions. Our leadership has 
              navigated high-stakes environments in landmark aviation, logistics, and public sector projects.
            </p>
            <div className="grid grid-cols-2 gap-6">
              <div>
                <div className="text-3xl font-bold text-yellow-300">$9.3B+</div>
                <div className="text-white">Infrastructure Program Experience</div>
              </div>
              <div>
                <div className="text-3xl font-bold text-yellow-300">$250M+</div>
                <div className="text-white">Operations Assets Managed</div>
              </div>
              <div>
                <div className="text-3xl font-bold text-yellow-300">50+</div>
                <div className="text-white">Team Leadership Experience</div>
              </div>
              <div>
                <div className="text-3xl font-bold text-yellow-300">120%+</div>
                <div className="text-white">Profit Growth Achieved</div>
              </div>
            </div>
          </motion.div>
          
          <motion.div
            initial={{ opacity: 0, x: 30 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8, delay: 0.2 }}
            className="relative aspect-video bg-white/10 rounded-lg overflow-hidden"
          >
            <Image
              src="https://cdn.abacus.ai/images/b6f36bdd-b3a3-496a-9b8a-513d94cb4816.png"
              alt="CDM Suite Team"
              fill
              className="object-cover"
            />
          </motion.div>
        </div>
      </div>
      
      {/* Background Elements */}
      <div className="absolute inset-0 opacity-10">
        <div className="absolute top-1/4 left-1/4 w-64 h-64 bg-white rounded-full blur-3xl"></div>
        <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-yellow-300 rounded-full blur-3xl"></div>
      </div>
    </section>
  );
};

export default AboutHero;

// ==========================================
// File: components/about/about-mission.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import { Target, Eye, Heart, Zap } from "lucide-react";

const AboutMission = () => {
  const values = [
    {
      icon: Target,
      title: "Infrastructure-Grade Planning",
      description: "Critical Path Method (CPM) scheduling and project controls from $9.3B+ programs ensure systematic delivery.",
    },
    {
      icon: Eye,
      title: "Sales & Financial Expertise",
      description: "OLT & Equity Licensed professionals with $2.4M+ in sales and proven wealth management solutions.",
    },
    {
      icon: Heart,
      title: "Operations Excellence",
      description: "Experience managing 50+ person teams with 120%+ profit growth through strategic process optimization.",
    },
    {
      icon: Zap,
      title: "Technical Certifications",
      description: "BIM certified, Oracle Primavera expertise, combined with React, Next.js, TypeScript, and AWS infrastructure.",
    },
  ];

  return (
    <section className="py-20 bg-gray-50">
      <div className="section-container">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mb-16"
        >
          <h2 className="text-4xl font-bold text-gray-900 mb-6">
            Our Mission & Values
          </h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            To deliver enterprise-grade digital solutions with infrastructure-level planning, strategic 
            financial oversight, and operations excellence‚Äîcombining technical rigor with proven business 
            development expertise.
          </p>
        </motion.div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-16">
          {values.map((value, index) => (
            <motion.div
              key={index}
              initial={{ opacity: 0, y: 30 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: index * 0.1 }}
              viewport={{ once: true }}
              className="bg-white p-8 rounded-lg shadow-lg text-center card-hover"
            >
              <div className="bg-primary/10 p-4 rounded-full inline-block mb-6">
                <value.icon className="h-8 w-8 text-primary" />
              </div>
              <h3 className="text-xl font-semibold text-gray-900 mb-4">
                {value.title}
              </h3>
              <p className="text-gray-600">
                {value.description}
              </p>
            </motion.div>
          ))}
        </div>

        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="bg-primary text-white rounded-lg p-12 text-center"
        >
          <h3 className="text-3xl font-bold mb-6">
            Ready for Professional Digital Solutions?
          </h3>
          <p className="text-xl mb-8 text-primary-foreground/90">
            Experience the difference that infrastructure-grade project management brings to digital delivery.
          </p>
          <motion.a
            href="/contact"
            whileHover={{ scale: 1.05 }}
            whileTap={{ scale: 0.95 }}
            className="inline-block bg-white text-primary px-8 py-4 rounded-md font-semibold hover:bg-gray-100 transition-colors"
          >
            Start Your Success Story
          </motion.a>
        </motion.div>
      </div>
    </section>
  );
};

export default AboutMission;

// ==========================================
// File: components/about/about-story.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Image from "next/image";

const AboutStory = () => {
  return (
    <section className="py-20 bg-gradient-to-br from-white via-gray-50 to-white">
      <div className="section-container">
        {/* Main Story */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center mb-20">
          <motion.div
            initial={{ opacity: 0, x: -30 }}
            whileInView={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
          >
            <div className="inline-block bg-gradient-to-r from-primary/10 to-secondary/10 rounded-full px-6 py-2 mb-6">
              <span className="text-primary font-semibold">üìñ Our Journey</span>
            </div>
            <h2 className="text-4xl font-bold text-gray-900 mb-6">
              From Infrastructure to Innovation
            </h2>
            <div className="space-y-4 text-gray-700 leading-relaxed text-lg">
              <p>
                <span className="font-semibold text-primary">Founded in 2020,</span> CDM Suite brings together complementary expertise spanning infrastructure management, operations excellence, financial planning, and technical project controls. Our leadership team combines experience from $5.1 billion and $4.2 billion airport terminal development programs at LaGuardia and JFK with proven operations management delivering 120%+ profit growth and $2.4M+ in sales across finance, logistics, and marketing sectors.
              </p>
              <p>
                This unique blend of infrastructure rigor and business development expertise allows us to deliver digital solutions with both technical precision and strategic financial oversight. Whether coordinating multi-phase construction programs or leading sales teams to exceed targets, we apply the same fundamentals: clear communication, systematic planning, risk mitigation, and stakeholder management.
              </p>
              <p>
                Today, our portfolio includes logistics websites like <span className="font-semibold text-secondary">rapidoshippinja.com</span>, 
                custom web applications at <span className="font-semibold text-secondary">melissa.cdmsuite.com</span>, and 
                professional branding work for clients across industries. We bring infrastructure-grade project 
                management combined with sales excellence and operations optimization to every solution we create.
              </p>
            </div>
          </motion.div>
          
          <motion.div
            initial={{ opacity: 0, x: 30 }}
            whileInView={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8, delay: 0.2 }}
            viewport={{ once: true }}
            className="relative"
          >
            <div className="relative aspect-square rounded-2xl overflow-hidden shadow-2xl">
              <Image
                src="https://i.ytimg.com/vi/94mnAH1luXY/maxresdefault.jpg"
                alt="CDM Suite team collaborating"
                fill
                className="object-cover"
              />
            </div>
            {/* Floating stat cards */}
            <div className="absolute -bottom-6 -left-6 bg-gradient-to-r from-accent to-secondary p-6 rounded-xl shadow-xl max-w-[200px]">
              <p className="text-3xl font-bold text-charcoal mb-1">$9.3B+</p>
              <p className="text-charcoal font-medium">Infrastructure Programs</p>
            </div>
            <div className="absolute -top-6 -right-6 bg-white p-6 rounded-xl shadow-xl max-w-[200px]">
              <p className="text-3xl font-bold text-primary mb-1">$2.4M+</p>
              <p className="text-gray-700 font-medium">Sales Achieved</p>
            </div>
          </motion.div>
        </div>

        {/* Our Philosophy */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="bg-gradient-to-br from-primary/5 via-secondary/5 to-accent/5 p-12 rounded-2xl"
        >
          <div className="text-center mb-12">
            <h3 className="text-3xl font-bold text-gray-900 mb-4">
              What Sets CDM Suite Apart
            </h3>
            <p className="text-lg text-gray-600 max-w-3xl mx-auto">
              Our unique background in complex infrastructure gives us an edge in digital delivery:
            </p>
          </div>

          <div className="grid md:grid-cols-2 gap-8">
            <div className="bg-white p-8 rounded-xl shadow-lg">
              <div className="text-4xl mb-4">üèóÔ∏è</div>
              <h4 className="text-xl font-bold text-gray-900 mb-3">Infrastructure-Grade Project Management</h4>
              <p className="text-gray-600 leading-relaxed">
                Experience from $5.1B LaGuardia Terminal B and $4.2B JFK Terminal 6 development programs. 
                We apply the same systematic planning, risk identification, and execution standards to 
                every digital project.
              </p>
            </div>

            <div className="bg-white p-8 rounded-xl shadow-lg">
              <div className="text-4xl mb-4">üíº</div>
              <h4 className="text-xl font-bold text-gray-900 mb-3">Sales & Financial Expertise</h4>
              <p className="text-gray-600 leading-relaxed">
                OLT & Equity Licensed financial consultant with $2.4M+ in documented sales across finance, 
                logistics, and marketing. Proven track record building professional networks and delivering 
                tailored wealth management solutions.
              </p>
            </div>

            <div className="bg-white p-8 rounded-xl shadow-lg">
              <div className="text-4xl mb-4">üìà</div>
              <h4 className="text-xl font-bold text-gray-900 mb-3">Operations Management Excellence</h4>
              <p className="text-gray-600 leading-relaxed">
                Experience managing 50+ person teams and $250M+ in operations assets with 120%+ profit growth. 
                Expertise in recruitment, training, performance management, and process optimization at scale.
              </p>
            </div>

            <div className="bg-white p-8 rounded-xl shadow-lg">
              <div className="text-4xl mb-4">‚ö°</div>
              <h4 className="text-xl font-bold text-gray-900 mb-3">Modern Tech with Proven Discipline</h4>
              <p className="text-gray-600 leading-relaxed">
                React, Next.js, TypeScript, and AWS cloud infrastructure combined with CPM scheduling, 
                BIM certification, and Oracle Primavera expertise. The best of both worlds.
              </p>
            </div>
          </div>
        </motion.div>

        {/* Our Commitment */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="mt-20 text-center bg-gradient-to-r from-primary to-charcoal p-12 rounded-2xl text-white"
        >
          <h3 className="text-3xl font-bold mb-6">Our Commitment</h3>
          <p className="text-xl leading-relaxed max-w-3xl mx-auto mb-8">
            We bring the same commitment to excellence and professional standards that guided landmark 
            infrastructure projects to every digital solution we create. Clear communication, systematic 
            planning, risk mitigation, and reliable delivery aren't just buzzwords‚Äîthey're the 
            foundation of how we work.
          </p>
          <div className="flex flex-wrap justify-center gap-6 text-center">
            <div>
              <p className="text-2xl font-bold text-accent mb-1">Professional</p>
              <p className="text-white/90">Communication Standards</p>
            </div>
            <div>
              <p className="text-2xl font-bold text-accent mb-1">Proven</p>
              <p className="text-white/90">Project Management</p>
            </div>
            <div>
              <p className="text-2xl font-bold text-accent mb-1">Reliable</p>
              <p className="text-white/90">Delivery Excellence</p>
            </div>
          </div>
        </motion.div>
      </div>
    </section>
  );
};

export default AboutStory;

// ==========================================
// File: components/about/about-team.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";

const AboutTeam = () => {
  return (
    <section className="py-20 bg-white">
      <div className="section-container">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mb-16"
        >
          <h2 className="text-4xl font-bold text-gray-900 mb-6">
            Leadership & Expertise
          </h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            Our leadership team combines proven experience from $9.3B+ infrastructure programs with 
            sales excellence, financial planning, and operations management expertise delivering 120%+ 
            profit growth across multiple sectors.
          </p>
        </motion.div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6 }}
            viewport={{ once: true }}
            className="text-center"
          >
            <div className="bg-primary/10 p-8 rounded-lg mb-6">
              <h3 className="text-6xl font-bold text-primary mb-2">$9.3B+</h3>
              <p className="text-gray-600">Infrastructure Programs</p>
            </div>
            <h4 className="text-xl font-semibold text-gray-900 mb-2">
              Complex Project Experience
            </h4>
            <p className="text-gray-600">
              LaGuardia Terminal B, JFK Terminal 6, and DASNY public sector projects.
            </p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.2 }}
            viewport={{ once: true }}
            className="text-center"
          >
            <div className="bg-primary/10 p-8 rounded-lg mb-6">
              <h3 className="text-6xl font-bold text-primary mb-2">$250M+</h3>
              <p className="text-gray-600">Operations Assets</p>
            </div>
            <h4 className="text-xl font-semibold text-gray-900 mb-2">
              Operational Excellence
            </h4>
            <p className="text-gray-600">
              Logistics operations management with proven 120%+ profit growth achievement.
            </p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.4 }}
            viewport={{ once: true }}
            className="text-center"
          >
            <div className="bg-primary/10 p-8 rounded-lg mb-6">
              <h3 className="text-6xl font-bold text-primary mb-2">$2.4M+</h3>
              <p className="text-gray-600">Sales Achieved</p>
            </div>
            <h4 className="text-xl font-semibold text-gray-900 mb-2">
              Sales & Financial Planning
            </h4>
            <p className="text-gray-600">
              OLT & Equity Licensed expertise across finance, logistics, and marketing sectors.
            </p>
          </motion.div>
        </div>

        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="bg-gray-50 rounded-lg p-12 text-center"
        >
          <h3 className="text-2xl font-semibold text-gray-900 mb-6">
            Leadership Expertise
          </h3>
          <p className="text-gray-600 mb-8 max-w-2xl mx-auto">
            Our leadership brings diverse, complementary expertise spanning infrastructure management, 
            operations excellence, financial planning, and technical project controls.
          </p>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
            <div className="text-center">
              <h4 className="font-semibold text-gray-900">Infrastructure PM</h4>
              <p className="text-sm text-gray-600">$9.3B+ programs, CPM scheduling, BIM certified</p>
            </div>
            <div className="text-center">
              <h4 className="font-semibold text-gray-900">Operations Management</h4>
              <p className="text-sm text-gray-600">50+ team leadership, 120%+ profit growth</p>
            </div>
            <div className="text-center">
              <h4 className="font-semibold text-gray-900">Sales & Financial Planning</h4>
              <p className="text-sm text-gray-600">OLT & Equity Licensed, $2.4M+ in sales</p>
            </div>
            <div className="text-center">
              <h4 className="font-semibold text-gray-900">Technical Development</h4>
              <p className="text-sm text-gray-600">React, Next.js, TypeScript, AWS cloud</p>
            </div>
          </div>
        </motion.div>
      </div>
    </section>
  );
};

export default AboutTeam;

// ==========================================
// File: components/agents/agent-builder.tsx
// ==========================================


"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Bot, Sparkles, FileText, Link as LinkIcon, Zap } from "lucide-react";
import { toast } from "react-hot-toast";

const AGENT_TYPES = [
  { value: "customer-support", label: "Customer Support", description: "24/7 support bot to answer common questions" },
  { value: "lead-gen", label: "Lead Generation", description: "Qualify and capture leads automatically" },
  { value: "appointment-booking", label: "Appointment Booking", description: "Schedule meetings and appointments" },
  { value: "sales-assistant", label: "Sales Assistant", description: "Help customers make purchase decisions" },
  { value: "faq-bot", label: "FAQ Bot", description: "Answer frequently asked questions" },
];

const PERSONALITIES = [
  { value: "professional", label: "Professional" },
  { value: "friendly", label: "Friendly" },
  { value: "casual", label: "Casual" },
  { value: "technical", label: "Technical" },
  { value: "sales", label: "Sales-Oriented" },
];

const TONES = [
  { value: "helpful", label: "Helpful" },
  { value: "direct", label: "Direct" },
  { value: "empathetic", label: "Empathetic" },
  { value: "persuasive", label: "Persuasive" },
];

export function AgentBuilder({ user }: { user: any }) {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [activeTab, setActiveTab] = useState("basics");
  
  const [formData, setFormData] = useState({
    name: "",
    description: "",
    agentType: "",
    personality: "professional",
    tone: "helpful",
    industry: "",
    welcomeMessage: "Hi! How can I help you today?",
    systemPrompt: "",
  });

  const handleInputChange = (field: string, value: string) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  };

  const handleCreate = async () => {
    // Validation
    if (!formData.name || !formData.agentType) {
      toast.error("Please fill in required fields");
      return;
    }

    setLoading(true);
    try {
      const response = await fetch("/api/agents", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message || "Failed to create agent");
      }

      const data = await response.json();
      toast.success("Agent created successfully!");
      router.push(`/dashboard/ai-agents/${data.agent.id}`);
    } catch (error: any) {
      console.error("Error creating agent:", error);
      toast.error(error.message || "Failed to create agent");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="max-w-4xl mx-auto space-y-8">
      {/* Header */}
      <div>
        <h1 className="text-3xl font-bold flex items-center gap-2">
          <Sparkles className="w-8 h-8 text-purple-600" />
          Create AI Agent
        </h1>
        <p className="text-muted-foreground mt-2">
          Build a custom AI agent to automate your business
        </p>
      </div>

      <Card className="p-6">
        <Tabs value={activeTab} onValueChange={setActiveTab}>
          <TabsList className="grid w-full grid-cols-3">
            <TabsTrigger value="basics">
              <Bot className="w-4 h-4 mr-2" />
              Basics
            </TabsTrigger>
            <TabsTrigger value="personality">
              <Sparkles className="w-4 h-4 mr-2" />
              Personality
            </TabsTrigger>
            <TabsTrigger value="advanced">
              <Zap className="w-4 h-4 mr-2" />
              Advanced
            </TabsTrigger>
          </TabsList>

          {/* Basics Tab */}
          <TabsContent value="basics" className="space-y-6">
            <div>
              <Label htmlFor="name">Agent Name *</Label>
              <Input
                id="name"
                value={formData.name}
                onChange={(e) => handleInputChange("name", e.target.value)}
                placeholder="e.g., Customer Support Bot"
                className="mt-2"
              />
            </div>

            <div>
              <Label htmlFor="description">Description</Label>
              <Textarea
                id="description"
                value={formData.description}
                onChange={(e) => handleInputChange("description", e.target.value)}
                placeholder="What does this agent do?"
                className="mt-2"
                rows={3}
              />
            </div>

            <div>
              <Label htmlFor="agentType">Agent Type *</Label>
              <Select
                value={formData.agentType}
                onValueChange={(value) => handleInputChange("agentType", value)}
              >
                <SelectTrigger className="mt-2">
                  <SelectValue placeholder="Select agent type" />
                </SelectTrigger>
                <SelectContent>
                  {AGENT_TYPES.map((type) => (
                    <SelectItem key={type.value} value={type.value}>
                      <div>
                        <div className="font-medium">{type.label}</div>
                        <div className="text-xs text-muted-foreground">
                          {type.description}
                        </div>
                      </div>
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <div>
              <Label htmlFor="industry">Industry (Optional)</Label>
              <Input
                id="industry"
                value={formData.industry}
                onChange={(e) => handleInputChange("industry", e.target.value)}
                placeholder="e.g., Real Estate, E-commerce, Healthcare"
                className="mt-2"
              />
            </div>
          </TabsContent>

          {/* Personality Tab */}
          <TabsContent value="personality" className="space-y-6">
            <div>
              <Label htmlFor="personality">Personality</Label>
              <Select
                value={formData.personality}
                onValueChange={(value) => handleInputChange("personality", value)}
              >
                <SelectTrigger className="mt-2">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  {PERSONALITIES.map((p) => (
                    <SelectItem key={p.value} value={p.value}>
                      {p.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <div>
              <Label htmlFor="tone">Tone</Label>
              <Select
                value={formData.tone}
                onValueChange={(value) => handleInputChange("tone", value)}
              >
                <SelectTrigger className="mt-2">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  {TONES.map((t) => (
                    <SelectItem key={t.value} value={t.value}>
                      {t.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <div>
              <Label htmlFor="welcomeMessage">Welcome Message</Label>
              <Input
                id="welcomeMessage"
                value={formData.welcomeMessage}
                onChange={(e) => handleInputChange("welcomeMessage", e.target.value)}
                placeholder="First message visitors see"
                className="mt-2"
              />
            </div>
          </TabsContent>

          {/* Advanced Tab */}
          <TabsContent value="advanced" className="space-y-6">
            <div>
              <Label htmlFor="systemPrompt">Custom System Prompt (Optional)</Label>
              <Textarea
                id="systemPrompt"
                value={formData.systemPrompt}
                onChange={(e) => handleInputChange("systemPrompt", e.target.value)}
                placeholder="Advanced: Custom instructions for the AI (leave blank for auto-generated)"
                className="mt-2"
                rows={6}
              />
              <p className="text-sm text-muted-foreground mt-2">
                If left blank, we'll generate optimal instructions based on your selections
              </p>
            </div>
          </TabsContent>
        </Tabs>

        <div className="flex justify-between mt-8 pt-6 border-t">
          <Button variant="outline" onClick={() => router.back()}>
            Cancel
          </Button>
          <Button onClick={handleCreate} disabled={loading}>
            {loading ? "Creating..." : "Create Agent"}
          </Button>
        </div>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/agents/agent-editor.tsx
// ==========================================


"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Settings, BookOpen, Link as LinkIcon, Zap, BarChart3, Code } from "lucide-react";
import { AgentSettingsTab } from "./tabs/agent-settings-tab";
import { AgentKnowledgeTab } from "./tabs/agent-knowledge-tab";
import { AgentIntegrationsTab } from "./tabs/agent-integrations-tab";
import { AgentWorkflowsTab } from "./tabs/agent-workflows-tab";
import { AgentAnalyticsTab } from "./tabs/agent-analytics-tab";
import { AgentDeployTab } from "./tabs/agent-deploy-tab";

export function AgentEditor({ agent, user }: { agent: any; user: any }) {
  const router = useRouter();
  const [activeTab, setActiveTab] = useState("settings");

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold">{agent.name}</h1>
          <p className="text-muted-foreground mt-1">
            {agent.agentType.replace(/-/g, " ").replace(/\b\w/g, (l: string) => l.toUpperCase())}
          </p>
        </div>
        <Button onClick={() => router.push("/dashboard/ai-agents")}>
          Back to Agents
        </Button>
      </div>

      <Card className="p-6">
        <Tabs value={activeTab} onValueChange={setActiveTab}>
          <TabsList className="grid w-full grid-cols-6">
            <TabsTrigger value="settings">
              <Settings className="w-4 h-4 mr-2" />
              Settings
            </TabsTrigger>
            <TabsTrigger value="knowledge">
              <BookOpen className="w-4 h-4 mr-2" />
              Knowledge
            </TabsTrigger>
            <TabsTrigger value="integrations">
              <LinkIcon className="w-4 h-4 mr-2" />
              Integrations
            </TabsTrigger>
            <TabsTrigger value="workflows">
              <Zap className="w-4 h-4 mr-2" />
              Workflows
            </TabsTrigger>
            <TabsTrigger value="analytics">
              <BarChart3 className="w-4 h-4 mr-2" />
              Analytics
            </TabsTrigger>
            <TabsTrigger value="deploy">
              <Code className="w-4 h-4 mr-2" />
              Deploy
            </TabsTrigger>
          </TabsList>

          <TabsContent value="settings">
            <AgentSettingsTab agent={agent} />
          </TabsContent>
          
          <TabsContent value="knowledge">
            <AgentKnowledgeTab agent={agent} />
          </TabsContent>
          
          <TabsContent value="integrations">
            <AgentIntegrationsTab agent={agent} />
          </TabsContent>
          
          <TabsContent value="workflows">
            <AgentWorkflowsTab agent={agent} />
          </TabsContent>
          
          <TabsContent value="analytics">
            <AgentAnalyticsTab agent={agent} />
          </TabsContent>
          
          <TabsContent value="deploy">
            <AgentDeployTab agent={agent} />
          </TabsContent>
        </Tabs>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/agents/agents-dashboard.tsx
// ==========================================


"use client";

import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Plus, Bot, TrendingUp, MessageSquare, Users, Eye } from "lucide-react";
import Link from "next/link";
import { toast } from "react-hot-toast";

interface Agent {
  id: string;
  name: string;
  slug: string;
  agentType: string;
  status: string;
  totalConversations: number;
  totalLeadsCaptured: number;
  satisfactionRating: number | null;
  isPublic: boolean;
  createdAt: string;
}

export function AgentsDashboard({ user }: { user: any }) {
  const [agents, setAgents] = useState<Agent[]>([]);
  const [loading, setLoading] = useState(true);
  const [stats, setStats] = useState({
    total: 0,
    active: 0,
    conversations: 0,
    leads: 0,
  });

  useEffect(() => {
    fetchAgents();
  }, []);

  const fetchAgents = async () => {
    try {
      const response = await fetch("/api/agents");
      if (!response.ok) throw new Error("Failed to fetch agents");
      
      const data = await response.json();
      setAgents(data.agents);
      setStats(data.stats);
    } catch (error) {
      console.error("Error fetching agents:", error);
      toast.error("Failed to load agents");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="space-y-8">
      {/* Header */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold">AI Agent Builder</h1>
          <p className="text-muted-foreground mt-2">
            Build and deploy revenue-generating AI agents
          </p>
        </div>
        <Link href="/dashboard/ai-agents/new">
          <Button size="lg">
            <Plus className="w-4 h-4 mr-2" />
            Create Agent
          </Button>
        </Link>
      </div>

      {/* Stats Cards */}
      <div className="grid md:grid-cols-4 gap-4">
        <Card className="p-6">
          <div className="flex items-center gap-4">
            <div className="p-3 bg-blue-100 dark:bg-blue-900 rounded-lg">
              <Bot className="w-6 h-6 text-blue-600 dark:text-blue-400" />
            </div>
            <div>
              <p className="text-sm text-muted-foreground">Total Agents</p>
              <p className="text-2xl font-bold">{stats.total}</p>
            </div>
          </div>
        </Card>
        <Card className="p-6">
          <div className="flex items-center gap-4">
            <div className="p-3 bg-green-100 dark:bg-green-900 rounded-lg">
              <TrendingUp className="w-6 h-6 text-green-600 dark:text-green-400" />
            </div>
            <div>
              <p className="text-sm text-muted-foreground">Active Agents</p>
              <p className="text-2xl font-bold">{stats.active}</p>
            </div>
          </div>
        </Card>
        <Card className="p-6">
          <div className="flex items-center gap-4">
            <div className="p-3 bg-purple-100 dark:bg-purple-900 rounded-lg">
              <MessageSquare className="w-6 h-6 text-purple-600 dark:text-purple-400" />
            </div>
            <div>
              <p className="text-sm text-muted-foreground">Conversations</p>
              <p className="text-2xl font-bold">{stats.conversations}</p>
            </div>
          </div>
        </Card>
        <Card className="p-6">
          <div className="flex items-center gap-4">
            <div className="p-3 bg-orange-100 dark:bg-orange-900 rounded-lg">
              <Users className="w-6 h-6 text-orange-600 dark:text-orange-400" />
            </div>
            <div>
              <p className="text-sm text-muted-foreground">Leads Captured</p>
              <p className="text-2xl font-bold">{stats.leads}</p>
            </div>
          </div>
        </Card>
      </div>

      {/* Agents List */}
      {loading ? (
        <div className="text-center py-12">
          <p className="text-muted-foreground">Loading agents...</p>
        </div>
      ) : agents.length === 0 ? (
        <Card className="p-12 text-center">
          <Bot className="w-16 h-16 mx-auto text-muted-foreground mb-4" />
          <h3 className="text-xl font-semibold mb-2">No agents yet</h3>
          <p className="text-muted-foreground mb-6">
            Create your first AI agent to start generating revenue
          </p>
          <Link href="/dashboard/ai-agents/new">
            <Button>
              <Plus className="w-4 h-4 mr-2" />
              Create Your First Agent
            </Button>
          </Link>
        </Card>
      ) : (
        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {agents.map((agent) => (
            <Card key={agent.id} className="p-6 hover:shadow-lg transition-shadow">
              <div className="flex justify-between items-start mb-4">
                <div className="flex-1">
                  <h3 className="text-lg font-semibold mb-1">{agent.name}</h3>
                  <p className="text-sm text-muted-foreground capitalize">
                    {agent.agentType.replace(/-/g, " ")}
                  </p>
                </div>
                <span className={`px-2 py-1 text-xs rounded-full ${
                  agent.status === "active" 
                    ? "bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300"
                    : "bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"
                }`}>
                  {agent.status}
                </span>
              </div>

              <div className="space-y-2 mb-4">
                <div className="flex justify-between text-sm">
                  <span className="text-muted-foreground">Conversations</span>
                  <span className="font-medium">{agent.totalConversations}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span className="text-muted-foreground">Leads</span>
                  <span className="font-medium">{agent.totalLeadsCaptured}</span>
                </div>
                {agent.satisfactionRating && (
                  <div className="flex justify-between text-sm">
                    <span className="text-muted-foreground">Rating</span>
                    <span className="font-medium">
                      {agent.satisfactionRating.toFixed(1)} / 5.0
                    </span>
                  </div>
                )}
              </div>

              {agent.isPublic && (
                <div className="flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400 mb-4">
                  <Eye className="w-4 h-4" />
                  <span>In public gallery</span>
                </div>
              )}

              <Link href={`/dashboard/ai-agents/${agent.id}`}>
                <Button variant="outline" className="w-full">
                  Manage Agent
                </Button>
              </Link>
            </Card>
          ))}
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/agents/tabs/agent-analytics-tab.tsx
// ==========================================


"use client";

import { Card } from "@/components/ui/card";
import { MessageSquare, Users, Calendar, TrendingUp } from "lucide-react";

export function AgentAnalyticsTab({ agent }: { agent: any }) {
  return (
    <div className="space-y-6 py-6">
      <div>
        <h3 className="text-lg font-semibold mb-2">Performance Analytics</h3>
        <p className="text-muted-foreground text-sm">
          Track your agent's performance and engagement
        </p>
      </div>

      <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
        <Card className="p-6">
          <div className="flex items-center gap-3 mb-2">
            <MessageSquare className="w-5 h-5 text-blue-600" />
            <p className="text-sm text-muted-foreground">Conversations</p>
          </div>
          <p className="text-3xl font-bold">{agent.totalConversations}</p>
        </Card>

        <Card className="p-6">
          <div className="flex items-center gap-3 mb-2">
            <Users className="w-5 h-5 text-green-600" />
            <p className="text-sm text-muted-foreground">Leads Captured</p>
          </div>
          <p className="text-3xl font-bold">{agent.totalLeadsCaptured}</p>
        </Card>

        <Card className="p-6">
          <div className="flex items-center gap-3 mb-2">
            <Calendar className="w-5 h-5 text-purple-600" />
            <p className="text-sm text-muted-foreground">Appointments</p>
          </div>
          <p className="text-3xl font-bold">{agent.totalAppointments}</p>
        </Card>

        <Card className="p-6">
          <div className="flex items-center gap-3 mb-2">
            <TrendingUp className="w-5 h-5 text-orange-600" />
            <p className="text-sm text-muted-foreground">Satisfaction</p>
          </div>
          <p className="text-3xl font-bold">
            {agent.satisfactionRating ? agent.satisfactionRating.toFixed(1) : "N/A"}
          </p>
        </Card>
      </div>

      <Card className="p-6">
        <p className="text-muted-foreground">
          Detailed analytics coming soon! Track conversation trends, lead quality, peak hours, and more.
        </p>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/agents/tabs/agent-deploy-tab.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Copy, ExternalLink } from "lucide-react";
import { toast } from "react-hot-toast";

export function AgentDeployTab({ agent }: { agent: any }) {
  const embedCode = `<!-- CDM Suite AI Agent -->
<script src="https://cdn.cdmsuite.com/agent-widget.js"></script>
<script>
  CDMAgent.init({
    agentId: "${agent.id}",
    slug: "${agent.slug}"
  });
</script>`;

  const handleCopy = () => {
    navigator.clipboard.writeText(embedCode);
    toast.success("Embed code copied to clipboard!");
  };

  const widgetUrl = `https://cdmsuite.com/agents/${agent.slug}`;

  return (
    <div className="space-y-6 py-6">
      <div>
        <h3 className="text-lg font-semibold mb-2">Deploy Your Agent</h3>
        <p className="text-muted-foreground text-sm">
          Add your agent to any website with a simple embed code
        </p>
      </div>

      <Card className="p-6">
        <h4 className="font-semibold mb-3">Agent URL</h4>
        <div className="flex gap-2">
          <input
            type="text"
            value={widgetUrl}
            readOnly
            className="flex-1 px-3 py-2 border rounded-md bg-muted"
          />
          <Button variant="outline" onClick={() => {
            navigator.clipboard.writeText(widgetUrl);
            toast.success("URL copied!");
          }}>
            <Copy className="w-4 h-4" />
          </Button>
          <Button variant="outline" onClick={() => window.open(widgetUrl, "_blank")}>
            <ExternalLink className="w-4 h-4" />
          </Button>
        </div>
      </Card>

      <Card className="p-6">
        <h4 className="font-semibold mb-3">Embed Code</h4>
        <div className="relative">
          <pre className="p-4 bg-muted rounded-md overflow-x-auto text-sm">
            <code>{embedCode}</code>
          </pre>
          <Button
            variant="secondary"
            size="sm"
            className="absolute top-2 right-2"
            onClick={handleCopy}
          >
            <Copy className="w-4 h-4 mr-2" />
            Copy Code
          </Button>
        </div>
        <p className="text-sm text-muted-foreground mt-3">
          Paste this code before the closing <code>&lt;/body&gt;</code> tag on your website
        </p>
      </Card>

      <Card className="p-6 bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800">
        <h4 className="font-semibold text-blue-900 dark:text-blue-100 mb-2">
          üìö Need Help?
        </h4>
        <p className="text-sm text-blue-800 dark:text-blue-200">
          Check out our documentation for detailed setup instructions, customization options, and best practices.
        </p>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/agents/tabs/agent-integrations-tab.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Switch } from "@/components/ui/switch";
import { Calendar, Mail, Database, CreditCard, MessageSquare } from "lucide-react";
import { toast } from "react-hot-toast";

const INTEGRATIONS = [
  { id: "calendar", name: "Google Calendar", icon: Calendar, description: "Book appointments" },
  { id: "email", name: "Email", icon: Mail, description: "Send emails" },
  { id: "crm", name: "CRM", icon: Database, description: "Sync with CRM" },
  { id: "payment", name: "Stripe", icon: CreditCard, description: "Process payments" },
  { id: "slack", name: "Slack", icon: MessageSquare, description: "Send notifications" },
];

export function AgentIntegrationsTab({ agent }: { agent: any }) {
  const [integrations, setIntegrations] = useState(agent.integrationConfigs || []);

  const isEnabled = (integrationId: string) => {
    return integrations.some((i: any) => i.serviceType === integrationId && i.status === "connected");
  };

  const handleToggle = async (integrationId: string, enabled: boolean) => {
    if (enabled) {
      // Show configuration dialog
      toast.success(`${integrationId} integration is coming soon!`);
    } else {
      // Disable integration
      toast.success(`${integrationId} integration disabled`);
    }
  };

  return (
    <div className="space-y-6 py-6">
      <div>
        <h3 className="text-lg font-semibold mb-2">Third-Party Integrations</h3>
        <p className="text-muted-foreground text-sm">
          Connect external services to unlock powerful automation
        </p>
      </div>

      <div className="grid md:grid-cols-2 gap-4">
        {INTEGRATIONS.map((integration) => {
          const Icon = integration.icon;
          const enabled = isEnabled(integration.id);
          
          return (
            <Card key={integration.id} className="p-6">
              <div className="flex items-start justify-between">
                <div className="flex items-start gap-4">
                  <div className="p-3 bg-primary/10 rounded-lg">
                    <Icon className="w-6 h-6 text-primary" />
                  </div>
                  <div>
                    <h4 className="font-semibold">{integration.name}</h4>
                    <p className="text-sm text-muted-foreground mt-1">
                      {integration.description}
                    </p>
                    {enabled && (
                      <p className="text-xs text-green-600 dark:text-green-400 mt-2">
                        ‚úì Connected
                      </p>
                    )}
                  </div>
                </div>
                <Switch
                  checked={enabled}
                  onCheckedChange={(checked) => handleToggle(integration.id, checked)}
                />
              </div>
            </Card>
          );
        })}
      </div>
    </div>
  );
}

// ==========================================
// File: components/agents/tabs/agent-knowledge-tab.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { FileText, Globe, Upload, Trash2, CheckCircle, AlertCircle } from "lucide-react";
import { toast } from "react-hot-toast";

export function AgentKnowledgeTab({ agent }: { agent: any }) {
  const [knowledge, setKnowledge] = useState(agent.knowledgeSources || []);
  const [uploading, setUploading] = useState(false);

  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = e.target.files;
    if (!files || files.length === 0) return;

    setUploading(true);
    const formData = new FormData();
    
    for (let i = 0; i < files.length; i++) {
      formData.append("files", files[i]);
    }
    formData.append("agentId", agent.id);

    try {
      const response = await fetch("/api/agents/knowledge/upload", {
        method: "POST",
        body: formData,
      });

      if (!response.ok) throw new Error("Upload failed");
      
      const data = await response.json();
      setKnowledge([...knowledge, ...data.sources]);
      toast.success("Files uploaded successfully");
    } catch (error) {
      console.error("Upload error:", error);
      toast.error("Failed to upload files");
    } finally {
      setUploading(false);
    }
  };

  const handleAddWebsite = async () => {
    const url = prompt("Enter website URL to train on:");
    if (!url) return;

    try {
      const response = await fetch("/api/agents/knowledge/website", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ agentId: agent.id, websiteUrl: url }),
      });

      if (!response.ok) throw new Error("Failed to add website");
      
      const data = await response.json();
      setKnowledge([...knowledge, data.source]);
      toast.success("Website added for training");
    } catch (error) {
      console.error("Error adding website:", error);
      toast.error("Failed to add website");
    }
  };

  const handleDelete = async (sourceId: string) => {
    if (!confirm("Delete this knowledge source?")) return;

    try {
      const response = await fetch(`/api/agents/knowledge/${sourceId}`, {
        method: "DELETE",
      });

      if (!response.ok) throw new Error("Delete failed");
      
      setKnowledge(knowledge.filter((k: any) => k.id !== sourceId));
      toast.success("Knowledge source deleted");
    } catch (error) {
      console.error("Delete error:", error);
      toast.error("Failed to delete");
    }
  };

  return (
    <div className="space-y-6 py-6">
      <div>
        <h3 className="text-lg font-semibold mb-2">Training Data</h3>
        <p className="text-muted-foreground text-sm">
          Upload documents or connect websites to train your agent
        </p>
      </div>

      <div className="flex gap-4">
        <label>
          <input
            type="file"
            multiple
            accept=".pdf,.txt,.csv,.doc,.docx"
            onChange={handleFileUpload}
            className="hidden"
            disabled={uploading}
          />
          <Button variant="outline" className="cursor-pointer" disabled={uploading}>
            <Upload className="w-4 h-4 mr-2" />
            {uploading ? "Uploading..." : "Upload Documents"}
          </Button>
        </label>
        
        <Button variant="outline" onClick={handleAddWebsite}>
          <Globe className="w-4 h-4 mr-2" />
          Add Website
        </Button>
      </div>

      {knowledge.length === 0 ? (
        <Card className="p-12 text-center">
          <FileText className="w-12 h-12 mx-auto text-muted-foreground mb-4" />
          <p className="text-muted-foreground">
            No training data yet. Upload documents or add websites to get started.
          </p>
        </Card>
      ) : (
        <div className="space-y-3">
          {knowledge.map((source: any) => (
            <Card key={source.id} className="p-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  {source.sourceType === "document" ? (
                    <FileText className="w-5 h-5 text-blue-600" />
                  ) : (
                    <Globe className="w-5 h-5 text-green-600" />
                  )}
                  <div>
                    <p className="font-medium">{source.title}</p>
                    <p className="text-sm text-muted-foreground">
                      {source.sourceType === "document" && `${(source.fileSize / 1024).toFixed(0)} KB`}
                      {source.sourceType === "website" && source.websiteUrl}
                    </p>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  {source.status === "completed" && (
                    <CheckCircle className="w-5 h-5 text-green-600" />
                  )}
                  {source.status === "processing" && (
                    <AlertCircle className="w-5 h-5 text-yellow-600 animate-pulse" />
                  )}
                  {source.status === "failed" && (
                    <AlertCircle className="w-5 h-5 text-red-600" />
                  )}
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => handleDelete(source.id)}
                  >
                    <Trash2 className="w-4 h-4 text-red-600" />
                  </Button>
                </div>
              </div>
            </Card>
          ))}
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/agents/tabs/agent-settings-tab.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Switch } from "@/components/ui/switch";
import { toast } from "react-hot-toast";

export function AgentSettingsTab({ agent }: { agent: any }) {
  const [loading, setLoading] = useState(false);
  const [formData, setFormData] = useState({
    name: agent.name,
    description: agent.description || "",
    personality: agent.personality,
    tone: agent.tone,
    welcomeMessage: agent.welcomeMessage,
    widgetColor: agent.widgetColor,
    widgetPosition: agent.widgetPosition,
    status: agent.status,
    isPublic: agent.isPublic,
  });

  const handleSave = async () => {
    setLoading(true);
    try {
      const response = await fetch(`/api/agents/${agent.id}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (!response.ok) throw new Error("Failed to update agent");
      
      toast.success("Settings updated successfully");
    } catch (error) {
      console.error("Error updating agent:", error);
      toast.error("Failed to update settings");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="space-y-6 py-6">
      <div>
        <Label htmlFor="name">Agent Name</Label>
        <Input
          id="name"
          value={formData.name}
          onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
          className="mt-2"
        />
      </div>

      <div>
        <Label htmlFor="description">Description</Label>
        <Textarea
          id="description"
          value={formData.description}
          onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}
          className="mt-2"
          rows={3}
        />
      </div>

      <div className="grid md:grid-cols-2 gap-4">
        <div>
          <Label htmlFor="personality">Personality</Label>
          <Select
            value={formData.personality}
            onValueChange={(value) => setFormData(prev => ({ ...prev, personality: value }))}
          >
            <SelectTrigger className="mt-2">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="professional">Professional</SelectItem>
              <SelectItem value="friendly">Friendly</SelectItem>
              <SelectItem value="casual">Casual</SelectItem>
              <SelectItem value="technical">Technical</SelectItem>
              <SelectItem value="sales">Sales-Oriented</SelectItem>
            </SelectContent>
          </Select>
        </div>

        <div>
          <Label htmlFor="tone">Tone</Label>
          <Select
            value={formData.tone}
            onValueChange={(value) => setFormData(prev => ({ ...prev, tone: value }))}
          >
            <SelectTrigger className="mt-2">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="helpful">Helpful</SelectItem>
              <SelectItem value="direct">Direct</SelectItem>
              <SelectItem value="empathetic">Empathetic</SelectItem>
              <SelectItem value="persuasive">Persuasive</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>

      <div>
        <Label htmlFor="welcomeMessage">Welcome Message</Label>
        <Input
          id="welcomeMessage"
          value={formData.welcomeMessage}
          onChange={(e) => setFormData(prev => ({ ...prev, welcomeMessage: e.target.value }))}
          className="mt-2"
        />
      </div>

      <div className="grid md:grid-cols-2 gap-4">
        <div>
          <Label htmlFor="widgetColor">Widget Color</Label>
          <Input
            id="widgetColor"
            type="color"
            value={formData.widgetColor}
            onChange={(e) => setFormData(prev => ({ ...prev, widgetColor: e.target.value }))}
            className="mt-2 h-10"
          />
        </div>

        <div>
          <Label htmlFor="widgetPosition">Widget Position</Label>
          <Select
            value={formData.widgetPosition}
            onValueChange={(value) => setFormData(prev => ({ ...prev, widgetPosition: value }))}
          >
            <SelectTrigger className="mt-2">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="bottom-right">Bottom Right</SelectItem>
              <SelectItem value="bottom-left">Bottom Left</SelectItem>
              <SelectItem value="top-right">Top Right</SelectItem>
              <SelectItem value="top-left">Top Left</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>

      <div>
        <Label htmlFor="status">Status</Label>
        <Select
          value={formData.status}
          onValueChange={(value) => setFormData(prev => ({ ...prev, status: value }))}
        >
          <SelectTrigger className="mt-2">
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="draft">Draft</SelectItem>
            <SelectItem value="active">Active</SelectItem>
            <SelectItem value="paused">Paused</SelectItem>
            <SelectItem value="archived">Archived</SelectItem>
          </SelectContent>
        </Select>
      </div>

      <div className="flex items-center justify-between p-4 bg-muted rounded-lg">
        <div>
          <p className="font-medium">Show in Public Gallery</p>
          <p className="text-sm text-muted-foreground">
            Display this agent in the public gallery for social proof
          </p>
        </div>
        <Switch
          checked={formData.isPublic}
          onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isPublic: checked }))}
        />
      </div>

      <div className="flex justify-end pt-4 border-t">
        <Button onClick={handleSave} disabled={loading}>
          {loading ? "Saving..." : "Save Changes"}
        </Button>
      </div>
    </div>
  );
}

// ==========================================
// File: components/agents/tabs/agent-workflows-tab.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Plus, Zap } from "lucide-react";
import { toast } from "react-hot-toast";

export function AgentWorkflowsTab({ agent }: { agent: any }) {
  const [workflows, setWorkflows] = useState(agent.workflowRules || []);

  const handleCreate = () => {
    toast.success("Workflow builder coming soon!");
  };

  return (
    <div className="space-y-6 py-6">
      <div className="flex justify-between items-center">
        <div>
          <h3 className="text-lg font-semibold mb-2">Automation Workflows</h3>
          <p className="text-muted-foreground text-sm">
            Create trigger-action workflows to automate tasks
          </p>
        </div>
        <Button onClick={handleCreate}>
          <Plus className="w-4 h-4 mr-2" />
          Create Workflow
        </Button>
      </div>

      {workflows.length === 0 ? (
        <Card className="p-12 text-center">
          <Zap className="w-12 h-12 mx-auto text-muted-foreground mb-4" />
          <p className="text-muted-foreground mb-4">
            No workflows configured yet
          </p>
          <Button onClick={handleCreate}>
            <Plus className="w-4 h-4 mr-2" />
            Create Your First Workflow
          </Button>
        </Card>
      ) : (
        <div className="space-y-3">
          {workflows.map((workflow: any) => (
            <Card key={workflow.id} className="p-4">
              <h4 className="font-semibold">{workflow.name}</h4>
              <p className="text-sm text-muted-foreground mt-1">
                {workflow.description}
              </p>
            </Card>
          ))}
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/ai-chatbot.tsx
// ==========================================


'use client';

import { useState, useRef, useEffect } from 'react';
import { usePathname } from 'next/navigation';
import { X, Send, MessageCircle, Minimize2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import toast from 'react-hot-toast';

interface Message {
  role: 'user' | 'assistant';
  content: string;
}

export function AIChatbot() {
  const pathname = usePathname();
  
  // Hide chatbot on dashboard pages and generated user sites - check the path first
  const shouldHide = pathname?.startsWith('/dashboard') || pathname?.startsWith('/site/');
  
  // All hooks must be called before any conditional returns
  const [isOpen, setIsOpen] = useState(false);
  const [isMinimized, setIsMinimized] = useState(false);
  const [messages, setMessages] = useState<Message[]>([
    {
      role: 'assistant',
      content: "Hi! üëã I'm your CDM Suite assistant. I can help you find the perfect digital marketing solution for your business. What brings you here today?",
    },
  ]);
  const [inputValue, setInputValue] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [sessionId] = useState(() => `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);
  const [leadCaptured, setLeadCaptured] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const inputRef = useRef<HTMLInputElement>(null);

  // All useEffect hooks must also be before any conditional returns
  useEffect(() => {
    if (!shouldHide) {
      messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
    }
  }, [messages, shouldHide]);

  // Removed auto-open functionality - chatbot only opens when user clicks the button

  useEffect(() => {
    if (!shouldHide && isOpen && !isMinimized) {
      inputRef.current?.focus();
    }
  }, [isOpen, isMinimized, shouldHide]);

  // Now it's safe to return null - all hooks have been called
  if (shouldHide) {
    return null;
  }

  const handleSendMessage = async () => {
    if (!inputValue.trim() || isLoading) return;

    const userMessage = inputValue.trim();
    setInputValue('');
    setIsLoading(true);

    const newMessages: Message[] = [...messages, { role: 'user', content: userMessage }];
    setMessages(newMessages);

    try {
      const response = await fetch('/api/chatbot', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          messages: newMessages,
          sessionId,
          leadCaptured,
        }),
      });

      if (!response.ok) throw new Error('Failed to get response');

      const reader = response.body?.getReader();
      const decoder = new TextDecoder();
      let assistantMessage = '';

      if (reader) {
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;

          const chunk = decoder.decode(value);
          const lines = chunk.split('\n');

          for (const line of lines) {
            if (line.startsWith('data: ')) {
              const data = line.slice(6);
              if (data === '[DONE]') continue;

              try {
                const parsed = JSON.parse(data);
                if (parsed.choices?.[0]?.delta?.content) {
                  assistantMessage += parsed.choices[0].delta.content;
                  setMessages([...newMessages, { role: 'assistant', content: assistantMessage }]);
                }
                if (parsed.leadCaptured) {
                  setLeadCaptured(true);
                }
              } catch (e) {
                // Skip invalid JSON
              }
            }
          }
        }
      }
    } catch (error) {
      console.error('Chat error:', error);
      toast.error('Failed to send message. Please try again.');
      setMessages([...newMessages, { role: 'assistant', content: 'Sorry, I encountered an error. Please try again or contact us directly.' }]);
    } finally {
      setIsLoading(false);
    }
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  if (!isOpen) {
    return (
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(true)}
          className="bg-blue-600 hover:bg-blue-700 text-white rounded-full p-4 shadow-lg transition-all duration-300 hover:scale-110 relative group"
          aria-label="Open chat"
        >
          <MessageCircle className="w-6 h-6" />
          <span className="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse" />
          
          {/* Subtle greeting tooltip - shows on hover on desktop, always visible on mobile for first few seconds */}
          <div className="absolute bottom-full right-0 mb-2 bg-white text-gray-900 px-3 py-2 rounded-lg shadow-lg text-sm font-medium whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none md:block hidden">
            Hey! üëã Need help?
            <div className="absolute top-full right-4 -mt-1 border-4 border-transparent border-t-white"></div>
          </div>
        </button>
      </div>
    );
  }

  if (isMinimized) {
    return (
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsMinimized(false)}
          className="bg-blue-600 hover:bg-blue-700 text-white rounded-full p-4 shadow-lg transition-all duration-300 hover:scale-110"
          aria-label="Maximize chat"
        >
          <MessageCircle className="w-6 h-6" />
          <span className="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse" />
        </button>
      </div>
    );
  }

  return (
    <div className="fixed bottom-6 right-6 z-50 w-96 max-w-[calc(100vw-3rem)] shadow-2xl rounded-lg overflow-hidden bg-white border border-gray-200 animate-in slide-in-from-bottom-5 duration-300">
      {/* Header */}
      <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 flex items-center justify-between">
        <div className="flex items-center gap-2">
          <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse" />
          <h3 className="font-semibold">CDM Suite Assistant</h3>
        </div>
        <div className="flex items-center gap-2">
          <button
            onClick={() => setIsMinimized(true)}
            className="hover:bg-blue-600 rounded p-1 transition-colors"
            aria-label="Minimize chat"
          >
            <Minimize2 className="w-4 h-4" />
          </button>
          <button
            onClick={() => setIsOpen(false)}
            className="hover:bg-blue-600 rounded p-1 transition-colors"
            aria-label="Close chat"
          >
            <X className="w-4 h-4" />
          </button>
        </div>
      </div>

      {/* Messages */}
      <div className="h-96 overflow-y-auto p-4 space-y-4 bg-gray-50">
        {messages.map((message, index) => (
          <div
            key={index}
            className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}
          >
            <div
              className={`max-w-[80%] rounded-lg p-3 ${
                message.role === 'user'
                  ? 'bg-blue-600 text-white'
                  : 'bg-white text-gray-900 border border-gray-200 shadow-sm'
              }`}
            >
              <p className="text-sm whitespace-pre-wrap">{message.content}</p>
            </div>
          </div>
        ))}
        {isLoading && (
          <div className="flex justify-start">
            <div className="bg-white text-gray-900 border border-gray-200 rounded-lg p-3 shadow-sm">
              <div className="flex gap-1">
                <div className="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
                <div className="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
                <div className="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
              </div>
            </div>
          </div>
        )}
        <div ref={messagesEndRef} />
      </div>

      {/* Input */}
      <div className="border-t border-gray-200 p-4 bg-white">
        <div className="flex gap-2">
          <Input
            ref={inputRef}
            value={inputValue}
            onChange={(e) => setInputValue(e.target.value)}
            onKeyPress={handleKeyPress}
            placeholder="Type your message..."
            disabled={isLoading}
            className="flex-1"
          />
          <Button
            onClick={handleSendMessage}
            disabled={isLoading || !inputValue.trim()}
            className="bg-blue-600 hover:bg-blue-700"
          >
            <Send className="w-4 h-4" />
          </Button>
        </div>
        <p className="text-xs text-gray-700 font-semibold mt-2 text-center">
          Powered by AI ‚Ä¢ Available 24/7
        </p>
      </div>
    </div>
  );
}

// ==========================================
// File: components/analytics/clarity-init.tsx
// ==========================================


'use client';

import { useEffect } from 'react';

export default function ClarityInit() {
  useEffect(() => {
    const clarityId = process.env.NEXT_PUBLIC_CLARITY_PROJECT_ID;
    
    if (!clarityId) {
      // Skip initialization if credentials are missing
      return;
    }

    if (typeof window !== 'undefined') {
      // TypeScript-friendly Clarity initialization
      const w = window as any;
      const d = document;
      
      w.clarity = w.clarity || function() {
        (w.clarity.q = w.clarity.q || []).push(arguments);
      };
      
      const script = d.createElement('script');
      script.async = true;
      script.src = 'https://www.clarity.ms/tag/' + clarityId;
      
      const firstScript = d.getElementsByTagName('script')[0];
      if (firstScript && firstScript.parentNode) {
        firstScript.parentNode.insertBefore(script, firstScript);
      }
    }
  }, []);

  return null;
}

// ==========================================
// File: components/analytics/google-analytics.tsx
// ==========================================


"use client";

import Script from 'next/script';
import { useEffect } from 'react';

export default function GoogleAnalytics({ gaId }: { gaId: string }) {
  if (!gaId) return null;

  return (
    <>
      <Script
        src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}
        strategy="afterInteractive"
      />
      <Script id="google-analytics" strategy="afterInteractive">
        {`
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', '${gaId}');
        `}
      </Script>
    </>
  );
}

// ==========================================
// File: components/analytics/posthog-pageview.tsx
// ==========================================


'use client';

import { useEffect } from 'react';
import { usePathname, useSearchParams } from 'next/navigation';
import posthog from 'posthog-js';

export function PostHogPageView() {
  const pathname = usePathname();
  const searchParams = useSearchParams();

  useEffect(() => {
    const key = process.env.NEXT_PUBLIC_POSTHOG_KEY;
    
    // Skip if credentials are missing
    if (!key) {
      return;
    }

    if (pathname) {
      let url = window.origin + pathname;
      if (searchParams && searchParams.toString()) {
        url = url + '?' + searchParams.toString();
      }
      posthog.capture('$pageview', {
        $current_url: url,
      });
    }
  }, [pathname, searchParams]);

  return null;
}

// ==========================================
// File: components/analytics/posthog-provider.tsx
// ==========================================


'use client';

import posthog from 'posthog-js';
import { PostHogProvider as PHProvider } from 'posthog-js/react';
import { useEffect } from 'react';

export function PostHogProvider({ children }: { children: React.ReactNode }) {
  useEffect(() => {
    const key = process.env.NEXT_PUBLIC_POSTHOG_KEY;
    const host = process.env.NEXT_PUBLIC_POSTHOG_HOST;

    // Skip initialization if credentials are missing
    if (!key || !host) {
      return;
    }

    posthog.init(key, {
      api_host: host,
      capture_pageview: false, // We'll manually capture pageviews
      capture_pageleave: true,
      autocapture: true,
    });
  }, []);

  return <PHProvider client={posthog}>{children}</PHProvider>;
}

// ==========================================
// File: components/analytics/reddit-pixel.tsx
// ==========================================


'use client';

import { useEffect, Suspense } from 'react';
import { useSession } from 'next-auth/react';
import { usePathname, useSearchParams } from 'next/navigation';

declare global {
  interface Window {
    rdt?: (command: string, ...args: any[]) => void;
  }
}

function RedditPixelInner() {
  const { data: session } = useSession();
  const pathname = usePathname();
  const searchParams = useSearchParams();

  // Initialize Reddit Pixel
  useEffect(() => {
    const pixelId = process.env.NEXT_PUBLIC_REDDIT_PIXEL_ID;
    
    if (!pixelId) {
      // Skip initialization if pixel ID is missing
      return;
    }

    if (typeof window !== 'undefined' && !window.rdt) {
      // Initialize Reddit Pixel
      const w = window as any;
      const d = document;
      
      if (!w.rdt) {
        const p: any = (w.rdt = function () {
          p.sendEvent
            ? p.sendEvent.apply(p, arguments)
            : p.callQueue.push(arguments);
        });
        p.callQueue = [];
        
        const t = d.createElement('script');
        t.src = 'https://www.redditstatic.com/ads/pixel.js';
        t.async = true;
        
        const s = d.getElementsByTagName('script')[0];
        if (s && s.parentNode) {
          s.parentNode.insertBefore(t, s);
        }
      }

      // Initialize with or without user data
      if (session?.user?.email) {
        w.rdt('init', pixelId, {
          email: session.user.email,
          externalId: session.user.id,
        });
      } else {
        w.rdt('init', pixelId);
      }

      // Track initial page visit
      w.rdt('track', 'PageVisit');
    }
  }, []);

  // Track page views on route changes
  useEffect(() => {
    const pixelId = process.env.NEXT_PUBLIC_REDDIT_PIXEL_ID;
    
    if (!pixelId || typeof window === 'undefined' || !window.rdt) {
      return;
    }

    window.rdt('track', 'PageVisit');
  }, [pathname, searchParams]);

  // Update user identity when session changes
  useEffect(() => {
    const pixelId = process.env.NEXT_PUBLIC_REDDIT_PIXEL_ID;
    
    if (!pixelId || typeof window === 'undefined' || !window.rdt) {
      return;
    }

    if (session?.user?.email) {
      // Re-initialize with user data
      window.rdt('init', pixelId, {
        email: session.user.email,
        externalId: session.user.id,
      });
    }
  }, [session]);

  return null;
}

export default function RedditPixel() {
  return (
    <Suspense fallback={null}>
      <RedditPixelInner />
    </Suspense>
  );
}

// ==========================================
// File: components/assistant/ai-assistant-button.tsx
// ==========================================


"use client";

import { useState } from "react";
import { usePathname } from "next/navigation";
import { Button } from "@/components/ui/button";
import { MessageSquare, X, Sparkles } from "lucide-react";
import { AIAssistantChat } from "./ai-assistant-chat";
import { cn } from "@/lib/utils";

interface AIAssistantButtonProps {
  user: any;
}

export function AIAssistantButton({ user }: AIAssistantButtonProps) {
  const [isOpen, setIsOpen] = useState(false);
  const pathname = usePathname();
  
  // Only show the AI assistant on dashboard pages
  const shouldShow = pathname?.startsWith('/dashboard');
  
  if (!shouldShow) {
    return null;
  }

  return (
    <>
      {/* Floating button */}
      <div className="fixed bottom-6 right-6 z-50">
        {!isOpen && (
          <Button
            onClick={() => setIsOpen(true)}
            size="lg"
            className="h-12 w-12 rounded-full shadow-2xl bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 transition-all hover:scale-110"
          >
            <Sparkles className="w-5 h-5" />
          </Button>
        )}
      </div>

      {/* Chat window */}
      {isOpen && (
        <div className="fixed bottom-6 right-6 z-50 w-96 max-w-[calc(100vw-3rem)] h-[600px] max-h-[calc(100vh-8rem)]">
          <div className="bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col h-full overflow-hidden">
            {/* Header */}
            <div className="bg-gradient-to-r from-blue-600 to-purple-600 p-4 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                  <Sparkles className="w-5 h-5 text-white" />
                </div>
                <div>
                  <h3 className="font-semibold text-white">AI Assistant</h3>
                  <p className="text-xs text-blue-100">
                    {user.tier === "free"
                      ? `${10 - (user.dailyMessageCount || 0)} free messages today`
                      : "Unlimited messages"}
                  </p>
                </div>
              </div>
              <Button
                size="sm"
                variant="ghost"
                className="text-white hover:bg-white/20"
                onClick={() => setIsOpen(false)}
              >
                <X className="w-5 h-5" />
              </Button>
            </div>

            {/* Chat content */}
            <AIAssistantChat user={user} />
          </div>
        </div>
      )}
    </>
  );
}

// ==========================================
// File: components/assistant/ai-assistant-chat.tsx
// ==========================================


"use client";

import { useState, useRef, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Send, Loader2, Sparkles, AlertCircle, Zap } from "lucide-react";
import { cn } from "@/lib/utils";
import Link from "next/link";

interface Message {
  role: "user" | "assistant";
  content: string;
}

interface AIAssistantChatProps {
  user: any;
}

export function AIAssistantChat({ user }: AIAssistantChatProps) {
  const isFreeTier = user.tier === "free";
  const [messages, setMessages] = useState<Message[]>([
    {
      role: "assistant",
      content: `Hi ${user.name?.split(" ")[0] || "there"}! üëã I'm your AI business assistant. I can help you build websites, create marketing strategies, analyze your performance, and grow your business. What would you like to work on today?`,
    },
  ]);
  const [input, setInput] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [conversationId, setConversationId] = useState<string | null>(null);
  const [messagesRemaining, setMessagesRemaining] = useState<number | null>(
    isFreeTier ? 10 - (user.dailyMessageCount || 0) : null
  );
  const [limitReached, setLimitReached] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const inputRef = useRef<HTMLInputElement>(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const handleSend = async () => {
    if (!input.trim() || isLoading || limitReached) return;

    const userMessage = input.trim();
    setInput("");
    setMessages((prev) => [...prev, { role: "user", content: userMessage }]);
    setIsLoading(true);

    try {
      const response = await fetch("/api/assistant/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          message: userMessage,
          conversationId,
        }),
      });

      if (!response.ok) {
        const error = await response.json();
        
        // Check if daily limit reached
        if (response.status === 403 && error.message?.includes("daily limit")) {
          setLimitReached(true);
          setMessagesRemaining(0);
          setMessages((prev) => [
            ...prev,
            {
              role: "assistant",
              content: error.message,
            },
          ]);
          return;
        }
        
        throw new Error(error.error || "Failed to send message");
      }

      const reader = response.body?.getReader();
      const decoder = new TextDecoder();
      let assistantMessage = "";

      // Add empty assistant message to start streaming
      setMessages((prev) => [...prev, { role: "assistant", content: "" }]);

      while (true) {
        const { done, value } = await reader!.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split("\n");

        for (const line of lines) {
          if (line.startsWith("data: ")) {
            const data = line.slice(6);
            try {
              const parsed = JSON.parse(data);
              if (parsed.type === "content") {
                assistantMessage += parsed.content;
                setMessages((prev) => {
                  const newMessages = [...prev];
                  newMessages[newMessages.length - 1].content =
                    assistantMessage;
                  return newMessages;
                });
              } else if (parsed.type === "done") {
                setConversationId(parsed.conversationId);
                // Update remaining messages for free tier
                if (parsed.remaining !== null && parsed.remaining !== undefined) {
                  setMessagesRemaining(parsed.remaining);
                }
              }
            } catch (e) {
              // Skip invalid JSON
            }
          }
        }
      }
    } catch (error: any) {
      console.error("Chat error:", error);
      setMessages((prev) => [
        ...prev,
        {
          role: "assistant",
          content:
            error.message || "Sorry, I encountered an error. Please try again.",
        },
      ]);
    } finally {
      setIsLoading(false);
      inputRef.current?.focus();
    }
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  return (
    <>
      {/* Messages */}
      <div className="flex-1 overflow-y-auto p-4 space-y-4">
        {messages.map((message, index) => (
          <div
            key={index}
            className={cn(
              "flex gap-3",
              message.role === "user" ? "justify-end" : "justify-start"
            )}
          >
            {message.role === "assistant" && (
              <div className="w-8 h-8 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0">
                <Sparkles className="w-4 h-4 text-white" />
              </div>
            )}
            <div
              className={cn(
                "rounded-2xl px-4 py-2 max-w-[80%]",
                message.role === "user"
                  ? "bg-blue-600 text-white rounded-br-none"
                  : "bg-gray-100 text-gray-900 rounded-bl-none"
              )}
            >
              <p className="text-sm whitespace-pre-wrap">{message.content}</p>
            </div>
            {message.role === "user" && (
              <div className="w-8 h-8 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-semibold text-sm flex-shrink-0">
                {user.name?.[0]?.toUpperCase() || "U"}
              </div>
            )}
          </div>
        ))}
        {isLoading && (
          <div className="flex gap-3 justify-start">
            <div className="w-8 h-8 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center flex-shrink-0">
              <Sparkles className="w-4 h-4 text-white" />
            </div>
            <div className="bg-gray-100 rounded-2xl rounded-bl-none px-4 py-3">
              <Loader2 className="w-4 h-4 animate-spin text-gray-600" />
            </div>
          </div>
        )}
        <div ref={messagesEndRef} />
      </div>

      {/* Input */}
      <div className="p-4 border-t border-gray-200">
        {limitReached ? (
          <div className="space-y-3">
            <div className="flex items-start gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg">
              <AlertCircle className="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" />
              <div className="flex-1">
                <p className="text-sm font-medium text-amber-900">
                  Daily limit reached
                </p>
                <p className="text-xs text-amber-700 mt-1">
                  You've used all 10 free messages today. Come back tomorrow or upgrade for unlimited access!
                </p>
              </div>
            </div>
            <Link href="/dashboard/upgrade">
              <Button className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700">
                <Zap className="w-4 h-4 mr-2" />
                Upgrade for Unlimited AI Assistant
              </Button>
            </Link>
          </div>
        ) : (
          <>
            <div className="flex gap-2">
              <Input
                ref={inputRef}
                value={input}
                onChange={(e) => setInput(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Ask me anything..."
                disabled={isLoading}
                className="flex-1"
              />
              <Button
                onClick={handleSend}
                disabled={!input.trim() || isLoading}
                size="icon"
                className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700"
              >
                {isLoading ? (
                  <Loader2 className="w-4 h-4 animate-spin" />
                ) : (
                  <Send className="w-4 h-4" />
                )}
              </Button>
            </div>
            <div className="mt-2 text-center">
              {isFreeTier ? (
                <p className="text-xs text-muted-foreground">
                  {messagesRemaining !== null && messagesRemaining > 0 ? (
                    <>
                      <span className="font-medium text-amber-600">
                        {messagesRemaining} free {messagesRemaining === 1 ? "message" : "messages"}
                      </span>{" "}
                      remaining today ‚Ä¢{" "}
                      <Link
                        href="/dashboard/upgrade"
                        className="text-blue-600 hover:underline font-medium"
                      >
                        Upgrade for unlimited
                      </Link>
                    </>
                  ) : (
                    <>
                      10 free messages per day ‚Ä¢{" "}
                      <Link
                        href="/dashboard/upgrade"
                        className="text-blue-600 hover:underline font-medium"
                      >
                        Upgrade for unlimited
                      </Link>
                    </>
                  )}
                </p>
              ) : (
                <p className="text-xs text-muted-foreground">
                  ‚ú® Unlimited AI assistant ‚Ä¢ {user.credits} project credits remaining
                </p>
              )}
            </div>
          </>
        )}
      </div>
    </>
  );
}

// ==========================================
// File: components/auditor/auditor-client-backup.tsx
// ==========================================



'use client';

import { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useSession } from 'next-auth/react';
import { 
  Search, 
  CheckCircle2, 
  XCircle, 
  AlertCircle, 
  TrendingUp, 
  Smartphone, 
  Shield, 
  Zap,
  Target,
  Mail,
  Building2,
  Globe,
  ArrowRight,
  Award,
  BarChart3,
  RefreshCw,
  LogIn,
  UserPlus,
  Save,
  Sparkles
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { toast } from 'react-hot-toast';
import Link from 'next/link';

interface AuditResult {
  overall_score: number;
  seo_score: number;
  performance_score: number;
  mobile_score: number;
  security_score: number;
  findings: {
    critical: string[];
    warnings: string[];
    good: string[];
  };
  recommendations: {
    category: string;
    priority: 'high' | 'medium' | 'low';
    issue: string;
    solution: string;
    estimatedImpact: string;
  }[];
  suggestedServices: {
    name: string;
    reason: string;
    price: string;
    slug: string;
  }[];
}

export default function AuditorClient() {
  const { data: session, status } = useSession();
  const isAuthenticated = status === "authenticated";
  const [step, setStep] = useState<'input' | 'analyzing' | 'results'>('input');
  const [formData, setFormData] = useState({
    websiteUrl: '',
    email: '',
    name: '',
    company: '',
    goals: [] as string[],
  });
  const [auditResult, setAuditResult] = useState<AuditResult | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  // Pre-fill email if user is logged in
  useEffect(() => {
    if (isAuthenticated && session?.user?.email) {
      setFormData(prev => ({
        ...prev,
        email: session.user?.email || '',
        name: session.user?.name || ''
      }));
    }
  }, [isAuthenticated, session]);

  const goals = [
    { id: 'increase-traffic', label: 'Increase Website Traffic', icon: TrendingUp },
    { id: 'improve-seo', label: 'Improve SEO Ranking', icon: Search },
    { id: 'generate-leads', label: 'Generate More Leads', icon: Target },
    { id: 'boost-sales', label: 'Boost Online Sales', icon: BarChart3 },
    { id: 'mobile-optimization', label: 'Mobile Optimization', icon: Smartphone },
    { id: 'faster-loading', label: 'Faster Load Times', icon: Zap },
  ];

  const handleGoalToggle = (goalId: string) => {
    setFormData(prev => ({
      ...prev,
      goals: prev.goals.includes(goalId)
        ? prev.goals.filter(g => g !== goalId)
        : [...prev.goals, goalId]
    }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!formData.websiteUrl || !formData.email) {
      toast.error('Please fill in all required fields');
      return;
    }

    setIsLoading(true);
    setStep('analyzing');

    try {
      const response = await fetch('/api/auditor/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ...formData,
          userId: session?.user?.id,
          isAuthenticated
        }),
      });

      if (!response.ok) throw new Error('Audit failed');

      const result = await response.json();
      setAuditResult(result.audit);
      setStep('results');
      
      if (isAuthenticated) {
        toast.success('Audit complete! Results saved to your dashboard.');
      } else {
        toast.success('Audit complete! Check your email for the full report.');
      }
    } catch (error) {
      console.error('Audit error:', error);
      toast.error('Failed to complete audit. Please try again.');
      setStep('input');
    } finally {
      setIsLoading(false);
    }
  };

  const getScoreColor = (score: number) => {
    if (score >= 80) return 'text-green-600';
    if (score >= 60) return 'text-yellow-600';
    return 'text-red-600';
  };

  const getScoreLabel = (score: number) => {
    if (score >= 80) return 'Excellent';
    if (score >= 60) return 'Good';
    if (score >= 40) return 'Needs Improvement';
    return 'Critical';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50">
      {/* Hero Section */}
      <section className="pt-24 pb-12 px-4 relative overflow-hidden">
        <div className="absolute inset-0 bg-grid-slate-100 [mask-image:linear-gradient(0deg,white,rgba(255,255,255,0.6))] -z-10" />
        
        <div className="max-w-6xl mx-auto text-center">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
          >
            <Badge className="mb-4 bg-blue-100 text-blue-700 hover:bg-blue-200">
              <Award className="w-3 h-3 mr-1" />
              Free Website Audit Tool
            </Badge>
            
            <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-slate-900 via-blue-800 to-slate-900">
              Discover What's Holding Your
              <br />
              <span className="text-blue-600">Website Back</span>
            </h1>
            
            <p className="text-xl text-slate-600 mb-8 max-w-3xl mx-auto">
              Get a complete analysis of your website's SEO, performance, mobile experience, and security. 
              Receive actionable insights in minutes‚Äîabsolutely free.
            </p>

            {/* Authentication Status Banner */}
            {isAuthenticated ? (
              <div className="inline-flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-full mb-8">
                <CheckCircle2 className="w-5 h-5 text-green-600" />
                <span className="text-green-800 font-medium">
                  Logged in as {session?.user?.name || session?.user?.email} ‚Ä¢ Results will be saved to your dashboard
                </span>
              </div>
            ) : (
              <div className="inline-flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-200 rounded-full mb-8">
                <Sparkles className="w-5 h-5 text-blue-600" />
                <span className="text-blue-800 font-medium">
                  <Link href="/auth/login?redirect=auditor" className="hover:underline font-semibold">
                    Log in
                  </Link>
                  {' '}or{' '}
                  <Link href="/auth/signup" className="hover:underline font-semibold">
                    sign up
                  </Link>
                  {' '}to save your audit results
                </span>
              </div>
            )}

            <div className="flex flex-wrap justify-center gap-6 mb-12">
              {[
                { icon: Search, label: 'SEO Analysis' },
                { icon: Zap, label: 'Performance Check' },
                { icon: Smartphone, label: 'Mobile-Friendly' },
                { icon: Shield, label: 'Security Scan' },
              ].map((item, index) => (
                <div key={index} className="flex items-center gap-2 text-slate-700">
                  <item.icon className="w-5 h-5 text-blue-600" />
                  <span className="font-medium">{item.label}</span>
                </div>
              ))}
            </div>
          </motion.div>
        </div>
      </section>

      {/* Main Content */}
      <section className="pb-24 px-4">
        <div className="max-w-4xl mx-auto">
          <AnimatePresence mode="wait">
            {step === 'input' && (
              <motion.div
                key="input"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -20 }}
              >
                <Card className="shadow-xl border-0 bg-white/80 backdrop-blur">
                  <CardHeader className="text-center pb-8">
                    <CardTitle className="text-2xl">Start Your Free Website Audit</CardTitle>
                    <CardDescription className="text-base">
                      No credit card required. Results delivered instantly.
                    </CardDescription>
                  </CardHeader>
                  
                  <CardContent>
                    <form onSubmit={handleSubmit} className="space-y-6">
                      {/* Website URL */}
                      <div className="space-y-2">
                        <Label htmlFor="websiteUrl" className="text-base font-semibold">
                          Website URL <span className="text-red-500">*</span>
                        </Label>
                        <div className="relative">
                          <Globe className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                          <Input
                            id="websiteUrl"
                            type="url"
                            placeholder="https://yourwebsite.com"
                            value={formData.websiteUrl}
                            onChange={(e) => setFormData(prev => ({ ...prev, websiteUrl: e.target.value }))}
                            className="pl-11 h-12 text-base"
                            required
                          />
                        </div>
                      </div>

                      {/* Email & Name */}
                      <div className="grid md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label htmlFor="email" className="text-base font-semibold">
                            Email Address <span className="text-red-500">*</span>
                          </Label>
                          <div className="relative">
                            <Mail className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                            <Input
                              id="email"
                              type="email"
                              placeholder="you@company.com"
                              value={formData.email}
                              onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}
                              className="pl-11 h-12"
                              required
                              disabled={isAuthenticated}
                            />
                          </div>
                        </div>

                        <div className="space-y-2">
                          <Label htmlFor="name" className="text-base font-semibold">
                            Full Name
                          </Label>
                          <Input
                            id="name"
                            type="text"
                            placeholder="John Smith"
                            value={formData.name}
                            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                            className="h-12"
                          />
                        </div>
                      </div>

                      {/* Company */}
                      <div className="space-y-2">
                        <Label htmlFor="company" className="text-base font-semibold">
                          Company Name
                        </Label>
                        <div className="relative">
                          <Building2 className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                          <Input
                            id="company"
                            type="text"
                            placeholder="Your Company"
                            value={formData.company}
                            onChange={(e) => setFormData(prev => ({ ...prev, company: e.target.value }))}
                            className="pl-11 h-12"
                          />
                        </div>
                      </div>

                      {/* Goals */}
                      <div className="space-y-3">
                        <Label className="text-base font-semibold">
                          What are your main goals? (Select all that apply)
                        </Label>
                        <div className="grid sm:grid-cols-2 gap-3">
                          {goals.map((goal) => (
                            <button
                              key={goal.id}
                              type="button"
                              onClick={() => handleGoalToggle(goal.id)}
                              className={`flex items-center gap-3 p-4 rounded-lg border-2 transition-all ${
                                formData.goals.includes(goal.id)
                                  ? 'border-blue-600 bg-blue-50'
                                  : 'border-slate-200 hover:border-slate-300 bg-white'
                              }`}
                            >
                              <goal.icon className={`w-5 h-5 ${
                                formData.goals.includes(goal.id) ? 'text-blue-600' : 'text-slate-400'
                              }`} />
                              <span className={`text-sm font-medium ${
                                formData.goals.includes(goal.id) ? 'text-blue-900' : 'text-slate-700'
                              }`}>
                                {goal.label}
                              </span>
                            </button>
                          ))}
                        </div>
                      </div>

                      <Button 
                        type="submit" 
                        size="lg" 
                        className="w-full h-14 text-lg font-semibold bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800"
                        disabled={isLoading}
                      >
                        {isLoading ? (
                          <>
                            <RefreshCw className="w-5 h-5 mr-2 animate-spin" />
                            Analyzing...
                          </>
                        ) : (
                          <>
                            Get My Free Audit
                            <ArrowRight className="w-5 h-5 ml-2" />
                          </>
                        )}
                      </Button>

                      <p className="text-xs text-center text-slate-500">
                        By submitting this form, you agree to receive marketing communications from CDM Suite.
                        You can unsubscribe at any time.
                      </p>
                    </form>
                  </CardContent>
                </Card>
              </motion.div>
            )}

            {step === 'analyzing' && (
              <motion.div
                key="analyzing"
                initial={{ opacity: 0, scale: 0.95 }}
                animate={{ opacity: 1, scale: 1 }}
                exit={{ opacity: 0, scale: 0.95 }}
              >
                <Card className="shadow-xl border-0 bg-white/80 backdrop-blur">
                  <CardContent className="py-16">
                    <div className="text-center space-y-6">
                      <div className="relative w-24 h-24 mx-auto">
                        <div className="absolute inset-0 bg-blue-600 rounded-full animate-ping opacity-20"></div>
                        <div className="relative w-24 h-24 bg-gradient-to-br from-blue-600 to-blue-700 rounded-full flex items-center justify-center">
                          <Search className="w-12 h-12 text-white animate-pulse" />
                        </div>
                      </div>
                      
                      <div>
                        <h3 className="text-2xl font-bold mb-2">Analyzing Your Website...</h3>
                        <p className="text-slate-600">This will only take a moment</p>
                      </div>

                      <div className="max-w-md mx-auto space-y-3">
                        {[
                          'Checking SEO optimization',
                          'Testing page speed & performance',
                          'Analyzing mobile responsiveness',
                          'Scanning security vulnerabilities',
                          'Generating recommendations',
                        ].map((text, index) => (
                          <motion.div
                            key={index}
                            initial={{ opacity: 0, x: -20 }}
                            animate={{ opacity: 1, x: 0 }}
                            transition={{ delay: index * 0.3 }}
                            className="flex items-center gap-3 text-left"
                          >
                            <CheckCircle2 className="w-5 h-5 text-green-600 flex-shrink-0" />
                            <span className="text-slate-700">{text}</span>
                          </motion.div>
                        ))}
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </motion.div>
            )}

            {step === 'results' && auditResult && (
              <motion.div
                key="results"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                className="space-y-6"
              >
                {/* Save Results CTA - Only show if not authenticated */}
                {!isAuthenticated && (
                  <Card className="shadow-xl border-2 border-blue-400 bg-gradient-to-r from-blue-50 to-purple-50">
                    <CardContent className="py-6">
                      <div className="flex flex-col md:flex-row items-center justify-between gap-4">
                        <div className="flex items-start gap-4">
                          <div className="w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center flex-shrink-0">
                            <Save className="w-6 h-6 text-white" />
                          </div>
                          <div>
                            <h3 className="font-bold text-xl text-gray-900 mb-1">
                              Save Your Audit Results
                            </h3>
                            <p className="text-gray-600 text-sm">
                              Create a free account to track your progress over time and access personalized recommendations
                            </p>
                          </div>
                        </div>
                        <div className="flex gap-3 flex-shrink-0">
                          <Link href="/auth/login?redirect=auditor&audit=true">
                            <Button variant="outline" className="gap-2">
                              <LogIn className="w-4 h-4" />
                              Log In
                            </Button>
                          </Link>
                          <Link href="/auth/signup">
                            <Button className="bg-gradient-to-r from-blue-600 to-blue-700 gap-2">
                              <UserPlus className="w-4 h-4" />
                              Sign Up Free
                            </Button>
                          </Link>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* Overall Score */}
                <Card className="shadow-xl border-0 bg-gradient-to-br from-blue-600 to-blue-700 text-white">
                  <CardContent className="pt-8 pb-8">
                    <div className="text-center">
                      <h2 className="text-2xl font-bold mb-2">Your Website Score</h2>
                      <div className="relative w-40 h-40 mx-auto mb-4">
                        <svg className="w-full h-full transform -rotate-90">
                          <circle
                            cx="80"
                            cy="80"
                            r="70"
                            stroke="rgba(255,255,255,0.2)"
                            strokeWidth="12"
                            fill="none"
                          />
                          <circle
                            cx="80"
                            cy="80"
                            r="70"
                            stroke="white"
                            strokeWidth="12"
                            fill="none"
                            strokeDasharray={`${2 * Math.PI * 70}`}
                            strokeDashoffset={`${2 * Math.PI * 70 * (1 - auditResult.overall_score / 100)}`}
                            strokeLinecap="round"
                          />
                        </svg>
                        <div className="absolute inset-0 flex items-center justify-center">
                          <div>
                            <div className="text-5xl font-bold">{auditResult.overall_score}</div>
                            <div className="text-sm opacity-90">out of 100</div>
                          </div>
                        </div>
                      </div>
                      <p className="text-xl opacity-90">
                        {getScoreLabel(auditResult.overall_score)}
                      </p>
                    </div>
                  </CardContent>
                </Card>

                {/* Category Scores */}
                <Card className="shadow-xl border-0">
                  <CardHeader>
                    <CardTitle>Detailed Breakdown</CardTitle>
                    <CardDescription>See how your website performs in each category</CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-6">
                    {[
                      { label: 'SEO Optimization', score: auditResult.seo_score, icon: Search },
                      { label: 'Performance & Speed', score: auditResult.performance_score, icon: Zap },
                      { label: 'Mobile Experience', score: auditResult.mobile_score, icon: Smartphone },
                      { label: 'Security', score: auditResult.security_score, icon: Shield },
                    ].map((category, index) => (
                      <div key={index} className="space-y-2">
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <category.icon className="w-5 h-5 text-slate-600" />
                            <span className="font-medium">{category.label}</span>
                          </div>
                          <span className={`text-2xl font-bold ${getScoreColor(category.score)}`}>
                            {category.score}
                          </span>
                        </div>
                        <Progress value={category.score} className="h-3" />
                      </div>
                    ))}
                  </CardContent>
                </Card>

                {/* Findings */}
                <Card className="shadow-xl border-0">
                  <CardHeader>
                    <CardTitle>Key Findings</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <Tabs defaultValue="critical" className="w-full">
                      <TabsList className="grid w-full grid-cols-3">
                        <TabsTrigger value="critical" className="gap-2">
                          <XCircle className="w-4 h-4" />
                          Critical ({auditResult.findings.critical.length})
                        </TabsTrigger>
                        <TabsTrigger value="warnings" className="gap-2">
                          <AlertCircle className="w-4 h-4" />
                          Warnings ({auditResult.findings.warnings.length})
                        </TabsTrigger>
                        <TabsTrigger value="good" className="gap-2">
                          <CheckCircle2 className="w-4 h-4" />
                          Good ({auditResult.findings.good.length})
                        </TabsTrigger>
                      </TabsList>
                      
                      <TabsContent value="critical" className="space-y-3 mt-4">
                        {auditResult.findings.critical.map((finding, index) => (
                          <div key={index} className="flex gap-3 p-4 bg-red-50 rounded-lg border border-red-200">
                            <XCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
                            <p className="text-sm text-slate-700">{finding}</p>
                          </div>
                        ))}
                      </TabsContent>
                      
                      <TabsContent value="warnings" className="space-y-3 mt-4">
                        {auditResult.findings.warnings.map((finding, index) => (
                          <div key={index} className="flex gap-3 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <AlertCircle className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" />
                            <p className="text-sm text-slate-700">{finding}</p>
                          </div>
                        ))}
                      </TabsContent>
                      
                      <TabsContent value="good" className="space-y-3 mt-4">
                        {auditResult.findings.good.map((finding, index) => (
                          <div key={index} className="flex gap-3 p-4 bg-green-50 rounded-lg border border-green-200">
                            <CheckCircle2 className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                            <p className="text-sm text-slate-700">{finding}</p>
                          </div>
                        ))}
                      </TabsContent>
                    </Tabs>
                  </CardContent>
                </Card>

                {/* Recommendations with Service Upsells */}
                <Card className="shadow-xl border-0">
                  <CardHeader>
                    <CardTitle>Personalized Recommendations</CardTitle>
                    <CardDescription>Action items to improve your website performance</CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    {auditResult.recommendations.map((rec, index) => (
                      <div key={index} className="p-5 rounded-lg border-2 border-slate-200 hover:border-blue-300 transition-colors">
                        <div className="flex items-start justify-between mb-3">
                          <div className="flex items-center gap-2">
                            <Badge variant={
                              rec.priority === 'high' ? 'destructive' :
                              rec.priority === 'medium' ? 'default' :
                              'secondary'
                            }>
                              {rec.priority} priority
                            </Badge>
                            <span className="text-sm font-medium text-slate-600">{rec.category}</span>
                          </div>
                          <Badge variant="outline" className="text-green-700 border-green-300">
                            {rec.estimatedImpact} impact
                          </Badge>
                        </div>
                        <h4 className="font-semibold text-lg mb-2">{rec.issue}</h4>
                        <p className="text-slate-600 mb-3">{rec.solution}</p>
                      </div>
                    ))}
                  </CardContent>
                </Card>

                {/* Suggested Services */}
                {auditResult.suggestedServices.length > 0 && (
                  <Card className="shadow-xl border-0 bg-gradient-to-br from-slate-50 to-blue-50">
                    <CardHeader className="text-center">
                      <CardTitle className="text-2xl">Ready to Take Action?</CardTitle>
                      <CardDescription className="text-base">
                        Based on your audit, here are our recommended services to help you improve
                      </CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="grid md:grid-cols-2 gap-4">
                        {auditResult.suggestedServices.map((service, index) => (
                          <div key={index} className="p-6 bg-white rounded-xl border-2 border-slate-200 hover:border-blue-400 transition-all hover:shadow-lg">
                            <h4 className="font-bold text-xl mb-2">{service.name}</h4>
                            <p className="text-slate-600 text-sm mb-4">{service.reason}</p>
                            <div className="flex items-center justify-between">
                              <span className="text-2xl font-bold text-blue-600">{service.price}</span>
                              <Button asChild size="sm">
                                <a href={`/services/${service.slug}`}>
                                  Learn More
                                  <ArrowRight className="w-4 h-4 ml-2" />
                                </a>
                              </Button>
                            </div>
                          </div>
                        ))}
                      </div>

                      <div className="mt-8 text-center">
                        <Button size="lg" asChild className="bg-gradient-to-r from-blue-600 to-blue-700">
                          <a href="/contact">
                            Schedule a Free Consultation
                            <ArrowRight className="w-5 h-5 ml-2" />
                          </a>
                        </Button>
                        <p className="text-sm text-slate-600 mt-4">
                          Want to discuss these results? Our experts are ready to help.
                        </p>
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* Email Confirmation */}
                <div className="text-center py-6">
                  <div className="inline-flex items-center gap-2 px-6 py-3 bg-green-50 border border-green-200 rounded-full">
                    <Mail className="w-5 h-5 text-green-600" />
                    <span className="text-green-800 font-medium">
                      Full report sent to {formData.email}
                    </span>
                  </div>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      </section>
    </div>
  );
}

// ==========================================
// File: components/auditor/auditor-client.tsx
// ==========================================

'use client';

import { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useSession } from 'next-auth/react';
import { 
  Search, 
  CheckCircle2, 
  XCircle, 
  AlertCircle, 
  TrendingUp, 
  Smartphone, 
  Shield, 
  Zap,
  Target,
  Mail,
  Building2,
  Globe,
  ArrowRight,
  Award,
  BarChart3,
  RefreshCw,
  Phone,
  Sparkles,
  ExternalLink
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { toast } from 'react-hot-toast';
import Link from 'next/link';
import TripwireFunnel from './tripwire-funnel';
import LoadingAnimation from '../loading-animation';

interface AuditResult {
  overall_score: number;
  seo_score: number;
  performance_score: number;
  mobile_score: number;
  security_score: number;
  findings: {
    critical: string[];
    warnings: string[];
    good: string[];
  };
  recommendations: {
    category: string;
    priority: 'high' | 'medium' | 'low';
    issue: string;
    solution: string;
    estimatedImpact: string;
  }[];
  suggestedServices: {
    name: string;
    reason: string;
    price: string;
    slug: string;
  }[];
}

export default function AuditorClient() {
  const { data: session, status } = useSession();
  const isAuthenticated = status === "authenticated";
  const [step, setStep] = useState<'input' | 'analyzing' | 'tripwire' | 'results'>('input');
  const [formData, setFormData] = useState({
    websiteUrl: '',
    email: '',
    name: '',
    phone: '',
    company: '',
    goals: [] as string[],
  });
  const [auditResult, setAuditResult] = useState<AuditResult | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  // Pre-fill email if user is logged in
  useEffect(() => {
    if (isAuthenticated && session?.user?.email) {
      setFormData(prev => ({
        ...prev,
        email: session.user?.email || '',
        name: session.user?.name || ''
      }));
    }
  }, [isAuthenticated, session]);

  const goals = [
    { id: 'increase-traffic', label: 'Increase Website Traffic', icon: TrendingUp },
    { id: 'improve-seo', label: 'Improve SEO Ranking', icon: Search },
    { id: 'generate-leads', label: 'Generate More Leads', icon: Target },
    { id: 'boost-sales', label: 'Boost Online Sales', icon: BarChart3 },
    { id: 'mobile-optimization', label: 'Mobile Optimization', icon: Smartphone },
    { id: 'faster-loading', label: 'Faster Load Times', icon: Zap },
  ];

  const handleGoalToggle = (goalId: string) => {
    setFormData(prev => ({
      ...prev,
      goals: prev.goals.includes(goalId)
        ? prev.goals.filter(g => g !== goalId)
        : [...prev.goals, goalId]
    }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!formData.websiteUrl || !formData.email) {
      toast.error('Please fill in all required fields');
      return;
    }

    setIsLoading(true);
    setStep('analyzing');

    try {
      const response = await fetch('/api/auditor/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ...formData,
          userId: session?.user?.id,
          isAuthenticated
        }),
      });

      if (!response.ok) throw new Error('Audit failed');

      const result = await response.json();
      setAuditResult(result.audit);
      
      // Show tripwire funnel before showing results
      setStep('tripwire');
      
      toast.success('Audit complete! Check your email for the full report.');
    } catch (error) {
      console.error('Audit error:', error);
      toast.error('Failed to complete audit. Please try again.');
      setStep('input');
    } finally {
      setIsLoading(false);
    }
  };

  const getScoreColor = (score: number) => {
    if (score >= 80) return 'text-green-600';
    if (score >= 60) return 'text-yellow-600';
    return 'text-red-600';
  };

  const getScoreBg = (score: number) => {
    if (score >= 80) return 'bg-green-50 border-green-200';
    if (score >= 60) return 'bg-yellow-50 border-yellow-200';
    return 'bg-red-50 border-red-200';
  };

  const getScoreLabel = (score: number) => {
    if (score >= 80) return 'Excellent';
    if (score >= 60) return 'Good';
    if (score >= 40) return 'Needs Improvement';
    return 'Critical';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50">
      {/* Hero Section */}
      <section className="pt-20 md:pt-24 pb-8 md:pb-12 px-4 relative overflow-hidden">
        <div className="absolute inset-0 bg-grid-slate-100 [mask-image:linear-gradient(0deg,white,rgba(255,255,255,0.6))] -z-10" />
        
        <div className="max-w-6xl mx-auto text-center">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
          >
            <Badge className="mb-4 bg-blue-100 text-blue-700 hover:bg-blue-200 text-xs md:text-sm">
              <Award className="w-3 h-3 md:w-4 md:h-4 mr-1" />
              Free Website Audit Tool
            </Badge>
            
            <h1 className="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-4 md:mb-6 bg-clip-text text-transparent bg-gradient-to-r from-slate-900 via-blue-800 to-slate-900 leading-tight px-2">
              Discover What's Holding Your
              <br className="hidden sm:block" />
              <span className="text-blue-600"> Website Back</span>
            </h1>
            
            <p className="text-base md:text-lg lg:text-xl text-slate-600 mb-6 md:mb-8 max-w-3xl mx-auto px-4">
              Get a complete analysis of your website's SEO, performance, mobile experience, and security. 
              Receive actionable insights in minutes‚Äîabsolutely free.
            </p>

            {/* Authentication Status Banner */}
            {isAuthenticated ? (
              <div className="inline-flex items-center gap-2 md:gap-3 px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-full mb-6 md:mb-8 mx-4 max-w-full">
                <CheckCircle2 className="w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0" />
                <span className="text-green-800 font-medium text-xs md:text-sm truncate">
                  Logged in as {session?.user?.name || session?.user?.email}
                </span>
              </div>
            ) : (
              <div className="inline-flex items-center gap-2 md:gap-3 px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-200 rounded-full mb-6 md:mb-8 mx-4 max-w-full">
                <Sparkles className="w-4 h-4 md:w-5 md:h-5 text-blue-600 flex-shrink-0" />
                <span className="text-blue-800 font-medium text-xs md:text-sm">
                  <Link href="/auth/login?redirect=auditor" className="hover:underline font-semibold">
                    Log in
                  </Link>
                  {' '}or{' '}
                  <Link href="/auth/signup" className="hover:underline font-semibold">
                    sign up
                  </Link>
                  {' '}to save results
                </span>
              </div>
            )}

            <div className="grid grid-cols-2 md:flex md:flex-wrap justify-center gap-3 md:gap-6 mb-8 md:mb-12 px-4">
              {[
                { icon: Search, label: 'SEO Analysis' },
                { icon: Zap, label: 'Performance' },
                { icon: Smartphone, label: 'Mobile' },
                { icon: Shield, label: 'Security' },
              ].map((item, index) => (
                <div key={index} className="flex items-center gap-2 text-slate-700 text-sm md:text-base">
                  <item.icon className="w-4 h-4 md:w-5 md:h-5 text-blue-600 flex-shrink-0" />
                  <span className="font-medium">{item.label}</span>
                </div>
              ))}
            </div>
          </motion.div>
        </div>
      </section>

      {/* Main Content */}
      <section className="pb-24 px-4">
        <div className="max-w-4xl mx-auto">
          <AnimatePresence mode="wait">
            {step === 'input' && (
              <motion.div
                key="input"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -20 }}
              >
                <Card className="shadow-xl border-0 bg-white/80 backdrop-blur">
                  <CardHeader className="text-center pb-8">
                    <CardTitle className="text-2xl">Start Your Free Website Audit</CardTitle>
                    <CardDescription className="text-base">
                      No credit card required. Results delivered instantly.
                    </CardDescription>
                  </CardHeader>
                  
                  <CardContent>
                    <form onSubmit={handleSubmit} className="space-y-6">
                      {/* Website URL */}
                      <div className="space-y-2">
                        <Label htmlFor="websiteUrl" className="text-base font-semibold">
                          Website URL <span className="text-red-500">*</span>
                        </Label>
                        <div className="relative">
                          <Globe className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                          <Input
                            id="websiteUrl"
                            type="url"
                            placeholder="https://yourwebsite.com"
                            value={formData.websiteUrl}
                            onChange={(e) => setFormData(prev => ({ ...prev, websiteUrl: e.target.value }))}
                            className="pl-11 h-12 text-base"
                            required
                          />
                        </div>
                      </div>

                      {/* Email & Name */}
                      <div className="grid md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label htmlFor="email" className="text-base font-semibold">
                            Email Address <span className="text-red-500">*</span>
                          </Label>
                          <div className="relative">
                            <Mail className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                            <Input
                              id="email"
                              type="email"
                              placeholder="you@company.com"
                              value={formData.email}
                              onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}
                              className="pl-11 h-12"
                              required
                              disabled={isAuthenticated}
                            />
                          </div>
                        </div>

                        <div className="space-y-2">
                          <Label htmlFor="name" className="text-base font-semibold">
                            Full Name
                          </Label>
                          <Input
                            id="name"
                            type="text"
                            placeholder="John Smith"
                            value={formData.name}
                            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                            className="h-12"
                          />
                        </div>
                      </div>

                      {/* Phone & Company */}
                      <div className="grid md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label htmlFor="phone" className="text-base font-semibold flex items-center gap-2">
                            Phone Number <span className="text-xs text-gray-500 font-normal">(Optional - for priority support)</span>
                          </Label>
                          <div className="relative">
                            <Phone className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                            <Input
                              id="phone"
                              type="tel"
                              placeholder="(555) 123-4567"
                              value={formData.phone}
                              onChange={(e) => setFormData(prev => ({ ...prev, phone: e.target.value }))}
                              className="pl-11 h-12"
                            />
                          </div>
                          <p className="text-xs text-gray-500">
                            üí° Add your number for faster response from our team
                          </p>
                        </div>

                        <div className="space-y-2">
                          <Label htmlFor="company" className="text-base font-semibold">
                            Company Name
                          </Label>
                          <div className="relative">
                            <Building2 className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                            <Input
                              id="company"
                              type="text"
                              placeholder="Your Company"
                              value={formData.company}
                              onChange={(e) => setFormData(prev => ({ ...prev, company: e.target.value }))}
                              className="pl-11 h-12"
                            />
                          </div>
                        </div>
                      </div>

                      {/* Goals */}
                      <div className="space-y-3">
                        <Label className="text-base font-semibold">
                          What are your main goals? (Select all that apply)
                        </Label>
                        <div className="grid sm:grid-cols-2 gap-3">
                          {goals.map((goal) => (
                            <button
                              key={goal.id}
                              type="button"
                              onClick={() => handleGoalToggle(goal.id)}
                              className={`flex items-center gap-3 p-4 rounded-lg border-2 transition-all ${
                                formData.goals.includes(goal.id)
                                  ? 'border-blue-600 bg-blue-50'
                                  : 'border-slate-200 hover:border-slate-300 bg-white'
                              }`}
                            >
                              <goal.icon className={`w-5 h-5 ${
                                formData.goals.includes(goal.id) ? 'text-blue-600' : 'text-slate-400'
                              }`} />
                              <span className={`text-sm font-medium ${
                                formData.goals.includes(goal.id) ? 'text-blue-900' : 'text-slate-700'
                              }`}>
                                {goal.label}
                              </span>
                            </button>
                          ))}
                        </div>
                      </div>

                      <Button 
                        type="submit" 
                        size="lg" 
                        className="w-full h-14 text-lg font-semibold bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800"
                        disabled={isLoading}
                      >
                        {isLoading ? (
                          <>
                            <RefreshCw className="w-5 h-5 mr-2 animate-spin" />
                            Analyzing...
                          </>
                        ) : (
                          <>
                            Get My Free Audit
                            <ArrowRight className="w-5 h-5 ml-2" />
                          </>
                        )}
                      </Button>

                      <p className="text-xs text-center text-slate-500">
                        By submitting this form, you agree to receive marketing communications from CDM Suite.
                        You can unsubscribe at any time.
                      </p>
                    </form>
                  </CardContent>
                </Card>
              </motion.div>
            )}

            {step === 'analyzing' && (
              <LoadingAnimation 
                toolName="Website Audit"
                messages={[
                  'üîç Checking SEO optimization...',
                  '‚ö° Testing page speed & performance...',
                  'üì± Analyzing mobile responsiveness...',
                  'üîí Scanning security vulnerabilities...',
                  '‚ú® Preparing your report...'
                ]}
                duration={5000}
              />
            )}

            {step === 'tripwire' && auditResult && (
              <TripwireFunnel
                websiteUrl={formData.websiteUrl}
                email={formData.email}
                name={formData.name || 'there'}
                overallScore={auditResult.overall_score}
                onComplete={() => setStep('results')}
              />
            )}

            {step === 'results' && auditResult && (
              <motion.div
                key="results"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                className="space-y-8"
              >
                {/* Overall Score Card */}
                <Card className={`shadow-xl border-2 ${getScoreBg(auditResult.overall_score)}`}>
                  <CardContent className="pt-8 pb-8">
                    <div className="flex flex-col md:flex-row items-center gap-8">
                      <div className="text-center md:text-left">
                        <div className={`text-6xl font-bold mb-2 ${getScoreColor(auditResult.overall_score)}`}>
                          {auditResult.overall_score}
                          <span className="text-3xl">/100</span>
                        </div>
                        <div className="text-xl font-semibold text-slate-900 mb-1">
                          {getScoreLabel(auditResult.overall_score)}
                        </div>
                        <p className="text-slate-600">Overall Website Health</p>
                      </div>

                      <div className="flex-1 grid sm:grid-cols-2 gap-4 w-full">
                        {[
                          { label: 'SEO', score: auditResult.seo_score, icon: Search },
                          { label: 'Performance', score: auditResult.performance_score, icon: Zap },
                          { label: 'Mobile', score: auditResult.mobile_score, icon: Smartphone },
                          { label: 'Security', score: auditResult.security_score, icon: Shield },
                        ].map((item, index) => (
                          <div key={index} className="bg-white/80 rounded-lg p-4">
                            <div className="flex items-center justify-between mb-2">
                              <div className="flex items-center gap-2">
                                <item.icon className="w-4 h-4 text-slate-600" />
                                <span className="font-medium text-slate-900">{item.label}</span>
                              </div>
                              <span className={`font-bold ${getScoreColor(item.score)}`}>
                                {item.score}
                              </span>
                            </div>
                            <Progress value={item.score} className="h-2" />
                          </div>
                        ))}
                      </div>
                    </div>
                  </CardContent>
                </Card>

                {/* Critical Issues */}
                {auditResult.findings.critical.length > 0 && (
                  <Card className="shadow-lg border-2 border-red-200 bg-red-50">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-red-800">
                        <XCircle className="w-6 h-6" />
                        Critical Issues ({auditResult.findings.critical.length})
                      </CardTitle>
                      <CardDescription>These issues need immediate attention</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <ul className="space-y-3">
                        {auditResult.findings.critical.map((issue, index) => (
                          <li key={index} className="flex items-start gap-3 bg-white p-4 rounded-lg">
                            <XCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
                            <span className="text-slate-700">{issue}</span>
                          </li>
                        ))}
                      </ul>
                    </CardContent>
                  </Card>
                )}

                {/* Warnings */}
                {auditResult.findings.warnings.length > 0 && (
                  <Card className="shadow-lg border-2 border-yellow-200 bg-yellow-50">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-yellow-800">
                        <AlertCircle className="w-6 h-6" />
                        Warnings ({auditResult.findings.warnings.length})
                      </CardTitle>
                      <CardDescription>These issues should be addressed soon</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <ul className="space-y-3">
                        {auditResult.findings.warnings.map((issue, index) => (
                          <li key={index} className="flex items-start gap-3 bg-white p-4 rounded-lg">
                            <AlertCircle className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" />
                            <span className="text-slate-700">{issue}</span>
                          </li>
                        ))}
                      </ul>
                    </CardContent>
                  </Card>
                )}

                {/* Good Findings */}
                {auditResult.findings.good.length > 0 && (
                  <Card className="shadow-lg border-2 border-green-200 bg-green-50">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-green-800">
                        <CheckCircle2 className="w-6 h-6" />
                        What's Working Well ({auditResult.findings.good.length})
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <ul className="space-y-3">
                        {auditResult.findings.good.map((item, index) => (
                          <li key={index} className="flex items-start gap-3 bg-white p-4 rounded-lg">
                            <CheckCircle2 className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                            <span className="text-slate-700">{item}</span>
                          </li>
                        ))}
                      </ul>
                    </CardContent>
                  </Card>
                )}

                {/* Recommendations */}
                <Card className="shadow-lg">
                  <CardHeader>
                    <CardTitle>Recommended Actions</CardTitle>
                    <CardDescription>
                      Prioritized improvements to boost your website's performance
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <Tabs defaultValue="all" className="w-full">
                      <TabsList className="grid w-full grid-cols-4">
                        <TabsTrigger value="all">All</TabsTrigger>
                        <TabsTrigger value="high">High Priority</TabsTrigger>
                        <TabsTrigger value="medium">Medium</TabsTrigger>
                        <TabsTrigger value="low">Low</TabsTrigger>
                      </TabsList>

                      {['all', 'high', 'medium', 'low'].map((priority) => (
                        <TabsContent key={priority} value={priority} className="space-y-4 mt-6">
                          {auditResult.recommendations
                            .filter(rec => priority === 'all' || rec.priority === priority)
                            .map((rec, index) => (
                              <div key={index} className="border-l-4 border-blue-600 bg-slate-50 p-6 rounded-r-lg">
                                <div className="flex items-start justify-between mb-3">
                                  <div>
                                    <Badge className={
                                      rec.priority === 'high' ? 'bg-red-100 text-red-800' :
                                      rec.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                      'bg-blue-100 text-blue-800'
                                    }>
                                      {rec.priority.toUpperCase()} PRIORITY
                                    </Badge>
                                    <h4 className="text-lg font-semibold text-slate-900 mt-2">
                                      {rec.category}: {rec.issue}
                                    </h4>
                                  </div>
                                  <Badge variant="outline" className="whitespace-nowrap">
                                    Impact: {rec.estimatedImpact}
                                  </Badge>
                                </div>
                                <p className="text-slate-700 leading-relaxed">{rec.solution}</p>
                              </div>
                            ))}
                        </TabsContent>
                      ))}
                    </Tabs>
                  </CardContent>
                </Card>

                {/* Suggested Services */}
                {auditResult.suggestedServices.length > 0 && (
                  <Card className="shadow-lg bg-gradient-to-br from-blue-50 to-purple-50">
                    <CardHeader>
                      <CardTitle>How We Can Help</CardTitle>
                      <CardDescription>
                        Based on your audit, here are our recommended services
                      </CardDescription>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      {auditResult.suggestedServices.map((service, index) => (
                        <div key={index} className="bg-white rounded-lg p-6 border-2 border-slate-200 hover:border-blue-400 transition-colors">
                          <div className="flex items-start justify-between mb-4">
                            <div>
                              <h4 className="text-xl font-bold text-slate-900 mb-2">
                                {service.name}
                              </h4>
                              <p className="text-slate-600">{service.reason}</p>
                            </div>
                            <div className="text-right">
                              <div className="text-2xl font-bold text-blue-600">{service.price}</div>
                            </div>
                          </div>
                          <Link href={`/services/${service.slug}?ref=audit`}>
                            <Button className="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800">
                              Learn More
                              <ExternalLink className="w-4 h-4 ml-2" />
                            </Button>
                          </Link>
                        </div>
                      ))}
                    </CardContent>
                  </Card>
                )}

                {/* CTA */}
                <Card className="shadow-lg bg-gradient-to-r from-accent to-secondary text-white">
                  <CardContent className="pt-8 pb-8 text-center">
                    <h3 className="text-3xl font-bold mb-4">Ready to Fix These Issues?</h3>
                    <p className="text-lg mb-6 opacity-90">
                      Let's turn these insights into real results. Book a free consultation with our team.
                    </p>
                    <div className="flex flex-col sm:flex-row gap-4 justify-center">
                      <Link href="/contact?source=audit">
                        <Button size="lg" className="bg-white text-blue-600 hover:bg-gray-100 font-bold">
                          Schedule Free Consultation
                        </Button>
                      </Link>
                      <a href="tel:8622727623">
                        <Button size="lg" variant="outline" className="border-2 border-white text-white hover:bg-white/10">
                          <Phone className="w-4 h-4 mr-2" />
                          Call (862) 272-7623
                        </Button>
                      </a>
                    </div>
                  </CardContent>
                </Card>

                {/* Email Confirmation */}
                <Card className="shadow-lg bg-green-50 border-2 border-green-200">
                  <CardContent className="pt-6 pb-6 text-center">
                    <div className="flex items-center justify-center gap-3 mb-2">
                      <Mail className="w-6 h-6 text-green-600" />
                      <h4 className="text-lg font-semibold text-green-900">
                        Full Report Sent to Your Email
                      </h4>
                    </div>
                    <p className="text-green-700">
                      We've sent a detailed PDF report to <strong>{formData.email}</strong> with all findings and recommendations.
                    </p>
                  </CardContent>
                </Card>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      </section>
    </div>
  );
}

// ==========================================
// File: components/auditor/tripwire-funnel.tsx
// ==========================================


"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { X, Check, Clock, TrendingUp, Zap, Award, ArrowRight, Sparkles, Rocket } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { toast } from "react-hot-toast";
import Link from "next/link";

interface TripwireFunnelProps {
  websiteUrl: string;
  email: string;
  name: string;
  overallScore: number;
  onComplete: () => void;
}

export default function TripwireFunnel({ websiteUrl, email, name, overallScore, onComplete }: TripwireFunnelProps) {
  const [step, setStep] = useState<'offer1' | 'upsell1' | 'complete'>('offer1');
  const [accepted, setAccepted] = useState<string[]>([]);

  // Offer 1: $100/month Website Fix Service
  const offer1 = {
    id: 'website-fix-service',
    title: 'üöÄ Website Performance Fix',
    monthlyPrice: 100,
    setupFee: 0, // Waived for limited time
    features: [
      '‚úÖ We fix ALL critical issues from your audit',
      '‚úÖ Performance optimization (speed, mobile, SEO)',
      '‚úÖ Guaranteed 20+ point score improvement',
      '‚úÖ Launched in less than 7 days',
      '‚úÖ Cancel anytime (no long-term contract)',
      '‚úÖ Monthly performance monitoring included'
    ],
    options: [
      {
        type: 'done-for-you',
        label: 'Done-For-You',
        description: 'We handle everything - you just approve',
        popular: true
      },
      {
        type: 'self-service',
        label: 'Self-Service',
        description: 'Access our platform + guided tutorials',
        popular: false
      }
    ],
    urgency: 'Limited to first 20 signups this week',
    cta: 'Start My Website Fix - $100/month',
    guarantee: 'Cancel anytime. First month money-back guarantee.'
  };

  // Upsell 1: Add-on Services at $100/month each
  const upsell1 = {
    id: 'growth-bundle',
    title: '‚ö° Add Growth Services',
    addons: [
      {
        id: 'seo-boost',
        name: 'SEO Optimization',
        price: 100,
        description: 'Rank higher on Google',
        features: ['Keyword research', 'Content optimization', 'Monthly ranking reports']
      },
      {
        id: 'content-engine',
        name: 'Content Creation',
        price: 100,
        description: '4 blog posts + 12 social posts/month',
        features: ['SEO-optimized blogs', 'Social media content', 'Content calendar']
      },
      {
        id: 'email-automation',
        name: 'Email Marketing',
        price: 100,
        description: 'Automated email sequences',
        features: ['Welcome series', 'Nurture campaigns', 'Performance tracking']
      }
    ],
    urgency: 'ONE-TIME OFFER: Bundle pricing only available now',
    cta: 'Add Growth Services',
    bonus: 'üéÅ Bundle 2+ services: Get first month at 50% off'
  };

  const handleAccept = async (offerId: string, selectedOptions?: any) => {
    setAccepted([...accepted, offerId]);
    
    // Track in CRM
    try {
      await fetch('/api/leads', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email,
          name,
          source: 'Audit Tripwire',
          interest: `Accepted: ${offerId}`,
          tags: ['audit', 'tripwire-accepted', offerId],
          notes: `Accepted ${offerId} offer after website audit (${websiteUrl}, score: ${overallScore}). Options: ${JSON.stringify(selectedOptions || {})}`
        })
      });
    } catch (error) {
      console.error('Failed to track acceptance:', error);
    }

    // Redirect to checkout for main offer
    if (step === 'offer1') {
      // Redirect to checkout page with pre-filled info
      const checkoutUrl = `/services/website-fix?email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}&website=${encodeURIComponent(websiteUrl)}`;
      window.location.href = checkoutUrl;
      return;
    }
    
    // For upsells, track and continue
    if (step === 'upsell1') {
      setStep('complete');
      setTimeout(onComplete, 2000);
    }
  };

  const handleDecline = async () => {
    if (step === 'offer1') {
      setStep('complete');
      setTimeout(onComplete, 2000);
    } else {
      setStep('complete');
      setTimeout(onComplete, 2000);
    }
  };

  const renderMainOffer = () => (
    <motion.div
      initial={{ opacity: 0, scale: 0.9 }}
      animate={{ opacity: 1, scale: 1 }}
      exit={{ opacity: 0, scale: 0.9 }}
      className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm overflow-y-auto"
    >
      <Card className="max-w-3xl w-full max-h-[90vh] overflow-y-auto relative my-4">
        <button
          onClick={handleDecline}
          className="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition-colors z-10"
        >
          <X className="w-5 h-5 text-gray-600" />
        </button>
        
        <CardContent className="p-8">
          {/* Urgency Banner */}
          <div className="bg-gradient-to-r from-red-500 to-orange-500 text-white px-6 py-3 rounded-lg mb-6 text-center font-bold flex items-center justify-center gap-2">
            <Clock className="w-5 h-5 animate-pulse" />
            {offer1.urgency}
          </div>

          {/* Title */}
          <h2 className="text-4xl font-bold text-gray-900 mb-2 text-center">
            {offer1.title}
          </h2>
          <p className="text-center text-gray-600 text-lg mb-6">
            The Utility-Style Website Service You Can Actually Afford
          </p>

          {/* Price Display */}
          <div className="bg-gradient-to-br from-blue-50 to-green-50 rounded-xl p-8 mb-6 text-center border-2 border-green-500">
            <div className="text-6xl font-bold text-green-600 mb-2">
              $100
              <span className="text-2xl text-gray-600 font-normal">/month</span>
            </div>
            <p className="text-gray-700 text-lg font-semibold mb-2">
              No setup fees. No hidden costs. Cancel anytime.
            </p>
            <div className="inline-flex items-center gap-2 bg-yellow-100 px-4 py-2 rounded-full">
              <Rocket className="w-5 h-5 text-yellow-600" />
              <span className="text-yellow-900 font-bold">Launched in less than 7 days</span>
            </div>
          </div>

          {/* Service Options */}
          <div className="mb-6">
            <h3 className="font-bold text-xl mb-4 text-gray-900 text-center">Choose Your Service Style:</h3>
            <div className="grid md:grid-cols-2 gap-4">
              {offer1.options.map((option) => (
                <div
                  key={option.type}
                  className={`relative border-2 rounded-lg p-5 cursor-pointer transition-all ${
                    option.popular 
                      ? 'border-green-500 bg-green-50 shadow-lg' 
                      : 'border-gray-300 bg-white hover:border-gray-400'
                  }`}
                >
                  {option.popular && (
                    <Badge className="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-green-600 text-white">
                      Most Popular
                    </Badge>
                  )}
                  <div className="text-center">
                    <h4 className="font-bold text-lg text-gray-900 mb-2">{option.label}</h4>
                    <p className="text-sm text-gray-600">{option.description}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* Features */}
          <div className="mb-6">
            <h3 className="font-bold text-xl mb-4 text-gray-900">What's Included:</h3>
            <ul className="space-y-3">
              {offer1.features.map((feature, index) => (
                <li key={index} className="flex items-start gap-3 bg-gray-50 p-3 rounded-lg">
                  <Check className="w-6 h-6 text-green-600 flex-shrink-0 mt-0.5" />
                  <span className="text-gray-800 font-medium">{feature}</span>
                </li>
              ))}
            </ul>
          </div>

          {/* Social Proof */}
          <div className="bg-blue-50 rounded-lg p-5 mb-6 border-l-4 border-blue-500">
            <div className="flex items-start gap-3 mb-2">
              <Award className="w-6 h-6 text-blue-600 flex-shrink-0" />
              <div>
                <p className="font-semibold text-blue-900 mb-1">Real Results</p>
                <p className="text-sm text-blue-800 italic">
                  "We went from a 52 audit score to 94 in just 5 days. Website loads 3x faster now and we're getting double the leads!"
                </p>
                <p className="text-xs text-blue-600 mt-1">‚Äî Jennifer M., Small Business Owner</p>
              </div>
            </div>
          </div>

          {/* CTA Button */}
          <Button
            onClick={() => handleAccept(offer1.id)}
            className="w-full py-7 text-xl font-bold bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-xl hover:shadow-2xl transition-all mb-4 btn-glow"
          >
            <Sparkles className="w-6 h-6 mr-2" />
            {offer1.cta}
            <ArrowRight className="w-6 h-6 ml-2" />
          </Button>

          {/* Guarantee */}
          <div className="text-center text-sm text-gray-600 mb-4 bg-gray-50 py-3 rounded-lg">
            <div className="flex items-center justify-center gap-2">
              <Shield className="w-5 h-5 text-green-600" />
              <span className="font-medium">{offer1.guarantee}</span>
            </div>
          </div>

          {/* Decline Option */}
          <button
            onClick={handleDecline}
            className="w-full text-sm text-gray-500 hover:text-gray-700 transition-colors underline"
          >
            No thanks, I'll view my report without the fix service
          </button>
        </CardContent>
      </Card>
    </motion.div>
  );

  const renderUpsell = () => {
    const [selectedAddons, setSelectedAddons] = useState<string[]>([]);

    const toggleAddon = (addonId: string) => {
      setSelectedAddons(prev => 
        prev.includes(addonId) 
          ? prev.filter(id => id !== addonId)
          : [...prev, addonId]
      );
    };

    const totalPrice = selectedAddons.length * 100;
    const discountedPrice = selectedAddons.length >= 2 ? totalPrice * 0.5 : totalPrice;

    return (
      <motion.div
        initial={{ opacity: 0, scale: 0.9 }}
        animate={{ opacity: 1, scale: 1 }}
        exit={{ opacity: 0, scale: 0.9 }}
        className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm overflow-y-auto"
      >
        <Card className="max-w-3xl w-full max-h-[90vh] overflow-y-auto relative my-4">
          <CardContent className="p-8">
            {/* Urgency Banner */}
            <div className="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-lg mb-6 text-center font-bold flex items-center justify-center gap-2">
              <Clock className="w-5 h-5 animate-pulse" />
              {upsell1.urgency}
            </div>

            <h2 className="text-3xl font-bold text-gray-900 mb-4 text-center">
              {upsell1.title}
            </h2>
            <p className="text-center text-gray-600 text-lg mb-6">
              Supercharge your growth with these add-on services at just $100/month each
            </p>

            {/* Bonus Badge */}
            {selectedAddons.length >= 2 && (
              <div className="bg-yellow-100 border-2 border-yellow-400 rounded-lg p-4 mb-6 text-center animate-pulse">
                <p className="text-yellow-900 font-bold text-lg">
                  üéâ {upsell1.bonus}
                </p>
              </div>
            )}

            {/* Add-on Services */}
            <div className="space-y-4 mb-6">
              {upsell1.addons.map((addon) => (
                <div
                  key={addon.id}
                  onClick={() => toggleAddon(addon.id)}
                  className={`border-2 rounded-lg p-5 cursor-pointer transition-all ${
                    selectedAddons.includes(addon.id)
                      ? 'border-green-500 bg-green-50 shadow-lg'
                      : 'border-gray-300 bg-white hover:border-gray-400'
                  }`}
                >
                  <div className="flex items-start justify-between mb-3">
                    <div className="flex-1">
                      <div className="flex items-center gap-3 mb-2">
                        <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                          selectedAddons.includes(addon.id)
                            ? 'border-green-500 bg-green-500'
                            : 'border-gray-300'
                        }`}>
                          {selectedAddons.includes(addon.id) && (
                            <Check className="w-4 h-4 text-white" />
                          )}
                        </div>
                        <h4 className="font-bold text-xl text-gray-900">{addon.name}</h4>
                      </div>
                      <p className="text-gray-600 mb-2">{addon.description}</p>
                      <ul className="space-y-1">
                        {addon.features.map((feature, idx) => (
                          <li key={idx} className="text-sm text-gray-600 flex items-center gap-2">
                            <span className="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                            {feature}
                          </li>
                        ))}
                      </ul>
                    </div>
                    <div className="text-right ml-4">
                      <p className="text-3xl font-bold text-green-600">${addon.price}</p>
                      <p className="text-sm text-gray-600">/month</p>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            {/* Total Price */}
            {selectedAddons.length > 0 && (
              <div className="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl p-6 mb-6 border-2 border-green-500">
                <div className="text-center">
                  {selectedAddons.length >= 2 && (
                    <p className="text-gray-600 line-through text-lg mb-1">
                      Regular: ${totalPrice}/month
                    </p>
                  )}
                  <p className="text-4xl font-bold text-green-600 mb-2">
                    ${discountedPrice}
                    <span className="text-lg text-gray-600 font-normal">/month</span>
                  </p>
                  <p className="text-gray-700">
                    {selectedAddons.length} service{selectedAddons.length > 1 ? 's' : ''} selected
                  </p>
                  {selectedAddons.length >= 2 && (
                    <p className="text-green-700 font-semibold mt-2">
                      You're saving ${totalPrice - discountedPrice}/month!
                    </p>
                  )}
                </div>
              </div>
            )}

            {/* CTA Buttons */}
            {selectedAddons.length > 0 ? (
              <Button
                onClick={() => handleAccept(upsell1.id, { addons: selectedAddons, price: discountedPrice })}
                className="w-full py-6 text-lg font-bold bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-xl hover:shadow-2xl transition-all mb-4"
              >
                <Sparkles className="w-5 h-5 mr-2" />
                Add Selected Services - ${discountedPrice}/mo
                <ArrowRight className="w-5 h-5 ml-2" />
              </Button>
            ) : (
              <Button
                onClick={handleDecline}
                className="w-full py-6 text-lg font-bold bg-gray-600 hover:bg-gray-700 text-white shadow-xl hover:shadow-2xl transition-all mb-4"
              >
                Continue Without Add-ons
                <ArrowRight className="w-5 h-5 ml-2" />
              </Button>
            )}

            {/* Skip Option */}
            <button
              onClick={handleDecline}
              className="w-full text-sm text-gray-500 hover:text-gray-700 transition-colors underline"
            >
              No thanks, I'll just stick with the website fix service
            </button>
          </CardContent>
        </Card>
      </motion.div>
    );
  };

  return (
    <AnimatePresence mode="wait">
      {step === 'offer1' && renderMainOffer()}
      {step === 'upsell1' && renderUpsell()}
      {step === 'complete' && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm"
        >
          <Card className="max-w-md w-full">
            <CardContent className="p-8 text-center">
              <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Check className="w-8 h-8 text-green-600" />
              </div>
              <h3 className="text-2xl font-bold text-gray-900 mb-2">
                {accepted.length > 0 ? "Welcome Aboard! üéâ" : "Report Ready!"}
              </h3>
              <p className="text-gray-600 mb-4">
                {accepted.length > 0 
                  ? "We'll email you within 24 hours to kick off your website improvements!"
                  : "Your full audit report is ready to view below."}
              </p>
              <Button
                onClick={onComplete}
                className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700"
              >
                View Full Report
                <ArrowRight className="w-4 h-4 ml-2" />
              </Button>
            </CardContent>
          </Card>
        </motion.div>
      )}
    </AnimatePresence>
  );
}

function Shield({ className }: { className?: string }) {
  return (
    <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
    </svg>
  );
}

// ==========================================
// File: components/auth/login-form.tsx
// ==========================================


"use client";

import { useState } from "react";
import { signIn } from "next-auth/react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { Loader2, AlertCircle } from "lucide-react";

export function LoginForm() {
  const router = useRouter();
  const [formData, setFormData] = useState({
    email: "",
    password: "",
  });
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError("");
    setLoading(true);

    try {
      const result = await signIn("credentials", {
        email: formData.email,
        password: formData.password,
        redirect: false,
      });

      if (result?.error) {
        setError("Invalid email or password");
        setLoading(false);
        return;
      }

      router.push("/dashboard");
      router.refresh();
    } catch (error) {
      setError("Something went wrong. Please try again.");
      setLoading(false);
    }
  };

  return (
    <div className="bg-white rounded-2xl shadow-xl p-8">
      <form onSubmit={handleSubmit} className="space-y-6">
        {error && (
          <Alert variant="destructive">
            <AlertCircle className="h-4 w-4" />
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}

        <div className="space-y-2">
          <Label htmlFor="email">Email</Label>
          <Input
            id="email"
            type="email"
            placeholder="you@example.com"
            value={formData.email}
            onChange={(e) =>
              setFormData({ ...formData, email: e.target.value })
            }
            required
            disabled={loading}
          />
        </div>

        <div className="space-y-2">
          <div className="flex items-center justify-between">
            <Label htmlFor="password">Password</Label>
            <Link
              href="/auth/forgot-password"
              className="text-sm text-blue-600 hover:text-blue-500"
            >
              Forgot password?
            </Link>
          </div>
          <Input
            id="password"
            type="password"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            value={formData.password}
            onChange={(e) =>
              setFormData({ ...formData, password: e.target.value })
            }
            required
            disabled={loading}
          />
        </div>

        <Button type="submit" className="w-full" disabled={loading}>
          {loading ? (
            <>
              <Loader2 className="mr-2 h-4 w-4 animate-spin" />
              Logging in...
            </>
          ) : (
            "Login"
          )}
        </Button>

        <p className="text-center text-sm text-gray-600">
          Don't have an account?{" "}
          <Link
            href="/auth/signup"
            className="font-semibold text-blue-600 hover:text-blue-500"
          >
            Sign up
          </Link>
        </p>
      </form>
    </div>
  );
}

// ==========================================
// File: components/auth/signup-form.tsx
// ==========================================


"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Alert, AlertDescription } from "@/components/ui/alert";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Loader2, AlertCircle, CheckCircle2 } from "lucide-react";
import { trackRedditSignup } from "@/lib/reddit-tracking";
import { trackConversion } from "@/lib/analytics";

const TIERS = [
  { value: "free", label: "Free - Start with Audit", price: "$0" },
  {
    value: "starter",
    label: "Starter - Website & SEO",
    price: "$250-500/mo",
    trial: true,
  },
  {
    value: "growth",
    label: "Growth - Full Marketing Suite",
    price: "$800-1,200/mo",
  },
  { value: "pro", label: "Pro - Enterprise Features", price: "$2,000+/mo" },
];

export function SignupForm({ referralCode }: { referralCode?: string }) {
  const router = useRouter();
  const [formData, setFormData] = useState({
    email: "",
    password: "",
    confirmPassword: "",
    name: "",
    company: "",
    phone: "",
    tier: "free",
    referralCode: referralCode || "",
  });
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError("");

    // Validation
    if (formData.password !== formData.confirmPassword) {
      setError("Passwords do not match");
      return;
    }

    if (formData.password.length < 8) {
      setError("Password must be at least 8 characters long");
      return;
    }

    setLoading(true);

    try {
      const response = await fetch("/api/auth/signup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: formData.email,
          password: formData.password,
          name: formData.name,
          company: formData.company,
          phone: formData.phone,
          tier: formData.tier,
        }),
      });

      const data = await response.json();

      if (!response.ok) {
        setError(data.error || "Something went wrong");
        setLoading(false);
        return;
      }

      // Track signup conversion - dual tracking (client-side + server-side)
      trackRedditSignup(formData.email);
      trackConversion('signup', undefined, 'USD', {
        email: formData.email,
        userId: data.userId,
        tier: formData.tier,
      });

      // Auto-login after signup
      const { signIn } = await import("next-auth/react");
      await signIn("credentials", {
        email: formData.email,
        password: formData.password,
        redirect: false,
      });

      router.push("/dashboard/onboarding");
      router.refresh();
    } catch (error) {
      setError("Something went wrong. Please try again.");
      setLoading(false);
    }
  };

  const selectedTier = TIERS.find((t) => t.value === formData.tier);

  return (
    <div className="bg-white rounded-2xl shadow-xl p-8">
      <form onSubmit={handleSubmit} className="space-y-6">
        {error && (
          <Alert variant="destructive">
            <AlertCircle className="h-4 w-4" />
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}

        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label htmlFor="name">Full Name</Label>
            <Input
              id="name"
              type="text"
              placeholder="John Doe"
              value={formData.name}
              onChange={(e) =>
                setFormData({ ...formData, name: e.target.value })
              }
              required
              disabled={loading}
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="email">Email</Label>
            <Input
              id="email"
              type="email"
              placeholder="you@example.com"
              value={formData.email}
              onChange={(e) =>
                setFormData({ ...formData, email: e.target.value })
              }
              required
              disabled={loading}
            />
          </div>
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label htmlFor="company">Company (Optional)</Label>
            <Input
              id="company"
              type="text"
              placeholder="Acme Inc."
              value={formData.company}
              onChange={(e) =>
                setFormData({ ...formData, company: e.target.value })
              }
              disabled={loading}
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="phone">Phone (Optional)</Label>
            <Input
              id="phone"
              type="tel"
              placeholder="+1 (555) 000-0000"
              value={formData.phone}
              onChange={(e) =>
                setFormData({ ...formData, phone: e.target.value })
              }
              disabled={loading}
            />
          </div>
        </div>

        <div className="space-y-2">
          <Label htmlFor="tier">Select Plan</Label>
          <Select
            value={formData.tier}
            onValueChange={(value) =>
              setFormData({ ...formData, tier: value })
            }
            disabled={loading}
          >
            <SelectTrigger>
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              {TIERS.map((tier) => (
                <SelectItem key={tier.value} value={tier.value}>
                  <div className="flex items-center justify-between w-full">
                    <span>{tier.label}</span>
                    <span className="text-sm text-gray-500 ml-2">
                      {tier.price}
                    </span>
                  </div>
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
          {selectedTier?.trial && (
            <p className="text-sm text-green-600 flex items-center gap-1">
              <CheckCircle2 className="h-4 w-4" />
              7-day free trial included
            </p>
          )}
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label htmlFor="password">Password</Label>
            <Input
              id="password"
              type="password"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              value={formData.password}
              onChange={(e) =>
                setFormData({ ...formData, password: e.target.value })
              }
              required
              disabled={loading}
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="confirmPassword">Confirm Password</Label>
            <Input
              id="confirmPassword"
              type="password"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              value={formData.confirmPassword}
              onChange={(e) =>
                setFormData({ ...formData, confirmPassword: e.target.value })
              }
              required
              disabled={loading}
            />
          </div>
        </div>

        <Button type="submit" className="w-full" disabled={loading}>
          {loading ? (
            <>
              <Loader2 className="mr-2 h-4 w-4 animate-spin" />
              Creating account...
            </>
          ) : (
            "Create Account"
          )}
        </Button>

        <p className="text-center text-sm text-gray-600">
          Already have an account?{" "}
          <Link
            href="/auth/login"
            className="font-semibold text-blue-600 hover:text-blue-500"
          >
            Login
          </Link>
        </p>
      </form>
    </div>
  );
}

// ==========================================
// File: components/bid-proposals/cover-page-editor.tsx
// ==========================================


'use client';

import { useState, useRef, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Pencil, Check, X, Sparkles, Bold, Italic, List, AlignLeft, AlignCenter } from 'lucide-react';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';

interface CoverPageEditorProps {
  bidProposalId: string;
  initialContent?: string | null;
  onUpdate?: (newContent: string) => void;
}

export function CoverPageEditor({ bidProposalId, initialContent, onUpdate }: CoverPageEditorProps) {
  const [isEditing, setIsEditing] = useState(false);
  const [content, setContent] = useState(initialContent || '');
  const [saving, setSaving] = useState(false);
  const [regenerating, setRegenerating] = useState(false);
  const editorRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (isEditing && editorRef.current) {
      editorRef.current.innerHTML = content;
    }
  }, [isEditing, content]);

  const handleSave = async () => {
    const htmlContent = editorRef.current?.innerHTML || '';
    
    if (!htmlContent.trim()) {
      toast.error('Cover page cannot be empty');
      return;
    }

    setSaving(true);
    try {
      const response = await fetch(`/api/bid-proposals/${bidProposalId}/update-cover`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ coverPageContent: htmlContent }),
      });

      if (!response.ok) {
        throw new Error('Failed to update cover page');
      }

      setContent(htmlContent);
      toast.success('Cover page updated successfully');
      setIsEditing(false);
      if (onUpdate) {
        onUpdate(htmlContent);
      }
    } catch (error) {
      console.error('Error updating cover page:', error);
      toast.error('Failed to update cover page');
    } finally {
      setSaving(false);
    }
  };

  const handleRegenerate = async () => {
    setRegenerating(true);
    try {
      const response = await fetch(`/api/bid-proposals/${bidProposalId}/regenerate-cover`, {
        method: 'POST',
      });

      if (!response.ok) {
        throw new Error('Failed to regenerate cover page');
      }

      const data = await response.json();
      setContent(data.coverPageContent);
      if (editorRef.current) {
        editorRef.current.innerHTML = data.coverPageContent;
      }
      toast.success('Cover page regenerated successfully');
      if (onUpdate) {
        onUpdate(data.coverPageContent);
      }
    } catch (error) {
      console.error('Error regenerating cover page:', error);
      toast.error('Failed to regenerate cover page');
    } finally {
      setRegenerating(false);
    }
  };

  const handleCancel = () => {
    setContent(initialContent || '');
    setIsEditing(false);
  };

  const execCommand = (command: string, value?: string) => {
    document.execCommand(command, false, value);
    editorRef.current?.focus();
  };

  if (isEditing) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Pencil className="w-5 h-5" />
            Edit Cover Page
          </CardTitle>
          <CardDescription>
            Customize the cover page content for your proposal
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {/* Formatting Toolbar */}
          <div className="flex flex-wrap gap-2 p-2 border rounded-lg bg-muted/50">
            <Button
              size="sm"
              variant="ghost"
              onClick={() => execCommand('bold')}
              title="Bold"
            >
              <Bold className="w-4 h-4" />
            </Button>
            <Button
              size="sm"
              variant="ghost"
              onClick={() => execCommand('italic')}
              title="Italic"
            >
              <Italic className="w-4 h-4" />
            </Button>
            <div className="w-px h-6 bg-border mx-1" />
            <Button
              size="sm"
              variant="ghost"
              onClick={() => execCommand('justifyLeft')}
              title="Align Left"
            >
              <AlignLeft className="w-4 h-4" />
            </Button>
            <Button
              size="sm"
              variant="ghost"
              onClick={() => execCommand('justifyCenter')}
              title="Align Center"
            >
              <AlignCenter className="w-4 h-4" />
            </Button>
            <div className="w-px h-6 bg-border mx-1" />
            <Button
              size="sm"
              variant="ghost"
              onClick={() => execCommand('insertUnorderedList')}
              title="Bullet List"
            >
              <List className="w-4 h-4" />
            </Button>
            <div className="w-px h-6 bg-border mx-1" />
            <select
              className="px-2 py-1 text-sm border rounded"
              onChange={(e) => execCommand('fontSize', e.target.value)}
              defaultValue="3"
            >
              <option value="1">Small</option>
              <option value="3">Normal</option>
              <option value="5">Large</option>
              <option value="7">Extra Large</option>
            </select>
          </div>

          {/* Editable Content */}
          <div
            ref={editorRef}
            contentEditable
            className={cn(
              "min-h-[400px] p-6 border rounded-lg bg-white",
              "prose prose-sm max-w-none",
              "focus:outline-none focus:ring-2 focus:ring-primary"
            )}
            style={{ lineHeight: '1.6' }}
          />

          <div className="flex gap-2">
            <Button onClick={handleSave} disabled={saving}>
              {saving ? (
                <>
                  <Check className="w-4 h-4 mr-2 animate-spin" />
                  Saving...
                </>
              ) : (
                <>
                  <Check className="w-4 h-4 mr-2" />
                  Save Changes
                </>
              )}
            </Button>
            <Button variant="outline" onClick={handleCancel} disabled={saving}>
              <X className="w-4 h-4 mr-2" />
              Cancel
            </Button>
            <Button
              variant="secondary"
              onClick={handleRegenerate}
              disabled={regenerating || saving}
              className="ml-auto"
            >
              {regenerating ? (
                <>
                  <Sparkles className="w-4 h-4 mr-2 animate-spin" />
                  Generating...
                </>
              ) : (
                <>
                  <Sparkles className="w-4 h-4 mr-2" />
                  Regenerate with AI
                </>
              )}
            </Button>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <span>Cover Page</span>
          <Button size="sm" variant="outline" onClick={() => setIsEditing(true)}>
            <Pencil className="w-4 h-4 mr-2" />
            Edit
          </Button>
        </CardTitle>
      </CardHeader>
      <CardContent>
        {content ? (
          <div 
            className="prose prose-sm max-w-none"
            dangerouslySetInnerHTML={{ __html: content }}
          />
        ) : (
          <p className="text-muted-foreground">No cover page content available</p>
        )}
      </CardContent>
    </Card>
  );
}

// ==========================================
// File: components/bid-proposals/document-manager.tsx
// ==========================================


'use client';

import React, { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Checkbox } from '@/components/ui/checkbox';
import {
  FileText,
  DollarSign,
  Users,
  Award,
  CheckCircle,
  Shield,
  Calendar,
  Phone,
  Download,
  Loader2,
  AlertCircle,
  Check,
  FileStack,
} from 'lucide-react';
import { getAllDocuments, getDocumentType, type DocumentTypeDefinition } from '@/lib/bid-document-types';
import { toast } from 'react-hot-toast';

interface DocumentStatus {
  id: string;
  documentType: string;
  title: string;
  status: 'pending' | 'generating' | 'completed' | 'error';
  generatedAt?: string;
  errorMessage?: string;
}

interface DocumentManagerProps {
  bidProposalId: string;
  refreshTrigger?: number;
}

const iconMap: Record<string, any> = {
  FileText,
  DollarSign,
  Users,
  Award,
  CheckCircle,
  Shield,
  Calendar,
  Phone,
};

export function DocumentManager({ bidProposalId, refreshTrigger }: DocumentManagerProps) {
  const [documents, setDocuments] = useState<DocumentStatus[]>([]);
  const [selectedDocTypes, setSelectedDocTypes] = useState<string[]>(['technical', 'cost']);
  const [loading, setLoading] = useState(true);
  const [generating, setGenerating] = useState(false);
  const [downloading, setDownloading] = useState<string | null>(null);

  const allDocTypes = getAllDocuments();

  // Fetch documents
  const fetchDocuments = async () => {
    try {
      const response = await fetch(`/api/bid-proposals/${bidProposalId}/documents`);
      if (response.ok) {
        const data = await response.json();
        setDocuments(data.documents || []);
      }
    } catch (error) {
      console.error('Error fetching documents:', error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchDocuments();
    // Poll for updates while generating
    const interval = setInterval(() => {
      if (documents.some(doc => doc.status === 'generating')) {
        fetchDocuments();
      }
    }, 3000);

    return () => clearInterval(interval);
  }, [bidProposalId, refreshTrigger]);

  // Generate documents
  const handleGenerate = async () => {
    if (selectedDocTypes.length === 0) {
      toast.error('Please select at least one document type');
      return;
    }

    setGenerating(true);
    try {
      const response = await fetch(`/api/bid-proposals/${bidProposalId}/documents`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ documentTypes: selectedDocTypes }),
      });

      if (!response.ok) {
        throw new Error('Failed to start document generation');
      }

      toast.success('Document generation started');
      fetchDocuments();
    } catch (error) {
      console.error('Error generating documents:', error);
      toast.error('Failed to generate documents');
    } finally {
      setGenerating(false);
    }
  };

  // Download individual document
  const handleDownloadDocument = async (docId: string, title: string) => {
    setDownloading(docId);
    try {
      const response = await fetch(
        `/api/bid-proposals/${bidProposalId}/documents/${docId}/download`
      );

      if (!response.ok) {
        throw new Error('Failed to download document');
      }

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${title.replace(/\s+/g, '_')}.pdf`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);

      toast.success('Document downloaded');
    } catch (error) {
      console.error('Error downloading document:', error);
      toast.error('Failed to download document');
    } finally {
      setDownloading(null);
    }
  };

  // Download combined PDF
  const handleDownloadCombined = async () => {
    const completedDocs = documents.filter(doc => doc.status === 'completed');
    if (completedDocs.length === 0) {
      toast.error('No completed documents to download');
      return;
    }

    setDownloading('combined');
    try {
      const response = await fetch(
        `/api/bid-proposals/${bidProposalId}/documents/combined`
      );

      if (!response.ok) {
        throw new Error('Failed to download combined PDF');
      }

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `bid_proposal_complete.pdf`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);

      toast.success('Combined PDF downloaded');
    } catch (error) {
      console.error('Error downloading combined PDF:', error);
      toast.error('Failed to download combined PDF');
    } finally {
      setDownloading(null);
    }
  };

  // Get document status
  const getDocumentStatus = (docType: string): DocumentStatus | undefined => {
    return documents.find(doc => doc.documentType === docType);
  };

  // Toggle document selection
  const toggleDocType = (docType: string) => {
    setSelectedDocTypes(prev =>
      prev.includes(docType)
        ? prev.filter(t => t !== docType)
        : [...prev, docType]
    );
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center p-8">
        <Loader2 className="h-6 w-6 animate-spin text-primary" />
      </div>
    );
  }

  const completedCount = documents.filter(doc => doc.status === 'completed').length;
  const generatingCount = documents.filter(doc => doc.status === 'generating').length;

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-lg font-semibold">Proposal Documents</h3>
          <p className="text-sm text-muted-foreground">
            Select and generate the documents you need for this bid
          </p>
        </div>
        <div className="flex gap-2">
          {completedCount > 0 && (
            <Button
              onClick={handleDownloadCombined}
              disabled={downloading === 'combined'}
              variant="outline"
            >
              {downloading === 'combined' ? (
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              ) : (
                <FileStack className="h-4 w-4 mr-2" />
              )}
              Download All ({completedCount})
            </Button>
          )}
          <Button
            onClick={handleGenerate}
            disabled={generating || selectedDocTypes.length === 0}
          >
            {generating ? (
              <>
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                Generating...
              </>
            ) : (
              <>
                <FileText className="h-4 w-4 mr-2" />
                Generate Selected
              </>
            )}
          </Button>
        </div>
      </div>

      {/* Document Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {allDocTypes.map((docType) => {
          const status = getDocumentStatus(docType.type);
          const Icon = iconMap[docType.icon] || FileText;
          const isSelected = selectedDocTypes.includes(docType.type);

          return (
            <Card
              key={docType.type}
              className={`relative transition-all ${
                isSelected ? 'border-primary ring-1 ring-primary' : ''
              }`}
            >
              <CardHeader className="pb-3">
                <div className="flex items-start justify-between">
                  <div className="flex items-start gap-3 flex-1">
                    <Checkbox
                      checked={isSelected}
                      onCheckedChange={() => toggleDocType(docType.type)}
                      className="mt-1"
                    />
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <Icon className="h-4 w-4 text-primary shrink-0" />
                        <h4 className="font-semibold text-sm truncate">
                          {docType.title}
                        </h4>
                      </div>
                      <p className="text-xs text-muted-foreground line-clamp-2">
                        {docType.description}
                      </p>
                    </div>
                  </div>
                </div>
              </CardHeader>

              <CardContent className="pt-0">
                {status ? (
                  <div className="space-y-2">
                    {/* Status Badge */}
                    <div className="flex items-center gap-2">
                      {status.status === 'completed' && (
                        <Badge variant="default" className="bg-green-500">
                          <Check className="h-3 w-3 mr-1" />
                          Completed
                        </Badge>
                      )}
                      {status.status === 'generating' && (
                        <Badge variant="secondary">
                          <Loader2 className="h-3 w-3 mr-1 animate-spin" />
                          Generating...
                        </Badge>
                      )}
                      {status.status === 'error' && (
                        <Badge variant="destructive">
                          <AlertCircle className="h-3 w-3 mr-1" />
                          Error
                        </Badge>
                      )}
                      {status.status === 'pending' && (
                        <Badge variant="outline">Pending</Badge>
                      )}
                    </div>

                    {/* Download Button */}
                    {status.status === 'completed' && (
                      <Button
                        size="sm"
                        variant="outline"
                        className="w-full"
                        onClick={() => handleDownloadDocument(status.id, docType.title)}
                        disabled={downloading === status.id}
                      >
                        {downloading === status.id ? (
                          <Loader2 className="h-3 w-3 mr-2 animate-spin" />
                        ) : (
                          <Download className="h-3 w-3 mr-2" />
                        )}
                        Download PDF
                      </Button>
                    )}

                    {/* Error Message */}
                    {status.status === 'error' && status.errorMessage && (
                      <p className="text-xs text-destructive">{status.errorMessage}</p>
                    )}

                    {/* Generated Date */}
                    {status.generatedAt && (
                      <p className="text-xs text-muted-foreground">
                        Generated {new Date(status.generatedAt).toLocaleDateString()}
                      </p>
                    )}
                  </div>
                ) : (
                  <Badge variant="outline">Not Generated</Badge>
                )}
              </CardContent>
            </Card>
          );
        })}
      </div>

      {/* Status Summary */}
      {(completedCount > 0 || generatingCount > 0) && (
        <div className="flex items-center gap-4 text-sm text-muted-foreground">
          {completedCount > 0 && (
            <div className="flex items-center gap-1">
              <Check className="h-4 w-4 text-green-500" />
              {completedCount} completed
            </div>
          )}
          {generatingCount > 0 && (
            <div className="flex items-center gap-1">
              <Loader2 className="h-4 w-4 animate-spin" />
              {generatingCount} generating
            </div>
          )}
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/bid-proposals/envelope-editor.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Badge } from '@/components/ui/badge';
import { Sparkles, Save, Loader2, FileText, Copy, Check, Download, Presentation, FileDown } from 'lucide-react';
import { toast } from 'sonner';
import { BidProposalData, getEnvelopeStatusBadge } from '@/lib/bid-proposal-types';
import { cn } from '@/lib/utils';

interface EnvelopeEditorProps {
  bidProposal: BidProposalData;
  envelopeType: 1 | 2;
  onUpdate: () => void;
}

export function EnvelopeEditor({ bidProposal, envelopeType, onUpdate }: EnvelopeEditorProps) {
  const isEnvelope1 = envelopeType === 1;
  const content = isEnvelope1 ? bidProposal.envelope1Content : bidProposal.envelope2Content;
  const status = isEnvelope1 ? bidProposal.envelope1Status : bidProposal.envelope2Status;
  const notes = isEnvelope1 ? bidProposal.envelope1Notes : bidProposal.envelope2Notes;
  
  const [editedContent, setEditedContent] = useState(content || '');
  const [editedNotes, setEditedNotes] = useState(notes || '');
  const [customInstructions, setCustomInstructions] = useState('');
  const [selectedServices, setSelectedServices] = useState<string[]>(bidProposal.selectedServices || []);
  const [baseEmailProposal, setBaseEmailProposal] = useState(bidProposal.baseEmailProposal || '');
  const [bidDocumentsContent, setBidDocumentsContent] = useState('');
  
  const [saving, setSaving] = useState(false);
  const [generating, setGenerating] = useState(false);
  const [showAIDialog, setShowAIDialog] = useState(false);
  const [copied, setCopied] = useState(false);

  const handleSave = async () => {
    setSaving(true);
    try {
      const updateData: any = {};
      
      if (isEnvelope1) {
        updateData.envelope1Content = editedContent;
        updateData.envelope1Notes = editedNotes;
        if (!status || status === 'draft') {
          updateData.envelope1Status = editedContent ? 'in_progress' : 'draft';
        }
      } else {
        updateData.envelope2Content = editedContent;
        updateData.envelope2Notes = editedNotes;
        if (!status || status === 'draft') {
          updateData.envelope2Status = editedContent ? 'in_progress' : 'draft';
        }
      }

      const res = await fetch(`/api/bid-proposals/${bidProposal.id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updateData),
      });

      if (!res.ok) {
        const error = await res.json();
        throw new Error(error.error || 'Failed to save');
      }

      toast.success('Saved successfully');
      onUpdate();
    } catch (error: any) {
      console.error('Error saving:', error);
      toast.error(error.message || 'Failed to save');
    } finally {
      setSaving(false);
    }
  };

  const handleGenerate = async () => {
    setGenerating(true);
    try {
      const res = await fetch(`/api/bid-proposals/${bidProposal.id}/generate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          envelopeType,
          customInstructions,
          bidDocumentsContent,
          selectedServices: selectedServices.length > 0 ? selectedServices : undefined,
          baseEmailProposal: baseEmailProposal.trim() || undefined,
        }),
      });

      if (!res.ok) {
        const error = await res.json();
        throw new Error(error.error || 'Failed to generate proposal');
      }

      const data = await res.json();
      setEditedContent(data.content);
      setShowAIDialog(false);
      toast.success(`${isEnvelope1 ? 'Technical' : 'Cost'} proposal generated successfully`);
      onUpdate();
    } catch (error: any) {
      console.error('Error generating proposal:', error);
      toast.error(error.message || 'Failed to generate proposal');
    } finally {
      setGenerating(false);
    }
  };

  const handleCopy = async () => {
    try {
      await navigator.clipboard.writeText(editedContent);
      setCopied(true);
      toast.success('Copied to clipboard');
      setTimeout(() => setCopied(false), 2000);
    } catch (error) {
      toast.error('Failed to copy to clipboard');
    }
  };

  const handleDownloadPDF = async () => {
    try {
      // Add timestamp to prevent caching
      const timestamp = Date.now();
      const response = await fetch(`/api/bid-proposals/${bidProposal.id}/download-pdf?envelope=${envelopeType}&t=${timestamp}`, {
        cache: 'no-store'
      });
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'Failed to download PDF');
      }

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${bidProposal.solicitationNumber || 'bid'}_envelope${envelopeType}_${timestamp}.pdf`;
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);
      toast.success('PDF downloaded successfully');
    } catch (error: any) {
      console.error('Error downloading PDF:', error);
      toast.error(error.message || 'Failed to download PDF');
    }
  };

  const handleDownloadSlides = async () => {
    try {
      const response = await fetch(`/api/bid-proposals/${bidProposal.id}/download-slides?envelope=${envelopeType}`);
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'Failed to download presentation');
      }

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const envelopeLabel = isEnvelope1 ? 'technical' : 'cost';
      a.download = `${bidProposal.solicitationNumber || 'bid'}_${envelopeLabel}_slides_${Date.now()}.pptx`;
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);
      toast.success('Presentation downloaded successfully');
    } catch (error: any) {
      console.error('Error downloading presentation:', error);
      toast.error(error.message || 'Failed to download presentation');
    }
  };

  const handleDownloadWord = async () => {
    try {
      const timestamp = Date.now();
      const response = await fetch(`/api/bid-proposals/${bidProposal.id}/download-word?envelope=${envelopeType}&t=${timestamp}`, {
        cache: 'no-store'
      });
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'Failed to download Word document');
      }

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const envelopeLabel = isEnvelope1 ? 'technical' : 'cost';
      a.download = `${bidProposal.solicitationNumber || 'bid'}_${envelopeLabel}_${timestamp}.docx`;
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);
      toast.success('Word document downloaded successfully');
    } catch (error: any) {
      console.error('Error downloading Word document:', error);
      toast.error(error.message || 'Failed to download Word document');
    }
  };

  return (
    <div className="space-y-4">
      {/* Header */}
      <Card>
        <CardHeader>
          <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div className="flex-1 min-w-0">
              <CardTitle className="flex items-center gap-2 text-base sm:text-lg">
                <FileText className="h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0" />
                <span className="break-words">Envelope {envelopeType} - {isEnvelope1 ? 'Technical' : 'Cost'}</span>
              </CardTitle>
              <CardDescription className="mt-1 text-xs sm:text-sm">
                {isEnvelope1
                  ? 'Technical approach, methodology, timeline, and team qualifications'
                  : 'Pricing breakdown, payment terms, and cost justification'}
              </CardDescription>
            </div>
            <Badge className={cn('flex-shrink-0 whitespace-nowrap', getEnvelopeStatusBadge(status).className)}>
              {getEnvelopeStatusBadge(status).label}
            </Badge>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex flex-col gap-2">
            <Dialog open={showAIDialog} onOpenChange={setShowAIDialog}>
              <DialogTrigger asChild>
                <Button variant="outline" className="w-full">
                  <Sparkles className="h-4 w-4 mr-2" />
                  Generate with AI
                </Button>
              </DialogTrigger>
              <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto w-[95vw] sm:w-full">
                <DialogHeader>
                  <DialogTitle className="text-base sm:text-lg">Generate {isEnvelope1 ? 'Technical' : 'Cost'} Proposal</DialogTitle>
                  <DialogDescription className="text-sm">
                    Use AI to generate a professional proposal based on bid requirements and CDM Suite services
                  </DialogDescription>
                </DialogHeader>
                <div className="space-y-3 sm:space-y-4 mt-4">
                  <div className="space-y-2">
                    <Label htmlFor="customInstructions">Custom Instructions (Optional)</Label>
                    <Textarea
                      id="customInstructions"
                      placeholder="Add any specific requirements or focus areas..."
                      value={customInstructions}
                      onChange={(e) => setCustomInstructions(e.target.value)}
                      rows={3}
                    />
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="bidDocuments">Bid Documents Content (Optional)</Label>
                    <Textarea
                      id="bidDocuments"
                      placeholder="Paste relevant content from bid documents..."
                      value={bidDocumentsContent}
                      onChange={(e) => setBidDocumentsContent(e.target.value)}
                      rows={4}
                    />
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="services">Services to Emphasize (Optional)</Label>
                    <Textarea
                      id="services"
                      placeholder="e.g., Web Design, SEO, AI Solutions, App Development"
                      value={selectedServices.join(', ')}
                      onChange={(e) => setSelectedServices(e.target.value.split(',').map(s => s.trim()).filter(Boolean))}
                      rows={2}
                    />
                  </div>

                  {!isEnvelope1 && (
                    <div className="space-y-2">
                      <Label htmlFor="baseProposal">Reference Proposal (Optional)</Label>
                      <Textarea
                        id="baseProposal"
                        placeholder="Paste a previous email proposal or pricing structure as reference..."
                        value={baseEmailProposal}
                        onChange={(e) => setBaseEmailProposal(e.target.value)}
                        rows={4}
                      />
                    </div>
                  )}

                  <div className="flex flex-col sm:flex-row justify-end gap-2 pt-4">
                    <Button
                      type="button"
                      variant="outline"
                      onClick={() => setShowAIDialog(false)}
                      disabled={generating}
                      className="w-full sm:w-auto order-2 sm:order-1"
                    >
                      Cancel
                    </Button>
                    <Button onClick={handleGenerate} disabled={generating} className="w-full sm:w-auto order-1 sm:order-2">
                      {generating ? (
                        <>
                          <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                          Generating...
                        </>
                      ) : (
                        <>
                          <Sparkles className="h-4 w-4 mr-2" />
                          Generate Proposal
                        </>
                      )}
                    </Button>
                  </div>
                </div>
              </DialogContent>
            </Dialog>

            <div className="grid grid-cols-2 sm:grid-cols-5 gap-2">
              <Button
                variant="outline"
                onClick={handleDownloadPDF}
                disabled={!editedContent}
                className="w-full"
              >
                <Download className="h-4 w-4 mr-2" />
                <span className="hidden sm:inline">PDF</span>
                <span className="sm:hidden">PDF</span>
              </Button>

              <Button
                variant="outline"
                onClick={handleDownloadWord}
                disabled={!editedContent}
                className="w-full"
              >
                <FileDown className="h-4 w-4 mr-2" />
                <span className="hidden sm:inline">Word</span>
                <span className="sm:hidden">DOCX</span>
              </Button>

              <Button
                variant="outline"
                onClick={handleDownloadSlides}
                disabled={!editedContent}
                className="w-full"
              >
                <Presentation className="h-4 w-4 mr-2" />
                <span className="hidden sm:inline">Slides</span>
                <span className="sm:hidden">PPTX</span>
              </Button>

              <Button
                variant="outline"
                onClick={handleCopy}
                disabled={!editedContent}
                className="w-full"
              >
                {copied ? <Check className="h-4 w-4 mr-2" /> : <Copy className="h-4 w-4 mr-2" />}
                <span>Copy</span>
              </Button>

              <Button onClick={handleSave} disabled={saving} className="w-full">
                {saving ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    <span className="hidden sm:inline">Saving...</span>
                    <span className="sm:hidden">Save...</span>
                  </>
                ) : (
                  <>
                    <Save className="h-4 w-4 mr-2" />
                    <span>Save</span>
                  </>
                )}
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Content Editor */}
      <Card>
        <CardHeader>
          <CardTitle className="text-base">Proposal Content</CardTitle>
        </CardHeader>
        <CardContent>
          <Textarea
            value={editedContent}
            onChange={(e) => setEditedContent(e.target.value)}
            placeholder={`Enter or generate your ${isEnvelope1 ? 'technical' : 'cost'} proposal content here...`}
            rows={20}
            className="font-mono text-sm"
          />
        </CardContent>
      </Card>

      {/* Internal Notes */}
      <Card>
        <CardHeader>
          <CardTitle className="text-base">Internal Notes</CardTitle>
          <CardDescription>
            Private notes for internal use (not included in proposal)
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Textarea
            value={editedNotes}
            onChange={(e) => setEditedNotes(e.target.value)}
            placeholder="Add internal notes, reminders, or strategy notes..."
            rows={4}
          />
        </CardContent>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/bid-proposals/general-settings-editor.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import {
  Save,
  Loader2,
  Plus,
  Trash2,
  CheckCircle2,
  AlertCircle,
  Info,
  FileCheck,
  Shield,
  Building2,
  Users,
} from 'lucide-react';
import { toast } from 'sonner';
import { BidProposalData, BusinessListing, BusinessVerificationResult } from '@/lib/bid-proposal-types';
import { cn } from '@/lib/utils';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';

interface GeneralSettingsEditorProps {
  bidProposal: BidProposalData;
  onUpdate: () => void;
}

export function GeneralSettingsEditor({ bidProposal, onUpdate }: GeneralSettingsEditorProps) {
  // General Comment state
  const [generalComment, setGeneralComment] = useState(bidProposal.generalProposalComment || '');
  
  // HUB Plan state
  const [hubPlanRequired, setHubPlanRequired] = useState(bidProposal.hubPlanRequired || false);
  const [hubFeeThreshold, setHubFeeThreshold] = useState(
    bidProposal.hubFeeThreshold?.toString() || ''
  );
  
  // Business Listings state
  const [businessListings, setBusinessListings] = useState<BusinessListing[]>(() => {
    try {
      if (bidProposal.businessListings && typeof bidProposal.businessListings === 'string') {
        return JSON.parse(bidProposal.businessListings);
      }
      return bidProposal.businessListings || [];
    } catch {
      return [];
    }
  });
  
  const [saving, setSaving] = useState(false);
  const [verifying, setVerifying] = useState(false);

  const addBusinessListing = () => {
    const newListing: BusinessListing = {
      id: `temp_${Date.now()}`,
      businessName: '',
      role: 'subcontractor',
      certifications: [],
    };
    setBusinessListings([...businessListings, newListing]);
  };

  const removeBusinessListing = (id: string) => {
    setBusinessListings(businessListings.filter(b => b.id !== id));
  };

  const updateBusinessListing = (id: string, field: keyof BusinessListing, value: any) => {
    setBusinessListings(businessListings.map(b => 
      b.id === id ? { ...b, [field]: value } : b
    ));
  };

  const handleSave = async () => {
    setSaving(true);
    try {
      const updateData: any = {
        generalProposalComment: generalComment || null,
        hubPlanRequired,
        hubFeeThreshold: hubFeeThreshold ? parseFloat(hubFeeThreshold) : null,
        businessListings: JSON.stringify(businessListings),
      };

      const res = await fetch(`/api/bid-proposals/${bidProposal.id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updateData),
      });

      if (!res.ok) {
        const error = await res.json();
        throw new Error(error.error || 'Failed to save');
      }

      toast.success('Settings saved successfully');
      onUpdate();
    } catch (error: any) {
      console.error('Error saving:', error);
      toast.error(error.message || 'Failed to save settings');
    } finally {
      setSaving(false);
    }
  };

  const handleVerifyBusinesses = async () => {
    if (businessListings.length === 0) {
      toast.error('Please add at least one business to verify');
      return;
    }

    setVerifying(true);
    try {
      const res = await fetch(`/api/bid-proposals/${bidProposal.id}/verify-businesses`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ businesses: businessListings }),
      });

      if (!res.ok) {
        const error = await res.json();
        throw new Error(error.error || 'Failed to verify businesses');
      }

      const data = await res.json();
      toast.success('Business verification complete!');
      onUpdate();
    } catch (error: any) {
      console.error('Error verifying businesses:', error);
      toast.error(error.message || 'Failed to verify businesses');
    } finally {
      setVerifying(false);
    }
  };

  const proposedPrice = bidProposal.proposedPrice || 0;
  const feeThresholdValue = hubFeeThreshold ? parseFloat(hubFeeThreshold) : 0;
  const meetsThreshold = proposedPrice >= feeThresholdValue && feeThresholdValue > 0;

  // Parse verification results
  const verificationResults: BusinessVerificationResult[] = (() => {
    try {
      if (bidProposal.businessVerificationResults && typeof bidProposal.businessVerificationResults === 'string') {
        return JSON.parse(bidProposal.businessVerificationResults);
      }
      return bidProposal.businessVerificationResults || [];
    } catch {
      return [];
    }
  })();

  return (
    <div className="space-y-6">
      {/* General Proposal Comment Section */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <FileCheck className="h-5 w-5 text-blue-600" />
            General Proposal Comment
          </CardTitle>
          <CardDescription>
            This comment will be automatically included in all proposal documents (Technical, Cost, HUB plans, etc.) to ensure consistent messaging.
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <Label htmlFor="generalComment">Comment</Label>
            <Textarea
              id="generalComment"
              placeholder="E.g., This proposal demonstrates our commitment to excellence and our proven track record of delivering $9.3B+ in infrastructure projects..."
              value={generalComment}
              onChange={(e) => setGeneralComment(e.target.value)}
              className="min-h-[150px] mt-2"
            />
            <p className="text-xs text-gray-500 mt-2">
              This comment will appear prominently in all generated documents to maintain brand consistency and key messaging.
            </p>
          </div>
        </CardContent>
      </Card>

      {/* HUB/Subcontracting Plan Logic Section */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Shield className="h-5 w-5 text-purple-600" />
            HUB/Subcontracting Plan Settings
          </CardTitle>
          <CardDescription>
            Configure requirements for Historically Underutilized Business (HUB) and subcontracting plans based on governmental thresholds.
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {/* Fee Threshold */}
          <div>
            <Label htmlFor="hubFeeThreshold">Governmental Fee Threshold</Label>
            <Input
              id="hubFeeThreshold"
              type="number"
              placeholder="Enter threshold amount (e.g., 100000)"
              value={hubFeeThreshold}
              onChange={(e) => setHubFeeThreshold(e.target.value)}
              className="mt-2"
            />
            <p className="text-xs text-gray-500 mt-2">
              County/State/Federal threshold for requiring full HUB plan
            </p>
          </div>

          {/* Current Status Display */}
          {proposedPrice > 0 && (
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <span className="text-sm font-medium text-gray-700">Proposed Price:</span>
                  <span className="text-sm font-semibold text-gray-900">
                    ${proposedPrice.toLocaleString()}
                  </span>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-sm font-medium text-gray-700">Fee Threshold:</span>
                  <span className="text-sm font-semibold text-gray-900">
                    ${feeThresholdValue.toLocaleString()}
                  </span>
                </div>
                <div className="flex items-center justify-between pt-2 border-t border-blue-300">
                  <span className="text-sm font-medium text-gray-700">Full HUB Plan Required:</span>
                  <Badge className={meetsThreshold ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}>
                    {meetsThreshold ? 'Yes - Above Threshold' : 'No - Below Threshold'}
                  </Badge>
                </div>
              </div>
            </div>
          )}

          {/* Intent/Waiver Information */}
          <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
            <div className="flex gap-2">
              <Info className="h-5 w-5 text-purple-600 flex-shrink-0 mt-0.5" />
              <div className="text-sm text-purple-900">
                <p className="font-medium mb-2">HUB Plan Logic:</p>
                <ul className="list-disc list-inside space-y-1 text-xs">
                  <li><strong>Below Threshold:</strong> Generate simplified intent/waiver document aligned with County/State/Federal requirements</li>
                  <li><strong>Above Threshold:</strong> Include full, detailed HUB subcontracting plan</li>
                  <li><strong>Partnership Status:</strong> Final contractual confirmation occurs only after client accepts bid</li>
                </ul>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Business Listing Verification Section */}
      <Card>
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle className="flex items-center gap-2">
                <Building2 className="h-5 w-5 text-green-600" />
                Business Listing & Verification
              </CardTitle>
              <CardDescription>
                Manage businesses for contracting families/helpers and verify their legitimacy before bid submission.
              </CardDescription>
            </div>
            <Button
              variant="outline"
              size="sm"
              onClick={addBusinessListing}
            >
              <Plus className="h-4 w-4 mr-2" />
              Add Business
            </Button>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          {/* Verification Status */}
          {bidProposal.businessVerificationStatus && bidProposal.businessVerificationStatus !== 'not_verified' && (
            <div className={cn(
              'rounded-lg p-4 border',
              bidProposal.businessVerificationStatus === 'verified' && 'bg-green-50 border-green-200',
              bidProposal.businessVerificationStatus === 'verifying' && 'bg-blue-50 border-blue-200',
              bidProposal.businessVerificationStatus === 'failed' && 'bg-red-50 border-red-200',
            )}>
              <div className="flex items-center gap-2">
                {bidProposal.businessVerificationStatus === 'verified' && (
                  <CheckCircle2 className="h-5 w-5 text-green-600" />
                )}
                {bidProposal.businessVerificationStatus === 'verifying' && (
                  <Loader2 className="h-5 w-5 text-blue-600 animate-spin" />
                )}
                {bidProposal.businessVerificationStatus === 'failed' && (
                  <AlertCircle className="h-5 w-5 text-red-600" />
                )}
                <span className="font-medium text-sm">
                  Status: {bidProposal.businessVerificationStatus === 'verified' ? 'Verified' : 
                           bidProposal.businessVerificationStatus === 'verifying' ? 'Verifying...' : 'Verification Failed'}
                </span>
              </div>
              {bidProposal.businessVerificationNote && (
                <p className="text-xs mt-2 text-gray-700">{bidProposal.businessVerificationNote}</p>
              )}
            </div>
          )}

          {/* Business Listings */}
          {businessListings.length === 0 ? (
            <div className="text-center py-8 text-gray-500">
              <Users className="h-12 w-12 mx-auto mb-3 text-gray-300" />
              <p className="text-sm">No businesses added yet</p>
              <p className="text-xs mt-1">Click "Add Business" to get started</p>
            </div>
          ) : (
            <div className="space-y-4">
              {businessListings.map((business, index) => {
                const verificationResult = verificationResults.find(r => r.businessId === business.id);
                
                return (
                  <Card key={business.id} className="border-gray-200">
                    <CardContent className="pt-4">
                      <div className="flex items-start justify-between mb-4">
                        <h4 className="text-sm font-medium text-gray-900">Business #{index + 1}</h4>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => removeBusinessListing(business.id)}
                        >
                          <Trash2 className="h-4 w-4 text-red-500" />
                        </Button>
                      </div>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <Label htmlFor={`businessName_${business.id}`}>Business Name *</Label>
                          <Input
                            id={`businessName_${business.id}`}
                            value={business.businessName}
                            onChange={(e) => updateBusinessListing(business.id, 'businessName', e.target.value)}
                            placeholder="Enter business name"
                            className="mt-1"
                          />
                        </div>
                        
                        <div>
                          <Label htmlFor={`role_${business.id}`}>Role *</Label>
                          <Select
                            value={business.role || 'subcontractor'}
                            onValueChange={(value) => updateBusinessListing(business.id, 'role', value)}
                          >
                            <SelectTrigger id={`role_${business.id}`} className="mt-1">
                              <SelectValue placeholder="Select role" />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="subcontractor">Subcontractor</SelectItem>
                              <SelectItem value="helper">Helper</SelectItem>
                              <SelectItem value="partner">Partner</SelectItem>
                              <SelectItem value="consultant">Consultant</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        
                        <div>
                          <Label htmlFor={`contactPerson_${business.id}`}>Contact Person</Label>
                          <Input
                            id={`contactPerson_${business.id}`}
                            value={business.contactPerson || ''}
                            onChange={(e) => updateBusinessListing(business.id, 'contactPerson', e.target.value)}
                            placeholder="Contact name"
                            className="mt-1"
                          />
                        </div>
                        
                        <div>
                          <Label htmlFor={`email_${business.id}`}>Email</Label>
                          <Input
                            id={`email_${business.id}`}
                            type="email"
                            value={business.email || ''}
                            onChange={(e) => updateBusinessListing(business.id, 'email', e.target.value)}
                            placeholder="email@example.com"
                            className="mt-1"
                          />
                        </div>
                        
                        <div>
                          <Label htmlFor={`phone_${business.id}`}>Phone</Label>
                          <Input
                            id={`phone_${business.id}`}
                            value={business.phone || ''}
                            onChange={(e) => updateBusinessListing(business.id, 'phone', e.target.value)}
                            placeholder="(123) 456-7890"
                            className="mt-1"
                          />
                        </div>
                        
                        <div>
                          <Label htmlFor={`estimatedValue_${business.id}`}>Estimated Value ($)</Label>
                          <Input
                            id={`estimatedValue_${business.id}`}
                            type="number"
                            value={business.estimatedValue || ''}
                            onChange={(e) => updateBusinessListing(business.id, 'estimatedValue', parseFloat(e.target.value) || 0)}
                            placeholder="50000"
                            className="mt-1"
                          />
                        </div>
                      </div>

                      <div className="mt-4">
                        <Label htmlFor={`proposedScope_${business.id}`}>Proposed Scope</Label>
                        <Textarea
                          id={`proposedScope_${business.id}`}
                          value={business.proposedScope || ''}
                          onChange={(e) => updateBusinessListing(business.id, 'proposedScope', e.target.value)}
                          placeholder="Brief description of work scope..."
                          className="mt-1"
                          rows={2}
                        />
                      </div>

                      {/* Verification Result Display */}
                      {verificationResult && (
                        <div className={cn(
                          'mt-4 p-3 rounded-lg border',
                          verificationResult.exists ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'
                        )}>
                          <div className="flex items-center gap-2">
                            {verificationResult.exists ? (
                              <CheckCircle2 className="h-4 w-4 text-green-600" />
                            ) : (
                              <AlertCircle className="h-4 w-4 text-red-600" />
                            )}
                            <span className="text-sm font-medium">
                              {verificationResult.exists ? 'Verified' : 'Not Found'}
                              {verificationResult.status && ` - ${verificationResult.status}`}
                            </span>
                          </div>
                          {verificationResult.notes && (
                            <p className="text-xs mt-2 text-gray-700">{verificationResult.notes}</p>
                          )}
                          {verificationResult.requiresPartnershipConfirmation && (
                            <p className="text-xs mt-2 text-orange-700 font-medium">
                              ‚ö†Ô∏è Partnership confirmation required after client accepts bid
                            </p>
                          )}
                        </div>
                      )}
                    </CardContent>
                  </Card>
                );
              })}
            </div>
          )}

          {/* Verification Action */}
          {businessListings.length > 0 && (
            <div className="space-y-3">
              <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                <div className="flex gap-2">
                  <Info className="h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5" />
                  <div className="text-sm text-yellow-900">
                    <p className="font-medium mb-1">Business Verification Note:</p>
                    <p className="text-xs">
                      This verification checks for basic business existence and status only. 
                      Final contractual partnership confirmation cannot occur until the client accepts the bid.
                    </p>
                  </div>
                </div>
              </div>
              
              <Button
                onClick={handleVerifyBusinesses}
                disabled={verifying}
                className="w-full bg-green-600 hover:bg-green-700"
              >
                {verifying ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    Verifying Businesses...
                  </>
                ) : (
                  <>
                    <CheckCircle2 className="h-4 w-4 mr-2" />
                    Verify All Businesses
                  </>
                )}
              </Button>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Save Button */}
      <div className="flex justify-end gap-3">
        <Button
          onClick={handleSave}
          disabled={saving}
          className="bg-blue-600 hover:bg-blue-700"
        >
          {saving ? (
            <>
              <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              Saving...
            </>
          ) : (
            <>
              <Save className="h-4 w-4 mr-2" />
              Save Settings
            </>
          )}
        </Button>
      </div>
    </div>
  );
}

// ==========================================
// File: components/bid-proposals/processing-status-indicator.tsx
// ==========================================


'use client';

import { useEffect, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Loader2, CheckCircle2, XCircle, FileText, Brain, Sparkles, FolderCheck } from 'lucide-react';
import { ProcessingStatus, ProcessingStage } from '@/lib/bid-proposal-types';

interface ProcessingStatusIndicatorProps {
  bidId: string;
  initialStatus?: ProcessingStatus;
  initialStage?: ProcessingStage | null;
  initialProgress?: number;
  initialMessage?: string | null;
  initialError?: string | null;
  onStatusChange?: (status: ProcessingStatus) => void;
}

const STAGE_ICONS: Record<ProcessingStage, any> = {
  uploading_files: FolderCheck,
  extracting_pdf: FileText,
  extracting_email: FileText,
  analyzing_content: Brain,
  detecting_client_type: Brain,
  researching_budget: Brain,
  generating_proposal: Sparkles,
  generating_intelligence: Brain,
  finalizing: CheckCircle2,
};

const STAGE_LABELS: Record<ProcessingStage, string> = {
  uploading_files: 'Uploading Files',
  extracting_pdf: 'Extracting PDF Content',
  extracting_email: 'Extracting Email Content',
  analyzing_content: 'Analyzing Documents',
  detecting_client_type: 'Detecting Client Type',
  researching_budget: 'Researching Budget Data',
  generating_proposal: 'Generating Proposal',
  generating_intelligence: 'Generating Intelligence',
  finalizing: 'Finalizing',
};

export function ProcessingStatusIndicator({
  bidId,
  initialStatus = 'idle',
  initialStage = null,
  initialProgress = 0,
  initialMessage = null,
  initialError = null,
  onStatusChange,
}: ProcessingStatusIndicatorProps) {
  const [status, setStatus] = useState<ProcessingStatus>(initialStatus);
  const [stage, setStage] = useState<ProcessingStage | null>(initialStage);
  const [progress, setProgress] = useState(initialProgress);
  const [message, setMessage] = useState(initialMessage);
  const [error, setError] = useState(initialError);
  const [isVisible, setIsVisible] = useState(initialStatus !== 'idle' && initialStatus !== 'completed');

  // Poll for status updates
  useEffect(() => {
    if (status === 'idle' || status === 'completed' || status === 'error') {
      // Stop polling if we're in a terminal state
      if (status === 'completed' || status === 'error') {
        // Auto-hide after 5 seconds
        const hideTimer = setTimeout(() => {
          setIsVisible(false);
        }, 5000);
        return () => clearTimeout(hideTimer);
      }
      return;
    }

    // Poll every 2 seconds while processing
    const pollInterval = setInterval(async () => {
      try {
        const response = await fetch(`/api/bid-proposals/${bidId}`);
        if (response.ok) {
          const data = await response.json();
          const newStatus = data.processingStatus || 'idle';
          
          setStatus(newStatus);
          setStage(data.processingStage || null);
          setProgress(data.processingProgress || 0);
          setMessage(data.processingMessage || null);
          setError(data.processingError || null);

          if (onStatusChange) {
            onStatusChange(newStatus);
          }

          // Show indicator if processing
          if (newStatus !== 'idle') {
            setIsVisible(true);
          }
        }
      } catch (err) {
        console.error('Error polling status:', err);
      }
    }, 2000);

    return () => clearInterval(pollInterval);
  }, [bidId, status, onStatusChange]);

  // Don't render if not visible
  if (!isVisible) {
    return null;
  }

  const StatusIcon = stage ? STAGE_ICONS[stage] : Loader2;

  return (
    <Card className="border-l-4 border-l-blue-500 shadow-lg">
      <CardHeader className="pb-3">
        <div className="flex items-center justify-between">
          <CardTitle className="text-lg flex items-center gap-2">
            {status === 'extracting' && (
              <>
                <Loader2 className="h-5 w-5 animate-spin text-blue-500" />
                <span>Extracting Documents...</span>
              </>
            )}
            {status === 'generating' && (
              <>
                <Sparkles className="h-5 w-5 text-purple-500 animate-pulse" />
                <span>Generating Proposal...</span>
              </>
            )}
            {status === 'completed' && (
              <>
                <CheckCircle2 className="h-5 w-5 text-green-500" />
                <span>Processing Complete</span>
              </>
            )}
            {status === 'error' && (
              <>
                <XCircle className="h-5 w-5 text-red-500" />
                <span>Processing Error</span>
              </>
            )}
          </CardTitle>
          <Badge 
            variant={
              status === 'completed' ? 'default' :
              status === 'error' ? 'destructive' :
              'secondary'
            }
            className={
              status === 'extracting' ? 'bg-blue-100 text-blue-700 border-blue-200' :
              status === 'generating' ? 'bg-purple-100 text-purple-700 border-purple-200' :
              ''
            }
          >
            {progress}%
          </Badge>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Progress Bar */}
        <div className="space-y-2">
          <Progress 
            value={progress} 
            className={`h-2 ${
              status === 'completed' ? '[&>div]:bg-green-500' :
              status === 'error' ? '[&>div]:bg-red-500' :
              status === 'generating' ? '[&>div]:bg-purple-500' :
              '[&>div]:bg-blue-500'
            }`}
          />
          
          {/* Current Stage */}
          {stage && (
            <div className="flex items-center gap-2 text-sm text-muted-foreground">
              <StatusIcon className="h-4 w-4" />
              <span>{STAGE_LABELS[stage]}</span>
            </div>
          )}
        </div>

        {/* Status Message */}
        {message && (
          <Alert className={
            status === 'completed' ? 'border-green-200 bg-green-50' :
            status === 'error' ? 'border-red-200 bg-red-50' :
            'border-blue-200 bg-blue-50'
          }>
            <AlertDescription className="text-sm">
              {message}
            </AlertDescription>
          </Alert>
        )}

        {/* Error Message */}
        {error && status === 'error' && (
          <Alert variant="destructive">
            <XCircle className="h-4 w-4" />
            <AlertDescription className="text-sm">
              {error}
            </AlertDescription>
          </Alert>
        )}

        {/* Processing Stages Timeline */}
        {(status === 'extracting' || status === 'generating') && (
          <div className="text-xs text-muted-foreground space-y-1 pt-2 border-t">
            <div className="font-medium mb-2">Processing Steps:</div>
            <div className={progress >= 10 ? 'text-green-600 flex items-center gap-1' : 'flex items-center gap-1'}>
              {progress >= 10 ? <CheckCircle2 className="h-3 w-3" /> : <div className="h-3 w-3 rounded-full border-2 border-gray-300" />}
              <span>Upload files</span>
            </div>
            <div className={progress >= 20 ? 'text-green-600 flex items-center gap-1' : 'flex items-center gap-1'}>
              {progress >= 20 ? <CheckCircle2 className="h-3 w-3" /> : <div className="h-3 w-3 rounded-full border-2 border-gray-300" />}
              <span>Extract document text</span>
            </div>
            <div className={progress >= 40 ? 'text-green-600 flex items-center gap-1' : 'flex items-center gap-1'}>
              {progress >= 40 ? <CheckCircle2 className="h-3 w-3" /> : <div className="h-3 w-3 rounded-full border-2 border-gray-300" />}
              <span>Analyze bid information</span>
            </div>
            <div className={progress >= 50 ? 'text-green-600 flex items-center gap-1' : 'flex items-center gap-1'}>
              {progress >= 50 ? <CheckCircle2 className="h-3 w-3" /> : <div className="h-3 w-3 rounded-full border-2 border-gray-300" />}
              <span>Generate proposals</span>
            </div>
            <div className={progress >= 100 ? 'text-green-600 flex items-center gap-1' : 'flex items-center gap-1'}>
              {progress >= 100 ? <CheckCircle2 className="h-3 w-3" /> : <div className="h-3 w-3 rounded-full border-2 border-gray-300" />}
              <span>Finalize and save</span>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}

// ==========================================
// File: components/bid-proposals/section-editor.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";
import { Loader2, Save, X, Wand2 } from "lucide-react";
import toast from "react-hot-toast";

interface SectionEditorProps {
  bidId: string;
  section: "envelope1Content" | "envelope2Content" | "envelope1Notes" | "envelope2Notes" | "generalProposalComment";
  initialContent: string;
  label: string;
  placeholder?: string;
  onSave?: () => void;
}

export function SectionEditor({
  bidId,
  section,
  initialContent,
  label,
  placeholder,
  onSave,
}: SectionEditorProps) {
  const [content, setContent] = useState(initialContent || "");
  const [isSaving, setIsSaving] = useState(false);
  const [isRegenerating, setIsRegenerating] = useState(false);
  const [isEditing, setIsEditing] = useState(false);

  const handleSave = async () => {
    setIsSaving(true);
    try {
      const response = await fetch(`/api/bid-proposals/${bidId}/update-section`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ section, content }),
      });

      if (!response.ok) {
        throw new Error("Failed to save section");
      }

      toast.success("Section saved successfully");
      setIsEditing(false);
      onSave?.();
    } catch (error) {
      console.error("Error saving section:", error);
      toast.error("Failed to save section");
    } finally {
      setIsSaving(false);
    }
  };

  const handleRegenerate = async () => {
    setIsRegenerating(true);
    try {
      const response = await fetch(`/api/bid-proposals/${bidId}/regenerate-section`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ section }),
      });

      if (!response.ok) {
        throw new Error("Failed to regenerate section");
      }

      const data = await response.json();
      setContent(data.content || "");
      toast.success("Section regenerated successfully");
      onSave?.();
    } catch (error) {
      console.error("Error regenerating section:", error);
      toast.error("Failed to regenerate section");
    } finally {
      setIsRegenerating(false);
    }
  };

  const handleCancel = () => {
    setContent(initialContent || "");
    setIsEditing(false);
  };

  if (!isEditing) {
    return (
      <div className="space-y-4">
        <div className="flex items-center justify-between">
          <h3 className="text-lg font-semibold">{label}</h3>
          <div className="flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => setIsEditing(true)}
            >
              Edit
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={handleRegenerate}
              disabled={isRegenerating}
            >
              {isRegenerating ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Regenerating...
                </>
              ) : (
                <>
                  <Wand2 className="mr-2 h-4 w-4" />
                  Regenerate with AI
                </>
              )}
            </Button>
          </div>
        </div>
        <div className="prose max-w-none rounded-lg border bg-muted/30 p-4">
          <div className="whitespace-pre-wrap">{content || "No content yet"}</div>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold">{label}</h3>
        <div className="flex gap-2">
          <Button
            variant="outline"
            size="sm"
            onClick={handleCancel}
            disabled={isSaving}
          >
            <X className="mr-2 h-4 w-4" />
            Cancel
          </Button>
          <Button
            size="sm"
            onClick={handleSave}
            disabled={isSaving}
          >
            {isSaving ? (
              <>
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                Saving...
              </>
            ) : (
              <>
                <Save className="mr-2 h-4 w-4" />
                Save
              </>
            )}
          </Button>
        </div>
      </div>
      <Textarea
        value={content}
        onChange={(e) => setContent(e.target.value)}
        placeholder={placeholder || `Enter ${label.toLowerCase()}...`}
        className="min-h-[400px] font-mono text-sm"
      />
      <p className="text-sm text-muted-foreground">
        {content.length.toLocaleString()} characters
      </p>
    </div>
  );
}

// ==========================================
// File: components/bid-proposals/title-editor.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Pencil, Check, X, Sparkles } from 'lucide-react';
import { toast } from 'sonner';

interface TitleEditorProps {
  bidProposalId: string;
  initialTitle?: string | null;
  onUpdate?: (newTitle: string) => void;
}

export function TitleEditor({ bidProposalId, initialTitle, onUpdate }: TitleEditorProps) {
  const [isEditing, setIsEditing] = useState(false);
  const [title, setTitle] = useState(initialTitle || '');
  const [saving, setSaving] = useState(false);
  const [regenerating, setRegenerating] = useState(false);

  const handleSave = async () => {
    if (!title.trim()) {
      toast.error('Title cannot be empty');
      return;
    }

    setSaving(true);
    try {
      const response = await fetch(`/api/bid-proposals/${bidProposalId}/update-title`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ proposalTitle: title }),
      });

      if (!response.ok) {
        throw new Error('Failed to update title');
      }

      toast.success('Title updated successfully');
      setIsEditing(false);
      if (onUpdate) {
        onUpdate(title);
      }
    } catch (error) {
      console.error('Error updating title:', error);
      toast.error('Failed to update title');
    } finally {
      setSaving(false);
    }
  };

  const handleRegenerate = async () => {
    setRegenerating(true);
    try {
      const response = await fetch(`/api/bid-proposals/${bidProposalId}/regenerate-title`, {
        method: 'POST',
      });

      if (!response.ok) {
        throw new Error('Failed to regenerate title');
      }

      const data = await response.json();
      setTitle(data.proposalTitle);
      toast.success('Title regenerated successfully');
      if (onUpdate) {
        onUpdate(data.proposalTitle);
      }
    } catch (error) {
      console.error('Error regenerating title:', error);
      toast.error('Failed to regenerate title');
    } finally {
      setRegenerating(false);
    }
  };

  const handleCancel = () => {
    setTitle(initialTitle || '');
    setIsEditing(false);
  };

  if (isEditing) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Pencil className="w-5 h-5" />
            Edit Proposal Title
          </CardTitle>
          <CardDescription>
            Enter a clear, professional title for your proposal
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="space-y-2">
            <Input
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              placeholder="Enter proposal title..."
              className="text-lg font-medium"
              maxLength={200}
            />
            <p className="text-sm text-muted-foreground">
              {title.length}/200 characters
            </p>
          </div>
          <div className="flex gap-2">
            <Button onClick={handleSave} disabled={saving || !title.trim()}>
              {saving ? (
                <>
                  <Check className="w-4 h-4 mr-2 animate-spin" />
                  Saving...
                </>
              ) : (
                <>
                  <Check className="w-4 h-4 mr-2" />
                  Save
                </>
              )}
            </Button>
            <Button variant="outline" onClick={handleCancel} disabled={saving}>
              <X className="w-4 h-4 mr-2" />
              Cancel
            </Button>
            <Button
              variant="secondary"
              onClick={handleRegenerate}
              disabled={regenerating || saving}
              className="ml-auto"
            >
              {regenerating ? (
                <>
                  <Sparkles className="w-4 h-4 mr-2 animate-spin" />
                  Generating...
                </>
              ) : (
                <>
                  <Sparkles className="w-4 h-4 mr-2" />
                  Regenerate with AI
                </>
              )}
            </Button>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <span>Proposal Title</span>
          <Button size="sm" variant="outline" onClick={() => setIsEditing(true)}>
            <Pencil className="w-4 h-4 mr-2" />
            Edit
          </Button>
        </CardTitle>
      </CardHeader>
      <CardContent>
        <p className="text-lg font-medium text-foreground">
          {title || 'No title set'}
        </p>
      </CardContent>
    </Card>
  );
}

// ==========================================
// File: components/blog/blog-hero.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import { BookOpen, TrendingUp, Users } from "lucide-react";

const BlogHero = () => {
  const stats = [
    {
      icon: BookOpen,
      number: "50+",
      label: "Articles Published"
    },
    {
      icon: TrendingUp,
      number: "10K+",
      label: "Monthly Readers"
    },
    {
      icon: Users,
      number: "500+",
      label: "Businesses Helped"
    }
  ];

  return (
    <section className="py-32 bg-gradient-to-r from-primary to-primary/80 text-white">
      <div className="section-container">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          className="text-center mb-16"
        >
          <h1 className="text-5xl md:text-6xl font-bold mb-6">
            Digital Marketing <span className="text-yellow-300">Blog</span>
          </h1>
          <p className="text-xl md:text-2xl text-primary-foreground/90 max-w-3xl mx-auto">
            Expert insights, proven strategies, and actionable tips to grow your business 
            through data-driven digital marketing.
          </p>
        </motion.div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          {stats.map((stat, index) => (
            <motion.div
              key={index}
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: index * 0.2 }}
              className="text-center"
            >
              <div className="bg-white/10 p-4 rounded-full inline-block mb-4">
                <stat.icon className="h-8 w-8" />
              </div>
              <div className="text-3xl font-bold text-yellow-300 mb-2">
                {stat.number}
              </div>
              <div className="text-primary-foreground/80">
                {stat.label}
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    </section>
  );
};

export default BlogHero;

// ==========================================
// File: components/blog/blog-list.tsx
// ==========================================


"use client";

import { useState } from "react";
import { motion } from "framer-motion";
import Image from "next/image";
import Link from "next/link";
import { Calendar, Clock, ArrowRight, Tag } from "lucide-react";
import { Button } from "@/components/ui/button";

const BlogList = () => {
  const [selectedCategory, setSelectedCategory] = useState("All");
  const [visiblePosts, setVisiblePosts] = useState(6);

  // Sample blog posts - in a real app, this would come from a database or CMS
  const blogPosts = [
    {
      id: "1",
      title: "10 Essential SEO Strategies for 2024",
      excerpt: "Discover the latest SEO techniques that will help your website rank higher in search results and drive more organic traffic.",
      image: "https://cdn.abacus.ai/images/970b470b-5cce-4f06-8637-65ff8c5feaa1.png",
      category: "SEO",
      date: "2024-10-05",
      readTime: "8 min read",
      slug: "essential-seo-strategies-2024"
    },
    {
      id: "2", 
      title: "How to Maximize ROI from PPC Advertising",
      excerpt: "Learn proven techniques to optimize your pay-per-click campaigns and achieve better returns on your advertising investment.",
      image: "https://cdn.abacus.ai/images/970b470b-5cce-4f06-8637-65ff8c5feaa1.png",
      category: "PPC",
      date: "2024-10-03",
      readTime: "6 min read",
      slug: "maximize-roi-ppc-advertising"
    },
    {
      id: "3",
      title: "The Future of AI in Digital Marketing",
      excerpt: "Explore how artificial intelligence is changing digital marketing and what it means for your business strategy.",
      image: "https://cdn.abacus.ai/images/970b470b-5cce-4f06-8637-65ff8c5feaa1.png",
      category: "AI",
      date: "2024-10-01",
      readTime: "10 min read",
      slug: "future-ai-digital-marketing"
    },
    {
      id: "4",
      title: "Mobile-First Design: Best Practices for 2024",
      excerpt: "Essential guidelines for creating responsive, user-friendly websites that perform excellently on mobile devices.",
      image: "https://cdn.abacus.ai/images/970b470b-5cce-4f06-8637-65ff8c5feaa1.png",
      category: "Web Design",
      date: "2024-09-28",
      readTime: "7 min read",
      slug: "mobile-first-design-best-practices"
    },
    {
      id: "5",
      title: "Social Media Marketing Trends to Watch",
      excerpt: "Stay ahead of the curve with the latest social media marketing trends that are driving engagement and conversions.",
      image: "https://cdn.abacus.ai/images/970b470b-5cce-4f06-8637-65ff8c5feaa1.png",
      category: "Social Media",
      date: "2024-09-25",
      readTime: "5 min read",
      slug: "social-media-marketing-trends-2024"
    },
    {
      id: "6",
      title: "Conversion Rate Optimization: A Complete Guide",
      excerpt: "Learn how to optimize your website for better conversions with proven CRO strategies and techniques.",
      image: "https://cdn.abacus.ai/images/970b470b-5cce-4f06-8637-65ff8c5feaa1.png",
      category: "CRO",
      date: "2024-09-22",
      readTime: "12 min read",
      slug: "conversion-rate-optimization-guide"
    }
  ];

  const categories = ["All", "SEO", "PPC", "AI", "Web Design", "Social Media", "CRO"];

  const filteredPosts = selectedCategory === "All" 
    ? blogPosts 
    : blogPosts.filter(post => post.category === selectedCategory);

  const displayedPosts = filteredPosts.slice(0, visiblePosts);

  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric"
    });
  };

  const loadMorePosts = () => {
    setVisiblePosts(prev => prev + 6);
  };

  return (
    <section className="py-20 bg-white">
      <div className="section-container">
        {/* Category Filter */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="flex flex-wrap gap-4 justify-center mb-16"
        >
          {categories.map((category) => (
            <Button
              key={category}
              variant={category === selectedCategory ? "default" : "outline"}
              onClick={() => {
                setSelectedCategory(category);
                setVisiblePosts(6);
              }}
              className={`${
                category === selectedCategory 
                  ? "bg-primary text-white hover:bg-primary/90" 
                  : "border-gray-300 hover:border-primary hover:text-primary"
              }`}
            >
              {category}
            </Button>
          ))}
        </motion.div>

        {/* Blog Posts Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {displayedPosts.map((post, index) => (
            <motion.article
              key={post.id}
              initial={{ opacity: 0, y: 30 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: index * 0.1 }}
              viewport={{ once: true }}
              className="bg-white rounded-lg shadow-lg overflow-hidden card-hover group"
            >
              <div className="relative h-48 bg-gray-100">
                <Image
                  src={post.image}
                  alt={post.title}
                  fill
                  className="object-cover group-hover:scale-105 transition-transform duration-300"
                />
                <div className="absolute top-4 left-4">
                  <span className="bg-primary text-white px-3 py-1 rounded-full text-sm font-semibold">
                    {post.category}
                  </span>
                </div>
              </div>
              
              <div className="p-6">
                <div className="flex items-center gap-4 text-sm text-gray-500 mb-4">
                  <div className="flex items-center gap-1">
                    <Calendar className="h-4 w-4" />
                    {formatDate(post.date)}
                  </div>
                  <div className="flex items-center gap-1">
                    <Clock className="h-4 w-4" />
                    {post.readTime}
                  </div>
                </div>
                
                <h3 className="text-xl font-semibold text-gray-900 mb-3 group-hover:text-primary transition-colors">
                  {post.title}
                </h3>
                
                <p className="text-gray-600 mb-4 line-clamp-3">
                  {post.excerpt}
                </p>
                
                <Link href={`/blog/${post.slug}`}>
                  <Button variant="ghost" className="group/btn p-0 h-auto text-primary hover:text-primary/80">
                    Read More
                    <ArrowRight className="ml-2 h-4 w-4 group-hover/btn:translate-x-1 transition-transform" />
                  </Button>
                </Link>
              </div>
            </motion.article>
          ))}
        </div>

        {/* Load More Button */}
        {filteredPosts.length > visiblePosts && (
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="text-center mt-12"
          >
            <Button 
              size="lg" 
              variant="outline" 
              className="group"
              onClick={loadMorePosts}
            >
              Load More Articles
              <ArrowRight className="ml-2 h-5 w-5 group-hover:translate-x-1 transition-transform" />
            </Button>
          </motion.div>
        )}

        {/* Newsletter Signup */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="mt-20 bg-primary/5 p-12 rounded-lg text-center"
        >
          <h3 className="text-3xl font-bold text-gray-900 mb-4">
            Stay Updated with Our Latest Insights
          </h3>
          <p className="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
            Get the latest digital marketing tips, strategies, and case studies delivered 
            directly to your inbox.
          </p>
          <Link href="/contact">
            <Button size="lg" className="btn-primary">
              Subscribe to Our Newsletter
            </Button>
          </Link>
        </motion.div>
      </div>
    </section>
  );
};

export default BlogList;

// ==========================================
// File: components/blog/blog-post-detail.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Image from "next/image";
import Link from "next/link";
import { ArrowLeft, Calendar, Clock, Share2 } from "lucide-react";
import { Button } from "@/components/ui/button";

interface BlogPostDetailProps {
  slug: string;
}

const BlogPostDetail = ({ slug }: BlogPostDetailProps) => {
  // In a real app, you'd fetch the blog post data based on the slug
  const blogPost = {
    title: "Digital Marketing Insights",
    content: "This is a sample blog post. In a production environment, you would fetch the actual content from your CMS or database based on the slug parameter.",
    image: "https://cdn.abacus.ai/images/970b470b-5cce-4f06-8637-65ff8c5feaa1.png",
    category: "Digital Marketing",
    date: "2024-10-01",
    readTime: "5 min read",
    author: "CDM Suite Team"
  };

  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long", 
      day: "numeric"
    });
  };

  const sharePost = () => {
    if (navigator.share) {
      navigator.share({
        title: blogPost.title,
        url: window.location.href,
      });
    } else {
      // Fallback for browsers that don't support Web Share API
      navigator.clipboard.writeText(window.location.href);
      alert("Link copied to clipboard!");
    }
  };

  return (
    <article className="py-20">
      <div className="section-container">
        {/* Back Button */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
          className="mb-8"
        >
          <Link href="/blog">
            <Button variant="ghost" className="group">
              <ArrowLeft className="mr-2 h-4 w-4 group-hover:-translate-x-1 transition-transform" />
              Back to Blog
            </Button>
          </Link>
        </motion.div>

        {/* Header */}
        <motion.header
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.2 }}
          className="text-center mb-12"
        >
          <div className="mb-6">
            <span className="bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-semibold">
              {blogPost.category}
            </span>
          </div>
          
          <h1 className="text-4xl md:text-5xl font-bold text-gray-900 mb-6 max-w-4xl mx-auto">
            {blogPost.title}
          </h1>
          
          <div className="flex items-center justify-center gap-6 text-gray-700 mb-8">
            <div className="flex items-center gap-2 text-gray-700">
              <Calendar className="h-4 w-4 text-gray-700" />
              <span className="text-gray-700">{formatDate(blogPost.date)}</span>
            </div>
            <div className="flex items-center gap-2 text-gray-700">
              <Clock className="h-4 w-4 text-gray-700" />
              <span className="text-gray-700">{blogPost.readTime}</span>
            </div>
            <div className="text-sm text-gray-700">
              By {blogPost.author}
            </div>
          </div>

          <Button onClick={sharePost} variant="outline" className="border-gray-300 text-gray-700 hover:bg-gray-100 group">
            <Share2 className="mr-2 h-4 w-4" />
            Share Article
          </Button>
        </motion.header>

        {/* Featured Image */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.4 }}
          className="relative aspect-video bg-gray-100 rounded-lg overflow-hidden mb-12 max-w-4xl mx-auto"
        >
          <Image
            src={blogPost.image}
            alt={blogPost.title}
            fill
            className="object-cover"
          />
        </motion.div>

        {/* Content */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.6 }}
          className="max-w-4xl mx-auto"
        >
          <div className="prose prose-lg max-w-none">
            <p className="text-xl text-gray-800 leading-relaxed mb-8">
              {blogPost.content}
            </p>
            
            <div className="bg-primary/5 p-8 rounded-lg border border-primary/10">
              <h2 className="text-2xl font-semibold text-gray-900 mb-4">
                Ready to Implement These Strategies?
              </h2>
              <p className="text-gray-800 mb-6">
                Our team at CDM Suite can help you implement these digital marketing strategies 
                and achieve measurable results for your business.
              </p>
              <Link href="/contact">
                <Button className="bg-primary hover:bg-primary/90 text-white">
                  Get Free Consultation
                </Button>
              </Link>
            </div>
          </div>
        </motion.div>

        {/* Related Posts CTA */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.8 }}
          className="text-center mt-16"
        >
          <Link href="/blog">
            <Button size="lg" variant="outline">
              Read More Articles
            </Button>
          </Link>
        </motion.div>
      </div>
    </article>
  );
};

export default BlogPostDetail;

// ==========================================
// File: components/blog-audio-player.tsx
// ==========================================


'use client';

import { useState, useRef, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Slider } from '@/components/ui/slider';
import { Play, Pause, Volume2, VolumeX } from 'lucide-react';

interface BlogAudioPlayerProps {
  audioUrl: string;
  title: string;
}

export function BlogAudioPlayer({ audioUrl, title }: BlogAudioPlayerProps) {
  const [isPlaying, setIsPlaying] = useState(false);
  const [currentTime, setCurrentTime] = useState(0);
  const [duration, setDuration] = useState(0);
  const [volume, setVolume] = useState(1);
  const [isMuted, setIsMuted] = useState(false);
  const audioRef = useRef<HTMLAudioElement>(null);

  useEffect(() => {
    const audio = audioRef.current;
    if (!audio) return;

    const handleTimeUpdate = () => setCurrentTime(audio.currentTime);
    const handleDurationChange = () => setDuration(audio.duration);
    const handleEnded = () => setIsPlaying(false);

    audio.addEventListener('timeupdate', handleTimeUpdate);
    audio.addEventListener('durationchange', handleDurationChange);
    audio.addEventListener('ended', handleEnded);

    return () => {
      audio.removeEventListener('timeupdate', handleTimeUpdate);
      audio.removeEventListener('durationchange', handleDurationChange);
      audio.removeEventListener('ended', handleEnded);
    };
  }, []);

  const togglePlay = () => {
    const audio = audioRef.current;
    if (!audio) return;

    if (isPlaying) {
      audio.pause();
    } else {
      audio.play();
    }
    setIsPlaying(!isPlaying);
  };

  const handleSeek = (value: number[]) => {
    const audio = audioRef.current;
    if (!audio) return;
    audio.currentTime = value[0];
    setCurrentTime(value[0]);
  };

  const handleVolumeChange = (value: number[]) => {
    const audio = audioRef.current;
    if (!audio) return;
    const newVolume = value[0];
    audio.volume = newVolume;
    setVolume(newVolume);
    setIsMuted(newVolume === 0);
  };

  const toggleMute = () => {
    const audio = audioRef.current;
    if (!audio) return;
    
    if (isMuted) {
      audio.volume = volume || 0.5;
      setIsMuted(false);
    } else {
      audio.volume = 0;
      setIsMuted(true);
    }
  };

  const formatTime = (time: number) => {
    const minutes = Math.floor(time / 60);
    const seconds = Math.floor(time % 60);
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
  };

  return (
    <div className="bg-gradient-to-r from-primary/10 to-purple-500/10 rounded-lg p-6">
      <div className="flex items-center gap-4 mb-4">
        <Volume2 className="h-5 w-5 text-primary" />
        <h3 className="font-semibold">Listen to this article</h3>
      </div>
      
      <div className="flex items-center gap-4">
        <Button
          variant="default"
          size="icon"
          onClick={togglePlay}
          className="rounded-full"
        >
          {isPlaying ? <Pause className="h-4 w-4" /> : <Play className="h-4 w-4 ml-0.5" />}
        </Button>

        <div className="flex-1">
          <Slider
            value={[currentTime]}
            max={duration || 100}
            step={1}
            onValueChange={handleSeek}
            className="cursor-pointer"
          />
          <div className="flex justify-between text-xs text-muted-foreground mt-1">
            <span>{formatTime(currentTime)}</span>
            <span>{formatTime(duration)}</span>
          </div>
        </div>

        <div className="flex items-center gap-2">
          <Button
            variant="ghost"
            size="icon"
            onClick={toggleMute}
          >
            {isMuted ? <VolumeX className="h-4 w-4" /> : <Volume2 className="h-4 w-4" />}
          </Button>
          <Slider
            value={[isMuted ? 0 : volume]}
            max={1}
            step={0.1}
            onValueChange={handleVolumeChange}
            className="w-20"
          />
        </div>
      </div>

      <audio ref={audioRef} src={audioUrl} preload="metadata" />
    </div>
  );
}

// ==========================================
// File: components/blog-post-grid.tsx
// ==========================================


'use client';

import { useState } from 'react';
import Image from 'next/image';
import Link from 'next/link';
import { useRouter, useSearchParams } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Card, CardContent, CardFooter, CardHeader } from '@/components/ui/card';
import { CalendarDays, Clock, ChevronLeft, ChevronRight } from 'lucide-react';
import { format } from 'date-fns';

interface BlogPost {
  id: string;
  title: string;
  slug: string;
  excerpt: string | null;
  author: string;
  featuredImage: string | null;
  categories: string[];
  tags: string[];
  publishedAt: Date | null;
}

interface BlogPostGridProps {
  posts: BlogPost[];
  categories: string[];
  totalPages: number;
  currentPage: number;
  selectedCategory?: string;
}

export function BlogPostGrid({
  posts,
  categories,
  totalPages,
  currentPage,
  selectedCategory,
}: BlogPostGridProps) {
  const router = useRouter();
  const searchParams = useSearchParams();
  const [activeCategory, setActiveCategory] = useState(selectedCategory || 'all');

  const handleCategoryChange = (category: string) => {
    setActiveCategory(category);
    const params = new URLSearchParams(searchParams?.toString());
    
    if (category === 'all') {
      params.delete('category');
    } else {
      params.set('category', category);
    }
    params.delete('page'); // Reset to page 1 when changing category
    
    router.push(`/blog?${params.toString()}`);
  };

  const handlePageChange = (page: number) => {
    const params = new URLSearchParams(searchParams?.toString());
    params.set('page', page.toString());
    router.push(`/blog?${params.toString()}`);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  return (
    <div className="space-y-8">
      {/* Category Filter */}
      <div className="flex flex-wrap gap-2 justify-center">
        <Button
          variant={activeCategory === 'all' ? 'default' : 'outline'}
          size="sm"
          onClick={() => handleCategoryChange('all')}
          className="rounded-full"
        >
          All Posts
        </Button>
        {categories.slice(0, 10).map((category) => (
          <Button
            key={category}
            variant={activeCategory === category ? 'default' : 'outline'}
            size="sm"
            onClick={() => handleCategoryChange(category)}
            className="rounded-full"
          >
            {category}
          </Button>
        ))}
      </div>

      {/* Posts Grid */}
      {posts.length === 0 ? (
        <div className="text-center py-20">
          <p className="text-xl text-muted-foreground">No blog posts found.</p>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {posts.map((post) => (
            <Link key={post.id} href={`/blog/${post.slug}`} className="group">
              <Card className="h-full overflow-hidden hover:shadow-xl transition-all duration-300 border-2 hover:border-primary/50">
                {/* Featured Image */}
                <div className="relative h-48 bg-muted overflow-hidden">
                  {post.featuredImage ? (
                    <Image
                      src={post.featuredImage}
                      alt={post.title}
                      fill
                      className="object-cover group-hover:scale-105 transition-transform duration-300"
                    />
                  ) : (
                    <div className="w-full h-full bg-gradient-to-br from-primary/20 to-purple-500/20 flex items-center justify-center">
                      <span className="text-6xl font-bold text-primary/30">
                        {post.title.charAt(0)}
                      </span>
                    </div>
                  )}
                  {post.categories[0] && (
                    <Badge className="absolute top-3 left-3 bg-primary/90 hover:bg-primary">
                      {post.categories[0]}
                    </Badge>
                  )}
                </div>

                <CardHeader>
                  <h3 className="text-xl font-bold line-clamp-2 group-hover:text-primary transition-colors">
                    {post.title}
                  </h3>
                </CardHeader>

                <CardContent>
                  <p className="text-muted-foreground line-clamp-3">
                    {post.excerpt || 'Read more to discover valuable insights...'}
                  </p>
                </CardContent>

                <CardFooter className="flex items-center justify-between text-sm text-muted-foreground">
                  <div className="flex items-center gap-2">
                    <CalendarDays className="h-4 w-4" />
                    <span>
                      {post.publishedAt
                        ? format(new Date(post.publishedAt), 'MMM d, yyyy')
                        : 'Coming soon'}
                    </span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Clock className="h-4 w-4" />
                    <span>5 min read</span>
                  </div>
                </CardFooter>
              </Card>
            </Link>
          ))}
        </div>
      )}

      {/* Pagination */}
      {totalPages > 1 && (
        <div className="flex items-center justify-center gap-2 pt-8">
          <Button
            variant="outline"
            size="sm"
            onClick={() => handlePageChange(currentPage - 1)}
            disabled={currentPage === 1}
          >
            <ChevronLeft className="h-4 w-4 mr-1" />
            Previous
          </Button>

          <div className="flex items-center gap-1">
            {Array.from({ length: Math.min(totalPages, 7) }, (_, i) => {
              let pageNum: number;
              if (totalPages <= 7) {
                pageNum = i + 1;
              } else if (currentPage <= 4) {
                pageNum = i + 1;
              } else if (currentPage >= totalPages - 3) {
                pageNum = totalPages - 6 + i;
              } else {
                pageNum = currentPage - 3 + i;
              }

              return (
                <Button
                  key={pageNum}
                  variant={currentPage === pageNum ? 'default' : 'outline'}
                  size="sm"
                  onClick={() => handlePageChange(pageNum)}
                  className="min-w-[40px]"
                >
                  {pageNum}
                </Button>
              );
            })}
          </div>

          <Button
            variant="outline"
            size="sm"
            onClick={() => handlePageChange(currentPage + 1)}
            disabled={currentPage === totalPages}
          >
            Next
            <ChevronRight className="h-4 w-4 ml-1" />
          </Button>
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/builder/ai-chat.tsx
// ==========================================


"use client";

import { useState, useRef, useEffect } from "react";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Send, Sparkles, Bot, User } from "lucide-react";

interface AIChatProps {
  businessData?: any;
  onDataUpdate?: (data: any) => void;
}

export function AIChat({ businessData, onDataUpdate }: AIChatProps) {
  const [messages, setMessages] = useState<Array<{ role: string; content: string }>>([
    {
      role: "assistant",
      content:
        "Hi! I'm your AI website builder assistant. I'll help you create the perfect website for your business. What kind of business are you building a website for?",
    },
  ]);
  const [input, setInput] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const handleSend = async () => {
    if (!input.trim() || isLoading) return;

    const userMessage = input.trim();
    setInput("");
    
    // Add user message
    const newMessages = [...messages, { role: "user", content: userMessage }];
    setMessages(newMessages);
    setIsLoading(true);

    try {
      const response = await fetch("/api/builder/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          message: userMessage,
          conversationHistory: messages,
          businessData,
        }),
      });

      if (!response.ok) {
        throw new Error("Failed to get response");
      }

      const reader = response.body?.getReader();
      const decoder = new TextDecoder();
      let assistantMessage = "";
      let partialRead = "";

      while (true) {
        const { done, value } = await reader!.read();
        if (done) break;

        partialRead += decoder.decode(value, { stream: true });
        let lines = partialRead.split("\n");
        partialRead = lines.pop() || "";

        for (const line of lines) {
          if (line.startsWith("data: ")) {
            const data = line.slice(6);
            if (data === "[DONE]") {
              break;
            }
            try {
              const parsed = JSON.parse(data);
              const content = parsed.choices?.[0]?.delta?.content || "";
              assistantMessage += content;
              
              // Update message in real-time
              setMessages([...newMessages, { role: "assistant", content: assistantMessage }]);
            } catch (e) {
              // Skip invalid JSON
            }
          }
        }
      }
    } catch (error) {
      console.error("Chat error:", error);
      setMessages([
        ...newMessages,
        {
          role: "assistant",
          content: "Sorry, I encountered an error. Please try again.",
        },
      ]);
    } finally {
      setIsLoading(false);
    }
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  return (
    <div className="max-w-4xl mx-auto">
      <div className="mb-6">
        <h2 className="text-2xl font-bold mb-2">Chat with AI</h2>
        <p className="text-muted-foreground">
          Have a conversation with our AI to build your perfect website
        </p>
      </div>

      <Card className="h-[600px] flex flex-col">
        {/* Messages */}
        <div className="flex-1 overflow-y-auto p-6 space-y-4">
          {messages.map((message, index) => (
            <div
              key={index}
              className={`flex gap-3 ${
                message.role === "user" ? "justify-end" : "justify-start"
              }`}
            >
              {message.role === "assistant" && (
                <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                  <Bot className="w-5 h-5 text-blue-600" />
                </div>
              )}
              <div
                className={`max-w-[70%] rounded-lg px-4 py-3 ${
                  message.role === "user"
                    ? "bg-blue-600 text-white"
                    : "bg-muted"
                }`}
              >
                <p className="text-sm whitespace-pre-wrap">{message.content}</p>
              </div>
              {message.role === "user" && (
                <div className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0">
                  <User className="w-5 h-5 text-gray-600" />
                </div>
              )}
            </div>
          ))}
          {isLoading && (
            <div className="flex gap-3 justify-start">
              <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                <Bot className="w-5 h-5 text-blue-600" />
              </div>
              <div className="bg-muted rounded-lg px-4 py-3">
                <div className="flex gap-1">
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" />
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100" />
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200" />
                </div>
              </div>
            </div>
          )}
          <div ref={messagesEndRef} />
        </div>

        {/* Input */}
        <div className="border-t p-4">
          <div className="flex gap-2">
            <Input
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyPress={handleKeyPress}
              placeholder="Type your message..."
              disabled={isLoading}
            />
            <Button onClick={handleSend} disabled={isLoading || !input.trim()}>
              <Send className="w-4 h-4" />
            </Button>
          </div>
          <p className="text-xs text-muted-foreground mt-2 text-center">
            Press Enter to send, Shift+Enter for new line
          </p>
        </div>
      </Card>

      <div className="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
        <div className="flex gap-2 items-start">
          <Sparkles className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
          <div>
            <p className="text-sm font-medium text-blue-900 mb-1">
              Pro Tip: Be Specific
            </p>
            <p className="text-xs text-blue-700">
              The more details you share about your business, target audience, and goals, 
              the better your AI-generated website will be!
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

// ==========================================
// File: components/builder/builder-client.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Card } from "@/components/ui/card";
import { MessageSquare, FormInput, Layout, Sparkles } from "lucide-react";
import { AIChat } from "./ai-chat";
import { BusinessForm } from "./business-form";
import { TemplateGallery } from "./template-gallery";
import { BuilderProgress } from "./builder-progress";

interface BuilderClientProps {
  user: any;
  auditData?: any;
}

export function BuilderClient({ user, auditData }: BuilderClientProps) {
  const [showDemo, setShowDemo] = useState<boolean>(true);
  const [activeTab, setActiveTab] = useState<string>("templates");
  const [selectedTemplate, setSelectedTemplate] = useState<string | null>(null);
  const [businessData, setBusinessData] = useState<any>(
    auditData
      ? {
          existingWebsite: auditData.websiteUrl,
          auditId: auditData.id,
        }
      : {}
  );
  const [generationStatus, setGenerationStatus] = useState<"idle" | "generating" | "completed">("idle");
  const [generatedProject, setGeneratedProject] = useState<any>(null);

  const handleTemplateSelect = (templateId: string) => {
    setSelectedTemplate(templateId);
    setActiveTab("form");
  };

  const handleStartCustomization = () => {
    setShowDemo(false);
    setSelectedTemplate("modern-business");
    setActiveTab("form");
  };

  const handleBusinessDataUpdate = (data: any) => {
    setBusinessData({ ...businessData, ...data });
  };

  const handleGenerate = async (data: any) => {
    if (!selectedTemplate) {
      alert("Please select a template first");
      return;
    }

    setGenerationStatus("generating");

    try {
      const response = await fetch("/api/builder/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          ...data,
          templateId: selectedTemplate,
          auditId: businessData.auditId || null,
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        
        // Handle insufficient credits error
        if (response.status === 402 && errorData.needsCredits) {
          const shouldBuyCredits = confirm(
            errorData.message + "\n\nWould you like to purchase more credits or upgrade your plan?"
          );
          
          if (shouldBuyCredits) {
            window.location.href = "/dashboard/billing?credits=true";
          }
          
          setGenerationStatus("idle");
          return;
        }
        
        throw new Error(errorData.message || "Generation failed");
      }

      const reader = response.body?.getReader();
      const decoder = new TextDecoder();
      let buffer = "";
      let partialRead = "";

      while (true) {
        const { done, value } = await reader!.read();
        if (done) break;

        partialRead += decoder.decode(value, { stream: true });
        let lines = partialRead.split("\n");
        partialRead = lines.pop() || "";

        for (const line of lines) {
          if (line.startsWith("data: ")) {
            const data = line.slice(6);
            if (data === "[DONE]") {
              return;
            }
            try {
              const parsed = JSON.parse(data);
              if (parsed.status === "completed") {
                setGenerationStatus("completed");
                setGeneratedProject(parsed.result);
                return;
              } else if (parsed.status === "error") {
                throw new Error(parsed.message || "Generation failed");
              }
            } catch (e) {
              // Skip invalid JSON
            }
          }
        }
      }
    } catch (error) {
      console.error("Generation error:", error);
      alert("Failed to generate website. Please try again.");
      setGenerationStatus("idle");
    }
  };

  if (generationStatus === "generating") {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 py-12">
        <div className="max-w-4xl mx-auto px-4">
          <BuilderProgress />
        </div>
      </div>
    );
  }

  // Demo/Sample view - shown first
  if (showDemo && !auditData) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 py-12">
        <div className="max-w-7xl mx-auto px-4">
          {/* Header */}
          <div className="text-center mb-12">
            <div className="inline-flex items-center gap-2 px-4 py-2 bg-blue-100 rounded-full mb-6">
              <Sparkles className="w-5 h-5 text-blue-600" />
              <span className="text-sm font-medium text-blue-700">AI Website Builder</span>
            </div>
            <h1 className="text-4xl md:text-5xl font-bold mb-4">
              Build Your Professional Website in Minutes
            </h1>
            <p className="text-xl text-muted-foreground max-w-2xl mx-auto mb-4">
              Create a stunning, SEO-optimized website powered by AI. No coding required.
            </p>
            
            {/* Pricing Badge */}
            <div className="inline-flex items-center gap-3 px-6 py-3 bg-white rounded-lg shadow-md border-2 border-blue-200 mb-8">
              <div className="text-left">
                <p className="text-sm text-muted-foreground">Starting from</p>
                <p className="text-2xl font-bold text-blue-600">$340 - $500</p>
              </div>
              <div className="h-10 w-px bg-gray-300" />
              <div className="text-left">
                <p className="text-sm text-muted-foreground">Or use</p>
                <p className="text-lg font-bold">1 Credit</p>
              </div>
            </div>
          </div>

          {/* Video Walkthrough */}
          <Card className="p-8 mb-8 bg-gradient-to-r from-purple-50 to-blue-50">
            <div className="text-center mb-6">
              <h2 className="text-2xl font-bold mb-2">See How It Works</h2>
              <p className="text-muted-foreground">Watch a quick demo of the AI Website Builder in action</p>
            </div>
            <div className="aspect-video bg-gradient-to-br from-gray-800 to-gray-900 rounded-lg flex items-center justify-center relative overflow-hidden">
              <div className="absolute inset-0 bg-gradient-to-br from-blue-500/20 to-purple-500/20" />
              <div className="relative z-10 text-center text-white">
                <div className="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center mx-auto mb-4 hover:bg-white/30 transition-colors cursor-pointer">
                  <svg className="w-10 h-10" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" />
                  </svg>
                </div>
                <p className="font-semibold text-lg">Watch 2-Minute Demo</p>
                <p className="text-sm text-gray-300 mt-1">Learn how to create your website with AI</p>
              </div>
            </div>
          </Card>

          {/* Interactive Template Preview */}
          <div className="mb-8">
            <div className="text-center mb-6">
              <h2 className="text-2xl font-bold mb-2">Choose From Professional Templates</h2>
              <p className="text-muted-foreground">All templates are fully customizable and optimized for your industry</p>
            </div>
            
            <div className="grid md:grid-cols-3 gap-6 mb-6">
              {[
                { 
                  name: "Business", 
                  color: "from-blue-500 to-blue-600",
                  icon: "üè¢",
                  features: ["Corporate design", "Service pages", "Team profiles"]
                },
                { 
                  name: "Creative", 
                  color: "from-purple-500 to-pink-500",
                  icon: "üé®",
                  features: ["Portfolio grid", "Case studies", "Bold design"]
                },
                { 
                  name: "E-commerce", 
                  color: "from-red-500 to-orange-500",
                  icon: "üõçÔ∏è",
                  features: ["Product catalog", "Shopping cart", "Checkout"]
                }
              ].map((template, idx) => (
                <Card key={idx} className="overflow-hidden hover:shadow-xl transition-all cursor-pointer group">
                  <div className={`h-48 bg-gradient-to-br ${template.color} flex items-center justify-center relative`}>
                    <div className="text-6xl group-hover:scale-110 transition-transform">{template.icon}</div>
                    <div className="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-sm font-semibold">
                      Popular
                    </div>
                  </div>
                  <div className="p-6">
                    <h3 className="text-xl font-bold mb-3">{template.name}</h3>
                    <ul className="space-y-2 text-sm text-muted-foreground">
                      {template.features.map((feature, i) => (
                        <li key={i} className="flex items-center gap-2">
                          <div className="w-1.5 h-1.5 bg-blue-600 rounded-full" />
                          {feature}
                        </li>
                      ))}
                    </ul>
                  </div>
                </Card>
              ))}
            </div>
          </div>

          {/* Main CTA */}
          <Card className="p-8 mb-8 text-center bg-gradient-to-r from-blue-600 to-purple-600 text-white">
            <h2 className="text-3xl font-bold mb-4">Ready to Build Your Website?</h2>
            <p className="text-lg mb-6 text-blue-50">
              Join hundreds of businesses who've launched their websites with our AI Builder
            </p>
            <button
              onClick={handleStartCustomization}
              className="px-10 py-4 bg-white text-blue-600 text-lg font-semibold rounded-lg hover:bg-gray-100 transition-colors shadow-lg hover:shadow-xl"
            >
              Start Building Now ‚Üí
            </button>
            <p className="text-sm text-blue-100 mt-4">
              First website free ‚Ä¢ Takes less than 5 minutes ‚Ä¢ No credit card required
            </p>
          </Card>

          {/* Features Grid */}
          <div className="grid md:grid-cols-3 gap-6 mb-8">
            <Card className="p-6">
              <div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                <Sparkles className="w-6 h-6 text-blue-600" />
              </div>
              <h3 className="font-semibold mb-2">AI-Powered Design</h3>
              <p className="text-sm text-muted-foreground">
                Our AI creates beautiful, modern designs specifically tailored for your business and industry
              </p>
            </Card>
            <Card className="p-6">
              <div className="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-4">
                <FormInput className="w-6 h-6 text-purple-600" />
              </div>
              <h3 className="font-semibold mb-2">Easy Customization</h3>
              <p className="text-sm text-muted-foreground">
                Simply answer a few questions about your business and watch your website come to life
              </p>
            </Card>
            <Card className="p-6">
              <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-4">
                <MessageSquare className="w-6 h-6 text-green-600" />
              </div>
              <h3 className="font-semibold mb-2">Launch in Minutes</h3>
              <p className="text-sm text-muted-foreground">
                Go from idea to live website in under 10 minutes. No technical skills required
              </p>
            </Card>
          </div>

          {/* What's Included */}
          <div className="grid md:grid-cols-2 gap-6">
            <Card className="p-6">
              <h3 className="font-semibold mb-4 text-lg">‚ú® What's Included:</h3>
              <ul className="space-y-3 text-sm">
                <li className="flex items-start gap-2">
                  <span className="text-green-600 font-bold">‚úì</span>
                  <span><strong>Professional Design:</strong> Mobile-responsive, modern layouts</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-green-600 font-bold">‚úì</span>
                  <span><strong>SEO Optimized:</strong> Built-in SEO best practices</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-green-600 font-bold">‚úì</span>
                  <span><strong>Lead Capture:</strong> Contact forms & lead generation tools</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-green-600 font-bold">‚úì</span>
                  <span><strong>Custom Domain:</strong> Connect your own domain</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-green-600 font-bold">‚úì</span>
                  <span><strong>SSL Security:</strong> Free SSL certificate included</span>
                </li>
              </ul>
            </Card>
            <Card className="p-6">
              <h3 className="font-semibold mb-4 text-lg">üöÄ Perfect For:</h3>
              <ul className="space-y-3 text-sm">
                <li className="flex items-start gap-2">
                  <span className="text-blue-600 font-bold">‚Üí</span>
                  <span><strong>Small Businesses:</strong> Get online fast with professional presence</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-blue-600 font-bold">‚Üí</span>
                  <span><strong>Startups:</strong> Launch your MVP website quickly</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-blue-600 font-bold">‚Üí</span>
                  <span><strong>Freelancers:</strong> Showcase your portfolio professionally</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-blue-600 font-bold">‚Üí</span>
                  <span><strong>Service Providers:</strong> Generate leads & bookings</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-blue-600 font-bold">‚Üí</span>
                  <span><strong>E-commerce:</strong> Start selling products online</span>
                </li>
              </ul>
            </Card>
          </div>
        </div>
      </div>
    );
  }

  if (generationStatus === "completed" && generatedProject) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 py-12">
        <div className="max-w-6xl mx-auto px-4">
          <Card className="p-8 text-center">
            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <Sparkles className="w-10 h-10 text-green-600" />
            </div>
            <h2 className="text-3xl font-bold mb-4">Your Website is Ready! üéâ</h2>
            <p className="text-lg text-muted-foreground mb-8">
              We've generated your professional website. View it live or continue editing.
            </p>

            <div className="bg-muted/50 rounded-lg p-6 mb-8 inline-block">
              <p className="text-sm text-muted-foreground mb-2">Your website URL:</p>
              <a
                href={`https://${generatedProject.subdomain}.cdmsuite.com`}
                target="_blank"
                rel="noopener noreferrer"
                className="text-xl font-mono text-blue-600 hover:underline"
              >
                {generatedProject.subdomain}.cdmsuite.com
              </a>
            </div>

            <div className="flex gap-4 justify-center">
              <a
                href={`/builder/preview/${generatedProject.projectId}`}
                className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
              >
                Preview Website
              </a>
              <a
                href={`/builder/editor/${generatedProject.projectId}`}
                className="px-6 py-3 bg-white border-2 border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition"
              >
                Edit Website
              </a>
              <a
                href="/dashboard"
                className="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition"
              >
                Go to Dashboard
              </a>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 py-12">
      <div className="max-w-7xl mx-auto px-4">
        {/* Header */}
        <div className="text-center mb-12">
          <div className="inline-flex items-center gap-2 px-4 py-2 bg-blue-100 rounded-full mb-6">
            <Sparkles className="w-5 h-5 text-blue-600" />
            <span className="text-sm font-medium text-blue-700">AI Website Builder</span>
          </div>
          <h1 className="text-4xl md:text-5xl font-bold mb-4">
            Build Your Website in Minutes
          </h1>
          <p className="text-xl text-muted-foreground max-w-2xl mx-auto">
            {auditData
              ? "Based on your audit, we'll help you rebuild a better website"
              : "Choose a template, tell us about your business, and let AI create your perfect website"}
          </p>
        </div>

        {/* Builder Tabs */}
        <Card className="p-6">
          <Tabs value={activeTab} onValueChange={setActiveTab}>
            <TabsList className="grid w-full grid-cols-3 mb-8">
              <TabsTrigger value="templates" className="flex items-center gap-2">
                <Layout className="w-4 h-4" />
                Templates
              </TabsTrigger>
              <TabsTrigger value="form" className="flex items-center gap-2" disabled={!selectedTemplate}>
                <FormInput className="w-4 h-4" />
                Business Info
              </TabsTrigger>
              <TabsTrigger value="chat" className="flex items-center gap-2" disabled={!selectedTemplate}>
                <MessageSquare className="w-4 h-4" />
                AI Chat
              </TabsTrigger>
            </TabsList>

            <TabsContent value="templates">
              <TemplateGallery
                onSelect={handleTemplateSelect}
                selectedTemplate={selectedTemplate}
              />
            </TabsContent>

            <TabsContent value="form">
              <BusinessForm
                templateId={selectedTemplate}
                initialData={businessData}
                onGenerate={handleGenerate}
                auditData={auditData}
              />
            </TabsContent>

            <TabsContent value="chat">
              <AIChat
                businessData={businessData}
                onDataUpdate={handleBusinessDataUpdate}
              />
            </TabsContent>
          </Tabs>
        </Card>
      </div>
    </div>
  );
}

// ==========================================
// File: components/builder/builder-progress.tsx
// ==========================================


"use client";

import { Card } from "@/components/ui/card";
import { Sparkles, Layout, Palette, FileText, Check } from "lucide-react";
import { useEffect, useState } from "react";

const STEPS = [
  { icon: Layout, label: "Analyzing template", duration: 2000 },
  { icon: Palette, label: "Creating design system", duration: 3000 },
  { icon: FileText, label: "Generating content", duration: 4000 },
  { icon: Check, label: "Building your website", duration: 2000 },
];

export function BuilderProgress() {
  const [currentStep, setCurrentStep] = useState(0);
  const [progress, setProgress] = useState(0);

  useEffect(() => {
    const totalDuration = STEPS.reduce((sum, step) => sum + step.duration, 0);
    const interval = 100;
    let elapsed = 0;

    const timer = setInterval(() => {
      elapsed += interval;
      const newProgress = Math.min((elapsed / totalDuration) * 100, 99);
      setProgress(newProgress);

      // Update current step
      let stepElapsed = 0;
      for (let i = 0; i < STEPS.length; i++) {
        stepElapsed += STEPS[i].duration;
        if (elapsed < stepElapsed) {
          setCurrentStep(i);
          break;
        }
      }
    }, interval);

    return () => clearInterval(timer);
  }, []);

  return (
    <Card className="p-8">
      <div className="text-center mb-8">
        <div className="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
          <Sparkles className="w-10 h-10 text-blue-600" />
        </div>
        <h2 className="text-2xl font-bold mb-2">Creating Your Website...</h2>
        <p className="text-muted-foreground">
          Our AI is working its magic. This will take just a moment.
        </p>
      </div>

      {/* Progress bar */}
      <div className="mb-8">
        <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
          <div
            className="bg-gradient-to-r from-blue-600 to-purple-600 h-full transition-all duration-300 ease-out"
            style={{ width: `${progress}%` }}
          />
        </div>
        <p className="text-center text-sm text-muted-foreground mt-2">
          {Math.round(progress)}% complete
        </p>
      </div>

      {/* Steps */}
      <div className="space-y-4">
        {STEPS.map((step, index) => {
          const Icon = step.icon;
          const isCompleted = index < currentStep;
          const isCurrent = index === currentStep;

          return (
            <div
              key={index}
              className={`flex items-center gap-4 p-4 rounded-lg transition-all ${
                isCurrent
                  ? "bg-blue-50 border-2 border-blue-200"
                  : isCompleted
                  ? "bg-green-50 border border-green-200"
                  : "bg-muted/50 border border-transparent"
              }`}
            >
              <div
                className={`w-10 h-10 rounded-full flex items-center justify-center ${
                  isCompleted
                    ? "bg-green-500"
                    : isCurrent
                    ? "bg-blue-500 animate-pulse"
                    : "bg-gray-300"
                }`}
              >
                <Icon className="w-5 h-5 text-white" />
              </div>
              <div className="flex-1">
                <p
                  className={`font-medium ${
                    isCurrent
                      ? "text-blue-900"
                      : isCompleted
                      ? "text-green-900"
                      : "text-muted-foreground"
                  }`}
                >
                  {step.label}
                </p>
              </div>
              {isCompleted && (
                <Check className="w-5 h-5 text-green-600" />
              )}
              {isCurrent && (
                <div className="flex gap-1">
                  <div className="w-2 h-2 bg-blue-600 rounded-full animate-bounce" />
                  <div className="w-2 h-2 bg-blue-600 rounded-full animate-bounce delay-100" />
                  <div className="w-2 h-2 bg-blue-600 rounded-full animate-bounce delay-200" />
                </div>
              )}
            </div>
          );
        })}
      </div>
    </Card>
  );
}

// ==========================================
// File: components/builder/business-form.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Sparkles, AlertCircle, Wand2, Loader2 } from "lucide-react";
import { getTemplate } from "@/lib/builder/templates";

interface BusinessFormProps {
  templateId: string | null;
  initialData?: any;
  onGenerate: (data: any) => void;
  auditData?: any;
}

export function BusinessForm({
  templateId,
  initialData = {},
  onGenerate,
  auditData,
}: BusinessFormProps) {
  const [formData, setFormData] = useState({
    businessName: initialData.businessName || "",
    industry: initialData.industry || "",
    services: initialData.services || "",
    targetAudience: initialData.targetAudience || "",
    goals: initialData.goals || "",
    existingWebsite: initialData.existingWebsite || "",
  });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [aiPrompt, setAiPrompt] = useState("");
  const [isAutofilling, setIsAutofilling] = useState(false);
  const [showAiInput, setShowAiInput] = useState(false);

  const template = templateId ? getTemplate(templateId) : null;

  const handleAiAutofill = async () => {
    if (!aiPrompt.trim()) return;

    setIsAutofilling(true);
    try {
      const response = await fetch("/api/assistant/autofill", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          prompt: aiPrompt,
          formType: "business",
        }),
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || "Failed to autofill");
      }

      const data = await response.json();
      setFormData({
        businessName: data.businessName || formData.businessName,
        industry: data.industry || formData.industry,
        services: data.services || formData.services,
        targetAudience: data.targetAudience || formData.targetAudience,
        goals: data.goals || formData.goals,
        existingWebsite: formData.existingWebsite,
      });
      setShowAiInput(false);
      setAiPrompt("");
    } catch (error: any) {
      alert(error.message || "Failed to autofill form. Please try again.");
    } finally {
      setIsAutofilling(false);
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSubmitting(true);

    // Parse services and goals
    const services = formData.services
      .split(",")
      .map((s: string) => s.trim())
      .filter((s: string) => s);
    const goals = formData.goals
      .split(",")
      .map((g: string) => g.trim())
      .filter((g: string) => g);

    await onGenerate({
      ...formData,
      services,
      goals,
    });

    setIsSubmitting(false);
  };

  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value,
    });
  };

  if (!template) {
    return (
      <div className="text-center py-12">
        <p className="text-muted-foreground">
          Please select a template first
        </p>
      </div>
    );
  }

  return (
    <div className="max-w-3xl mx-auto">
      {auditData && (
        <Card className="p-4 mb-6 bg-blue-50 border-blue-200">
          <div className="flex gap-3">
            <AlertCircle className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
            <div>
              <h3 className="font-semibold text-blue-900 mb-1">
                Building from Audit Data
              </h3>
              <p className="text-sm text-blue-700">
                We'll use insights from your website audit (Score: {auditData.overallScore}/100) to create 
                an improved version with better SEO, performance, and user experience.
              </p>
            </div>
          </div>
        </Card>
      )}

      {/* AI Autofill */}
      <Card className="p-6 mb-6 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200">
        <div className="flex items-start gap-3">
          <Wand2 className="w-6 h-6 text-purple-600 flex-shrink-0 mt-1" />
          <div className="flex-1">
            <h3 className="font-semibold text-purple-900 mb-1">
              ‚ú® Quick Start with AI
            </h3>
            <p className="text-sm text-purple-700 mb-3">
              Just describe your business in 3-4 words and let AI fill out the entire form for you!
            </p>
            
            {!showAiInput ? (
              <Button
                type="button"
                variant="outline"
                size="sm"
                onClick={() => setShowAiInput(true)}
                className="bg-white"
              >
                <Wand2 className="w-4 h-4 mr-2" />
                Use AI Autofill (2 credits)
              </Button>
            ) : (
              <div className="space-y-2">
                <Input
                  value={aiPrompt}
                  onChange={(e) => setAiPrompt(e.target.value)}
                  placeholder="e.g., Digital marketing agency, Coffee shop Portland, Personal fitness trainer"
                  className="bg-white"
                  onKeyPress={(e) => {
                    if (e.key === "Enter" && !isAutofilling) {
                      handleAiAutofill();
                    }
                  }}
                />
                <div className="flex gap-2">
                  <Button
                    type="button"
                    size="sm"
                    onClick={handleAiAutofill}
                    disabled={!aiPrompt.trim() || isAutofilling}
                    className="bg-purple-600 hover:bg-purple-700"
                  >
                    {isAutofilling ? (
                      <>
                        <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                        Generating...
                      </>
                    ) : (
                      <>
                        <Sparkles className="w-4 h-4 mr-2" />
                        Generate
                      </>
                    )}
                  </Button>
                  <Button
                    type="button"
                    size="sm"
                    variant="ghost"
                    onClick={() => {
                      setShowAiInput(false);
                      setAiPrompt("");
                    }}
                  >
                    Cancel
                  </Button>
                </div>
              </div>
            )}
          </div>
        </div>
      </Card>

      <div className="mb-6">
        <h2 className="text-2xl font-bold mb-2">Tell Us About Your Business</h2>
        <p className="text-muted-foreground">
          Provide details about your business so our AI can create tailored content for your{" "}
          <span className="font-semibold text-blue-600">{template.name}</span> website
        </p>
      </div>

      <form onSubmit={handleSubmit} className="space-y-6">
        <div>
          <Label htmlFor="businessName">Business Name *</Label>
          <Input
            id="businessName"
            name="businessName"
            value={formData.businessName}
            onChange={handleChange}
            placeholder="e.g., Acme Digital Marketing"
            required
          />
        </div>

        <div>
          <Label htmlFor="industry">Industry *</Label>
          <Input
            id="industry"
            name="industry"
            value={formData.industry}
            onChange={handleChange}
            placeholder="e.g., Digital Marketing, Web Design, Consulting"
            required
          />
        </div>

        <div>
          <Label htmlFor="services">
            Services or Products (comma-separated) *
          </Label>
          <Textarea
            id="services"
            name="services"
            value={formData.services}
            onChange={handleChange}
            placeholder="e.g., SEO, Social Media Marketing, Web Development, Branding"
            rows={3}
            required
          />
          <p className="text-xs text-muted-foreground mt-1">
            Separate each service with a comma
          </p>
        </div>

        <div>
          <Label htmlFor="targetAudience">Target Audience *</Label>
          <Input
            id="targetAudience"
            name="targetAudience"
            value={formData.targetAudience}
            onChange={handleChange}
            placeholder="e.g., Small business owners, Startups, E-commerce brands"
            required
          />
        </div>

        <div>
          <Label htmlFor="goals">
            Business Goals (comma-separated) *
          </Label>
          <Textarea
            id="goals"
            name="goals"
            value={formData.goals}
            onChange={handleChange}
            placeholder="e.g., Generate leads, Increase brand awareness, Showcase portfolio"
            rows={3}
            required
          />
          <p className="text-xs text-muted-foreground mt-1">
            Separate each goal with a comma
          </p>
        </div>

        {!auditData && (
          <div>
            <Label htmlFor="existingWebsite">
              Existing Website (optional)
            </Label>
            <Input
              id="existingWebsite"
              name="existingWebsite"
              type="url"
              value={formData.existingWebsite}
              onChange={handleChange}
              placeholder="https://yourwebsite.com"
            />
            <p className="text-xs text-muted-foreground mt-1">
              If you have an existing website, we'll use it as reference
            </p>
          </div>
        )}

        <div className="flex gap-4 pt-4">
          <Button
            type="submit"
            disabled={isSubmitting}
            className="flex-1"
            size="lg"
          >
            {isSubmitting ? (
              <>Generating...</>
            ) : (
              <>
                <Sparkles className="w-5 h-5 mr-2" />
                Generate My Website
              </>
            )}
          </Button>
        </div>
      </form>

      {/* Template Preview */}
      <Card className="mt-8 p-6 bg-muted/50">
        <h3 className="font-semibold mb-4">Selected Template: {template.name}</h3>
        <div className="grid grid-cols-2 gap-4 text-sm">
          <div>
            <p className="text-muted-foreground mb-1">Pages included:</p>
            <p className="font-medium">{template.pages.join(", ")}</p>
          </div>
          <div>
            <p className="text-muted-foreground mb-1">Key features:</p>
            <p className="font-medium">{template.features.slice(0, 2).join(", ")}</p>
          </div>
        </div>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/builder/content-context-menu.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { 
  Wand2, Sparkles, Type, Zap, CheckCircle2, 
  ChevronRight, Loader2 
} from "lucide-react";
import { toast } from "sonner";

interface ContentContextMenuProps {
  selectedText: string;
  position: { x: number; y: number };
  onClose: () => void;
  onReplace: (newText: string) => void;
}

const IMPROVEMENT_ACTIONS = [
  { id: "shorter", label: "Make Shorter", icon: Zap },
  { id: "professional", label: "More Professional", icon: Type },
  { id: "casual", label: "Make Casual", icon: Sparkles },
  { id: "formal", label: "Make Formal", icon: CheckCircle2 },
  { id: "expand", label: "Expand", icon: ChevronRight },
  { id: "fix-grammar", label: "Fix Grammar", icon: CheckCircle2 },
];

export function ContentContextMenu({
  selectedText,
  position,
  onClose,
  onReplace,
}: ContentContextMenuProps) {
  const [loading, setLoading] = useState(false);
  const [activeAction, setActiveAction] = useState<string | null>(null);

  const handleAction = async (action: string) => {
    if (!selectedText.trim()) {
      toast.error("Please select some text first");
      return;
    }

    setLoading(true);
    setActiveAction(action);

    try {
      const response = await fetch("/api/builder/improve-content", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          content: selectedText,
          action,
          context: {},
        }),
      });

      if (!response.ok) throw new Error("Failed to improve content");

      const data = await response.json();
      onReplace(data.improved);
      toast.success("Content improved!");
      onClose();
    } catch (error) {
      console.error("Content improvement error:", error);
      toast.error("Failed to improve content");
    } finally {
      setLoading(false);
      setActiveAction(null);
    }
  };

  return (
    <Card
      className="absolute z-50 shadow-xl border-2 p-2 min-w-[200px]"
      style={{
        left: `${position.x}px`,
        top: `${position.y}px`,
      }}
    >
      <div className="flex items-center gap-2 px-2 py-1 mb-2 border-b">
        <Wand2 className="w-4 h-4 text-purple-600" />
        <span className="text-sm font-semibold">Improve with AI</span>
      </div>

      <div className="space-y-1">
        {IMPROVEMENT_ACTIONS.map((action) => {
          const Icon = action.icon;
          const isActive = activeAction === action.id;

          return (
            <Button
              key={action.id}
              variant="ghost"
              size="sm"
              className="w-full justify-start text-left"
              onClick={() => handleAction(action.id)}
              disabled={loading}
            >
              {isActive && loading ? (
                <Loader2 className="w-4 h-4 mr-2 animate-spin" />
              ) : (
                <Icon className="w-4 h-4 mr-2" />
              )}
              {action.label}
            </Button>
          );
        })}
      </div>

      <div className="border-t mt-2 pt-2 px-2">
        <p className="text-xs text-muted-foreground">
          Select text in the editor and choose an action
        </p>
      </div>
    </Card>
  );
}

// ==========================================
// File: components/builder/enhanced-visual-editor.tsx
// ==========================================


"use client";

import { useState, useEffect, useRef } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { Badge } from "@/components/ui/badge";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import {
  Save,
  Eye,
  ArrowLeft,
  Plus,
  Trash2,
  ExternalLink,
  Sparkles,
  Wand2,
  Layout,
  Palette,
  Search,
  Settings,
  FileText,
} from "lucide-react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { toast } from "sonner";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { NavigationEditor } from "./navigation-editor";
import { GlobalStylesPanel } from "./global-styles-panel";
import { SeoPanel } from "./seo-panel";
import { ContentContextMenu } from "./content-context-menu";

interface EnhancedVisualEditorProps {
  project: any;
}

export function EnhancedVisualEditor({ project }: EnhancedVisualEditorProps) {
  const router = useRouter();
  const [saving, setSaving] = useState(false);
  const [pages, setPages] = useState<any[]>(project.pages || []);
  const [selectedPageIndex, setSelectedPageIndex] = useState(0);
  const [selectedSectionIndex, setSelectedSectionIndex] = useState<number | null>(null);
  const [siteConfig, setSiteConfig] = useState<any>(project.siteConfig || {});
  const [previewMode, setPreviewMode] = useState(false);
  const [aiRegenerating, setAiRegenerating] = useState(false);
  const [rightPanelTab, setRightPanelTab] = useState("page");

  // Content context menu state
  const [selectedText, setSelectedText] = useState("");
  const [contextMenuPosition, setContextMenuPosition] = useState<{ x: number; y: number } | null>(null);
  const [activeTextArea, setActiveTextArea] = useState<HTMLTextAreaElement | null>(null);

  const selectedPage = pages[selectedPageIndex];

  // Handle text selection for context menu
  useEffect(() => {
    const handleSelection = () => {
      const selection = window.getSelection();
      const text = selection?.toString().trim();

      if (text && text.length > 0) {
        const range = selection?.getRangeAt(0);
        const rect = range?.getBoundingClientRect();

        if (rect) {
          setSelectedText(text);
          setContextMenuPosition({
            x: rect.left + rect.width / 2,
            y: rect.bottom + 10,
          });
        }
      } else {
        setContextMenuPosition(null);
      }
    };

    document.addEventListener("mouseup", handleSelection);
    return () => document.removeEventListener("mouseup", handleSelection);
  }, []);

  const handleSave = async () => {
    setSaving(true);
    try {
      const response = await fetch(`/api/builder/update`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          projectId: project.id,
          pages,
          siteConfig,
        }),
      });

      if (!response.ok) throw new Error("Save failed");

      toast.success("Changes saved successfully!");
      router.refresh();
    } catch (error) {
      console.error("Save error:", error);
      toast.error("Failed to save changes");
    } finally {
      setSaving(false);
    }
  };

  const handlePublish = async () => {
    setSaving(true);
    try {
      const response = await fetch(`/api/builder/publish`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          projectId: project.id,
        }),
      });

      if (!response.ok) throw new Error("Publish failed");

      toast.success("Website published successfully!");
      window.open(`https://${project.subdomain}.cdmsuite.com`, "_blank");
    } catch (error) {
      console.error("Publish error:", error);
      toast.error("Failed to publish website");
    } finally {
      setSaving(false);
    }
  };

  const updateHero = (field: string, value: string) => {
    const updatedPages = [...pages];
    updatedPages[selectedPageIndex].hero = {
      ...updatedPages[selectedPageIndex].hero,
      [field]: value,
    };
    setPages(updatedPages);
  };

  const updateSection = (sectionIndex: number, field: string, value: any) => {
    const updatedPages = [...pages];
    updatedPages[selectedPageIndex].sections[sectionIndex] = {
      ...updatedPages[selectedPageIndex].sections[sectionIndex],
      [field]: value,
    };
    setPages(updatedPages);
  };

  const addSection = () => {
    const updatedPages = [...pages];
    updatedPages[selectedPageIndex].sections.push({
      type: "content",
      title: "New Section",
      content: "Add your content here...",
      items: [],
    });
    setPages(updatedPages);
  };

  const deleteSection = (sectionIndex: number) => {
    const updatedPages = [...pages];
    updatedPages[selectedPageIndex].sections.splice(sectionIndex, 1);
    setPages(updatedPages);
    setSelectedSectionIndex(null);
  };

  const addPage = () => {
    const newPage = {
      slug: `page-${pages.length + 1}`,
      title: `New Page ${pages.length + 1}`,
      navLabel: `New Page ${pages.length + 1}`,
      hero: {
        headline: "Page Headline",
        subheadline: "Page subheadline",
        cta: "Get Started",
      },
      sections: [],
      seo: {
        metaTitle: "",
        metaDescription: "",
        keywords: "",
      },
    };
    setPages([...pages, newPage]);
    setSelectedPageIndex(pages.length);
  };

  const deletePage = (pageIndex: number) => {
    if (pages.length === 1) {
      toast.error("Cannot delete the last page");
      return;
    }
    const updatedPages = pages.filter((_, i) => i !== pageIndex);
    setPages(updatedPages);
    setSelectedPageIndex(Math.max(0, pageIndex - 1));
  };

  const aiRegenerateSection = async (sectionIndex: number) => {
    setAiRegenerating(true);
    try {
      const section = selectedPage.sections[sectionIndex];
      const response = await fetch("/api/builder/regenerate-section", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          projectId: project.id,
          pageSlug: selectedPage.slug,
          sectionType: section.type,
          currentContent: section,
        }),
      });

      if (!response.ok) throw new Error("Regeneration failed");

      const data = await response.json();
      updateSection(sectionIndex, "content", data.content);
      updateSection(sectionIndex, "title", data.title);
      if (data.items) {
        updateSection(sectionIndex, "items", data.items);
      }

      toast.success("Section regenerated with AI!");
    } catch (error) {
      console.error("AI regeneration error:", error);
      toast.error("Failed to regenerate section");
    } finally {
      setAiRegenerating(false);
    }
  };

  const handleContentReplace = (newText: string) => {
    if (!activeTextArea) return;

    const start = activeTextArea.selectionStart;
    const end = activeTextArea.selectionEnd;
    const currentValue = activeTextArea.value;

    const newValue =
      currentValue.substring(0, start) + newText + currentValue.substring(end);

    // Update the appropriate field based on which textarea is active
    // This is a simplified version - you'd need to track which field the textarea belongs to
    activeTextArea.value = newValue;
    setContextMenuPosition(null);
  };

  return (
    <div className="h-screen flex flex-col bg-gray-50">
      {/* Top Bar */}
      <div className="bg-white border-b px-4 py-3 flex items-center justify-between">
        <div className="flex items-center gap-4">
          <Button asChild variant="ghost" size="sm">
            <Link href="/dashboard/builder">
              <ArrowLeft className="w-4 h-4 mr-2" />
              Projects
            </Link>
          </Button>
          <div className="h-6 w-px bg-gray-300" />
          <div>
            <h2 className="font-semibold text-lg">{project.name}</h2>
            <p className="text-xs text-muted-foreground">
              {project.subdomain}.cdmsuite.com
            </p>
          </div>
        </div>

        <div className="flex items-center gap-2">
          <Badge variant={project.status === "active" ? "default" : "secondary"}>
            {project.status}
          </Badge>
          <Button
            variant="outline"
            size="sm"
            onClick={() => setPreviewMode(!previewMode)}
          >
            <Eye className="w-4 h-4 mr-2" />
            {previewMode ? "Edit" : "Preview"}
          </Button>
          <Button variant="outline" size="sm" onClick={handleSave} disabled={saving}>
            <Save className="w-4 h-4 mr-2" />
            {saving ? "Saving..." : "Save"}
          </Button>
          <Button size="sm" onClick={handlePublish} disabled={saving}>
            <ExternalLink className="w-4 h-4 mr-2" />
            Publish
          </Button>
        </div>
      </div>

      {/* Main Content */}
      <div className="flex-1 flex overflow-hidden">
        {/* Sidebar - Page Navigator */}
        {!previewMode && (
          <div className="w-64 bg-white border-r overflow-y-auto">
            <div className="p-4 border-b">
              <div className="flex items-center justify-between mb-2">
                <h3 className="font-semibold">Pages</h3>
                <Button size="sm" variant="ghost" onClick={addPage}>
                  <Plus className="w-4 h-4" />
                </Button>
              </div>
              <div className="space-y-1">
                {pages.map((page, index) => (
                  <div
                    key={index}
                    className={`p-2 rounded-lg cursor-pointer flex items-center justify-between group ${
                      selectedPageIndex === index
                        ? "bg-blue-50 text-blue-700"
                        : "hover:bg-gray-50"
                    }`}
                    onClick={() => {
                      setSelectedPageIndex(index);
                      setSelectedSectionIndex(null);
                    }}
                  >
                    <span className="text-sm font-medium">{page.title}</span>
                    {pages.length > 1 && (
                      <Button
                        size="sm"
                        variant="ghost"
                        className="opacity-0 group-hover:opacity-100 h-6 w-6 p-0"
                        onClick={(e) => {
                          e.stopPropagation();
                          deletePage(index);
                        }}
                      >
                        <Trash2 className="w-3 h-3" />
                      </Button>
                    )}
                  </div>
                ))}
              </div>
            </div>

            {selectedPage && (
              <div className="p-4">
                <h3 className="font-semibold mb-2">Sections</h3>
                <div className="space-y-1">
                  <div
                    className={`p-2 rounded-lg cursor-pointer text-sm ${
                      selectedSectionIndex === null
                        ? "bg-blue-50 text-blue-700"
                        : "hover:bg-gray-50"
                    }`}
                    onClick={() => setSelectedSectionIndex(null)}
                  >
                    Hero Section
                  </div>
                  {selectedPage.sections?.map((section: any, index: number) => (
                    <div
                      key={index}
                      className={`p-2 rounded-lg cursor-pointer text-sm flex items-center justify-between group ${
                        selectedSectionIndex === index
                          ? "bg-blue-50 text-blue-700"
                          : "hover:bg-gray-50"
                      }`}
                      onClick={() => setSelectedSectionIndex(index)}
                    >
                      <span>{section.title || `Section ${index + 1}`}</span>
                      <Button
                        size="sm"
                        variant="ghost"
                        className="opacity-0 group-hover:opacity-100 h-6 w-6 p-0"
                        onClick={(e) => {
                          e.stopPropagation();
                          deleteSection(index);
                        }}
                      >
                        <Trash2 className="w-3 h-3" />
                      </Button>
                    </div>
                  ))}
                  <Button
                    size="sm"
                    variant="outline"
                    className="w-full mt-2"
                    onClick={addSection}
                  >
                    <Plus className="w-4 h-4 mr-2" />
                    Add Section
                  </Button>
                </div>
              </div>
            )}
          </div>
        )}

        {/* Editor Panel */}
        <div className="flex-1 overflow-y-auto">
          {previewMode ? (
            <WebsitePreview pages={pages} siteConfig={siteConfig} />
          ) : (
            <div className="max-w-4xl mx-auto p-8">
              {selectedPage && (
                <>
                  {/* Hero Section Editor */}
                  {selectedSectionIndex === null && (
                    <Card className="p-6 mb-6">
                      <div className="flex items-center justify-between mb-4">
                        <h3 className="text-lg font-semibold flex items-center gap-2">
                          <Sparkles className="w-5 h-5" />
                          Hero Section
                        </h3>
                      </div>
                      <div className="space-y-4">
                        <div>
                          <Label>Headline</Label>
                          <Input
                            value={selectedPage.hero?.headline || ""}
                            onChange={(e) => updateHero("headline", e.target.value)}
                            className="text-lg font-bold"
                          />
                        </div>
                        <div>
                          <Label>Subheadline</Label>
                          <Textarea
                            value={selectedPage.hero?.subheadline || ""}
                            onChange={(e) => updateHero("subheadline", e.target.value)}
                            rows={3}
                            onFocus={(e) => setActiveTextArea(e.currentTarget)}
                          />
                        </div>
                        <div>
                          <Label>Call-to-Action Button Text</Label>
                          <Input
                            value={selectedPage.hero?.cta || ""}
                            onChange={(e) => updateHero("cta", e.target.value)}
                          />
                        </div>
                      </div>
                    </Card>
                  )}

                  {/* Section Editor */}
                  {selectedSectionIndex !== null &&
                    selectedPage.sections?.[selectedSectionIndex] && (
                      <Card className="p-6 mb-6">
                        <div className="flex items-center justify-between mb-4">
                          <h3 className="text-lg font-semibold">Edit Section</h3>
                          <div className="flex gap-2">
                            <Button
                              size="sm"
                              variant="outline"
                              onClick={() => aiRegenerateSection(selectedSectionIndex)}
                              disabled={aiRegenerating}
                            >
                              <Wand2 className="w-4 h-4 mr-2" />
                              {aiRegenerating ? "Regenerating..." : "AI Regenerate"}
                            </Button>
                            <Button
                              size="sm"
                              variant="destructive"
                              onClick={() => deleteSection(selectedSectionIndex)}
                            >
                              <Trash2 className="w-4 h-4" />
                            </Button>
                          </div>
                        </div>
                        <div className="space-y-4">
                          <div>
                            <Label>Section Type</Label>
                            <Select
                              value={
                                selectedPage.sections[selectedSectionIndex].type ||
                                "content"
                              }
                              onValueChange={(value) =>
                                updateSection(selectedSectionIndex, "type", value)
                              }
                            >
                              <SelectTrigger>
                                <SelectValue />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="content">Content</SelectItem>
                                <SelectItem value="services">Services</SelectItem>
                                <SelectItem value="features">Features</SelectItem>
                                <SelectItem value="benefits">Benefits</SelectItem>
                                <SelectItem value="testimonials">
                                  Testimonials
                                </SelectItem>
                                <SelectItem value="cta">Call to Action</SelectItem>
                                <SelectItem value="about">About</SelectItem>
                                <SelectItem value="portfolio">Portfolio</SelectItem>
                                <SelectItem value="team">Team</SelectItem>
                                <SelectItem value="pricing">Pricing</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div>
                            <Label>Section Title</Label>
                            <Input
                              value={
                                selectedPage.sections[selectedSectionIndex].title || ""
                              }
                              onChange={(e) =>
                                updateSection(
                                  selectedSectionIndex,
                                  "title",
                                  e.target.value
                                )
                              }
                            />
                          </div>
                          <div>
                            <Label>Content</Label>
                            <Textarea
                              value={
                                selectedPage.sections[selectedSectionIndex].content ||
                                ""
                              }
                              onChange={(e) =>
                                updateSection(
                                  selectedSectionIndex,
                                  "content",
                                  e.target.value
                                )
                              }
                              rows={6}
                              onFocus={(e) => setActiveTextArea(e.currentTarget)}
                            />
                          </div>

                          {/* Items Editor */}
                          {selectedPage.sections[selectedSectionIndex].items &&
                            selectedPage.sections[selectedSectionIndex].items.length >
                              0 && (
                              <div>
                                <Label className="mb-2 block">Items</Label>
                                <div className="space-y-3">
                                  {selectedPage.sections[
                                    selectedSectionIndex
                                  ].items.map((item: any, itemIndex: number) => (
                                    <Card key={itemIndex} className="p-4 bg-gray-50">
                                      <div className="space-y-2">
                                        <Input
                                          placeholder="Item title"
                                          value={item.title || ""}
                                          onChange={(e) => {
                                            const updatedItems = [
                                              ...selectedPage.sections[
                                                selectedSectionIndex
                                              ].items,
                                            ];
                                            updatedItems[itemIndex].title =
                                              e.target.value;
                                            updateSection(
                                              selectedSectionIndex,
                                              "items",
                                              updatedItems
                                            );
                                          }}
                                        />
                                        <Textarea
                                          placeholder="Item description"
                                          value={item.description || ""}
                                          onChange={(e) => {
                                            const updatedItems = [
                                              ...selectedPage.sections[
                                                selectedSectionIndex
                                              ].items,
                                            ];
                                            updatedItems[itemIndex].description =
                                              e.target.value;
                                            updateSection(
                                              selectedSectionIndex,
                                              "items",
                                              updatedItems
                                            );
                                          }}
                                          rows={2}
                                          onFocus={(e) =>
                                            setActiveTextArea(e.currentTarget)
                                          }
                                        />
                                      </div>
                                    </Card>
                                  ))}
                                </div>
                              </div>
                            )}
                        </div>
                      </Card>
                    )}
                </>
              )}
            </div>
          )}
        </div>

        {/* Right Panel - Settings & Tools */}
        {!previewMode && (
          <div className="w-96 bg-white border-l overflow-y-auto">
            <div className="p-4">
              <Tabs value={rightPanelTab} onValueChange={setRightPanelTab}>
                <TabsList className="grid w-full grid-cols-4">
                  <TabsTrigger value="page" title="Page Settings">
                    <FileText className="w-4 h-4" />
                  </TabsTrigger>
                  <TabsTrigger value="nav" title="Navigation">
                    <Layout className="w-4 h-4" />
                  </TabsTrigger>
                  <TabsTrigger value="styles" title="Styles">
                    <Palette className="w-4 h-4" />
                  </TabsTrigger>
                  <TabsTrigger value="seo" title="SEO">
                    <Search className="w-4 h-4" />
                  </TabsTrigger>
                </TabsList>

                <TabsContent value="page" className="space-y-4 mt-4">
                  {selectedPage && (
                    <>
                      <div>
                        <Label>Page Title</Label>
                        <Input
                          value={selectedPage.title || ""}
                          onChange={(e) => {
                            const updatedPages = [...pages];
                            updatedPages[selectedPageIndex].title = e.target.value;
                            setPages(updatedPages);
                          }}
                        />
                      </div>
                      <div>
                        <Label>Page Slug</Label>
                        <Input
                          value={selectedPage.slug || ""}
                          onChange={(e) => {
                            const updatedPages = [...pages];
                            updatedPages[selectedPageIndex].slug = e.target.value
                              .toLowerCase()
                              .replace(/[^a-z0-9-]/g, "-");
                            setPages(updatedPages);
                          }}
                        />
                        <p className="text-xs text-muted-foreground mt-1">
                          URL: /{selectedPage.slug}
                        </p>
                      </div>
                    </>
                  )}
                </TabsContent>

                <TabsContent value="nav" className="mt-4">
                  <NavigationEditor
                    projectId={project.id}
                    pages={pages}
                    onUpdate={(config) => {
                      // Apply navigation config to pages
                      const updatedPages = [...pages];
                      config.pageOrder.forEach((slug: string, index: number) => {
                        const pageIndex = updatedPages.findIndex(
                          (p) => p.slug === slug
                        );
                        if (pageIndex !== -1) {
                          updatedPages[pageIndex].navLabel =
                            config.navLabels?.[slug] || updatedPages[pageIndex].title;
                          updatedPages[pageIndex].icon = config.icons?.[slug];
                          updatedPages[pageIndex].hidden =
                            config.hiddenPages?.includes(slug);
                          updatedPages[pageIndex].isDropdownParent =
                            config.dropdownParents?.includes(slug);
                        }
                      });
                      setPages(updatedPages);
                    }}
                  />
                </TabsContent>

                <TabsContent value="styles" className="mt-4">
                  <GlobalStylesPanel
                    projectId={project.id}
                    initialStyles={project.globalStyles || null}
                    onUpdate={(styles) => {
                      // Update global styles in project
                      setSiteConfig({ ...siteConfig, globalStyles: styles });
                    }}
                  />
                </TabsContent>

                <TabsContent value="seo" className="mt-4">
                  {selectedPage && (
                    <SeoPanel
                      projectId={project.id}
                      pageSlug={selectedPage.slug}
                      pageTitle={selectedPage.title}
                      initialSeo={selectedPage.seo}
                      onUpdate={(seoData) => {
                        const updatedPages = [...pages];
                        updatedPages[selectedPageIndex].seo = seoData;
                        setPages(updatedPages);
                      }}
                    />
                  )}
                </TabsContent>
              </Tabs>
            </div>
          </div>
        )}
      </div>

      {/* Content Context Menu */}
      {contextMenuPosition && selectedText && (
        <ContentContextMenu
          selectedText={selectedText}
          position={contextMenuPosition}
          onClose={() => {
            setContextMenuPosition(null);
            setSelectedText("");
          }}
          onReplace={handleContentReplace}
        />
      )}
    </div>
  );
}

function WebsitePreview({ pages, siteConfig }: any) {
  const [currentPageIndex, setCurrentPageIndex] = useState(0);
  const currentPage = pages[currentPageIndex];

  return (
    <div className="bg-white">
      {/* Preview Navigation */}
      <div className="border-b bg-gray-50 px-8 py-4">
        <div className="max-w-6xl mx-auto flex items-center justify-between">
          <h1 className="text-xl font-bold">{siteConfig.siteName}</h1>
          <nav className="flex gap-6">
            {pages.map((page: any, index: number) => (
              <button
                key={index}
                onClick={() => setCurrentPageIndex(index)}
                className={`text-sm font-medium ${
                  currentPageIndex === index
                    ? "text-blue-600"
                    : "text-gray-600 hover:text-gray-900"
                }`}
              >
                {page.navLabel || page.title}
              </button>
            ))}
          </nav>
        </div>
      </div>

      {/* Preview Content */}
      {currentPage && (
        <div className="max-w-6xl mx-auto">
          {/* Hero */}
          <div className="py-20 px-8 text-center bg-gradient-to-br from-blue-50 to-purple-50">
            <h1 className="text-5xl font-bold mb-6">
              {currentPage.hero?.headline}
            </h1>
            <p className="text-xl text-gray-600 mb-8 max-w-3xl mx-auto">
              {currentPage.hero?.subheadline}
            </p>
            <Button size="lg">{currentPage.hero?.cta}</Button>
          </div>

          {/* Sections */}
          {currentPage.sections?.map((section: any, index: number) => (
            <div key={index} className="py-16 px-8">
              <div className="max-w-4xl mx-auto">
                <h2 className="text-3xl font-bold mb-6 text-center">
                  {section.title}
                </h2>
                <div className="prose max-w-none mb-8">
                  <p>{section.content}</p>
                </div>
                {section.items && section.items.length > 0 && (
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                    {section.items.map((item: any, itemIndex: number) => (
                      <Card key={itemIndex} className="p-6">
                        <h3 className="font-semibold text-lg mb-2">
                          {item.title}
                        </h3>
                        <p className="text-gray-600 text-sm">
                          {item.description}
                        </p>
                      </Card>
                    ))}
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/builder/global-styles-panel.tsx
// ==========================================


"use client";

import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Card } from "@/components/ui/card";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Palette, Save, RotateCcw, Sparkles } from "lucide-react";
import { toast } from "sonner";

interface GlobalStylesPanelProps {
  projectId: string;
  initialStyles?: any;
  onUpdate: (styles: any) => void;
}

const WEB_SAFE_FONTS = [
  { value: "Inter", label: "Inter (Modern Sans-serif)" },
  { value: "Arial", label: "Arial" },
  { value: "Helvetica", label: "Helvetica" },
  { value: "Georgia", label: "Georgia (Serif)" },
  { value: "Times New Roman", label: "Times New Roman" },
  { value: "Courier New", label: "Courier New (Monospace)" },
  { value: "Verdana", label: "Verdana" },
  { value: "Trebuchet MS", label: "Trebuchet MS" },
  { value: "Palatino", label: "Palatino" },
  { value: "Garamond", label: "Garamond" },
];

export function GlobalStylesPanel({ 
  projectId, 
  initialStyles, 
  onUpdate 
}: GlobalStylesPanelProps) {
  const [styles, setStyles] = useState({
    colors: {
      primary: "#3B82F6",
      secondary: "#8B5CF6",
      accent: "#F59E0B",
      text: "#1F2937",
      background: "#FFFFFF",
    },
    fonts: {
      heading: "Inter",
      body: "Inter",
    },
    ...initialStyles,
  });

  const [saving, setSaving] = useState(false);
  const [hasChanges, setHasChanges] = useState(false);

  useEffect(() => {
    if (initialStyles) {
      setStyles({ ...styles, ...initialStyles });
    }
  }, [initialStyles]);

  const handleColorChange = (colorKey: string, value: string) => {
    setStyles({
      ...styles,
      colors: {
        ...styles.colors,
        [colorKey]: value,
      },
    });
    setHasChanges(true);
  };

  const handleFontChange = (fontKey: string, value: string) => {
    setStyles({
      ...styles,
      fonts: {
        ...styles.fonts,
        [fontKey]: value,
      },
    });
    setHasChanges(true);
  };

  const handleSave = async () => {
    setSaving(true);
    try {
      const response = await fetch("/api/builder/global-styles", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ projectId, globalStyles: styles }),
      });

      if (!response.ok) throw new Error("Failed to save styles");

      toast.success("Site styles updated successfully!");
      setHasChanges(false);
      onUpdate(styles);
    } catch (error) {
      console.error("Save styles error:", error);
      toast.error("Failed to save styles");
    } finally {
      setSaving(false);
    }
  };

  const handleReset = () => {
    setStyles(initialStyles || {
      colors: {
        primary: "#3B82F6",
        secondary: "#8B5CF6",
        accent: "#F59E0B",
        text: "#1F2937",
        background: "#FFFFFF",
      },
      fonts: {
        heading: "Inter",
        body: "Inter",
      },
    });
    setHasChanges(false);
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-lg font-semibold flex items-center gap-2">
            <Palette className="w-5 h-5" />
            Site Styles
          </h3>
          <p className="text-sm text-muted-foreground">
            Customize your site's visual brand
          </p>
        </div>
        <div className="flex gap-2">
          {hasChanges && (
            <Button variant="ghost" size="sm" onClick={handleReset}>
              <RotateCcw className="w-4 h-4 mr-2" />
              Reset
            </Button>
          )}
          <Button 
            size="sm" 
            onClick={handleSave} 
            disabled={saving || !hasChanges}
          >
            <Save className="w-4 h-4 mr-2" />
            {saving ? "Saving..." : "Save"}
          </Button>
        </div>
      </div>

      {/* Colors Section */}
      <Card className="p-4">
        <h4 className="font-semibold mb-4 flex items-center gap-2">
          <Palette className="w-4 h-4" />
          Color Palette
        </h4>
        <div className="space-y-3">
          {Object.entries(styles.colors).map(([key, value]) => (
            <div key={key} className="flex items-center gap-3">
              <div className="flex-1">
                <Label className="capitalize">{key}</Label>
              </div>
              <input
                type="color"
                value={value as string}
                onChange={(e) => handleColorChange(key, e.target.value)}
                className="w-12 h-10 rounded border cursor-pointer"
              />
              <input
                type="text"
                value={value as string}
                onChange={(e) => handleColorChange(key, e.target.value)}
                className="w-24 px-2 py-1 text-sm border rounded font-mono"
              />
            </div>
          ))}
        </div>
      </Card>

      {/* Fonts Section */}
      <Card className="p-4">
        <h4 className="font-semibold mb-4">Typography</h4>
        <div className="space-y-4">
          <div>
            <Label>Heading Font</Label>
            <Select
              value={styles.fonts.heading}
              onValueChange={(value) => handleFontChange("heading", value)}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {WEB_SAFE_FONTS.map((font) => (
                  <SelectItem key={font.value} value={font.value}>
                    <span style={{ fontFamily: font.value }}>{font.label}</span>
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div>
            <Label>Body Font</Label>
            <Select
              value={styles.fonts.body}
              onValueChange={(value) => handleFontChange("body", value)}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {WEB_SAFE_FONTS.map((font) => (
                  <SelectItem key={font.value} value={font.value}>
                    <span style={{ fontFamily: font.value }}>{font.label}</span>
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </div>
      </Card>

      {/* Preview */}
      <Card className="p-6">
        <h4 className="font-semibold mb-4">Style Preview</h4>
        <div 
          className="space-y-4 p-6 rounded-lg"
          style={{ 
            backgroundColor: styles.colors.background,
            color: styles.colors.text,
          }}
        >
          <h1 
            className="text-3xl font-bold"
            style={{ 
              fontFamily: styles.fonts.heading,
              color: styles.colors.primary,
            }}
          >
            Heading Example
          </h1>
          <p style={{ fontFamily: styles.fonts.body }}>
            This is how your body text will look on your website. The font and colors
            will be applied consistently across all pages.
          </p>
          <div className="flex gap-2">
            <button
              className="px-4 py-2 rounded-lg font-medium"
              style={{ 
                backgroundColor: styles.colors.primary,
                color: "#FFFFFF",
              }}
            >
              Primary Button
            </button>
            <button
              className="px-4 py-2 rounded-lg font-medium"
              style={{ 
                backgroundColor: styles.colors.secondary,
                color: "#FFFFFF",
              }}
            >
              Secondary Button
            </button>
            <button
              className="px-4 py-2 rounded-lg font-medium"
              style={{ 
                backgroundColor: styles.colors.accent,
                color: "#FFFFFF",
              }}
            >
              Accent Button
            </button>
          </div>
        </div>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/builder/icon-picker.tsx
// ==========================================


"use client";

import { useState, useMemo } from "react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import * as LucideIcons from "lucide-react";
import { Search } from "lucide-react";

interface IconPickerProps {
  open: boolean;
  onClose: () => void;
  onSelect: (iconName: string) => void;
  currentIcon?: string;
}

// Popular icon names for common pages
const POPULAR_ICONS = [
  "Home", "Phone", "Mail", "User", "Users", "Briefcase", "ShoppingCart",
  "Heart", "Star", "Settings", "Menu", "Search", "Calendar", "Clock",
  "MapPin", "MessageSquare", "Image", "Video", "Music", "FileText",
  "Folder", "Download", "Upload", "Share2", "Link", "ExternalLink",
  "ChevronRight", "ChevronDown", "Plus", "Minus", "X", "Check",
  "Info", "AlertCircle", "HelpCircle", "Zap", "TrendingUp", "Award"
];

export function IconPicker({ open, onClose, onSelect, currentIcon }: IconPickerProps) {
  const [search, setSearch] = useState("");

  // Get all available Lucide icons
  const allIcons = useMemo(() => {
    return Object.keys(LucideIcons).filter(
      (key) => 
        key !== "default" && 
        key !== "createLucideIcon" &&
        typeof (LucideIcons as any)[key] === "function"
    );
  }, []);

  // Filter icons based on search
  const filteredIcons = useMemo(() => {
    if (!search) {
      return POPULAR_ICONS;
    }
    return allIcons.filter((name) =>
      name.toLowerCase().includes(search.toLowerCase())
    );
  }, [search, allIcons]);

  const handleSelect = (iconName: string) => {
    onSelect(iconName);
    onClose();
  };

  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="max-w-2xl">
        <DialogHeader>
          <DialogTitle>Choose an Icon</DialogTitle>
        </DialogHeader>

        <div className="space-y-4">
          {/* Search */}
          <div className="relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
            <Input
              placeholder="Search icons..."
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="pl-9"
            />
          </div>

          {/* Icon Grid */}
          <ScrollArea className="h-96">
            <div className="grid grid-cols-8 gap-2 p-1">
              {filteredIcons.map((iconName) => {
                const IconComponent = (LucideIcons as any)[iconName];
                return (
                  <button
                    key={iconName}
                    onClick={() => handleSelect(iconName)}
                    className={`p-3 rounded-lg hover:bg-accent transition-colors flex flex-col items-center gap-1 group ${
                      currentIcon === iconName ? "bg-accent ring-2 ring-primary" : ""
                    }`}
                    title={iconName}
                  >
                    <IconComponent className="w-6 h-6" />
                    <span className="text-xs opacity-0 group-hover:opacity-100 transition-opacity truncate w-full text-center">
                      {iconName}
                    </span>
                  </button>
                );
              })}
            </div>
          </ScrollArea>

          {/* Footer */}
          <div className="flex justify-between items-center text-sm text-muted-foreground">
            <span>
              {search ? `${filteredIcons.length} icons found` : "Popular icons"}
            </span>
            <Button variant="ghost" size="sm" onClick={() => setSearch("")}>
              Clear Search
            </Button>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}

// ==========================================
// File: components/builder/navigation-editor.tsx
// ==========================================


"use client";

import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Card } from "@/components/ui/card";
import { Switch } from "@/components/ui/switch";
import { 
  Eye, EyeOff, GripVertical, ChevronRight, ChevronDown, 
  Sparkles, Save, RotateCcw 
} from "lucide-react";
import * as LucideIcons from "lucide-react";
import { IconPicker } from "./icon-picker";
import { toast } from "sonner";
import {
  DndContext,
  closestCenter,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
  DragEndEvent,
} from "@dnd-kit/core";
import {
  arrayMove,
  SortableContext,
  sortableKeyboardCoordinates,
  useSortable,
  verticalListSortingStrategy,
} from "@dnd-kit/sortable";
import { CSS } from "@dnd-kit/utilities";

interface NavigationEditorProps {
  projectId: string;
  pages: any[];
  onUpdate: (navigationConfig: any) => void;
}

interface NavItem {
  slug: string;
  title: string;
  navLabel: string;
  icon?: string;
  hidden: boolean;
  isDropdownParent?: boolean;
  children?: NavItem[];
}

function SortableNavItem({ 
  item, 
  onToggleVisibility, 
  onLabelChange, 
  onIconSelect,
  onToggleDropdown,
  isChild = false 
}: any) {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: item.slug });

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
    opacity: isDragging ? 0.5 : 1,
  };

  const [isEditing, setIsEditing] = useState(false);
  const [tempLabel, setTempLabel] = useState(item.navLabel);
  const [iconPickerOpen, setIconPickerOpen] = useState(false);
  const [isExpanded, setIsExpanded] = useState(true);

  const IconComponent = item.icon 
    ? (LucideIcons as any)[item.icon] 
    : null;

  const handleLabelSave = () => {
    onLabelChange(item.slug, tempLabel);
    setIsEditing(false);
  };

  return (
    <>
      <div
        ref={setNodeRef}
        style={style}
        className={`group ${isChild ? "ml-8" : ""}`}
      >
        <Card className={`p-3 mb-2 ${item.hidden ? "opacity-50" : ""}`}>
          <div className="flex items-center gap-3">
            {/* Drag Handle */}
            <div
              {...attributes}
              {...listeners}
              className="cursor-grab active:cursor-grabbing text-muted-foreground hover:text-foreground"
            >
              <GripVertical className="w-4 h-4" />
            </div>

            {/* Icon */}
            <button
              onClick={() => setIconPickerOpen(true)}
              className="w-8 h-8 flex items-center justify-center rounded-lg bg-muted hover:bg-accent transition-colors"
              title="Change icon"
            >
              {IconComponent ? (
                <IconComponent className="w-4 h-4" />
              ) : (
                <Sparkles className="w-4 h-4 text-muted-foreground" />
              )}
            </button>

            {/* Label */}
            <div className="flex-1">
              {isEditing ? (
                <div className="flex gap-2">
                  <Input
                    value={tempLabel}
                    onChange={(e) => setTempLabel(e.target.value)}
                    onBlur={handleLabelSave}
                    onKeyDown={(e) => {
                      if (e.key === "Enter") handleLabelSave();
                      if (e.key === "Escape") {
                        setTempLabel(item.navLabel);
                        setIsEditing(false);
                      }
                    }}
                    autoFocus
                    className="h-8"
                  />
                </div>
              ) : (
                <button
                  onClick={() => setIsEditing(true)}
                  className="text-left hover:text-primary transition-colors"
                >
                  <p className="font-medium">{item.navLabel}</p>
                  <p className="text-xs text-muted-foreground">/{item.slug}</p>
                </button>
              )}
            </div>

            {/* Dropdown Toggle */}
            {!isChild && (
              <Button
                variant="ghost"
                size="sm"
                onClick={() => onToggleDropdown(item.slug)}
                title={item.isDropdownParent ? "Remove from dropdown" : "Make dropdown parent"}
              >
                {item.isDropdownParent ? (
                  <ChevronDown className="w-4 h-4" />
                ) : (
                  <ChevronRight className="w-4 h-4 opacity-30" />
                )}
              </Button>
            )}

            {/* Visibility Toggle */}
            <div className="flex items-center gap-2">
              <Switch
                checked={!item.hidden}
                onCheckedChange={(checked) => onToggleVisibility(item.slug, !checked)}
              />
              {item.hidden ? (
                <EyeOff className="w-4 h-4 text-muted-foreground" />
              ) : (
                <Eye className="w-4 h-4 text-muted-foreground" />
              )}
            </div>
          </div>
        </Card>
      </div>

      <IconPicker
        open={iconPickerOpen}
        onClose={() => setIconPickerOpen(false)}
        onSelect={(iconName) => onIconSelect(item.slug, iconName)}
        currentIcon={item.icon}
      />
    </>
  );
}

export function NavigationEditor({ projectId, pages, onUpdate }: NavigationEditorProps) {
  const [navItems, setNavItems] = useState<NavItem[]>([]);
  const [saving, setSaving] = useState(false);
  const [hasChanges, setHasChanges] = useState(false);

  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    })
  );

  // Initialize nav items from pages
  useEffect(() => {
    const items: NavItem[] = pages.map((page) => ({
      slug: page.slug,
      title: page.title,
      navLabel: page.navLabel || page.title,
      icon: page.icon,
      hidden: page.hidden || false,
      isDropdownParent: page.isDropdownParent || false,
      children: [],
    }));
    setNavItems(items);
  }, [pages]);

  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event;

    if (over && active.id !== over.id) {
      setNavItems((items) => {
        const oldIndex = items.findIndex((item) => item.slug === active.id);
        const newIndex = items.findIndex((item) => item.slug === over.id);
        return arrayMove(items, oldIndex, newIndex);
      });
      setHasChanges(true);
    }
  };

  const handleToggleVisibility = (slug: string, hidden: boolean) => {
    setNavItems((items) =>
      items.map((item) =>
        item.slug === slug ? { ...item, hidden } : item
      )
    );
    setHasChanges(true);
  };

  const handleLabelChange = (slug: string, newLabel: string) => {
    setNavItems((items) =>
      items.map((item) =>
        item.slug === slug ? { ...item, navLabel: newLabel } : item
      )
    );
    setHasChanges(true);
  };

  const handleIconSelect = (slug: string, iconName: string) => {
    setNavItems((items) =>
      items.map((item) =>
        item.slug === slug ? { ...item, icon: iconName } : item
      )
    );
    setHasChanges(true);
  };

  const handleToggleDropdown = (slug: string) => {
    setNavItems((items) =>
      items.map((item) =>
        item.slug === slug 
          ? { ...item, isDropdownParent: !item.isDropdownParent } 
          : item
      )
    );
    setHasChanges(true);
  };

  const handleSave = async () => {
    setSaving(true);
    try {
      const navigationConfig = {
        pageOrder: navItems.map((item) => item.slug),
        hiddenPages: navItems.filter((item) => item.hidden).map((item) => item.slug),
        icons: navItems.reduce((acc: any, item) => {
          if (item.icon) acc[item.slug] = item.icon;
          return acc;
        }, {}),
        navLabels: navItems.reduce((acc: any, item) => {
          acc[item.slug] = item.navLabel;
          return acc;
        }, {}),
        dropdownParents: navItems.filter((item) => item.isDropdownParent).map((item) => item.slug),
      };

      const response = await fetch("/api/builder/navigation", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ projectId, navigationConfig }),
      });

      if (!response.ok) throw new Error("Failed to save navigation");

      toast.success("Navigation updated successfully!");
      setHasChanges(false);
      onUpdate(navigationConfig);
    } catch (error) {
      console.error("Save navigation error:", error);
      toast.error("Failed to save navigation");
    } finally {
      setSaving(false);
    }
  };

  const handleReset = () => {
    const items: NavItem[] = pages.map((page) => ({
      slug: page.slug,
      title: page.title,
      navLabel: page.navLabel || page.title,
      icon: page.icon,
      hidden: page.hidden || false,
      isDropdownParent: page.isDropdownParent || false,
      children: [],
    }));
    setNavItems(items);
    setHasChanges(false);
  };

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-lg font-semibold">Navigation Manager</h3>
          <p className="text-sm text-muted-foreground">
            Drag to reorder, click labels to edit, toggle visibility
          </p>
        </div>
        <div className="flex gap-2">
          {hasChanges && (
            <Button variant="ghost" size="sm" onClick={handleReset}>
              <RotateCcw className="w-4 h-4 mr-2" />
              Reset
            </Button>
          )}
          <Button 
            size="sm" 
            onClick={handleSave} 
            disabled={saving || !hasChanges}
          >
            <Save className="w-4 h-4 mr-2" />
            {saving ? "Saving..." : "Save Changes"}
          </Button>
        </div>
      </div>

      <DndContext
        sensors={sensors}
        collisionDetection={closestCenter}
        onDragEnd={handleDragEnd}
      >
        <SortableContext
          items={navItems.map((item) => item.slug)}
          strategy={verticalListSortingStrategy}
        >
          <div className="space-y-2">
            {navItems.map((item) => (
              <SortableNavItem
                key={item.slug}
                item={item}
                onToggleVisibility={handleToggleVisibility}
                onLabelChange={handleLabelChange}
                onIconSelect={handleIconSelect}
                onToggleDropdown={handleToggleDropdown}
              />
            ))}
          </div>
        </SortableContext>
      </DndContext>
    </div>
  );
}

// ==========================================
// File: components/builder/preview-client.tsx
// ==========================================


"use client";

import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { ArrowLeft, Globe, ExternalLink, Edit, Eye, ShoppingBag } from "lucide-react";
import Link from "next/link";
import { useState } from "react";

interface PreviewClientProps {
  project: any;
}

export function PreviewClient({ project }: PreviewClientProps) {
  const { name, subdomain, pages, siteConfig } = project;
  const [selectedPage, setSelectedPage] = useState("home");

  // Check if this is an ecommerce site
  const isEcommerce = pages?.some((p: any) => 
    p.slug === "shop" || p.slug === "products" || p.slug === "store"
  );

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <div className="bg-white border-b sticky top-0 z-10">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <Button asChild variant="ghost" size="sm">
                <Link href="/dashboard/projects">
                  <ArrowLeft className="w-4 h-4 mr-2" />
                  Back to Projects
                </Link>
              </Button>
              <div>
                <h1 className="font-bold text-lg">{name}</h1>
                {subdomain && (
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-blue-600">
                      {subdomain}.cdmsuite.com
                    </span>
                    {isEcommerce && (
                      <span className="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full">
                        E-commerce
                      </span>
                    )}
                  </div>
                )}
              </div>
            </div>
            <div className="flex gap-2">
              {isEcommerce && (
                <Button asChild variant="outline">
                  <Link href={`/dashboard/projects/${project.id}/shopify`}>
                    <ShoppingBag className="w-4 h-4 mr-2" />
                    Connect Shopify
                  </Link>
                </Button>
              )}
              <Button asChild variant="outline">
                <Link href={`/builder/editor/${project.id}`}>
                  <Edit className="w-4 h-4 mr-2" />
                  Edit
                </Link>
              </Button>
              {subdomain && (
                <Button asChild>
                  <Link href={`/site/${subdomain}`} target="_blank">
                    <Eye className="w-4 h-4 mr-2" />
                    View Live Site
                  </Link>
                </Button>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* Website Preview */}
      <div className="max-w-7xl mx-auto px-4 py-8">
        <div className="bg-white rounded-lg shadow-lg overflow-hidden">
          {/* Browser Chrome */}
          <div className="bg-gray-100 border-b px-4 py-3 flex items-center gap-2">
            <div className="flex gap-2">
              <div className="w-3 h-3 rounded-full bg-red-500"></div>
              <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
              <div className="w-3 h-3 rounded-full bg-green-500"></div>
            </div>
            <div className="flex-1 mx-4">
              <div className="bg-white rounded px-3 py-1 text-sm text-gray-600">
                https://{subdomain}.cdmsuite.com
              </div>
            </div>
          </div>

          {/* Page Tabs */}
          <div className="bg-gray-50 border-b px-4 py-2 flex gap-2 overflow-x-auto">
            {pages?.map((page: any) => (
              <button
                key={page.slug}
                onClick={() => setSelectedPage(page.slug)}
                className={`px-4 py-2 rounded-t text-sm font-medium transition-colors whitespace-nowrap ${
                  selectedPage === page.slug
                    ? "bg-white text-blue-600 border-b-2 border-blue-600"
                    : "text-gray-600 hover:text-gray-900"
                }`}
              >
                {page.title}
              </button>
            ))}
          </div>

          {/* Website Content */}
          <div className="bg-white" style={{ minHeight: "600px" }}>
            <iframe
              src={`/site/${subdomain}?page=${selectedPage}`}
              className="w-full"
              style={{ height: "calc(100vh - 300px)", minHeight: "600px" }}
              title="Website Preview"
            />
          </div>
        </div>

        {/* Info Cards */}
        <div className="grid md:grid-cols-3 gap-6 mt-8">
          <Card className="p-6">
            <h3 className="font-bold mb-2">üìÑ Pages Created</h3>
            <p className="text-3xl font-bold text-blue-600">{pages?.length || 0}</p>
            <p className="text-sm text-gray-600 mt-2">
              Full multi-page website with navigation
            </p>
          </Card>

          <Card className="p-6">
            <h3 className="font-bold mb-2">üé® Design Template</h3>
            <p className="text-lg font-semibold">{project.template || "Custom"}</p>
            <p className="text-sm text-gray-600 mt-2">
              Professional design optimized for your industry
            </p>
          </Card>

          <Card className="p-6">
            <h3 className="font-bold mb-2">üöÄ Status</h3>
            <div className="flex items-center gap-2 mt-2">
              <div className="w-2 h-2 rounded-full bg-green-500"></div>
              <span className="font-semibold text-green-600">Live & Ready</span>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Your website is published and accessible
            </p>
          </Card>
        </div>

        {/* Next Steps */}
        <Card className="p-6 mt-6">
          <h3 className="font-bold text-lg mb-4">Next Steps</h3>
          <div className="grid md:grid-cols-2 gap-4">
            <div className="flex gap-3">
              <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                <span className="text-blue-600 font-bold">1</span>
              </div>
              <div>
                <h4 className="font-semibold">Customize Your Content</h4>
                <p className="text-sm text-gray-600">
                  Edit pages, update images, and personalize the content
                </p>
              </div>
            </div>
            <div className="flex gap-3">
              <div className="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0">
                <span className="text-purple-600 font-bold">2</span>
              </div>
              <div>
                <h4 className="font-semibold">Connect Your Domain</h4>
                <p className="text-sm text-gray-600">
                  Link your custom domain for a professional presence
                </p>
              </div>
            </div>
            {isEcommerce && (
              <div className="flex gap-3">
                <div className="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                  <span className="text-green-600 font-bold">3</span>
                </div>
                <div>
                  <h4 className="font-semibold">Connect Shopify Store</h4>
                  <p className="text-sm text-gray-600">
                    Link your Shopify account to enable real e-commerce
                  </p>
                </div>
              </div>
            )}
            <div className="flex gap-3">
              <div className="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center flex-shrink-0">
                <span className="text-orange-600 font-bold">{isEcommerce ? "4" : "3"}</span>
              </div>
              <div>
                <h4 className="font-semibold">Share & Promote</h4>
                <p className="text-sm text-gray-600">
                  Share your new website and start attracting visitors
                </p>
              </div>
            </div>
          </div>
        </Card>
      </div>
    </div>
  );
}

// ==========================================
// File: components/builder/seo-panel.tsx
// ==========================================


"use client";

import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Save, RotateCcw, Sparkles, Upload, X } from "lucide-react";
import { toast } from "sonner";

interface SeoData {
  metaTitle: string;
  metaDescription: string;
  keywords: string;
  ogImage?: string;
}

interface SeoPanelProps {
  projectId: string;
  pageSlug: string;
  pageTitle: string;
  initialSeo?: SeoData;
  onUpdate: (seoData: SeoData) => void;
}

export function SeoPanel({ 
  projectId, 
  pageSlug, 
  pageTitle,
  initialSeo, 
  onUpdate 
}: SeoPanelProps) {
  const [seoData, setSeoData] = useState<SeoData>({
    metaTitle: "",
    metaDescription: "",
    keywords: "",
    ogImage: "",
    ...initialSeo,
  });

  const [saving, setSaving] = useState(false);
  const [hasChanges, setHasChanges] = useState(false);
  const [generating, setGenerating] = useState(false);

  useEffect(() => {
    if (initialSeo) {
      setSeoData({ ...seoData, ...initialSeo });
    }
  }, [initialSeo]);

  const handleChange = (field: keyof SeoData, value: string) => {
    setSeoData({ ...seoData, [field]: value });
    setHasChanges(true);
  };

  const handleSave = async () => {
    setSaving(true);
    try {
      const response = await fetch("/api/builder/seo", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ projectId, pageSlug, seoData }),
      });

      if (!response.ok) throw new Error("Failed to save SEO settings");

      toast.success("SEO settings updated successfully!");
      setHasChanges(false);
      onUpdate(seoData);
    } catch (error) {
      console.error("Save SEO error:", error);
      toast.error("Failed to save SEO settings");
    } finally {
      setSaving(false);
    }
  };

  const handleReset = () => {
    setSeoData(initialSeo || {
      metaTitle: "",
      metaDescription: "",
      keywords: "",
      ogImage: "",
    });
    setHasChanges(false);
  };

  const handleGenerateWithAI = async () => {
    setGenerating(true);
    try {
      // This would call an AI endpoint to generate SEO content
      // For now, we'll create intelligent defaults based on page title
      const generatedSeo = {
        metaTitle: `${pageTitle} | Your Business Name`,
        metaDescription: `Learn more about ${pageTitle.toLowerCase()} and how we can help you achieve your goals. Get started today!`,
        keywords: pageTitle.toLowerCase().split(" ").join(", "),
      };
      
      setSeoData({ ...seoData, ...generatedSeo });
      setHasChanges(true);
      toast.success("AI-generated SEO content!");
    } catch (error) {
      console.error("Generate SEO error:", error);
      toast.error("Failed to generate SEO content");
    } finally {
      setGenerating(false);
    }
  };

  const titleLength = seoData.metaTitle.length;
  const descriptionLength = seoData.metaDescription.length;
  const titleStatus = titleLength === 0 ? "empty" : titleLength > 60 ? "too-long" : "good";
  const descriptionStatus = descriptionLength === 0 ? "empty" : descriptionLength > 160 ? "too-long" : "good";

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-lg font-semibold">SEO Settings</h3>
          <p className="text-sm text-muted-foreground">
            Optimize {pageTitle} for search engines
          </p>
        </div>
        <div className="flex gap-2">
          <Button 
            variant="outline" 
            size="sm" 
            onClick={handleGenerateWithAI}
            disabled={generating}
          >
            <Sparkles className="w-4 h-4 mr-2" />
            {generating ? "Generating..." : "Generate with AI"}
          </Button>
          {hasChanges && (
            <Button variant="ghost" size="sm" onClick={handleReset}>
              <RotateCcw className="w-4 h-4 mr-2" />
              Reset
            </Button>
          )}
          <Button 
            size="sm" 
            onClick={handleSave} 
            disabled={saving || !hasChanges}
          >
            <Save className="w-4 h-4 mr-2" />
            {saving ? "Saving..." : "Save"}
          </Button>
        </div>
      </div>

      <Card className="p-4 space-y-4">
        {/* Meta Title */}
        <div>
          <div className="flex items-center justify-between mb-2">
            <Label>Meta Title</Label>
            <div className="flex items-center gap-2">
              <Badge 
                variant={titleStatus === "good" ? "default" : titleStatus === "too-long" ? "destructive" : "secondary"}
              >
                {titleLength}/60
              </Badge>
              {titleStatus === "too-long" && (
                <span className="text-xs text-destructive">Too long</span>
              )}
            </div>
          </div>
          <Input
            value={seoData.metaTitle}
            onChange={(e) => handleChange("metaTitle", e.target.value)}
            placeholder="Your page title for search results"
            maxLength={80}
          />
          <p className="text-xs text-muted-foreground mt-1">
            Recommended: 50-60 characters
          </p>
        </div>

        {/* Meta Description */}
        <div>
          <div className="flex items-center justify-between mb-2">
            <Label>Meta Description</Label>
            <div className="flex items-center gap-2">
              <Badge 
                variant={descriptionStatus === "good" ? "default" : descriptionStatus === "too-long" ? "destructive" : "secondary"}
              >
                {descriptionLength}/160
              </Badge>
              {descriptionStatus === "too-long" && (
                <span className="text-xs text-destructive">Too long</span>
              )}
            </div>
          </div>
          <Textarea
            value={seoData.metaDescription}
            onChange={(e) => handleChange("metaDescription", e.target.value)}
            placeholder="A brief description that appears in search results"
            rows={3}
            maxLength={200}
          />
          <p className="text-xs text-muted-foreground mt-1">
            Recommended: 150-160 characters
          </p>
        </div>

        {/* Keywords */}
        <div>
          <Label>Keywords (comma-separated)</Label>
          <Input
            value={seoData.keywords}
            onChange={(e) => handleChange("keywords", e.target.value)}
            placeholder="keyword1, keyword2, keyword3"
          />
          <p className="text-xs text-muted-foreground mt-1">
            Add 3-5 relevant keywords for this page
          </p>
        </div>

        {/* Open Graph Image */}
        <div>
          <Label>Social Media Share Image (Open Graph)</Label>
          {seoData.ogImage ? (
            <div className="mt-2 relative">
              <img 
                src={seoData.ogImage} 
                alt="OG Image" 
                className="w-full h-40 object-cover rounded-lg border"
              />
              <Button
                variant="destructive"
                size="sm"
                className="absolute top-2 right-2"
                onClick={() => handleChange("ogImage", "")}
              >
                <X className="w-4 h-4" />
              </Button>
            </div>
          ) : (
            <div className="mt-2 border-2 border-dashed rounded-lg p-8 text-center">
              <Upload className="w-8 h-8 mx-auto mb-2 text-muted-foreground" />
              <p className="text-sm text-muted-foreground mb-2">
                Upload an image for social media sharing
              </p>
              <Button variant="outline" size="sm">
                Choose File
              </Button>
              <p className="text-xs text-muted-foreground mt-2">
                Recommended: 1200x630px
              </p>
            </div>
          )}
        </div>
      </Card>

      {/* Preview */}
      <Card className="p-4">
        <h4 className="font-semibold mb-3">Search Result Preview</h4>
        <div className="space-y-1">
          <div className="text-blue-600 text-lg hover:underline">
            {seoData.metaTitle || "Your Page Title"}
          </div>
          <div className="text-green-700 text-sm">
            https://yourdomain.com/{pageSlug}
          </div>
          <div className="text-gray-600 text-sm">
            {seoData.metaDescription || "Your page description will appear here..."}
          </div>
        </div>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/builder/shopify-integration-client.tsx
// ==========================================


"use client";

import { useState, useEffect } from "react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { ArrowLeft, ShoppingBag, Check, ExternalLink, AlertCircle } from "lucide-react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import toast from "react-hot-toast";

interface ShopifyIntegrationClientProps {
  project: any;
}

export function ShopifyIntegrationClient({ project }: ShopifyIntegrationClientProps) {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [connected, setConnected] = useState(false);
  const [shopifyData, setShopifyData] = useState<any>(null);
  const [formData, setFormData] = useState({
    shopifyDomain: "",
    accessToken: "",
  });

  useEffect(() => {
    // Check existing connection
    const checkConnection = async () => {
      try {
        const response = await fetch(`/api/builder/shopify?projectId=${project.id}`);
        if (response.ok) {
          const data = await response.json();
          setConnected(data.connected);
          setShopifyData(data);
          if (data.domain) {
            setFormData((prev) => ({ ...prev, shopifyDomain: data.domain }));
          }
        }
      } catch (error) {
        console.error("Error checking Shopify connection:", error);
      }
    };

    checkConnection();
  }, [project.id]);

  const handleConnect = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const response = await fetch("/api/builder/shopify", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          projectId: project.id,
          shopifyDomain: formData.shopifyDomain,
          accessToken: formData.accessToken,
        }),
      });

      if (!response.ok) {
        throw new Error("Failed to connect Shopify");
      }

      toast.success("Shopify connected successfully!");
      setConnected(true);
      router.refresh();
    } catch (error) {
      console.error("Error connecting Shopify:", error);
      toast.error("Failed to connect Shopify. Please check your credentials.");
    } finally {
      setLoading(false);
    }
  };

  const handleDisconnect = async () => {
    if (!confirm("Are you sure you want to disconnect Shopify?")) return;

    setLoading(true);
    try {
      const response = await fetch("/api/builder/shopify", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ projectId: project.id }),
      });

      if (!response.ok) {
        throw new Error("Failed to disconnect Shopify");
      }

      toast.success("Shopify disconnected successfully");
      setConnected(false);
      setFormData({ shopifyDomain: "", accessToken: "" });
      router.refresh();
    } catch (error) {
      console.error("Error disconnecting Shopify:", error);
      toast.error("Failed to disconnect Shopify");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center gap-4">
        <Button asChild variant="ghost" size="sm">
          <Link href={`/dashboard/projects/${project.id}`}>
            <ArrowLeft className="w-4 h-4 mr-2" />
            Back to Project
          </Link>
        </Button>
      </div>

      <div>
        <h1 className="text-3xl font-bold text-gray-900">Shopify Integration</h1>
        <p className="text-gray-600 mt-1">
          Connect your Shopify store to enable real e-commerce functionality
        </p>
      </div>

      {/* Status Card */}
      {connected ? (
        <Card className="border-green-200 bg-green-50">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                  <Check className="w-6 h-6 text-green-600" />
                </div>
                <div>
                  <CardTitle className="text-green-900">Shopify Connected</CardTitle>
                  <CardDescription className="text-green-700">
                    Your store is linked: {shopifyData?.domain}
                  </CardDescription>
                </div>
              </div>
              <Button variant="outline" onClick={handleDisconnect} disabled={loading}>
                Disconnect
              </Button>
            </div>
          </CardHeader>
        </Card>
      ) : (
        <Card className="border-blue-200 bg-blue-50">
          <CardHeader>
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                <ShoppingBag className="w-6 h-6 text-blue-600" />
              </div>
              <div>
                <CardTitle className="text-blue-900">Connect Your Shopify Store</CardTitle>
                <CardDescription className="text-blue-700">
                  Link your Shopify account to enable product management and checkout
                </CardDescription>
              </div>
            </div>
          </CardHeader>
        </Card>
      )}

      <div className="grid md:grid-cols-2 gap-6">
        {/* Connection Form */}
        <Card>
          <CardHeader>
            <CardTitle>Store Connection</CardTitle>
            <CardDescription>
              Enter your Shopify store credentials to enable integration
            </CardDescription>
          </CardHeader>
          <CardContent>
            <form onSubmit={handleConnect} className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="shopifyDomain">Shopify Store Domain</Label>
                <Input
                  id="shopifyDomain"
                  placeholder="your-store.myshopify.com"
                  value={formData.shopifyDomain}
                  onChange={(e) =>
                    setFormData({ ...formData, shopifyDomain: e.target.value })
                  }
                  required
                  disabled={connected}
                />
                <p className="text-xs text-muted-foreground">
                  Your Shopify store URL (e.g., mystore.myshopify.com)
                </p>
              </div>

              <div className="space-y-2">
                <Label htmlFor="accessToken">Access Token</Label>
                <Input
                  id="accessToken"
                  type="password"
                  placeholder="shpat_..."
                  value={formData.accessToken}
                  onChange={(e) =>
                    setFormData({ ...formData, accessToken: e.target.value })
                  }
                  required
                  disabled={connected}
                />
                <p className="text-xs text-muted-foreground">
                  Your Shopify Admin API access token
                </p>
              </div>

              {!connected && (
                <Button type="submit" className="w-full" disabled={loading}>
                  {loading ? "Connecting..." : "Connect Shopify"}
                </Button>
              )}
            </form>
          </CardContent>
        </Card>

        {/* Setup Instructions */}
        <Card>
          <CardHeader>
            <CardTitle>How to Get Your Credentials</CardTitle>
            <CardDescription>
              Follow these steps to connect your Shopify store
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="space-y-3">
              <div className="flex gap-3">
                <div className="w-6 h-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-bold flex-shrink-0">
                  1
                </div>
                <div className="text-sm">
                  <p className="font-semibold mb-1">Log into Shopify Admin</p>
                  <p className="text-muted-foreground">
                    Go to your Shopify admin dashboard
                  </p>
                </div>
              </div>

              <div className="flex gap-3">
                <div className="w-6 h-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-bold flex-shrink-0">
                  2
                </div>
                <div className="text-sm">
                  <p className="font-semibold mb-1">Create Custom App</p>
                  <p className="text-muted-foreground">
                    Settings ‚Üí Apps and sales channels ‚Üí Develop apps
                  </p>
                </div>
              </div>

              <div className="flex gap-3">
                <div className="w-6 h-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-bold flex-shrink-0">
                  3
                </div>
                <div className="text-sm">
                  <p className="font-semibold mb-1">Configure API Scopes</p>
                  <p className="text-muted-foreground">
                    Enable: read_products, write_products, read_orders
                  </p>
                </div>
              </div>

              <div className="flex gap-3">
                <div className="w-6 h-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-bold flex-shrink-0">
                  4
                </div>
                <div className="text-sm">
                  <p className="font-semibold mb-1">Install App & Get Token</p>
                  <p className="text-muted-foreground">
                    Install the app and copy the Admin API access token
                  </p>
                </div>
              </div>
            </div>

            <Button asChild variant="outline" className="w-full">
              <a
                href="https://help.shopify.com/en/manual/apps/app-types/custom-apps"
                target="_blank"
                rel="noopener noreferrer"
              >
                <ExternalLink className="w-4 h-4 mr-2" />
                View Shopify Documentation
              </a>
            </Button>
          </CardContent>
        </Card>
      </div>

      {/* Features */}
      <Card>
        <CardHeader>
          <CardTitle>What You Get with Shopify Integration</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid md:grid-cols-3 gap-6">
            <div className="flex gap-3">
              <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0">
                <ShoppingBag className="w-5 h-5 text-blue-600" />
              </div>
              <div>
                <h4 className="font-semibold mb-1">Product Sync</h4>
                <p className="text-sm text-muted-foreground">
                  Automatically sync products from your Shopify store
                </p>
              </div>
            </div>

            <div className="flex gap-3">
              <div className="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center flex-shrink-0">
                <Check className="w-5 h-5 text-purple-600" />
              </div>
              <div>
                <h4 className="font-semibold mb-1">Secure Checkout</h4>
                <p className="text-sm text-muted-foreground">
                  Use Shopify's secure checkout process for transactions
                </p>
              </div>
            </div>

            <div className="flex gap-3">
              <div className="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0">
                <AlertCircle className="w-5 h-5 text-green-600" />
              </div>
              <div>
                <h4 className="font-semibold mb-1">Inventory Management</h4>
                <p className="text-sm text-muted-foreground">
                  Real-time inventory updates and order management
                </p>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/builder/ssl-notice.tsx
// ==========================================


"use client";

import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";
import { Info, ExternalLink } from "lucide-react";
import { Button } from "@/components/ui/button";
import Link from "next/link";

interface SslNoticeProps {
  subdomain?: string;
  showDetails?: boolean;
}

export function SslNotice({ subdomain, showDetails = false }: SslNoticeProps) {
  return (
    <Alert className="border-blue-200 bg-blue-50">
      <Info className="h-4 w-4 text-blue-600" />
      <AlertTitle className="text-blue-900 font-semibold">
        Site Preview Available
      </AlertTitle>
      <AlertDescription className="text-blue-800">
        {subdomain ? (
          <>
            Your site is ready at <strong>{subdomain}.cdmsuite.com</strong>!
            <br />
            <span className="text-sm">
              Preview it within the dashboard below. Public SSL access coming soon.
            </span>
          </>
        ) : (
          <>
            Preview your site within the dashboard. Direct subdomain access requires SSL
            configuration.
          </>
        )}
        
        {showDetails && (
          <div className="mt-3 space-y-2">
            <p className="text-sm font-medium">Why can't I access my subdomain directly?</p>
            <p className="text-sm">
              Dynamic subdomains require wildcard SSL certificates for secure HTTPS access.
              We're working on enabling this for all users. In the meantime, you can:
            </p>
            <ul className="text-sm list-disc pl-5 space-y-1">
              <li>Preview your site in the dashboard (always works)</li>
              <li>Export your site and host it on your own domain</li>
              <li>Upgrade to Pro for custom domain support with your own SSL</li>
            </ul>
            <div className="pt-2">
              <Button asChild size="sm" variant="outline">
                <Link href="/dashboard/billing">
                  <ExternalLink className="w-4 h-4 mr-2" />
                  Learn About Custom Domains
                </Link>
              </Button>
            </div>
          </div>
        )}
      </AlertDescription>
    </Alert>
  );
}

// ==========================================
// File: components/builder/template-gallery.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Card } from "@/components/ui/card";
import { WEBSITE_TEMPLATES } from "@/lib/builder/templates";
import { Check, Sparkles } from "lucide-react";
import Image from "next/image";

interface TemplateGalleryProps {
  onSelect: (templateId: string) => void;
  selectedTemplate: string | null;
}

export function TemplateGallery({ onSelect, selectedTemplate }: TemplateGalleryProps) {
  const [hoveredTemplate, setHoveredTemplate] = useState<string | null>(null);

  return (
    <div className="space-y-8">
      <div className="text-center mb-8">
        <h2 className="text-2xl font-bold mb-2">Choose Your Template</h2>
        <p className="text-muted-foreground">
          Select a professionally designed template that matches your industry
        </p>
        <p className="text-sm text-blue-600 mt-2 font-medium">
          All templates include 5-15 pages ‚Ä¢ Fully responsive ‚Ä¢ SEO optimized
        </p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {WEBSITE_TEMPLATES.map((template) => (
          <Card
            key={template.id}
            className={`relative overflow-hidden cursor-pointer transition-all ${
              selectedTemplate === template.id
                ? "ring-4 ring-blue-600 shadow-2xl scale-105"
                : "hover:ring-2 hover:ring-blue-400 hover:shadow-xl"
            }`}
            onClick={() => onSelect(template.id)}
            onMouseEnter={() => setHoveredTemplate(template.id)}
            onMouseLeave={() => setHoveredTemplate(null)}
          >
            {/* Selection indicator */}
            {selectedTemplate === template.id && (
              <div className="absolute top-4 right-4 z-10 w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center shadow-lg">
                <Check className="w-6 h-6 text-white" />
              </div>
            )}

            {/* Template thumbnail with interactive preview */}
            <div className="relative aspect-[4/3] bg-gradient-to-br from-gray-100 to-gray-200 overflow-hidden">
              <div className="absolute inset-0 flex items-center justify-center">
                <div
                  className="w-full h-full transition-all duration-300"
                  style={{
                    background: `linear-gradient(135deg, ${template.colors.primary}${hoveredTemplate === template.id ? '44' : '22'} 0%, ${template.colors.secondary}${hoveredTemplate === template.id ? '44' : '22'} 100%)`,
                  }}
                />
                
                {/* Animated browser mockup */}
                <div className="absolute inset-0 p-6 flex items-center justify-center">
                  <div className="w-full h-full bg-white rounded-lg shadow-xl overflow-hidden">
                    {/* Browser chrome */}
                    <div className="h-6 bg-gray-200 flex items-center gap-1.5 px-3">
                      <div className="flex gap-1.5">
                        <div className="w-2 h-2 rounded-full bg-red-400" />
                        <div className="w-2 h-2 rounded-full bg-yellow-400" />
                        <div className="w-2 h-2 rounded-full bg-green-400" />
                      </div>
                    </div>
                    
                    {/* Page content mockup */}
                    <div className="p-3 space-y-2 bg-white">
                      <div 
                        className="h-8 rounded transition-all duration-300"
                        style={{ 
                          backgroundColor: hoveredTemplate === template.id ? template.colors.primary : template.colors.primary + '40',
                          width: '80%'
                        }}
                      />
                      <div className="space-y-1">
                        <div className="h-2 bg-gray-200 rounded" style={{ width: '90%' }} />
                        <div className="h-2 bg-gray-200 rounded" style={{ width: '70%' }} />
                      </div>
                      <div className="grid grid-cols-3 gap-2 mt-3">
                        {[1, 2, 3].map((i) => (
                          <div 
                            key={i} 
                            className="h-8 rounded transition-all duration-200"
                            style={{ backgroundColor: template.colors.secondary + '30' }}
                          />
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              {/* Hover overlay */}
              {hoveredTemplate === template.id && (
                <div className="absolute inset-0 bg-black/10 flex items-center justify-center">
                  <div className="bg-white/90 backdrop-blur-sm px-4 py-2 rounded-lg font-semibold text-sm">
                    Click to Select
                  </div>
                </div>
              )}
            </div>

            {/* Template details */}
            <div className="p-6">
              <div className="flex items-center justify-between mb-2">
                <h3 className="text-xl font-bold">{template.name}</h3>
                <span className="text-xs px-3 py-1 bg-blue-100 text-blue-700 rounded-full font-semibold">
                  {template.category}
                </span>
              </div>
              <p className="text-sm text-muted-foreground mb-4">
                {template.description}
              </p>

              {/* Pages included */}
              <div className="mb-4">
                <p className="text-xs font-semibold text-muted-foreground mb-2">
                  PAGES INCLUDED ({template.pages.length}):
                </p>
                <p className="text-xs text-gray-600">
                  {template.pages.join(", ")}
                </p>
              </div>

              {/* Features */}
              <div className="mb-4">
                <p className="text-xs font-semibold text-muted-foreground mb-2">
                  KEY FEATURES:
                </p>
                <div className="flex flex-wrap gap-2">
                  {template.features.slice(0, 3).map((feature, idx) => (
                    <span
                      key={idx}
                      className="text-xs px-2 py-1 bg-muted rounded-md flex items-center gap-1"
                    >
                      <Check className="w-3 h-3 text-green-600" />
                      {feature}
                    </span>
                  ))}
                </div>
              </div>

              {/* Ideal for */}
              <div className="mb-4">
                <p className="text-xs font-semibold text-muted-foreground mb-2">
                  PERFECT FOR:
                </p>
                <p className="text-xs text-gray-600">
                  {template.ideal_for.slice(0, 2).join(" ‚Ä¢ ")}
                </p>
              </div>

              {/* Color palette */}
              <div className="flex items-center gap-2">
                <p className="text-xs font-semibold text-muted-foreground">COLORS:</p>
                <div className="flex gap-1.5">
                  <div
                    className="w-6 h-6 rounded-full border-2 border-gray-200 shadow-sm"
                    style={{ backgroundColor: template.colors.primary }}
                    title="Primary"
                  />
                  <div
                    className="w-6 h-6 rounded-full border-2 border-gray-200 shadow-sm"
                    style={{ backgroundColor: template.colors.secondary }}
                    title="Secondary"
                  />
                  <div
                    className="w-6 h-6 rounded-full border-2 border-gray-200 shadow-sm"
                    style={{ backgroundColor: template.colors.accent }}
                    title="Accent"
                  />
                </div>
              </div>
            </div>
          </Card>
        ))}
      </div>

      {/* Selection CTA */}
      {selectedTemplate && (
        <div className="sticky bottom-8 left-0 right-0 flex justify-center z-20">
          <Card className="p-4 bg-blue-600 text-white shadow-2xl">
            <div className="flex items-center gap-4">
              <Check className="w-6 h-6" />
              <div>
                <p className="font-semibold">
                  Template Selected: {WEBSITE_TEMPLATES.find(t => t.id === selectedTemplate)?.name}
                </p>
                <p className="text-sm text-blue-100">
                  Click "Business Info" tab above to continue
                </p>
              </div>
            </div>
          </Card>
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/builder/visual-editor.tsx
// ==========================================


"use client";

import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { Badge } from "@/components/ui/badge";
import {
  Save,
  Eye,
  ArrowLeft,
  Plus,
  Trash2,
  Edit2,
  Image as ImageIcon,
  Type,
  Layout,
  Palette,
  X,
  Check,
  ExternalLink,
  Sparkles,
  Wand2,
  Upload
} from "lucide-react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { toast } from "sonner";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";

interface VisualEditorProps {
  project: any;
}

export function VisualEditor({ project }: VisualEditorProps) {
  const router = useRouter();
  const [saving, setSaving] = useState(false);
  const [pages, setPages] = useState<any[]>(project.pages || []);
  const [selectedPageIndex, setSelectedPageIndex] = useState(0);
  const [selectedSectionIndex, setSelectedSectionIndex] = useState<number | null>(null);
  const [editingElement, setEditingElement] = useState<{
    type: "hero" | "section" | "item";
    data: any;
  } | null>(null);
  const [siteConfig, setSiteConfig] = useState<any>(project.siteConfig || {});
  const [previewMode, setPreviewMode] = useState(false);
  const [aiRegenerating, setAiRegenerating] = useState(false);

  const selectedPage = pages[selectedPageIndex];

  const handleSave = async () => {
    setSaving(true);
    try {
      const response = await fetch(`/api/builder/update`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          projectId: project.id,
          pages,
          siteConfig,
        }),
      });

      if (!response.ok) throw new Error("Save failed");

      toast.success("Changes saved successfully!");
      router.refresh();
    } catch (error) {
      console.error("Save error:", error);
      toast.error("Failed to save changes");
    } finally {
      setSaving(false);
    }
  };

  const handlePublish = async () => {
    setSaving(true);
    try {
      const response = await fetch(`/api/builder/publish`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          projectId: project.id,
        }),
      });

      if (!response.ok) throw new Error("Publish failed");

      const data = await response.json();
      toast.success("Website published successfully!");
      
      // Open published site in new tab
      window.open(`https://${project.subdomain}.cdmsuite.com`, "_blank");
    } catch (error) {
      console.error("Publish error:", error);
      toast.error("Failed to publish website");
    } finally {
      setSaving(false);
    }
  };

  const updateHero = (field: string, value: string) => {
    const updatedPages = [...pages];
    updatedPages[selectedPageIndex].hero = {
      ...updatedPages[selectedPageIndex].hero,
      [field]: value,
    };
    setPages(updatedPages);
  };

  const updateSection = (sectionIndex: number, field: string, value: any) => {
    const updatedPages = [...pages];
    updatedPages[selectedPageIndex].sections[sectionIndex] = {
      ...updatedPages[selectedPageIndex].sections[sectionIndex],
      [field]: value,
    };
    setPages(updatedPages);
  };

  const addSection = () => {
    const updatedPages = [...pages];
    updatedPages[selectedPageIndex].sections.push({
      type: "content",
      title: "New Section",
      content: "Add your content here...",
      items: [],
    });
    setPages(updatedPages);
  };

  const deleteSection = (sectionIndex: number) => {
    const updatedPages = [...pages];
    updatedPages[selectedPageIndex].sections.splice(sectionIndex, 1);
    setPages(updatedPages);
    setSelectedSectionIndex(null);
  };

  const addPage = () => {
    const newPage = {
      slug: `page-${pages.length + 1}`,
      title: `New Page ${pages.length + 1}`,
      hero: {
        headline: "Page Headline",
        subheadline: "Page subheadline",
        cta: "Get Started",
      },
      sections: [],
    };
    setPages([...pages, newPage]);
    setSelectedPageIndex(pages.length);
  };

  const deletePage = (pageIndex: number) => {
    if (pages.length === 1) {
      toast.error("Cannot delete the last page");
      return;
    }
    const updatedPages = pages.filter((_, i) => i !== pageIndex);
    setPages(updatedPages);
    setSelectedPageIndex(Math.max(0, pageIndex - 1));
  };

  const aiRegenerateSection = async (sectionIndex: number) => {
    setAiRegenerating(true);
    try {
      const section = selectedPage.sections[sectionIndex];
      const response = await fetch("/api/builder/regenerate-section", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          projectId: project.id,
          pageSlug: selectedPage.slug,
          sectionType: section.type,
          currentContent: section,
        }),
      });

      if (!response.ok) throw new Error("Regeneration failed");

      const data = await response.json();
      updateSection(sectionIndex, "content", data.content);
      updateSection(sectionIndex, "title", data.title);
      if (data.items) {
        updateSection(sectionIndex, "items", data.items);
      }
      
      toast.success("Section regenerated with AI!");
    } catch (error) {
      console.error("AI regeneration error:", error);
      toast.error("Failed to regenerate section");
    } finally {
      setAiRegenerating(false);
    }
  };

  return (
    <div className="h-screen flex flex-col bg-gray-50">
      {/* Top Bar */}
      <div className="bg-white border-b px-4 py-3 flex items-center justify-between">
        <div className="flex items-center gap-4">
          <Button asChild variant="ghost" size="sm">
            <Link href="/dashboard/projects">
              <ArrowLeft className="w-4 h-4 mr-2" />
              Projects
            </Link>
          </Button>
          <div className="h-6 w-px bg-gray-300" />
          <div>
            <h2 className="font-semibold text-lg">{project.name}</h2>
            <p className="text-xs text-muted-foreground">
              {project.subdomain}.cdmsuite.com
            </p>
          </div>
        </div>

        <div className="flex items-center gap-2">
          <Badge variant={project.status === "active" ? "default" : "secondary"}>
            {project.status}
          </Badge>
          <Button
            variant="outline"
            size="sm"
            onClick={() => setPreviewMode(!previewMode)}
          >
            <Eye className="w-4 h-4 mr-2" />
            {previewMode ? "Edit" : "Preview"}
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={handleSave}
            disabled={saving}
          >
            <Save className="w-4 h-4 mr-2" />
            {saving ? "Saving..." : "Save"}
          </Button>
          <Button size="sm" onClick={handlePublish} disabled={saving}>
            <ExternalLink className="w-4 h-4 mr-2" />
            Publish
          </Button>
        </div>
      </div>

      {/* Main Content */}
      <div className="flex-1 flex overflow-hidden">
        {/* Sidebar - Page & Section Navigator */}
        {!previewMode && (
          <div className="w-64 bg-white border-r overflow-y-auto">
            <div className="p-4 border-b">
              <div className="flex items-center justify-between mb-2">
                <h3 className="font-semibold">Pages</h3>
                <Button size="sm" variant="ghost" onClick={addPage}>
                  <Plus className="w-4 h-4" />
                </Button>
              </div>
              <div className="space-y-1">
                {pages.map((page, index) => (
                  <div
                    key={index}
                    className={`p-2 rounded-lg cursor-pointer flex items-center justify-between group ${
                      selectedPageIndex === index
                        ? "bg-blue-50 text-blue-700"
                        : "hover:bg-gray-50"
                    }`}
                    onClick={() => {
                      setSelectedPageIndex(index);
                      setSelectedSectionIndex(null);
                    }}
                  >
                    <span className="text-sm font-medium">{page.title}</span>
                    {pages.length > 1 && (
                      <Button
                        size="sm"
                        variant="ghost"
                        className="opacity-0 group-hover:opacity-100 h-6 w-6 p-0"
                        onClick={(e) => {
                          e.stopPropagation();
                          deletePage(index);
                        }}
                      >
                        <Trash2 className="w-3 h-3" />
                      </Button>
                    )}
                  </div>
                ))}
              </div>
            </div>

            {selectedPage && (
              <div className="p-4">
                <h3 className="font-semibold mb-2">Sections</h3>
                <div className="space-y-1">
                  <div
                    className={`p-2 rounded-lg cursor-pointer text-sm ${
                      selectedSectionIndex === null
                        ? "bg-blue-50 text-blue-700"
                        : "hover:bg-gray-50"
                    }`}
                    onClick={() => setSelectedSectionIndex(null)}
                  >
                    Hero Section
                  </div>
                  {selectedPage.sections?.map((section: any, index: number) => (
                    <div
                      key={index}
                      className={`p-2 rounded-lg cursor-pointer text-sm flex items-center justify-between group ${
                        selectedSectionIndex === index
                          ? "bg-blue-50 text-blue-700"
                          : "hover:bg-gray-50"
                      }`}
                      onClick={() => setSelectedSectionIndex(index)}
                    >
                      <span>{section.title || `Section ${index + 1}`}</span>
                      <Button
                        size="sm"
                        variant="ghost"
                        className="opacity-0 group-hover:opacity-100 h-6 w-6 p-0"
                        onClick={(e) => {
                          e.stopPropagation();
                          deleteSection(index);
                        }}
                      >
                        <Trash2 className="w-3 h-3" />
                      </Button>
                    </div>
                  ))}
                  <Button
                    size="sm"
                    variant="outline"
                    className="w-full mt-2"
                    onClick={addSection}
                  >
                    <Plus className="w-4 h-4 mr-2" />
                    Add Section
                  </Button>
                </div>
              </div>
            )}
          </div>
        )}

        {/* Editor Panel */}
        <div className="flex-1 overflow-y-auto">
          {previewMode ? (
            <WebsitePreview pages={pages} siteConfig={siteConfig} />
          ) : (
            <div className="max-w-4xl mx-auto p-8">
              {selectedPage && (
                <>
                  {/* Hero Section Editor */}
                  {selectedSectionIndex === null && (
                    <Card className="p-6 mb-6">
                      <div className="flex items-center justify-between mb-4">
                        <h3 className="text-lg font-semibold flex items-center gap-2">
                          <Sparkles className="w-5 h-5" />
                          Hero Section
                        </h3>
                      </div>
                      <div className="space-y-4">
                        <div>
                          <Label>Headline</Label>
                          <Input
                            value={selectedPage.hero?.headline || ""}
                            onChange={(e) => updateHero("headline", e.target.value)}
                            className="text-lg font-bold"
                          />
                        </div>
                        <div>
                          <Label>Subheadline</Label>
                          <Textarea
                            value={selectedPage.hero?.subheadline || ""}
                            onChange={(e) => updateHero("subheadline", e.target.value)}
                            rows={3}
                          />
                        </div>
                        <div>
                          <Label>Call-to-Action Button Text</Label>
                          <Input
                            value={selectedPage.hero?.cta || ""}
                            onChange={(e) => updateHero("cta", e.target.value)}
                          />
                        </div>
                      </div>
                    </Card>
                  )}

                  {/* Section Editor */}
                  {selectedSectionIndex !== null &&
                    selectedPage.sections?.[selectedSectionIndex] && (
                      <Card className="p-6 mb-6">
                        <div className="flex items-center justify-between mb-4">
                          <h3 className="text-lg font-semibold">
                            Edit Section
                          </h3>
                          <div className="flex gap-2">
                            <Button
                              size="sm"
                              variant="outline"
                              onClick={() => aiRegenerateSection(selectedSectionIndex)}
                              disabled={aiRegenerating}
                            >
                              <Wand2 className="w-4 h-4 mr-2" />
                              {aiRegenerating ? "Regenerating..." : "AI Regenerate"}
                            </Button>
                            <Button
                              size="sm"
                              variant="destructive"
                              onClick={() => deleteSection(selectedSectionIndex)}
                            >
                              <Trash2 className="w-4 h-4" />
                            </Button>
                          </div>
                        </div>
                        <div className="space-y-4">
                          <div>
                            <Label>Section Type</Label>
                            <Select
                              value={
                                selectedPage.sections[selectedSectionIndex]
                                  .type || "content"
                              }
                              onValueChange={(value) =>
                                updateSection(selectedSectionIndex, "type", value)
                              }
                            >
                              <SelectTrigger>
                                <SelectValue />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="content">Content</SelectItem>
                                <SelectItem value="services">Services</SelectItem>
                                <SelectItem value="features">Features</SelectItem>
                                <SelectItem value="benefits">Benefits</SelectItem>
                                <SelectItem value="testimonials">
                                  Testimonials
                                </SelectItem>
                                <SelectItem value="cta">Call to Action</SelectItem>
                                <SelectItem value="about">About</SelectItem>
                                <SelectItem value="portfolio">Portfolio</SelectItem>
                                <SelectItem value="team">Team</SelectItem>
                                <SelectItem value="pricing">Pricing</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div>
                            <Label>Section Title</Label>
                            <Input
                              value={
                                selectedPage.sections[selectedSectionIndex]
                                  .title || ""
                              }
                              onChange={(e) =>
                                updateSection(
                                  selectedSectionIndex,
                                  "title",
                                  e.target.value
                                )
                              }
                            />
                          </div>
                          <div>
                            <Label>Content</Label>
                            <Textarea
                              value={
                                selectedPage.sections[selectedSectionIndex]
                                  .content || ""
                              }
                              onChange={(e) =>
                                updateSection(
                                  selectedSectionIndex,
                                  "content",
                                  e.target.value
                                )
                              }
                              rows={6}
                            />
                          </div>

                          {/* Items Editor (for lists) */}
                          {selectedPage.sections[selectedSectionIndex].items &&
                            selectedPage.sections[selectedSectionIndex].items
                              .length > 0 && (
                              <div>
                                <Label className="mb-2 block">Items</Label>
                                <div className="space-y-3">
                                  {selectedPage.sections[
                                    selectedSectionIndex
                                  ].items.map((item: any, itemIndex: number) => (
                                    <Card key={itemIndex} className="p-4 bg-gray-50">
                                      <div className="space-y-2">
                                        <Input
                                          placeholder="Item title"
                                          value={item.title || ""}
                                          onChange={(e) => {
                                            const updatedItems = [
                                              ...selectedPage.sections[
                                                selectedSectionIndex
                                              ].items,
                                            ];
                                            updatedItems[itemIndex].title =
                                              e.target.value;
                                            updateSection(
                                              selectedSectionIndex,
                                              "items",
                                              updatedItems
                                            );
                                          }}
                                        />
                                        <Textarea
                                          placeholder="Item description"
                                          value={item.description || ""}
                                          onChange={(e) => {
                                            const updatedItems = [
                                              ...selectedPage.sections[
                                                selectedSectionIndex
                                              ].items,
                                            ];
                                            updatedItems[itemIndex].description =
                                              e.target.value;
                                            updateSection(
                                              selectedSectionIndex,
                                              "items",
                                              updatedItems
                                            );
                                          }}
                                          rows={2}
                                        />
                                      </div>
                                    </Card>
                                  ))}
                                </div>
                              </div>
                            )}
                        </div>
                      </Card>
                    )}
                </>
              )}
            </div>
          )}
        </div>

        {/* Right Panel - Settings */}
        {!previewMode && (
          <div className="w-80 bg-white border-l overflow-y-auto">
            <div className="p-4">
              <Tabs defaultValue="page">
                <TabsList className="grid w-full grid-cols-2">
                  <TabsTrigger value="page">Page</TabsTrigger>
                  <TabsTrigger value="site">Site</TabsTrigger>
                </TabsList>
                
                <TabsContent value="page" className="space-y-4 mt-4">
                  {selectedPage && (
                    <>
                      <div>
                        <Label>Page Title</Label>
                        <Input
                          value={selectedPage.title || ""}
                          onChange={(e) => {
                            const updatedPages = [...pages];
                            updatedPages[selectedPageIndex].title =
                              e.target.value;
                            setPages(updatedPages);
                          }}
                        />
                      </div>
                      <div>
                        <Label>Page Slug</Label>
                        <Input
                          value={selectedPage.slug || ""}
                          onChange={(e) => {
                            const updatedPages = [...pages];
                            updatedPages[selectedPageIndex].slug = e.target.value
                              .toLowerCase()
                              .replace(/[^a-z0-9-]/g, "-");
                            setPages(updatedPages);
                          }}
                        />
                        <p className="text-xs text-muted-foreground mt-1">
                          URL: /{selectedPage.slug}
                        </p>
                      </div>
                    </>
                  )}
                </TabsContent>

                <TabsContent value="site" className="space-y-4 mt-4">
                  <div>
                    <Label>Site Name</Label>
                    <Input
                      value={siteConfig.siteName || ""}
                      onChange={(e) =>
                        setSiteConfig({ ...siteConfig, siteName: e.target.value })
                      }
                    />
                  </div>
                  <div>
                    <Label>Tagline</Label>
                    <Input
                      value={siteConfig.tagline || ""}
                      onChange={(e) =>
                        setSiteConfig({ ...siteConfig, tagline: e.target.value })
                      }
                    />
                  </div>
                  <div>
                    <Label>Contact Email</Label>
                    <Input
                      type="email"
                      value={siteConfig.contact?.email || ""}
                      onChange={(e) =>
                        setSiteConfig({
                          ...siteConfig,
                          contact: { ...siteConfig.contact, email: e.target.value },
                        })
                      }
                    />
                  </div>
                  <div>
                    <Label>Phone</Label>
                    <Input
                      value={siteConfig.contact?.phone || ""}
                      onChange={(e) =>
                        setSiteConfig({
                          ...siteConfig,
                          contact: { ...siteConfig.contact, phone: e.target.value },
                        })
                      }
                    />
                  </div>
                </TabsContent>
              </Tabs>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

function WebsitePreview({ pages, siteConfig }: any) {
  const [currentPageIndex, setCurrentPageIndex] = useState(0);
  const currentPage = pages[currentPageIndex];

  return (
    <div className="bg-white">
      {/* Preview Navigation */}
      <div className="border-b bg-gray-50 px-8 py-4">
        <div className="max-w-6xl mx-auto flex items-center justify-between">
          <h1 className="text-xl font-bold">{siteConfig.siteName}</h1>
          <nav className="flex gap-6">
            {pages.map((page: any, index: number) => (
              <button
                key={index}
                onClick={() => setCurrentPageIndex(index)}
                className={`text-sm font-medium ${
                  currentPageIndex === index
                    ? "text-blue-600"
                    : "text-gray-600 hover:text-gray-900"
                }`}
              >
                {page.title}
              </button>
            ))}
          </nav>
        </div>
      </div>

      {/* Preview Content */}
      {currentPage && (
        <div className="max-w-6xl mx-auto">
          {/* Hero */}
          <div className="py-20 px-8 text-center bg-gradient-to-br from-blue-50 to-purple-50">
            <h1 className="text-5xl font-bold mb-6">
              {currentPage.hero?.headline}
            </h1>
            <p className="text-xl text-gray-600 mb-8 max-w-3xl mx-auto">
              {currentPage.hero?.subheadline}
            </p>
            <Button size="lg">{currentPage.hero?.cta}</Button>
          </div>

          {/* Sections */}
          {currentPage.sections?.map((section: any, index: number) => (
            <div key={index} className="py-16 px-8">
              <div className="max-w-4xl mx-auto">
                <h2 className="text-3xl font-bold mb-6 text-center">
                  {section.title}
                </h2>
                <div className="prose max-w-none mb-8">
                  <p>{section.content}</p>
                </div>
                {section.items && section.items.length > 0 && (
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                    {section.items.map((item: any, itemIndex: number) => (
                      <Card key={itemIndex} className="p-6">
                        <h3 className="font-semibold text-lg mb-2">
                          {item.title}
                        </h3>
                        <p className="text-gray-600 text-sm">{item.description}</p>
                      </Card>
                    ))}
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/builder/website-renderer.tsx
// ==========================================


"use client";

import Image from "next/image";
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import {
  Mail,
  Phone,
  MapPin,
  Menu,
  X,
  ShoppingCart,
  Search,
  User,
} from "lucide-react";
import { useState } from "react";
import * as LucideIcons from "lucide-react";

interface WebsiteRendererProps {
  page: any;
  pages: any[];
  siteConfig: any;
  subdomain: string;
  navigationConfig?: any;
  globalStyles?: any;
}

export function WebsiteRenderer({
  page,
  pages,
  siteConfig,
  subdomain,
  navigationConfig,
  globalStyles,
}: WebsiteRendererProps) {
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const [formSubmitting, setFormSubmitting] = useState(false);
  const [formSuccess, setFormSuccess] = useState(false);
  
  // Use global styles if available, fallback to site config
  const colors = globalStyles?.colors || siteConfig.colors || {
    primary: "#1E3A8A",
    secondary: "#3B82F6",
    accent: "#F59E0B",
  };

  // Check if this is an ecommerce site
  const isEcommerce = pages.some((p: any) => 
    p.slug === "shop" || p.slug === "products" || p.slug === "store"
  );

  // Get icon component dynamically
  const getIcon = (iconName: string) => {
    const icons = LucideIcons as any;
    const IconComponent = icons[iconName] || icons.Circle;
    return IconComponent;
  };

  // Helper function to format slug into a navigation label as fallback
  const formatSlugToNavLabel = (slug: string): string => {
    // Map common slugs to standard nav labels
    const standardLabels: Record<string, string> = {
      'home': 'Home',
      'about': 'About',
      'about-us': 'About',
      'services': 'Services',
      'our-services': 'Services',
      'products': 'Products',
      'shop': 'Shop',
      'store': 'Store',
      'portfolio': 'Portfolio',
      'work': 'Work',
      'projects': 'Projects',
      'our-work': 'Work',
      'team': 'Team',
      'our-team': 'Team',
      'blog': 'Blog',
      'news': 'News',
      'resources': 'Resources',
      'contact': 'Contact',
      'contact-us': 'Contact',
      'get-in-touch': 'Contact',
      'pricing': 'Pricing',
      'features': 'Features',
      'testimonials': 'Reviews',
      'case-studies': 'Case Studies',
      'gallery': 'Gallery'
    };

    // Return standard label if exists
    if (standardLabels[slug]) {
      return standardLabels[slug];
    }

    // Otherwise, capitalize first letter of each word
    return slug
      .split('-')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
  };

  // Get navigation icon for a page
  const getNavigationIcon = (slug: string) => {
    if (!navigationConfig?.icons || !navigationConfig.icons[slug]) {
      return null;
    }
    return getIcon(navigationConfig.icons[slug]);
  };

  // Filter and order pages for navigation
  const getNavigationPages = () => {
    let navPages = [...pages];

    // Filter out hidden pages
    if (navigationConfig?.hiddenPages) {
      navPages = navPages.filter((p: any) => !navigationConfig.hiddenPages.includes(p.slug));
    }

    // Reorder pages if custom order is specified
    if (navigationConfig?.pageOrder) {
      navPages.sort((a: any, b: any) => {
        const aIndex = navigationConfig.pageOrder.indexOf(a.slug);
        const bIndex = navigationConfig.pageOrder.indexOf(b.slug);
        
        // If both are in custom order, use that order
        if (aIndex !== -1 && bIndex !== -1) {
          return aIndex - bIndex;
        }
        // If only one is in custom order, prioritize it
        if (aIndex !== -1) return -1;
        if (bIndex !== -1) return 1;
        // Otherwise maintain original order
        return 0;
      });
    }

    return navPages;
  };

  const navigationPages = getNavigationPages();

  // Handle contact form submission
  const handleFormSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setFormSubmitting(true);

    const formData = new FormData(e.currentTarget);
    const data = {
      name: formData.get('name') as string,
      email: formData.get('email') as string,
      phone: formData.get('phone') as string,
      company: formData.get('company') as string,
      message: formData.get('message') as string,
      subdomain,
      pageSlug: page.slug,
    };

    try {
      const response = await fetch('/api/builder/leads/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      if (response.ok) {
        setFormSuccess(true);
        (e.target as HTMLFormElement).reset();
        
        // Reset success message after 5 seconds
        setTimeout(() => setFormSuccess(false), 5000);
      } else {
        throw new Error('Submission failed');
      }
    } catch (error) {
      console.error('Form submission error:', error);
      alert('Failed to submit form. Please try again.');
    } finally {
      setFormSubmitting(false);
    }
  };

  return (
    <div className="min-h-screen bg-white">
      {/* Navigation */}
      <nav className="border-b sticky top-0 bg-white z-50 shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center h-16">
            {/* Logo */}
            <Link href={`/site/${subdomain}`} className="flex items-center">
              <h1 className="text-xl font-bold" style={{ color: colors.primary }}>
                {siteConfig.siteName}
              </h1>
            </Link>

            {/* Desktop Navigation */}
            <div className="hidden md:flex items-center space-x-8">
              {navigationPages.map((p: any) => {
                const NavIcon = getNavigationIcon(p.slug);
                return (
                  <Link
                    key={p.slug}
                    href={`/site/${subdomain}?page=${p.slug}`}
                    className={`flex items-center gap-2 text-sm font-medium transition-colors hover:text-blue-600 ${
                      p.slug === page.slug ? "text-blue-600" : "text-gray-700"
                    }`}
                  >
                    {NavIcon && <NavIcon className="w-4 h-4" />}
                    {p.customNavLabel || p.navLabel || formatSlugToNavLabel(p.slug)}
                  </Link>
                );
              })}
            </div>

            {/* Right side icons */}
            <div className="hidden md:flex items-center space-x-4">
              {isEcommerce && (
                <>
                  <Button variant="ghost" size="icon">
                    <Search className="w-5 h-5" />
                  </Button>
                  <Button variant="ghost" size="icon">
                    <User className="w-5 h-5" />
                  </Button>
                  <Button variant="ghost" size="icon" className="relative">
                    <ShoppingCart className="w-5 h-5" />
                    <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                      0
                    </span>
                  </Button>
                </>
              )}
            </div>

            {/* Mobile menu button */}
            <button
              className="md:hidden p-2"
              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
            >
              {mobileMenuOpen ? (
                <X className="w-6 h-6" />
              ) : (
                <Menu className="w-6 h-6" />
              )}
            </button>
          </div>

          {/* Mobile Navigation */}
          {mobileMenuOpen && (
            <div className="md:hidden py-4 space-y-2">
              {navigationPages.map((p: any) => {
                const NavIcon = getNavigationIcon(p.slug);
                return (
                  <Link
                    key={p.slug}
                    href={`/site/${subdomain}?page=${p.slug}`}
                    className={`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg ${
                      p.slug === page.slug
                        ? "bg-blue-50 text-blue-600"
                        : "text-gray-700 hover:bg-gray-50"
                    }`}
                    onClick={() => setMobileMenuOpen(false)}
                  >
                    {NavIcon && <NavIcon className="w-4 h-4" />}
                    {p.customNavLabel || p.navLabel || formatSlugToNavLabel(p.slug)}
                  </Link>
                );
              })}
            </div>
          )}
        </div>
      </nav>

      {/* Hero Section */}
      {page.hero && (
        <section
          className="relative py-20 px-4 overflow-hidden"
          style={{
            background: `linear-gradient(135deg, ${colors.primary}10 0%, ${colors.secondary}20 50%, ${colors.accent}10 100%)`,
          }}
        >
          {/* Decorative background elements */}
          <div className="absolute top-0 right-0 w-96 h-96 rounded-full opacity-10 blur-3xl" style={{ background: colors.primary }} />
          <div className="absolute bottom-0 left-0 w-96 h-96 rounded-full opacity-10 blur-3xl" style={{ background: colors.secondary }} />
          <div className="max-w-7xl mx-auto relative z-10">
            <div className="grid md:grid-cols-2 gap-12 items-center">
              <div className="space-y-6">
                <div 
                  className="inline-block px-4 py-2 rounded-full text-sm font-semibold mb-2"
                  style={{ 
                    backgroundColor: `${colors.primary}15`,
                    color: colors.primary
                  }}
                >
                  ‚ú® {siteConfig.tagline || "Welcome"}
                </div>
                <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold leading-tight bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent">
                  {page.hero.headline}
                </h1>
                <p className="text-lg md:text-xl text-gray-700 leading-relaxed">
                  {page.hero.subheadline}
                </p>
                <div className="flex flex-wrap gap-4 pt-4">
                  {page.hero.cta && (
                    <Button
                      size="lg"
                      style={{ backgroundColor: colors.primary }}
                      className="text-white hover:opacity-90 transition-opacity shadow-lg hover:shadow-xl px-8 py-6 text-base"
                    >
                      {page.hero.cta} ‚Üí
                    </Button>
                  )}
                  {page.hero.ctaSecondary && (
                    <Button 
                      size="lg" 
                      variant="outline"
                      className="px-8 py-6 text-base hover:bg-gray-50"
                      style={{ borderColor: colors.primary, color: colors.primary }}
                    >
                      {page.hero.ctaSecondary}
                    </Button>
                  )}
                </div>
              </div>
              {page.hero.image && (
                <div className="relative h-[400px] md:h-[500px] rounded-2xl overflow-hidden shadow-2xl group">
                  <div 
                    className="absolute inset-0 rounded-2xl"
                    style={{ 
                      background: `linear-gradient(135deg, ${colors.primary}30, ${colors.secondary}30)`,
                      opacity: 0,
                      transition: 'opacity 0.3s'
                    }}
                  />
                  <Image
                    src={page.hero.image}
                    alt={page.hero.imageDescription || "Hero image"}
                    fill
                    className="object-cover group-hover:scale-105 transition-transform duration-500"
                  />
                </div>
              )}
            </div>
          </div>
        </section>
      )}

      {/* Page Sections */}
      <div className="max-w-7xl mx-auto px-4 py-16 space-y-24">
        {page.sections?.map((section: any, idx: number) => (
          <section key={idx} className="space-y-8">
            {/* Section Header */}
            {section.title && (
              <div className="text-center max-w-3xl mx-auto space-y-4">
                <h2 className="text-3xl md:text-4xl font-bold">{section.title}</h2>
                {section.subtitle && (
                  <p className="text-lg text-gray-600">{section.subtitle}</p>
                )}
              </div>
            )}

            {/* Section Content */}
            {section.content && (
              <div
                className="prose max-w-4xl mx-auto"
                dangerouslySetInnerHTML={{ __html: section.content }}
              />
            )}

            {/* Section Items */}
            {section.items && section.items.length > 0 && (
              <div>
                {/* Services/Features Grid */}
                {(section.type === "services" ||
                  section.type === "features" ||
                  section.type === "benefits") && (
                  <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {section.items.map((item: any, itemIdx: number) => {
                      const IconComponent = getIcon(
                        item.icon || "Circle"
                      );
                      return (
                        <Card 
                          key={itemIdx} 
                          className="p-6 hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 border-t-4 group"
                          style={{ borderTopColor: colors.primary }}
                        >
                          <div
                            className="w-14 h-14 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300"
                            style={{ 
                              background: `linear-gradient(135deg, ${colors.primary}20 0%, ${colors.secondary}30 100%)` 
                            }}
                          >
                            <IconComponent
                              className="w-7 h-7"
                              style={{ color: colors.primary }}
                            />
                          </div>
                          <h3 className="text-xl font-bold mb-3" style={{ color: colors.primary }}>{item.title}</h3>
                          <p className="text-gray-600 leading-relaxed">{item.description}</p>
                          {item.image && (
                            <div className="relative h-48 mt-4 rounded-lg overflow-hidden">
                              <Image
                                src={item.image}
                                alt={item.title}
                                fill
                                className="object-cover group-hover:scale-105 transition-transform duration-300"
                              />
                            </div>
                          )}
                        </Card>
                      );
                    })}
                  </div>
                )}

                {/* Portfolio/Work Grid */}
                {(section.type === "portfolio" || section.type === "work") && (
                  <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {section.items.map((item: any, itemIdx: number) => (
                      <Card key={itemIdx} className="overflow-hidden hover:shadow-xl transition-shadow group">
                        {item.image && (
                          <div className="relative h-64 overflow-hidden">
                            <Image
                              src={item.image}
                              alt={item.title}
                              fill
                              className="object-cover group-hover:scale-110 transition-transform duration-300"
                            />
                          </div>
                        )}
                        <div className="p-6">
                          <h3 className="text-xl font-bold mb-2">{item.title}</h3>
                          <p className="text-gray-600">{item.description}</p>
                        </div>
                      </Card>
                    ))}
                  </div>
                )}

                {/* Team Grid */}
                {section.type === "team" && (
                  <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                    {section.items.map((item: any, itemIdx: number) => (
                      <Card key={itemIdx} className="text-center p-6">
                        {item.image ? (
                          <div className="relative w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden">
                            <Image
                              src={item.image}
                              alt={item.title}
                              fill
                              className="object-cover"
                            />
                          </div>
                        ) : (
                          <div className="w-32 h-32 mx-auto mb-4 rounded-full bg-gray-200 flex items-center justify-center">
                            <User className="w-16 h-16 text-gray-400" />
                          </div>
                        )}
                        <h3 className="text-lg font-bold mb-1">{item.title}</h3>
                        <p className="text-sm text-gray-600">{item.description}</p>
                      </Card>
                    ))}
                  </div>
                )}

                {/* Testimonials */}
                {section.type === "testimonials" && (
                  <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {section.items.map((item: any, itemIdx: number) => (
                      <Card key={itemIdx} className="p-6">
                        <div className="flex items-start gap-4 mb-4">
                          {item.image ? (
                            <div className="relative w-12 h-12 rounded-full overflow-hidden flex-shrink-0">
                              <Image
                                src={item.image}
                                alt={item.title}
                                fill
                                className="object-cover"
                              />
                            </div>
                          ) : (
                            <div className="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0">
                              <User className="w-6 h-6 text-gray-400" />
                            </div>
                          )}
                          <div>
                            <h4 className="font-bold">{item.title}</h4>
                            {item.subtitle && (
                              <p className="text-sm text-gray-500">{item.subtitle}</p>
                            )}
                          </div>
                        </div>
                        <p className="text-gray-600 italic">&ldquo;{item.description}&rdquo;</p>
                      </Card>
                    ))}
                  </div>
                )}

                {/* Stats */}
                {section.type === "stats" && (
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-8">
                    {section.items.map((item: any, itemIdx: number) => {
                      const IconComponent = getIcon(item.icon || "TrendingUp");
                      return (
                        <div key={itemIdx} className="text-center">
                          <IconComponent
                            className="w-8 h-8 mx-auto mb-2"
                            style={{ color: colors.primary }}
                          />
                          <div
                            className="text-3xl md:text-4xl font-bold mb-2"
                            style={{ color: colors.primary }}
                          >
                            {item.description}
                          </div>
                          <div className="text-gray-600">{item.title}</div>
                        </div>
                      );
                    })}
                  </div>
                )}

                {/* Process/Steps */}
                {section.type === "process" && (
                  <div className="space-y-6">
                    {section.items.map((item: any, itemIdx: number) => {
                      const IconComponent = getIcon(item.icon || "CheckCircle");
                      return (
                        <div key={itemIdx} className="flex gap-4">
                          <div
                            className="w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0"
                            style={{ backgroundColor: colors.primary, color: "white" }}
                          >
                            {itemIdx + 1}
                          </div>
                          <div className="flex-1">
                            <h3 className="text-xl font-bold mb-2">{item.title}</h3>
                            <p className="text-gray-600">{item.description}</p>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                )}

                {/* FAQ */}
                {section.type === "faq" && (
                  <div className="max-w-3xl mx-auto space-y-4">
                    {section.items.map((item: any, itemIdx: number) => (
                      <Card key={itemIdx} className="p-6">
                        <h3 className="text-lg font-bold mb-2">{item.title}</h3>
                        <p className="text-gray-600">{item.description}</p>
                      </Card>
                    ))}
                  </div>
                )}

                {/* Products/Ecommerce */}
                {(section.type === "products" || section.type === "shop") && (
                  <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    {section.items.map((item: any, itemIdx: number) => (
                      <Card key={itemIdx} className="overflow-hidden hover:shadow-lg transition-shadow">
                        {item.image && (
                          <div className="relative h-64 overflow-hidden">
                            <Image
                              src={item.image}
                              alt={item.title}
                              fill
                              className="object-cover group-hover:scale-110 transition-transform"
                            />
                          </div>
                        )}
                        <div className="p-4">
                          <h3 className="font-bold mb-1">{item.title}</h3>
                          <p className="text-sm text-gray-600 mb-3 line-clamp-2">
                            {item.description}
                          </p>
                          {item.price && (
                            <div className="flex items-center justify-between">
                              <span
                                className="text-xl font-bold"
                                style={{ color: colors.primary }}
                              >
                                ${item.price}
                              </span>
                              <Button
                                size="sm"
                                style={{ backgroundColor: colors.primary }}
                                className="text-white"
                              >
                                Add to Cart
                              </Button>
                            </div>
                          )}
                        </div>
                      </Card>
                    ))}
                  </div>
                )}

                {/* Pricing */}
                {section.type === "pricing" && (
                  <div className="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                    {section.items.map((item: any, itemIdx: number) => (
                      <Card
                        key={itemIdx}
                        className={`p-8 ${
                          item.popular
                            ? "border-2 shadow-xl"
                            : ""
                        }`}
                        style={
                          item.popular
                            ? { borderColor: colors.primary }
                            : undefined
                        }
                      >
                        {item.popular && (
                          <div
                            className="text-center text-sm font-bold px-3 py-1 rounded-full mb-4"
                            style={{
                              backgroundColor: `${colors.primary}20`,
                              color: colors.primary,
                            }}
                          >
                            Most Popular
                          </div>
                        )}
                        <h3 className="text-2xl font-bold mb-2">{item.title}</h3>
                        <div className="mb-4">
                          <span
                            className="text-4xl font-bold"
                            style={{ color: colors.primary }}
                          >
                            ${item.price}
                          </span>
                          {item.period && (
                            <span className="text-gray-600">/{item.period}</span>
                          )}
                        </div>
                        <p className="text-gray-600 mb-6">{item.description}</p>
                        {item.features && (
                          <ul className="space-y-3 mb-6">
                            {item.features.map((feature: any, fIdx: number) => {
                              // Handle both string and object formats
                              const featureText = typeof feature === 'string' ? feature : feature?.text || feature?.title || String(feature);
                              const featureIcon = typeof feature === 'object' ? feature?.icon : null;
                              const FeatureIcon = featureIcon ? getIcon(featureIcon) : null;
                              
                              return (
                                <li key={fIdx} className="flex items-start gap-2">
                                  {FeatureIcon ? (
                                    <FeatureIcon
                                      className="w-5 h-5 flex-shrink-0 mt-0.5"
                                      style={{ color: colors.primary }}
                                    />
                                  ) : (
                                    <svg
                                      className="w-5 h-5 flex-shrink-0 mt-0.5"
                                      style={{ color: colors.primary }}
                                      fill="none"
                                      stroke="currentColor"
                                      viewBox="0 0 24 24"
                                    >
                                      <path
                                        strokeLinecap="round"
                                        strokeLinejoin="round"
                                        strokeWidth={2}
                                        d="M5 13l4 4L19 7"
                                      />
                                    </svg>
                                  )}
                                  <span className="text-sm">{featureText}</span>
                                </li>
                              );
                            })}
                          </ul>
                        )}
                        <Button
                          className="w-full"
                          style={
                            item.popular
                              ? { backgroundColor: colors.primary, color: "white" }
                              : undefined
                          }
                          variant={item.popular ? "default" : "outline"}
                        >
                          Get Started
                        </Button>
                      </Card>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* Section Image */}
            {section.image && section.imagePlacement !== "background" && (
              <div className="relative h-96 rounded-2xl overflow-hidden shadow-lg">
                <Image
                  src={section.image}
                  alt={section.imageDescription || section.title}
                  fill
                  className="object-cover"
                />
              </div>
            )}
          </section>
        ))}

        {/* Contact Form Section (if page has contact form) */}
        {(page.slug === 'contact' || page.slug === 'contact-us') && (
          <section className="max-w-3xl mx-auto">
            <Card className="p-8">
              <div className="text-center mb-8">
                <h2 className="text-3xl font-bold mb-4">Get In Touch</h2>
                <p className="text-muted-foreground">
                  Fill out the form below and we'll get back to you as soon as possible.
                </p>
              </div>

              {formSuccess && (
                <div className="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800">
                  <p className="font-semibold">Thank you for your message!</p>
                  <p className="text-sm mt-1">We'll get back to you soon.</p>
                </div>
              )}

              <form onSubmit={handleFormSubmit} className="space-y-6">
                <div className="grid md:grid-cols-2 gap-6">
                  <div>
                    <label htmlFor="name" className="block text-sm font-medium mb-2">
                      Name *
                    </label>
                    <Input
                      id="name"
                      name="name"
                      type="text"
                      required
                      placeholder="Your name"
                      className="w-full"
                    />
                  </div>
                  <div>
                    <label htmlFor="email" className="block text-sm font-medium mb-2">
                      Email *
                    </label>
                    <Input
                      id="email"
                      name="email"
                      type="email"
                      required
                      placeholder="your@email.com"
                      className="w-full"
                    />
                  </div>
                </div>

                <div className="grid md:grid-cols-2 gap-6">
                  <div>
                    <label htmlFor="phone" className="block text-sm font-medium mb-2">
                      Phone
                    </label>
                    <Input
                      id="phone"
                      name="phone"
                      type="tel"
                      placeholder="(555) 123-4567"
                      className="w-full"
                    />
                  </div>
                  <div>
                    <label htmlFor="company" className="block text-sm font-medium mb-2">
                      Company
                    </label>
                    <Input
                      id="company"
                      name="company"
                      type="text"
                      placeholder="Company name"
                      className="w-full"
                    />
                  </div>
                </div>

                <div>
                  <label htmlFor="message" className="block text-sm font-medium mb-2">
                    Message *
                  </label>
                  <textarea
                    id="message"
                    name="message"
                    required
                    rows={6}
                    placeholder="Tell us about your project or question..."
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>

                <Button
                  type="submit"
                  disabled={formSubmitting}
                  className="w-full"
                  style={{ backgroundColor: colors.primary }}
                >
                  {formSubmitting ? "Sending..." : "Send Message"}
                </Button>
              </form>
            </Card>
          </section>
        )}
      </div>

      {/* Footer */}
      <footer className="bg-gray-900 text-white py-12 px-4 mt-24">
        <div className="max-w-7xl mx-auto">
          <div className="grid md:grid-cols-4 gap-8 mb-8">
            <div>
              <h3 className="text-xl font-bold mb-4">{siteConfig.siteName}</h3>
              <p className="text-gray-400 text-sm">{siteConfig.tagline}</p>
            </div>
            <div>
              <h4 className="font-bold mb-4">Quick Links</h4>
              <ul className="space-y-2">
                {pages.slice(0, 5).map((p: any) => (
                  <li key={p.slug}>
                    <Link
                      href={`/site/${subdomain}?page=${p.slug}`}
                      className="text-gray-400 hover:text-white text-sm transition-colors"
                    >
                      {p.title}
                    </Link>
                  </li>
                ))}
              </ul>
            </div>
            <div>
              <h4 className="font-bold mb-4">Contact</h4>
              <ul className="space-y-3 text-sm text-gray-400">
                {siteConfig.contact?.email && (
                  <li className="flex items-center gap-2">
                    <Mail className="w-4 h-4" />
                    {siteConfig.contact.email}
                  </li>
                )}
                {siteConfig.contact?.phone && (
                  <li className="flex items-center gap-2">
                    <Phone className="w-4 h-4" />
                    {siteConfig.contact.phone}
                  </li>
                )}
                {siteConfig.contact?.address && (
                  <li className="flex items-center gap-2">
                    <MapPin className="w-4 h-4" />
                    {siteConfig.contact.address}
                  </li>
                )}
              </ul>
            </div>
            <div>
              <h4 className="font-bold mb-4">Business Hours</h4>
              <p className="text-sm text-gray-400">
                {siteConfig.contact?.hours || "Monday-Friday: 9am-5pm"}
              </p>
            </div>
          </div>
          <div className="border-t border-gray-800 pt-8 text-center text-sm text-gray-400">
            <p>&copy; {new Date().getFullYear()} {siteConfig.siteName}. All rights reserved.</p>
            <p className="mt-2">
              Built with{" "}
              <a
                href="https://cdmsuite.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-blue-400 hover:underline"
              >
                CDM Suite
              </a>
            </p>
          </div>
        </div>
      </footer>

      {/* Shopify Integration Notice (if ecommerce) */}
      {isEcommerce && (
        <div className="fixed bottom-4 right-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4 shadow-lg max-w-sm">
          <p className="text-sm text-yellow-800">
            <strong>E-commerce Integration:</strong> This is a demo. To enable real shopping cart
            functionality, connect your Shopify store in the dashboard.
          </p>
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/calendly-scheduler.tsx
// ==========================================


"use client";

import { useState, useEffect } from "react";

interface CalendlySchedulerProps {
  url: string;
  onScheduleClick?: () => void;
}

export default function CalendlyScheduler({ url, onScheduleClick }: CalendlySchedulerProps) {
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    // Load Calendly script
    const script = document.createElement('script');
    script.src = 'https://assets.calendly.com/assets/external/widget.js';
    script.async = true;
    
    script.onload = () => {
      setTimeout(() => {
        setIsLoading(false);
      }, 500);
    };

    document.head.appendChild(script);

    return () => {
      // Cleanup script if component unmounts
      if (script.parentNode) {
        script.parentNode.removeChild(script);
      }
    };
  }, []);

  return (
    <div className="mt-8 min-h-[700px] relative">
      {isLoading && (
        <div className="flex justify-center items-center h-full pt-20">
          <div className="w-9 h-9 border-4 border-gray-200 border-t-primary rounded-full animate-spin"></div>
        </div>
      )}
      <div className={`${isLoading ? 'hidden' : 'block'} fade-in`}>
        <div 
          className="calendly-inline-widget" 
          data-url={url}
          style={{ minWidth: '320px', height: '700px' }}
        ></div>
      </div>
    </div>
  );
}

// ==========================================
// File: components/case-studies/case-studies-hero.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import { TrendingUp, Users, Award } from "lucide-react";

const CaseStudiesHero = () => {
  const stats = [
    {
      icon: TrendingUp,
      number: "300%",
      label: "Average ROI Increase"
    },
    {
      icon: Users,
      number: "200+",
      label: "Successful Projects"
    },
    {
      icon: Award,
      number: "98%",
      label: "Client Satisfaction"
    }
  ];

  return (
    <section className="py-32 bg-gradient-to-r from-primary to-primary/80 text-white">
      <div className="section-container">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          className="text-center mb-16"
        >
          <h1 className="text-5xl md:text-6xl font-bold mb-6">
            Success <span className="text-yellow-300">Stories</span>
          </h1>
          <p className="text-xl md:text-2xl text-primary-foreground/90 max-w-3xl mx-auto">
            Real businesses, real results. See how our smart digital marketing 
            strategies have helped companies achieve remarkable growth.
          </p>
        </motion.div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          {stats.map((stat, index) => (
            <motion.div
              key={index}
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: index * 0.2 }}
              className="text-center"
            >
              <div className="bg-white/10 p-4 rounded-full inline-block mb-4">
                <stat.icon className="h-8 w-8" />
              </div>
              <div className="text-4xl font-bold text-yellow-300 mb-2">
                {stat.number}
              </div>
              <div className="text-primary-foreground/80">
                {stat.label}
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    </section>
  );
};

export default CaseStudiesHero;

// ==========================================
// File: components/case-studies/case-studies-list.tsx
// ==========================================

"use client";

import { useState } from "react";
import { motion } from "framer-motion";
import Image from "next/image";
import Link from "next/link";
import { ArrowRight, Quote } from "lucide-react";
import { Button } from "@/components/ui/button";

interface CaseStudy {
  id: string;
  slug: string;
  title: string;
  category: string;
  client: string;
  description: string;
  challenge?: string | null;
  solution?: string | null;
  results?: any;
  testimonialQuote?: string | null;
  testimonialAuthor?: string | null;
  testimonialCompany?: string | null;
  heroImage: string;
  tags: any;
}

interface CaseStudiesListProps {
  studies: CaseStudy[];
}

const CaseStudiesList = ({ studies }: CaseStudiesListProps) => {
  const [selectedCategory, setSelectedCategory] = useState("All");

  // Get unique categories
  const categories = ["All", ...Array.from(new Set(studies.map(study => study.category)))];

  const filteredCaseStudies = selectedCategory === "All" 
    ? studies 
    : studies.filter(study => study.category === selectedCategory);

  return (
    <section className="py-20 bg-white dark:bg-gray-900">
      <div className="section-container">
        {/* Category Filter */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="flex flex-wrap gap-4 justify-center mb-16"
        >
          {categories.map((category) => (
            <Button
              key={category}
              variant={category === selectedCategory ? "default" : "outline"}
              onClick={() => setSelectedCategory(category)}
              className={`${
                category === selectedCategory 
                  ? "bg-primary text-white hover:bg-primary/90" 
                  : "border-gray-300 hover:border-primary hover:text-primary"
              }`}
            >
              {category}
            </Button>
          ))}
        </motion.div>

        {/* Case Studies Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
          {filteredCaseStudies.map((study, index) => {
            const results = Array.isArray(study.results) ? study.results : [];
            const tags = Array.isArray(study.tags) ? study.tags : [];
            
            return (
            <motion.div
              key={study.id}
              initial={{ opacity: 0, y: 30 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: index * 0.1 }}
              viewport={{ once: true }}
              className="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden card-hover group"
            >
              <div className="relative h-64 bg-gray-100 dark:bg-gray-700">
                <Image
                  src={study.heroImage.startsWith('uploads/') ? `/api/file/${encodeURIComponent(study.heroImage)}` : study.heroImage}
                  alt={study.title}
                  fill
                  className="object-cover group-hover:scale-105 transition-transform duration-300"
                />
                <div className="absolute top-4 left-4">
                  <span className="bg-primary text-white px-3 py-1 rounded-full text-sm font-semibold">
                    {study.category}
                  </span>
                </div>
              </div>
              
              <div className="p-8">
                <h3 className="text-2xl font-semibold text-gray-900 dark:text-white mb-2 group-hover:text-primary transition-colors">
                  {study.title}
                </h3>
                <p className="text-primary font-medium mb-4">{study.client}</p>
                
                <p className="text-gray-700 dark:text-gray-300 mb-4">{study.description}</p>

                {study.challenge && (
                  <div className="space-y-2 mb-4">
                    <div>
                      <h4 className="font-semibold text-gray-900 dark:text-white mb-1">Challenge:</h4>
                      <p className="text-gray-700 dark:text-gray-300 text-sm">{study.challenge}</p>
                    </div>
                  </div>
                )}

                {results && results.length > 0 && (
                  <div className="mb-4">
                    <h4 className="font-semibold text-gray-900 dark:text-white mb-2">Results:</h4>
                    <ul className="space-y-1">
                      {results.map((result: any, idx: number) => (
                        <li key={idx} className="text-sm text-gray-700 dark:text-gray-300 flex items-center gap-2">
                          <span className="text-green-500">‚úì</span>
                          {result}
                        </li>
                      ))}
                    </ul>
                  </div>
                )}

                {study.testimonialQuote && (
                  <div className="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4">
                    <Quote className="h-6 w-6 text-primary mb-2" />
                    <p className="text-sm text-gray-800 dark:text-gray-300 italic line-clamp-3">
                      "{study.testimonialQuote.substring(0, 150)}..."
                    </p>
                    <p className="text-xs text-gray-700 dark:text-gray-400 mt-2">
                      ‚Äî {study.testimonialAuthor}, {study.testimonialCompany}
                    </p>
                  </div>
                )}
                
                <div className="flex flex-wrap gap-2 mb-4">
                  {tags.map((tag: any, idx: number) => (
                    <span key={idx} className="text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded">
                      {tag}
                    </span>
                  ))}
                </div>
                
                <Link href={`/case-studies/${study.slug}`}>
                  <Button className="w-full group">
                    View Full Case Study
                    <ArrowRight className="ml-2 h-4 w-4 group-hover:translate-x-1 transition-transform" />
                  </Button>
                </Link>
              </div>
            </motion.div>
          )})}
        </div>

        {filteredCaseStudies.length === 0 && (
          <div className="text-center py-12">
            <p className="text-gray-600 dark:text-gray-400 text-lg">No case studies found in this category.</p>
          </div>
        )}

        {/* Call to Action */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="mt-20 bg-primary/5 dark:bg-primary/10 p-12 rounded-lg text-center"
        >
          <h3 className="text-3xl font-bold text-gray-900 dark:text-white mb-4">
            Ready to Write Your Success Story?
          </h3>
          <p className="text-xl text-gray-600 dark:text-gray-300 mb-8 max-w-2xl mx-auto">
            Join the businesses that have achieved remarkable growth with our 
            data-driven digital marketing strategies.
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <Link href="/contact">
              <Button size="lg" className="btn-primary">
                Start Your Success Story
              </Button>
            </Link>
            <Link href="/pricing">
              <Button size="lg" variant="outline">
                View Our Packages
              </Button>
            </Link>
          </div>
        </motion.div>
      </div>
    </section>
  );
};

export default CaseStudiesList;

// ==========================================
// File: components/case-studies/case-study-detail.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Image from "next/image";
import Link from "next/link";
import { ArrowLeft, Calendar, TrendingUp, Target, Award } from "lucide-react";
import { Button } from "@/components/ui/button";

interface CaseStudyDetailProps {
  slug: string;
}

const CaseStudyDetail = ({ slug }: CaseStudyDetailProps) => {
  // In a real app, you'd fetch the case study data based on the slug
  const caseStudy = {
    title: "Business Success Story",
    client: "Sample Client",
    industry: "Business",
    challenge: "This case study demonstrates how our data-driven digital marketing strategies help businesses achieve remarkable growth.",
    solution: "We implemented a comprehensive digital marketing strategy tailored to the client's specific needs and goals.",
    results: {
      metric1: "+250%",
      metric2: "+180%", 
      metric3: "+95%"
    },
    timeline: "6 months",
    image: "https://cdn.abacus.ai/images/970b470b-5cce-4f06-8637-65ff8c5feaa1.png"
  };

  return (
    <article className="py-20">
      <div className="section-container">
        {/* Back Button */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
          className="mb-8"
        >
          <Link href="/case-studies">
            <Button variant="ghost" className="group">
              <ArrowLeft className="mr-2 h-4 w-4 group-hover:-translate-x-1 transition-transform" />
              Back to Case Studies
            </Button>
          </Link>
        </motion.div>

        {/* Header */}
        <motion.header
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.2 }}
          className="text-center mb-12"
        >
          <div className="mb-6">
            <span className="bg-primary text-white px-4 py-2 rounded-full text-sm font-semibold">
              {caseStudy.industry}
            </span>
          </div>
          
          <h1 className="text-4xl md:text-5xl font-bold text-gray-900 mb-6 max-w-4xl mx-auto">
            {caseStudy.title}
          </h1>
          
          <p className="text-xl text-gray-600 mb-8">
            {caseStudy.client} ‚Ä¢ {caseStudy.timeline}
          </p>
        </motion.header>

        {/* Results Overview */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.4 }}
          className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12 max-w-4xl mx-auto"
        >
          <div className="text-center p-6 bg-primary/5 rounded-lg">
            <div className="text-3xl font-bold text-primary mb-2">
              {caseStudy.results.metric1}
            </div>
            <div className="text-gray-600">Growth Achieved</div>
          </div>
          <div className="text-center p-6 bg-primary/5 rounded-lg">
            <div className="text-3xl font-bold text-primary mb-2">
              {caseStudy.results.metric2}
            </div>
            <div className="text-gray-600">Revenue Increase</div>
          </div>
          <div className="text-center p-6 bg-primary/5 rounded-lg">
            <div className="text-3xl font-bold text-primary mb-2">
              {caseStudy.results.metric3}
            </div>
            <div className="text-gray-600">ROI Improvement</div>
          </div>
        </motion.div>

        {/* Featured Image */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.6 }}
          className="relative aspect-video bg-gray-100 rounded-lg overflow-hidden mb-12 max-w-4xl mx-auto"
        >
          <Image
            src={caseStudy.image}
            alt={caseStudy.title}
            fill
            className="object-cover"
          />
        </motion.div>

        {/* Content */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.8 }}
          className="max-w-4xl mx-auto"
        >
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <div>
              <h2 className="text-2xl font-semibold text-gray-900 mb-4 flex items-center">
                <Target className="mr-2 h-6 w-6 text-primary" />
                Challenge
              </h2>
              <p className="text-gray-600 leading-relaxed">
                {caseStudy.challenge}
              </p>
            </div>
            
            <div>
              <h2 className="text-2xl font-semibold text-gray-900 mb-4 flex items-center">
                <Award className="mr-2 h-6 w-6 text-primary" />
                Solution
              </h2>
              <p className="text-gray-600 leading-relaxed">
                {caseStudy.solution}
              </p>
            </div>
          </div>

          <div className="bg-primary text-white p-8 rounded-lg mt-12 text-center">
            <h3 className="text-2xl font-semibold mb-4">
              Ready for Similar Results?
            </h3>
            <p className="text-primary-foreground/90 mb-6">
              Let our team help your business achieve remarkable growth with data-driven 
              digital marketing strategies.
            </p>
            <Link href="/contact">
              <Button size="lg" className="bg-white text-primary hover:bg-gray-100">
                Start Your Success Story
              </Button>
            </Link>
          </div>
        </motion.div>

        {/* More Case Studies CTA */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 1 }}
          className="text-center mt-16"
        >
          <Link href="/case-studies">
            <Button size="lg" variant="outline">
              View More Case Studies
            </Button>
          </Link>
        </motion.div>
      </div>
    </article>
  );
};

export default CaseStudyDetail;

// ==========================================
// File: components/checkout-button.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { toast } from 'react-hot-toast';
import { ShoppingCart, Loader2 } from 'lucide-react';

interface CheckoutButtonProps {
  serviceId: string;
  serviceName?: string;
  className?: string;
  variant?: 'default' | 'outline' | 'ghost' | 'link';
  size?: 'default' | 'sm' | 'lg' | 'icon';
  fullWidth?: boolean;
}

export function CheckoutButton({
  serviceId,
  serviceName,
  className = '',
  variant = 'default',
  size = 'default',
  fullWidth = false,
}: CheckoutButtonProps) {
  const [loading, setLoading] = useState(false);

  const handleCheckout = async () => {
    setLoading(true);
    
    try {
      const response = await fetch('/api/create-checkout-session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ serviceId }),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'Failed to create checkout session');
      }

      // Redirect to Stripe Checkout
      window.location.href = data.url;
    } catch (error: any) {
      console.error('Checkout error:', error);
      toast.error(error.message || 'Failed to initiate checkout');
      setLoading(false);
    }
  };

  return (
    <Button
      onClick={handleCheckout}
      disabled={loading}
      variant={variant}
      size={size}
      className={`${fullWidth ? 'w-full' : ''} ${className}`}
    >
      {loading ? (
        <>
          <Loader2 className="w-4 h-4 mr-2 animate-spin" />
          Processing...
        </>
      ) : (
        <>
          <ShoppingCart className="w-4 h-4 mr-2" />
          Purchase {serviceName || 'Service'}
        </>
      )}
    </Button>
  );
}

// ==========================================
// File: components/client-success-stories.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Image from "next/image";
import { useState } from "react";
import { Button } from "@/components/ui/button";
import { ArrowRight, Quote, TrendingUp, Users, DollarSign } from "lucide-react";
import Link from "next/link";

const ClientSuccessStories = () => {
  const [activeStory, setActiveStory] = useState(0);

  const successStories = [
    {
      clientName: "Urban Pulse Fitness",
      industry: "Health & Fitness",
      challenge: "A local gym chain struggling with online visibility and lead generation in a competitive market.",
      solution: "Implemented a comprehensive SEO strategy, redesigned their website for better conversion, and launched targeted social media campaigns.",
      results: [
        { metric: "Website Traffic", value: "+285%", icon: TrendingUp },
        { metric: "Lead Generation", value: "+340%", icon: Users },
        { metric: "Revenue Growth", value: "+180%", icon: DollarSign },
      ],
      testimonial: "CDM Suite didn't just build us a website‚Äîthey transformed how we connect with our community. Within 6 months, we saw a dramatic increase in membership inquiries, and our online booking system is now fully automated. They truly became an extension of our team.",
      clientRole: "Sarah Martinez, Owner",
      clientImage: "https://pbs.twimg.com/profile_images/1563452336646680577/NBNCIFMD_200x200.jpg",
      timeframe: "6 months",
      color: "from-blue-500 to-cyan-500",
    },
    {
      clientName: "Precision Home Services",
      industry: "Home Services",
      challenge: "A plumbing and HVAC company with excellent service but no digital presence, losing customers to competitors with better online visibility.",
      solution: "Created a mobile-first website, optimized Google My Business, launched local SEO campaigns, and implemented automated lead follow-up systems.",
      results: [
        { metric: "Local Search Rankings", value: "Top 3", icon: TrendingUp },
        { metric: "Monthly Leads", value: "+420%", icon: Users },
        { metric: "Cost Per Lead", value: "-65%", icon: DollarSign },
      ],
      testimonial: "Before CDM Suite, we relied entirely on word-of-mouth. Now, we're booked solid three weeks out. The best part? The phone rings automatically with qualified leads who already want to hire us. It's like having a 24/7 sales team.",
      clientRole: "Marcus Thompson, Founder",
      clientImage: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Nicholas_Marcus_Thompson.jpg/1200px-Nicholas_Marcus_Thompson.jpg",
      timeframe: "4 months",
      color: "from-orange-500 to-red-500",
    },
    {
      clientName: "Elevate Digital Boutique",
      industry: "E-commerce Fashion",
      challenge: "An online fashion boutique with great products but struggling with cart abandonment and low conversion rates.",
      solution: "Redesigned the entire user experience, implemented strategic A/B testing, created automated email sequences, and optimized the checkout process.",
      results: [
        { metric: "Conversion Rate", value: "+215%", icon: TrendingUp },
        { metric: "Cart Abandonment", value: "-58%", icon: Users },
        { metric: "Average Order Value", value: "+92%", icon: DollarSign },
      ],
      testimonial: "We were ready to shut down the store before working with CDM Suite. They analyzed every step of our customer journey and made data-driven changes that completely turned things around. Now we're profitable and scaling fast.",
      clientRole: "Jasmine Chen, Founder & Creative Director",
      clientImage: "https://miro.medium.com/v2/resize:fit:2000/1*Qd1PYvJHkpFUyGOnVh0wkQ.jpeg",
      timeframe: "5 months",
      color: "from-purple-500 to-pink-500",
    },
  ];

  const story = successStories[activeStory];

  return (
    <section className="py-24 bg-gradient-to-br from-gray-50 via-white to-gray-50 relative overflow-hidden">
      {/* Decorative background */}
      <div className="absolute inset-0 opacity-5">
        <div className="absolute top-0 left-1/4 w-96 h-96 bg-primary rounded-full filter blur-3xl"></div>
        <div className="absolute bottom-0 right-1/4 w-96 h-96 bg-secondary rounded-full filter blur-3xl"></div>
      </div>

      <div className="section-container relative z-10">
        {/* Section Header */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mb-16"
        >
          <div className="inline-block bg-gradient-to-r from-primary/10 to-secondary/10 rounded-full px-6 py-2 mb-6">
            <span className="text-primary font-semibold">üí™ Real Results, Real Stories</span>
          </div>
          <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
            Success Stories From Businesses Like Yours
          </h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            Don't just take our word for it‚Äîsee how we've helped real businesses achieve 
            measurable growth and transform their digital presence.
          </p>
        </motion.div>

        {/* Story Navigation */}
        <div className="flex flex-wrap justify-center gap-4 mb-12">
          {successStories.map((s, index) => (
            <button
              key={index}
              onClick={() => setActiveStory(index)}
              className={`px-6 py-3 rounded-full font-semibold transition-all duration-300 ${
                activeStory === index
                  ? "bg-gradient-to-r from-primary to-secondary text-white shadow-lg scale-105"
                  : "bg-white text-gray-600 hover:bg-gray-100 shadow"
              }`}
            >
              {s.clientName}
            </button>
          ))}
        </div>

        {/* Active Story Card */}
        <motion.div
          key={activeStory}
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className="bg-white rounded-2xl shadow-2xl overflow-hidden"
        >
          <div className={`bg-gradient-to-r ${story.color} p-8 text-white`}>
            <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
              <div>
                <h3 className="text-3xl font-bold mb-2">{story.clientName}</h3>
                <p className="text-white/90 text-lg">{story.industry} ‚Ä¢ {story.timeframe} project</p>
              </div>
              <div className="flex items-center gap-4">
                <div className="relative w-16 h-16 rounded-full overflow-hidden border-4 border-white shadow-lg">
                  <Image
                    src={story.clientImage}
                    alt={story.clientRole}
                    fill
                    className="object-cover"
                  />
                </div>
              </div>
            </div>
          </div>

          <div className="p-8 md:p-12">
            {/* The Challenge */}
            <div className="mb-8">
              <h4 className="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                <span className="text-2xl">‚ö†Ô∏è</span> The Challenge
              </h4>
              <p className="text-gray-700 leading-relaxed">{story.challenge}</p>
            </div>

            {/* Our Solution */}
            <div className="mb-8">
              <h4 className="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                <span className="text-2xl">üí°</span> Our Solution
              </h4>
              <p className="text-gray-700 leading-relaxed">{story.solution}</p>
            </div>

            {/* Results Grid */}
            <div className="mb-8">
              <h4 className="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <span className="text-2xl">üéØ</span> The Results
              </h4>
              <div className="grid md:grid-cols-3 gap-6">
                {story.results.map((result, index) => (
                  <motion.div
                    key={index}
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ delay: index * 0.1 }}
                    className={`bg-gradient-to-br ${story.color} p-6 rounded-xl text-white shadow-lg`}
                  >
                    <result.icon className="h-8 w-8 mb-3 opacity-90" />
                    <p className="text-sm font-medium opacity-90 mb-1">{result.metric}</p>
                    <p className="text-3xl font-bold">{result.value}</p>
                  </motion.div>
                ))}
              </div>
            </div>

            {/* Testimonial */}
            <div className="bg-gradient-to-br from-gray-50 to-gray-100 p-8 rounded-xl relative">
              <Quote className="absolute top-4 left-4 h-12 w-12 text-gray-300" />
              <div className="relative z-10 pl-8">
                <p className="text-lg text-gray-800 leading-relaxed mb-4 italic">
                  "{story.testimonial}"
                </p>
                <p className="font-semibold text-gray-900">{story.clientRole}</p>
              </div>
            </div>
          </div>
        </motion.div>

        {/* CTA */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mt-16"
        >
          <h3 className="text-2xl font-bold text-gray-900 mb-4">
            Ready to Write Your Success Story?
          </h3>
          <p className="text-gray-600 mb-8 max-w-2xl mx-auto">
            Let's discuss how we can help your business achieve similar results with a 
            customized digital marketing strategy.
          </p>
          <Link href="/contact">
            <Button size="lg" className="bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold shadow-xl hover:shadow-2xl transition-all group px-10 py-6 text-lg btn-breathe btn-glow">
              Schedule Your Free Strategy Call
              <ArrowRight className="ml-2 h-5 w-5 group-hover:translate-x-1 transition-transform" />
            </Button>
          </Link>
        </motion.div>
      </div>
    </section>
  );
};

export default ClientSuccessStories;

// ==========================================
// File: components/contact/contact-form.tsx
// ==========================================



"use client";

import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { useToast } from "@/hooks/use-toast";
import { Loader2, Send, CheckCircle, Calendar } from "lucide-react";
import Script from "next/script";
import { trackRedditLead } from "@/lib/reddit-tracking";
import { trackConversion } from "@/lib/analytics";

interface FormData {
  name: string;
  email: string;
  phone: string;
  company: string;
  message: string;
  formType: string;
  // Honeypot field - should remain empty
  website: string;
}

const ContactForm = () => {
  const [formData, setFormData] = useState<FormData>({
    name: "",
    email: "",
    phone: "",
    company: "",
    message: "",
    formType: "get-started",
    website: "" // Honeypot
  });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [isSubmitted, setIsSubmitted] = useState(false);
  const [formMountTime] = useState(Date.now()); // Track when form loads
  const { toast } = useToast();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSubmitting(true);

    // Anti-spam checks (client-side)
    const submissionTime = Date.now();
    const timeTaken = (submissionTime - formMountTime) / 1000; // in seconds
    
    // Check 1: Honeypot field should be empty
    if (formData.website) {
      console.warn('Spam detected: honeypot field filled');
      setIsSubmitting(false);
      return; // Silently reject
    }
    
    // Check 2: Form filled too quickly (< 3 seconds is suspicious)
    if (timeTaken < 3) {
      console.warn('Spam detected: form submitted too quickly');
      toast({
        title: "Please take a moment",
        description: "Please review your message before submitting.",
        variant: "destructive",
      });
      setIsSubmitting(false);
      return;
    }

    try {
      const response = await fetch("/api/contact", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          ...formData,
          _submitTime: timeTaken // Send time taken for backend validation
        }),
      });

      if (response.ok) {
        setIsSubmitted(true);
        
        // Track lead conversion - dual tracking (client-side + server-side)
        trackRedditLead(formData.email);
        trackConversion('contact_form_submission', undefined, 'USD', {
          email: formData.email,
          formType: formData.formType,
          company: formData.company,
        });
        
        toast({
          title: "Message sent successfully!",
          description: "We'll get back to you within 24 hours.",
        });
        // Reset form
        setFormData({
          name: "",
          email: "",
          phone: "",
          company: "",
          message: "",
          formType: "get-started",
          website: "" // Reset honeypot
        });
      } else {
        throw new Error("Failed to send message");
      }
    } catch (error) {
      console.error("Error:", error);
      toast({
        title: "Error sending message",
        description: "Please try again or contact us directly.",
        variant: "destructive",
      });
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    setFormData(prev => ({
      ...prev,
      [e.target.name]: e.target.value
    }));
  };

  if (isSubmitted) {
    return (
      <section className="py-20 bg-white">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, scale: 0.8 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: 0.6 }}
            className="max-w-2xl mx-auto text-center"
          >
            <div className="bg-green-100 p-8 rounded-lg">
              <CheckCircle className="h-16 w-16 text-green-600 mx-auto mb-6" />
              <h2 className="text-3xl font-bold text-gray-900 mb-4">
                Thank You!
              </h2>
              <p className="text-lg text-gray-600 mb-6">
                Your message has been sent successfully. Our team will review your inquiry 
                and get back to you within 24 hours with a customized strategy proposal.
              </p>
              <Button
                onClick={() => setIsSubmitted(false)}
                variant="outline"
                className="mr-4"
              >
                Send Another Message
              </Button>
              <Button asChild>
                <a href="/">Back to Home</a>
              </Button>
            </div>
          </motion.div>
        </div>
      </section>
    );
  }

  return (
    <section className="py-20 bg-white">
      <div className="section-container">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
          {/* Contact Form */}
          <motion.div
            initial={{ opacity: 0, x: -30 }}
            whileInView={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
          >
            <h2 className="text-3xl font-bold text-gray-900 mb-8">
              Get Your Free Consultation
            </h2>
            
            <form onSubmit={handleSubmit} className="space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <Label htmlFor="name">Full Name *</Label>
                  <Input
                    id="name"
                    name="name"
                    type="text"
                    value={formData.name}
                    onChange={handleChange}
                    required
                    className="mt-2"
                    placeholder="Your full name"
                  />
                </div>
                <div>
                  <Label htmlFor="email">Email Address *</Label>
                  <Input
                    id="email"
                    name="email"
                    type="email"
                    value={formData.email}
                    onChange={handleChange}
                    required
                    className="mt-2"
                    placeholder="your@email.com"
                  />
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <Label htmlFor="phone">Phone Number</Label>
                  <Input
                    id="phone"
                    name="phone"
                    type="tel"
                    value={formData.phone}
                    onChange={handleChange}
                    className="mt-2"
                    placeholder="(555) 123-4567"
                  />
                </div>
                <div>
                  <Label htmlFor="company">Company Name</Label>
                  <Input
                    id="company"
                    name="company"
                    type="text"
                    value={formData.company}
                    onChange={handleChange}
                    className="mt-2"
                    placeholder="Your company name"
                  />
                </div>
              </div>

              <div>
                <Label htmlFor="message">Tell Us About Your Project *</Label>
                <Textarea
                  id="message"
                  name="message"
                  value={formData.message}
                  onChange={handleChange}
                  required
                  className="mt-2 min-h-[120px]"
                  placeholder="Describe your goals, challenges, and how we can help grow your business..."
                />
              </div>

              {/* Honeypot field - hidden from humans, visible to bots */}
              <div className="absolute opacity-0 pointer-events-none" style={{ position: 'absolute', left: '-9999px' }} aria-hidden="true">
                <Label htmlFor="website">Website (leave blank)</Label>
                <Input
                  id="website"
                  name="website"
                  type="text"
                  value={formData.website}
                  onChange={handleChange}
                  tabIndex={-1}
                  autoComplete="off"
                  placeholder="https://yourwebsite.com"
                />
              </div>

              <Button
                type="submit"
                disabled={isSubmitting}
                className="w-full btn-primary group"
                size="lg"
              >
                {isSubmitting ? (
                  <>
                    <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                    Sending Message...
                  </>
                ) : (
                  <>
                    Send Message
                    <Send className="ml-2 h-5 w-5 group-hover:translate-x-1 transition-transform" />
                  </>
                )}
              </Button>

              <p className="text-sm text-gray-500 text-center">
                * Required fields. We respect your privacy and never share your information.
              </p>
            </form>
          </motion.div>

          {/* Contact Information */}
          <motion.div
            initial={{ opacity: 0, x: 30 }}
            whileInView={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8, delay: 0.2 }}
            viewport={{ once: true }}
            className="space-y-8"
          >
            <div className="bg-gray-50 p-8 rounded-lg">
              <h3 className="text-2xl font-semibold text-gray-900 mb-6">
                What Happens Next?
              </h3>
              
              <div className="space-y-6">
                <div className="flex items-start">
                  <div className="bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-4 mt-1">
                    1
                  </div>
                  <div>
                    <h4 className="font-semibold text-gray-900">Initial Review</h4>
                    <p className="text-gray-600 mt-1">
                      We'll review your submission and research your business and industry.
                    </p>
                  </div>
                </div>
                
                <div className="flex items-start">
                  <div className="bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-4 mt-1">
                    2
                  </div>
                  <div>
                    <h4 className="font-semibold text-gray-900">Strategy Call</h4>
                    <p className="text-gray-600 mt-1">
                      We'll schedule a consultation call to discuss your goals and challenges.
                    </p>
                  </div>
                </div>
                
                <div className="flex items-start">
                  <div className="bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-4 mt-1">
                    3
                  </div>
                  <div>
                    <h4 className="font-semibold text-gray-900">Custom Proposal</h4>
                    <p className="text-gray-600 mt-1">
                      You'll receive a tailored strategy and proposal within 48 hours.
                    </p>
                  </div>
                </div>
              </div>

              <div className="mt-8 p-6 bg-primary/10 rounded-lg">
                <h4 className="font-semibold text-gray-900 mb-2">
                  üöÄ Ready to get started immediately?
                </h4>
                <p className="text-gray-600 text-sm">
                  Most clients see initial results within 30 days of starting. 
                  Our average client achieves 150-300% ROI within 6-12 months.
                </p>
              </div>
            </div>

            {/* Calendly Booking Widget */}
            <div className="bg-gradient-to-br from-blue-50 to-purple-50 p-8 rounded-lg border-2 border-primary/20">
              <div className="flex items-center gap-3 mb-4">
                <Calendar className="w-6 h-6 text-primary" />
                <h3 className="text-2xl font-semibold text-gray-900">
                  Book a Strategy Session
                </h3>
              </div>
              <p className="text-gray-600 mb-6">
                Want to talk right now? Book a 30-minute digital marketing power session with our team.
              </p>
              <div 
                className="calendly-inline-widget" 
                data-url="https://calendly.com/cdm-creativemedia/digital-marketing-power-session?hide_event_type_details=1&hide_gdpr_banner=1" 
                style={{minWidth: '320px', height: '700px'}}
              ></div>
              <Script
                src="https://assets.calendly.com/assets/external/widget.js"
                strategy="lazyOnload"
              />
            </div>
          </motion.div>
        </div>
      </div>
    </section>
  );
};

export default ContactForm;

// ==========================================
// File: components/contact/contact-hero.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import { MessageCircle, Calendar, Phone } from "lucide-react";

const ContactHero = () => {
  const benefits = [
    {
      icon: MessageCircle,
      title: "Free Consultation",
      description: "Get expert advice tailored to your business needs"
    },
    {
      icon: Calendar,
      title: "Quick Response",
      description: "We'll get back to you within 24 hours"
    },
    {
      icon: Phone,
      title: "No Obligation",
      description: "No pressure, just honest recommendations"
    }
  ];

  return (
    <section className="py-32 bg-gradient-to-r from-primary to-primary/80 text-white">
      <div className="section-container">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          className="text-center mb-16"
        >
          <h1 className="text-5xl md:text-6xl font-bold mb-6">
            Let's <span className="text-yellow-300">Get Started</span>
          </h1>
          <p className="text-xl md:text-2xl text-primary-foreground/90 max-w-3xl mx-auto">
            Ready to grow your business with smart digital marketing? 
            Get your free consultation and custom strategy today.
          </p>
        </motion.div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          {benefits.map((benefit, index) => (
            <motion.div
              key={index}
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: index * 0.2 }}
              className="text-center"
            >
              <div className="bg-white/10 p-4 rounded-full inline-block mb-4">
                <benefit.icon className="h-8 w-8" />
              </div>
              <h3 className="text-xl font-semibold mb-2">{benefit.title}</h3>
              <p className="text-primary-foreground/80">{benefit.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    </section>
  );
};

export default ContactHero;

// ==========================================
// File: components/contact/contact-info.tsx
// ==========================================



"use client";

import { motion } from "framer-motion";
import { MapPin, Phone, Mail, Clock } from "lucide-react";

const ContactInfo = () => {
  return (
    <section className="py-20 bg-gray-50">
      <div className="section-container">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mb-16"
        >
          <h2 className="text-4xl font-bold text-gray-900 mb-6">
            Get In Touch
          </h2>
          <p className="text-xl text-gray-600 max-w-2xl mx-auto">
            Have questions? We're here to help. Reach out to us using any of the methods below.
          </p>
        </motion.div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6 }}
            viewport={{ once: true }}
            className="bg-white p-8 rounded-lg shadow-lg text-center card-hover"
          >
            <div className="bg-primary/10 p-4 rounded-full inline-block mb-6">
              <MapPin className="h-8 w-8 text-primary" />
            </div>
            <h3 className="text-xl font-semibold text-gray-900 mb-4">
              Our Locations
            </h3>
            <div className="space-y-2 text-gray-600">
              <p className="font-medium">USA</p>
              <p className="font-medium">Central America</p>
            </div>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.1 }}
            viewport={{ once: true }}
            className="bg-white p-8 rounded-lg shadow-lg text-center card-hover"
          >
            <div className="bg-primary/10 p-4 rounded-full inline-block mb-6">
              <Phone className="h-8 w-8 text-primary" />
            </div>
            <h3 className="text-xl font-semibold text-gray-900 mb-4">
              Call Us Now
            </h3>
            <div className="space-y-2">
              <a 
                href="tel:8622727623" 
                className="block text-2xl font-bold text-primary hover:text-primary/80 transition-colors"
              >
                (862) 272-7623
              </a>
              <p className="text-gray-600">Available 24/7</p>
            </div>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.2 }}
            viewport={{ once: true }}
            className="bg-white p-8 rounded-lg shadow-lg text-center card-hover"
          >
            <div className="bg-primary/10 p-4 rounded-full inline-block mb-6">
              <Mail className="h-8 w-8 text-primary" />
            </div>
            <h3 className="text-xl font-semibold text-gray-900 mb-4">
              Email Us
            </h3>
            <div className="space-y-2 text-gray-600">
              <p>Quick Response</p>
              <p>Within 24 hours</p>
            </div>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.3 }}
            viewport={{ once: true }}
            className="bg-white p-8 rounded-lg shadow-lg text-center card-hover"
          >
            <div className="bg-primary/10 p-4 rounded-full inline-block mb-6">
              <Clock className="h-8 w-8 text-primary" />
            </div>
            <h3 className="text-xl font-semibold text-gray-900 mb-4">
              Business Hours
            </h3>
            <div className="space-y-2 text-gray-600">
              <p>Mon-Fri: 9AM-6PM EST</p>
              <p>24/7 Support Available</p>
            </div>
          </motion.div>
        </div>

        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mt-16 p-8 bg-white rounded-lg shadow-lg"
        >
          <h3 className="text-2xl font-semibold text-gray-900 mb-4">
            Prefer to Email Directly?
          </h3>
          <p className="text-gray-600 mb-6">
            You can also reach out to us directly via email with any questions or to schedule a consultation.
          </p>
          <a
            href="mailto:hello@cdmsuite.com?subject=New Business Inquiry&body=Hi CDM Suite team,%0A%0AI'm interested in learning more about your digital marketing services.%0A%0ABusiness: [Your Business Name]%0AWebsite: [Your Website URL]%0AGoals: [Brief description of your marketing goals]%0A%0APlease contact me to schedule a consultation.%0A%0AThank you!"
            className="inline-block bg-primary text-white px-8 py-3 rounded-md font-semibold hover:bg-primary/90 transition-colors"
          >
            Email Us Directly
          </a>
        </motion.div>
      </div>
    </section>
  );
};

export default ContactInfo;

// ==========================================
// File: components/crm/activity-timeline.tsx
// ==========================================


'use client';

import { LeadActivity } from '@/lib/crm-types';
import { formatDistanceToNow } from 'date-fns';
import { 
  Mail, 
  Phone, 
  FileText, 
  Users, 
  AlertCircle,
  MessageSquare,
  CheckCircle2,
  TrendingUp,
  Target
} from 'lucide-react';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { Badge } from '@/components/ui/badge';
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip';
import { cn, formatDetailedTimestamp } from '@/lib/utils';

interface ActivityTimelineProps {
  activities: LeadActivity[];
}

const activityIcons = {
  note: FileText,
  email: Mail,
  call: Phone,
  meeting: Users,
  status_change: AlertCircle,
  assignment: Users,
};

const activityColors = {
  note: 'bg-blue-100 text-blue-700',
  email: 'bg-green-100 text-green-700',
  call: 'bg-purple-100 text-purple-700',
  meeting: 'bg-yellow-100 text-yellow-700',
  status_change: 'bg-orange-100 text-orange-700',
  assignment: 'bg-pink-100 text-pink-700',
};

// Parse metadata if available
function parseMetadata(metadataStr: string | null | undefined): any {
  if (!metadataStr) return null;
  try {
    return JSON.parse(metadataStr);
  } catch {
    return null;
  }
}

export function ActivityTimeline({ activities }: ActivityTimelineProps) {
  if (activities.length === 0) {
    return (
      <div className="text-center py-8">
        <MessageSquare className="h-12 w-12 text-gray-300 mx-auto mb-3" />
        <p className="text-sm text-gray-500">No activities yet</p>
        <p className="text-xs text-gray-400 mt-1">
          Activities will appear here when you interact with this lead
        </p>
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {activities.map((activity, index) => {
        const Icon = activityIcons[activity.type as keyof typeof activityIcons] || FileText;
        const colorClass = activityColors[activity.type as keyof typeof activityColors] || 'bg-gray-100 text-gray-700';
        const metadata = parseMetadata(activity.metadata);

        return (
          <div key={activity.id} className="relative">
            {/* Connecting Line */}
            {index < activities.length - 1 && (
              <div className="absolute left-5 top-10 bottom-0 w-px bg-gray-200" />
            )}

            {/* Activity Item */}
            <div className="flex gap-3">
              {/* Icon */}
              <div className={cn("flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center", colorClass)}>
                <Icon className="h-5 w-5" />
              </div>

              {/* Content */}
              <div className="flex-1 min-w-0">
                <div className="flex items-start justify-between gap-2">
                  <div className="flex-1">
                    <div className="flex items-center gap-2">
                      <p className="font-medium text-sm">{activity.title}</p>
                      {metadata?.score && (
                        <Badge 
                          variant="secondary" 
                          className={cn(
                            "text-xs",
                            metadata.score >= 80 ? "bg-red-100 text-red-700" : 
                            metadata.score >= 60 ? "bg-orange-100 text-orange-700" : 
                            "bg-blue-100 text-blue-700"
                          )}
                        >
                          Score: {metadata.score}/100
                        </Badge>
                      )}
                      {metadata?.emailSent && (
                        <Badge variant="outline" className="text-xs bg-green-50 text-green-700 border-green-200">
                          <Mail className="h-3 w-3 mr-1" />
                          Email Sent
                        </Badge>
                      )}
                    </div>
                    
                    {/* Description - Preserve line breaks */}
                    {activity.description && (
                      <div className="text-sm text-gray-600 mt-2 whitespace-pre-line">
                        {activity.description}
                      </div>
                    )}

                    {/* Follow-up Actions */}
                    {metadata?.followUpActions && metadata.followUpActions.length > 0 && (
                      <div className="mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                        <div className="flex items-center gap-2 mb-2">
                          <Target className="h-4 w-4 text-amber-700" />
                          <p className="font-medium text-sm text-amber-900">Recommended Follow-Up Actions</p>
                        </div>
                        <ul className="space-y-1 text-xs text-amber-800">
                          {metadata.followUpActions.map((action: string, idx: number) => (
                            <li key={idx} className="flex items-start gap-2">
                              <span className="text-amber-600 mt-0.5">‚Ä¢</span>
                              <span>{action}</span>
                            </li>
                          ))}
                        </ul>
                      </div>
                    )}

                    {/* Email Details */}
                    {metadata?.emailSent && (
                      <div className="mt-3 p-3 bg-green-50 border border-green-200 rounded-lg">
                        <div className="flex items-center gap-2 mb-1">
                          <Mail className="h-4 w-4 text-green-700" />
                          <p className="font-medium text-sm text-green-900">Automated Emails Sent</p>
                        </div>
                        <div className="text-xs text-green-800 space-y-1">
                          <div className="flex items-center gap-1">
                            <CheckCircle2 className="h-3 w-3" />
                            <span>Thank you email sent to lead</span>
                          </div>
                          <div className="flex items-center gap-1">
                            <CheckCircle2 className="h-3 w-3" />
                            <span>Internal notification sent to team</span>
                          </div>
                          <div className="flex items-center gap-1">
                            <TrendingUp className="h-3 w-3" />
                            <span>Follow-up sequence auto-generated (pending approval)</span>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Need Level Badge */}
                    {metadata?.needLevel && (
                      <div className="mt-2">
                        <Badge 
                          className={cn(
                            "text-xs",
                            metadata.needLevel === 'critical' ? "bg-red-100 text-red-700" :
                            metadata.needLevel === 'high' ? "bg-orange-100 text-orange-700" :
                            metadata.needLevel === 'moderate' ? "bg-yellow-100 text-yellow-700" :
                            "bg-blue-100 text-blue-700"
                          )}
                        >
                          Need Level: {metadata.needLevel.toUpperCase()}
                        </Badge>
                      </div>
                    )}
                  </div>
                  <TooltipProvider>
                    <Tooltip>
                      <TooltipTrigger asChild>
                        <span className="text-xs text-gray-500 whitespace-nowrap cursor-help">
                          {formatDetailedTimestamp(activity.createdAt, { showTime: true }).relative}
                        </span>
                      </TooltipTrigger>
                      <TooltipContent>
                        <p className="text-xs">{formatDetailedTimestamp(activity.createdAt, { showTime: true }).full}</p>
                      </TooltipContent>
                    </Tooltip>
                  </TooltipProvider>
                </div>

                {/* Created By */}
                {activity.createdBy && (
                  <div className="flex items-center gap-2 mt-2">
                    <Avatar className="h-5 w-5">
                      <AvatarFallback className="bg-gray-200 text-gray-700 text-[10px]">
                        {activity.createdBy.user.name?.[0]?.toUpperCase() || 'U'}
                      </AvatarFallback>
                    </Avatar>
                    <span className="text-xs text-gray-500">
                      {activity.createdBy.user.name || activity.createdBy.user.email}
                    </span>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      })}
    </div>
  );
}

// ==========================================
// File: components/crm/bulk-import-dialog.tsx
// ==========================================


'use client';

import { useState, useRef } from 'react';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Checkbox } from '@/components/ui/checkbox';
import { Upload, CheckCircle2, XCircle, AlertCircle, FileSpreadsheet, X } from 'lucide-react';
import { toast } from 'sonner';

interface BulkImportDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onImportComplete: () => void;
}

export function BulkImportDialog({ open, onOpenChange, onImportComplete }: BulkImportDialogProps) {
  const [bulkData, setBulkData] = useState('');
  const [generateProposals, setGenerateProposals] = useState(true);
  const [importing, setImporting] = useState(false);
  const [results, setResults] = useState<any>(null);
  const [uploadedFile, setUploadedFile] = useState<File | null>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;

    const validTypes = [
      'text/csv',
      'application/vnd.ms-excel',
      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
    ];

    if (!validTypes.includes(file.type) && !file.name.endsWith('.csv') && !file.name.endsWith('.xlsx')) {
      toast.error('Please upload a CSV or Excel file');
      return;
    }

    setUploadedFile(file);

    try {
      const text = await file.text();
      
      // Parse CSV/Excel data
      let parsedData = '';
      const lines = text.split('\n');
      
      // Skip header row if it exists
      const startIndex = lines[0]?.toLowerCase().includes('name') || 
                         lines[0]?.toLowerCase().includes('email') ? 1 : 0;
      
      for (let i = startIndex; i < lines.length; i++) {
        const line = lines[i].trim();
        if (line) {
          parsedData += line + '\n';
        }
      }

      setBulkData(parsedData);
      toast.success(`File uploaded: ${file.name}`);
    } catch (error) {
      console.error('Error reading file:', error);
      toast.error('Failed to read file');
      setUploadedFile(null);
    }
  };

  const handleRemoveFile = () => {
    setUploadedFile(null);
    setBulkData('');
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  const handleImport = async () => {
    if (!bulkData.trim()) {
      toast.error('Please enter some data to import or upload a file');
      return;
    }

    setImporting(true);
    setResults(null);

    try {
      const res = await fetch('/api/crm/leads/bulk-import', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          data: bulkData,
          generateProposals,
        }),
      });

      const data = await res.json();

      if (res.ok) {
        setResults(data);
        toast.success(
          `Successfully imported ${data.leadsCreated} lead(s)${
            data.proposalsCreated > 0 ? ` and created ${data.proposalsCreated} proposal(s)` : ''
          }`
        );
        onImportComplete();
      } else {
        toast.error(data.error || 'Failed to import leads');
      }
    } catch (error) {
      console.error('Import error:', error);
      toast.error('An error occurred during import');
    } finally {
      setImporting(false);
    }
  };

  const handleClose = () => {
    setBulkData('');
    setResults(null);
    setUploadedFile(null);
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
    onOpenChange(false);
  };

  return (
    <Dialog open={open} onOpenChange={handleClose}>
      <DialogContent className="max-w-3xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>Bulk Import Leads</DialogTitle>
          <DialogDescription>
            Paste your lead data below. Each line should contain: Name, Company, Phone, Email, Service Needs
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4 mt-4">
          {/* Instructions */}
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h4 className="font-medium text-blue-900 mb-2">Format Example:</h4>
            <div className="text-sm text-blue-700 font-mono space-y-1">
              <div>John Smith - Acme Corp, 555-123-4567, john@acme.com - needs website and SEO</div>
              <div>Jane Doe, 555-987-6543, jane@example.com - interested in social media marketing</div>
            </div>
            <p className="text-sm text-blue-600 mt-3">
              <strong>Tip:</strong> Include keywords like "website", "SEO", "social media", "ads", "marketing", "app" to automatically generate proposals.
            </p>
          </div>

          {/* File Upload Section */}
          <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 bg-gray-50">
            <div className="text-center">
              <FileSpreadsheet className="w-12 h-12 text-gray-400 mx-auto mb-3" />
              <h4 className="font-medium text-gray-900 mb-2">Upload CSV or Excel File</h4>
              <p className="text-sm text-gray-600 mb-4">
                Upload a file with your lead data (CSV, XLSX, or XLS format)
              </p>
              
              <input
                ref={fileInputRef}
                type="file"
                accept=".csv,.xlsx,.xls"
                onChange={handleFileUpload}
                className="hidden"
                id="file-upload"
              />
              
              {uploadedFile ? (
                <div className="flex items-center justify-center gap-2 bg-white border border-green-200 rounded-lg p-3">
                  <FileSpreadsheet className="w-5 h-5 text-green-600" />
                  <span className="text-sm font-medium text-gray-900">{uploadedFile.name}</span>
                  <Button
                    type="button"
                    variant="ghost"
                    size="sm"
                    onClick={handleRemoveFile}
                    className="ml-2 h-6 w-6 p-0"
                  >
                    <X className="h-4 w-4 text-red-600" />
                  </Button>
                </div>
              ) : (
                <label htmlFor="file-upload">
                  <Button type="button" variant="outline" asChild>
                    <span className="cursor-pointer">
                      <Upload className="w-4 h-4 mr-2" />
                      Choose File
                    </span>
                  </Button>
                </label>
              )}
            </div>
          </div>

          {/* OR Divider */}
          <div className="relative">
            <div className="absolute inset-0 flex items-center">
              <div className="w-full border-t border-gray-300"></div>
            </div>
            <div className="relative flex justify-center text-sm">
              <span className="px-2 bg-white text-gray-500">OR paste data manually</span>
            </div>
          </div>

          {/* Input Area */}
          <div>
            <Label>Lead Data (Manual Entry)</Label>
            <Textarea
              value={bulkData}
              onChange={(e) => setBulkData(e.target.value)}
              placeholder="Paste your lead data here... (one lead per line)"
              rows={8}
              className="mt-1 font-mono text-sm"
            />
          </div>

          {/* Options */}
          <div className="flex items-center space-x-2">
            <Checkbox
              id="generate-proposals"
              checked={generateProposals}
              onCheckedChange={(checked) => setGenerateProposals(checked as boolean)}
            />
            <Label
              htmlFor="generate-proposals"
              className="text-sm font-normal cursor-pointer"
            >
              Automatically generate draft proposals for leads with service keywords
            </Label>
          </div>

          {/* Results */}
          {results && (
            <div className="border rounded-lg p-4 bg-gray-50">
              <h4 className="font-medium mb-3">Import Results</h4>
              <div className="space-y-2">
                <div className="flex items-center gap-2 text-green-700">
                  <CheckCircle2 className="h-4 w-4" />
                  <span className="text-sm">{results.leadsCreated} leads imported</span>
                </div>
                {results.proposalsCreated > 0 && (
                  <div className="flex items-center gap-2 text-blue-700">
                    <CheckCircle2 className="h-4 w-4" />
                    <span className="text-sm">{results.proposalsCreated} proposals created</span>
                  </div>
                )}
                {results.errors && results.errors.length > 0 && (
                  <div className="mt-3">
                    <div className="flex items-center gap-2 text-orange-700 mb-2">
                      <AlertCircle className="h-4 w-4" />
                      <span className="text-sm font-medium">
                        {results.errors.length} issue(s) found
                      </span>
                    </div>
                    <div className="space-y-1 ml-6">
                      {results.errors.map((err: any, idx: number) => (
                        <div key={idx} className="text-sm text-gray-600">
                          {err.lead}: {err.error}
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Actions */}
          <div className="flex justify-end gap-2 pt-4 border-t">
            <Button variant="outline" onClick={handleClose}>
              Close
            </Button>
            <Button onClick={handleImport} disabled={importing || !bulkData.trim()}>
              <Upload className="h-4 w-4 mr-2" />
              {importing ? 'Importing...' : 'Import Leads'}
            </Button>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}

// ==========================================
// File: components/crm/kanban-board.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { Lead, LeadStatus } from '@/lib/crm-types';
import { LEAD_STATUSES, getStatusColor } from '@/lib/crm-utils';
import { LeadCard } from './lead-card';
import { ScrollArea } from '@/components/ui/scroll-area';
import { cn } from '@/lib/utils';

interface KanbanBoardProps {
  leads: Lead[];
  onLeadClick: (lead: Lead) => void;
  onStatusChange: (leadId: string, newStatus: LeadStatus) => void;
}

export function KanbanBoard({ leads, onLeadClick, onStatusChange }: KanbanBoardProps) {
  const [draggedLead, setDraggedLead] = useState<Lead | null>(null);

  const handleDragStart = (lead: Lead) => {
    setDraggedLead(lead);
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
  };

  const handleDrop = (status: LeadStatus) => {
    if (draggedLead && draggedLead.status !== status) {
      onStatusChange(draggedLead.id, status);
    }
    setDraggedLead(null);
  };

  const getLeadsByStatus = (status: LeadStatus) => {
    return leads.filter(lead => lead.status === status);
  };

  return (
    <div className="relative">
      {/* Scroll hint for mobile */}
      <div className="lg:hidden mb-2 text-xs text-gray-500 text-center">
        ‚Üê Swipe to view all stages ‚Üí
      </div>
      
      <div className="flex gap-3 sm:gap-4 overflow-x-auto pb-4 snap-x snap-mandatory lg:snap-none scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100">
        {LEAD_STATUSES.map(statusConfig => {
          const statusLeads = getLeadsByStatus(statusConfig.value);
          const statusColor = getStatusColor(statusConfig.value);

          return (
            <div
              key={statusConfig.value}
              className="flex-shrink-0 w-[85vw] sm:w-80 lg:w-80 snap-center lg:snap-align-none"
              onDragOver={handleDragOver}
              onDrop={() => handleDrop(statusConfig.value)}
            >
              {/* Column Header */}
              <div className="mb-3 sm:mb-4 sticky top-0 bg-gray-50 py-2 z-10">
                <div className="flex items-center gap-2 mb-2">
                  <div className={cn("w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full flex-shrink-0", statusColor)} />
                  <h3 className="font-semibold text-xs sm:text-sm truncate">{statusConfig.label}</h3>
                  <span className="text-xs text-gray-500 bg-gray-200 px-2 py-0.5 rounded-full flex-shrink-0 ml-auto">
                    {statusLeads.length}
                  </span>
                </div>
              </div>

              {/* Cards Container */}
              <div className="space-y-2 sm:space-y-3">
                {statusLeads.length === 0 ? (
                  <div className="bg-gray-50 rounded-lg p-4 sm:p-6 text-center border-2 border-dashed border-gray-200">
                    <p className="text-xs sm:text-sm text-gray-500">No leads</p>
                  </div>
                ) : (
                  statusLeads.map(lead => (
                    <LeadCard
                      key={lead.id}
                      lead={lead}
                      onClick={() => onLeadClick(lead)}
                      draggable
                      onDragStart={() => handleDragStart(lead)}
                    />
                  ))
                )}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

// ==========================================
// File: components/crm/lead-card.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { Lead } from '@/lib/crm-types';
import { 
  getStatusColor, 
  getPriorityColor, 
  formatLeadSource,
  getLeadTimeframe,
  isLeadOverdue
} from '@/lib/crm-utils';
import { Mail, Phone, Building2, Clock, AlertCircle, Star } from 'lucide-react';
import { Badge } from '@/components/ui/badge';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { cn } from '@/lib/utils';

interface LeadCardProps {
  lead: Lead;
  onClick?: () => void;
  draggable?: boolean;
  onDragStart?: (e: React.DragEvent) => void;
}

export function LeadCard({ lead, onClick, draggable, onDragStart }: LeadCardProps) {
  const priorityColor = getPriorityColor(lead.priority);
  const overdue = isLeadOverdue(lead.nextFollowUpAt);
  const [isDragging, setIsDragging] = useState(false);
  const [dragStartPos, setDragStartPos] = useState({ x: 0, y: 0 });

  const handleMouseDown = (e: React.MouseEvent) => {
    setDragStartPos({ x: e.clientX, y: e.clientY });
    setIsDragging(false);
  };

  const handleMouseMove = (e: React.MouseEvent) => {
    if (draggable) {
      const distance = Math.sqrt(
        Math.pow(e.clientX - dragStartPos.x, 2) + 
        Math.pow(e.clientY - dragStartPos.y, 2)
      );
      if (distance > 5) {
        setIsDragging(true);
      }
    }
  };

  const handleClick = (e: React.MouseEvent) => {
    // Only trigger click if we haven't dragged
    if (!isDragging && onClick) {
      onClick();
    }
    setIsDragging(false);
  };

  const handleViewDetailsClick = (e: React.MouseEvent) => {
    // Completely bypass drag detection for the button
    e.stopPropagation();
    e.preventDefault();
    if (onClick) {
      onClick();
    }
  };

  const handleDragStart = (e: React.DragEvent) => {
    setIsDragging(true);
    if (onDragStart) {
      onDragStart(e);
    }
  };

  return (
    <div
      draggable={draggable}
      onDragStart={handleDragStart}
      onMouseDown={handleMouseDown}
      onMouseMove={handleMouseMove}
      onClick={handleClick}
      className={cn(
        "bg-white rounded-lg p-4 shadow-sm border border-gray-200",
        "hover:shadow-md transition-all duration-200 cursor-pointer",
        "flex flex-col",
        overdue && "border-red-300 bg-red-50"
      )}
    >
      {/* Header */}
      <div className="flex items-start justify-between mb-3">
        <div className="flex items-center gap-2 flex-1">
          <Avatar className="h-8 w-8">
            <AvatarFallback className="bg-gradient-to-br from-blue-500 to-purple-500 text-white text-xs">
              {lead.name?.[0]?.toUpperCase() || lead.email[0].toUpperCase()}
            </AvatarFallback>
          </Avatar>
          <div className="flex-1 min-w-0">
            <p className="font-medium text-sm truncate">
              {lead.name || lead.email}
            </p>
            <p className="text-xs text-gray-500">{getLeadTimeframe(lead.createdAt)}</p>
          </div>
        </div>
        
        {/* Score Badge */}
        <Badge 
          variant="secondary" 
          className={cn(
            "ml-2",
            lead.score >= 80 ? "bg-green-100 text-green-700" :
            lead.score >= 50 ? "bg-yellow-100 text-yellow-700" :
            "bg-gray-100 text-gray-700"
          )}
        >
          <Star className="h-3 w-3 mr-1" />
          {lead.score}
        </Badge>
      </div>

      {/* Contact Info */}
      <div className="space-y-1.5 mb-3">
        <div className="flex items-center gap-2 text-xs text-gray-600">
          <Mail className="h-3 w-3" />
          <span className="truncate">{lead.email}</span>
        </div>
        
        {lead.phone && (
          <div className="flex items-center gap-2 text-xs text-gray-600">
            <Phone className="h-3 w-3" />
            <span>{lead.phone}</span>
          </div>
        )}
        
        {lead.company && (
          <div className="flex items-center gap-2 text-xs text-gray-600">
            <Building2 className="h-3 w-3" />
            <span className="truncate">{lead.company}</span>
          </div>
        )}
      </div>

      {/* Interest & Source */}
      {lead.interest && (
        <p className="text-xs text-gray-700 mb-2 line-clamp-2">
          <span className="font-medium">Interested in:</span> {lead.interest}
        </p>
      )}

      {/* Footer */}
      <div className="flex items-center justify-between pt-3 border-t border-gray-100">
        <Badge variant="outline" className="text-xs">
          {formatLeadSource(lead.source)}
        </Badge>
        
        <div className="flex items-center gap-2">
          {/* Priority Indicator */}
          <div className={cn("flex items-center gap-1 text-xs", priorityColor)}>
            <AlertCircle className="h-3 w-3" />
            <span className="capitalize">{lead.priority}</span>
          </div>
          
          {/* Overdue Indicator */}
          {overdue && (
            <Badge variant="destructive" className="text-xs">
              <Clock className="h-3 w-3 mr-1" />
              Overdue
            </Badge>
          )}
        </div>
      </div>

      {/* Assigned To */}
      {lead.assignedTo && (
        <div className="mt-2 pt-2 border-t border-gray-100">
          <div className="flex items-center gap-2">
            <Avatar className="h-5 w-5">
              <AvatarFallback className="bg-gray-200 text-gray-700 text-[10px]">
                {lead.assignedTo.user.name?.[0]?.toUpperCase() || 'A'}
              </AvatarFallback>
            </Avatar>
            <span className="text-xs text-gray-600 truncate">
              {lead.assignedTo.user.name || lead.assignedTo.user.email}
            </span>
          </div>
        </div>
      )}

      {/* View Details Button */}
      <div className="mt-3 pt-3 border-t border-gray-100">
        <button
          onClick={handleViewDetailsClick}
          onMouseDown={(e) => {
            e.stopPropagation(); // Prevent drag start
          }}
          onMouseMove={(e) => {
            e.stopPropagation(); // Prevent drag detection
          }}
          type="button"
          className="w-full py-2 px-3 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md transition-colors flex items-center justify-center gap-2"
        >
          View Details
        </button>
      </div>
    </div>
  );
}

// ==========================================
// File: components/crm/lead-sequences.tsx
// ==========================================


'use client';

import { useEffect, useState } from 'react';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import {
  Plus,
  Play,
  Pause,
  RotateCcw,
  CheckCircle2,
  Clock,
  Mail,
  MessageSquare,
  CheckSquare,
  GitBranch,
} from 'lucide-react';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';
import { SequenceAssignment, Sequence } from '@/lib/sequence-types';
import Link from 'next/link';

interface LeadSequencesProps {
  leadId: string;
}

export function LeadSequences({ leadId }: LeadSequencesProps) {
  const [assignments, setAssignments] = useState<SequenceAssignment[]>([]);
  const [availableSequences, setAvailableSequences] = useState<Sequence[]>([]);
  const [loading, setLoading] = useState(true);
  const [showAssignDialog, setShowAssignDialog] = useState(false);
  const [selectedSequence, setSelectedSequence] = useState<string>('');
  const [notes, setNotes] = useState('');
  const [autoStart, setAutoStart] = useState(false);

  useEffect(() => {
    fetchAssignments();
    fetchAvailableSequences();
  }, [leadId]);

  const fetchAssignments = async () => {
    try {
      const res = await fetch(`/api/crm/leads/${leadId}/sequences`);
      if (res.ok) {
        const data = await res.json();
        setAssignments(data.assignments);
      }
    } catch (error) {
      console.error('Error fetching assignments:', error);
    } finally {
      setLoading(false);
    }
  };

  const fetchAvailableSequences = async () => {
    try {
      const res = await fetch('/api/crm/sequences?status=active');
      if (res.ok) {
        const data = await res.json();
        setAvailableSequences(data.sequences);
      }
    } catch (error) {
      console.error('Error fetching sequences:', error);
    }
  };

  const handleAssignSequence = async () => {
    if (!selectedSequence) {
      toast.error('Please select a sequence');
      return;
    }

    try {
      const res = await fetch(`/api/crm/leads/${leadId}/sequences`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          sequenceId: selectedSequence,
          notes,
          autoStart,
        }),
      });

      if (res.ok) {
        toast.success('Sequence assigned successfully');
        setShowAssignDialog(false);
        setSelectedSequence('');
        setNotes('');
        setAutoStart(false);
        fetchAssignments();
      } else {
        const error = await res.json();
        toast.error(error.error || 'Failed to assign sequence');
      }
    } catch (error) {
      console.error('Error assigning sequence:', error);
      toast.error('An error occurred');
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'active':
        return 'bg-blue-100 text-blue-700';
      case 'pending':
        return 'bg-yellow-100 text-yellow-700';
      case 'completed':
        return 'bg-green-100 text-green-700';
      case 'paused':
        return 'bg-orange-100 text-orange-700';
      case 'cancelled':
        return 'bg-red-100 text-red-700';
      default:
        return 'bg-gray-100 text-gray-700';
    }
  };

  if (loading) {
    return (
      <div className="text-center py-8">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto" />
      </div>
    );
  }

  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <p className="text-sm text-gray-600">
          {assignments.length === 0
            ? 'No sequences assigned to this lead'
            : `${assignments.length} sequence${assignments.length === 1 ? '' : 's'} assigned`}
        </p>
        <Button size="sm" onClick={() => setShowAssignDialog(true)}>
          <Plus className="h-4 w-4 mr-2" />
          Assign Sequence
        </Button>
      </div>

      {assignments.length > 0 ? (
        <div className="space-y-3">
          {assignments.map((assignment) => (
            <div
              key={assignment.id}
              className="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors"
            >
              <div className="flex items-start justify-between mb-3">
                <div className="flex-1">
                  <div className="flex items-center gap-2 mb-1">
                    <h4 className="font-semibold text-gray-900">
                      {assignment.sequence?.name || 'Unknown Sequence'}
                    </h4>
                    <Badge className={cn('text-xs', getStatusColor(assignment.status))}>
                      {assignment.status}
                    </Badge>
                  </div>
                  {assignment.sequence?.description && (
                    <p className="text-sm text-gray-600">
                      {assignment.sequence.description}
                    </p>
                  )}
                </div>
                <Link href={`/dashboard/crm/sequences/${assignment.sequenceId}`}>
                  <Button variant="ghost" size="sm">
                    <GitBranch className="h-4 w-4" />
                  </Button>
                </Link>
              </div>

              {/* Progress */}
              <div className="space-y-2">
                <div className="flex justify-between text-sm">
                  <span className="text-gray-600">Progress</span>
                  <span className="font-medium text-gray-900">
                    {assignment.currentStep} / {assignment.sequence?.steps?.length || 0} steps
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div
                    className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                    style={{
                      width: `${
                        assignment.sequence?.steps?.length
                          ? (assignment.currentStep / assignment.sequence.steps.length) * 100
                          : 0
                      }%`,
                    }}
                  />
                </div>
              </div>

              {/* Stats */}
              <div className="grid grid-cols-4 gap-4 mt-4 pt-4 border-t border-gray-200">
                <div className="text-center">
                  <div className="flex items-center justify-center gap-1 text-gray-600 text-xs mb-1">
                    <Mail className="h-3 w-3" />
                    Sent
                  </div>
                  <div className="font-semibold text-gray-900">{assignment.emailsSent}</div>
                </div>
                <div className="text-center">
                  <div className="flex items-center justify-center gap-1 text-gray-600 text-xs mb-1">
                    <CheckCircle2 className="h-3 w-3" />
                    Opened
                  </div>
                  <div className="font-semibold text-gray-900">
                    {assignment.emailsOpened}
                    {assignment.emailsSent > 0 && (
                      <span className="text-xs text-gray-500 ml-1">
                        ({Math.round((assignment.emailsOpened / assignment.emailsSent) * 100)}%)
                      </span>
                    )}
                  </div>
                </div>
                <div className="text-center">
                  <div className="flex items-center justify-center gap-1 text-gray-600 text-xs mb-1">
                    <MessageSquare className="h-3 w-3" />
                    Replied
                  </div>
                  <div className="font-semibold text-gray-900">{assignment.emailsReplied}</div>
                </div>
                <div className="text-center">
                  <div className="flex items-center justify-center gap-1 text-gray-600 text-xs mb-1">
                    <CheckSquare className="h-3 w-3" />
                    Tasks
                  </div>
                  <div className="font-semibold text-gray-900">
                    {assignment.tasksCompleted}/{assignment.tasksCreated}
                  </div>
                </div>
              </div>

              {/* Timestamps */}
              {(assignment.startedAt || assignment.completedAt) && (
                <div className="mt-3 pt-3 border-t border-gray-200 text-xs text-gray-500">
                  {assignment.startedAt && (
                    <div>Started: {new Date(assignment.startedAt).toLocaleDateString()}</div>
                  )}
                  {assignment.completedAt && (
                    <div>Completed: {new Date(assignment.completedAt).toLocaleDateString()}</div>
                  )}
                </div>
              )}
            </div>
          ))}
        </div>
      ) : (
        <div className="text-center py-12 border border-dashed border-gray-300 rounded-lg">
          <GitBranch className="h-12 w-12 text-gray-400 mx-auto mb-3" />
          <h3 className="text-sm font-medium text-gray-900 mb-1">No sequences assigned</h3>
          <p className="text-sm text-gray-600 mb-4">
            Assign a sequence to automate communication with this lead
          </p>
          <Button onClick={() => setShowAssignDialog(true)}>
            <Plus className="h-4 w-4 mr-2" />
            Assign First Sequence
          </Button>
        </div>
      )}

      {/* Assign Sequence Dialog */}
      <Dialog open={showAssignDialog} onOpenChange={setShowAssignDialog}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Assign Sequence</DialogTitle>
            <DialogDescription>
              Choose a sequence to automate communication with this lead
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-4 mt-4">
            <div>
              <Label>Sequence</Label>
              <Select value={selectedSequence} onValueChange={setSelectedSequence}>
                <SelectTrigger>
                  <SelectValue placeholder="Select a sequence" />
                </SelectTrigger>
                <SelectContent>
                  {availableSequences.length === 0 ? (
                    <div className="p-4 text-center text-sm text-gray-500">
                      No active sequences available.{' '}
                      <Link href="/dashboard/crm/sequences" className="text-blue-600 hover:underline">
                        Create one
                      </Link>
                    </div>
                  ) : (
                    availableSequences.map((seq) => (
                      <SelectItem key={seq.id} value={seq.id}>
                        {seq.name}
                      </SelectItem>
                    ))
                  )}
                </SelectContent>
              </Select>
            </div>

            <div>
              <Label>Notes (Optional)</Label>
              <Textarea
                value={notes}
                onChange={(e) => setNotes(e.target.value)}
                placeholder="Add any notes about this assignment..."
                rows={3}
              />
            </div>

            <div className="flex items-center gap-2">
              <input
                type="checkbox"
                id="autoStart"
                checked={autoStart}
                onChange={(e) => setAutoStart(e.target.checked)}
                className="rounded"
              />
              <Label htmlFor="autoStart" className="cursor-pointer">
                Start sequence immediately
              </Label>
            </div>

            <div className="flex justify-end gap-2 pt-4 border-t">
              <Button variant="outline" onClick={() => setShowAssignDialog(false)}>
                Cancel
              </Button>
              <Button onClick={handleAssignSequence}>Assign Sequence</Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>
    </div>
  );
}

// ==========================================
// File: components/crm/leads-table.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { Lead } from '@/lib/crm-types';
import { Checkbox } from '@/components/ui/checkbox';
import { Badge } from '@/components/ui/badge';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { cn, formatDetailedTimestamp } from '@/lib/utils';
import {
  Mail,
  Phone,
  Building2,
  Calendar,
  Star,
} from 'lucide-react';
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip';
import { formatLeadSource, getPriorityColor, getStatusColor } from '@/lib/crm-utils';

interface LeadsTableProps {
  leads: Lead[];
  selectedLeads: string[];
  onLeadClick: (lead: Lead) => void;
  onSelectionChange: (leadIds: string[]) => void;
}

export function LeadsTable({
  leads,
  selectedLeads,
  onLeadClick,
  onSelectionChange,
}: LeadsTableProps) {
  const isAllSelected = leads.length > 0 && selectedLeads.length === leads.length;
  const isSomeSelected = selectedLeads.length > 0 && selectedLeads.length < leads.length;

  const handleSelectAll = () => {
    if (isAllSelected) {
      onSelectionChange([]);
    } else {
      onSelectionChange(leads.map(lead => lead.id));
    }
  };

  const handleSelectLead = (leadId: string) => {
    if (selectedLeads.includes(leadId)) {
      onSelectionChange(selectedLeads.filter(id => id !== leadId));
    } else {
      onSelectionChange([...selectedLeads, leadId]);
    }
  };

  const formatDate = (date: Date | string) => {
    return new Date(date).toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
    });
  };

  return (
    <>
      {/* Mobile Card View */}
      <div className="lg:hidden space-y-3">
        {leads.length === 0 ? (
          <div className="rounded-md border p-8 text-center">
            <p className="text-sm text-gray-500">No leads found</p>
          </div>
        ) : (
          leads.map(lead => (
            <div
              key={lead.id}
              className={cn(
                'rounded-lg border bg-white p-4 cursor-pointer hover:bg-gray-50 transition-colors',
                selectedLeads.includes(lead.id) && 'bg-blue-50 border-blue-200 hover:bg-blue-100'
              )}
              onClick={() => onLeadClick(lead)}
            >
              <div className="flex items-start justify-between gap-3 mb-3">
                <div className="flex items-start gap-3 min-w-0 flex-1">
                  <Checkbox
                    checked={selectedLeads.includes(lead.id)}
                    onCheckedChange={() => handleSelectLead(lead.id)}
                    onClick={(e) => e.stopPropagation()}
                    aria-label={`Select ${lead.name || lead.email}`}
                    className="mt-1"
                  />
                  <div className="min-w-0 flex-1">
                    <h3 className="font-semibold text-sm text-gray-900 break-words">
                      {lead.name || 'Unnamed Lead'}
                    </h3>
                    {lead.company && (
                      <p className="text-xs text-gray-500 flex items-center gap-1 mt-1">
                        <Building2 className="h-3 w-3 flex-shrink-0" />
                        <span className="break-words">{lead.company}</span>
                      </p>
                    )}
                  </div>
                </div>
                <div className="flex items-center gap-1 flex-shrink-0">
                  <Star className={cn(
                    'h-3.5 w-3.5',
                    lead.score >= 80 ? 'text-green-600' :
                    lead.score >= 50 ? 'text-yellow-600' :
                    'text-gray-400'
                  )} />
                  <span className="text-xs font-medium">{lead.score}</span>
                </div>
              </div>

              <div className="space-y-2 mb-3">
                {lead.email && (
                  <div className="flex items-center gap-2 text-xs text-gray-600 min-w-0">
                    <Mail className="h-3.5 w-3.5 flex-shrink-0 text-gray-400" />
                    <span className="break-all">{lead.email}</span>
                  </div>
                )}
                {lead.phone && (
                  <div className="flex items-center gap-2 text-xs text-gray-600">
                    <Phone className="h-3.5 w-3.5 flex-shrink-0 text-gray-400" />
                    <span>{lead.phone}</span>
                  </div>
                )}
              </div>

              <div className="flex flex-wrap items-center gap-2">
                <Badge className={cn('text-xs', getStatusColor(lead.status))}>
                  {lead.status}
                </Badge>
                <span className={cn('text-xs capitalize font-medium px-2 py-0.5 rounded-full', getPriorityColor(lead.priority))}>
                  {lead.priority}
                </span>
                <span className="text-xs text-gray-500">
                  {formatLeadSource(lead.source)}
                </span>
                <span className="text-xs text-gray-400 ml-auto">
                  {formatDetailedTimestamp(lead.createdAt, { showTime: false }).relative}
                </span>
              </div>
            </div>
          ))
        )}
      </div>

      {/* Desktop Table View */}
      <div className="hidden lg:block rounded-md border">
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead className="w-12">
                <Checkbox
                  checked={isAllSelected ? true : (isSomeSelected ? 'indeterminate' as any : false)}
                  onCheckedChange={handleSelectAll}
                  aria-label="Select all leads"
                />
              </TableHead>
              <TableHead>Lead</TableHead>
              <TableHead>Contact</TableHead>
              <TableHead>Status</TableHead>
              <TableHead>Priority</TableHead>
              <TableHead>Source</TableHead>
              <TableHead>Score</TableHead>
              <TableHead>Created</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {leads.length === 0 ? (
              <TableRow>
                <TableCell colSpan={8} className="h-24 text-center">
                  <p className="text-sm text-gray-500">No leads found</p>
                </TableCell>
              </TableRow>
            ) : (
              leads.map(lead => (
              <TableRow
                key={lead.id}
                className={cn(
                  'cursor-pointer hover:bg-gray-50 transition-colors',
                  selectedLeads.includes(lead.id) && 'bg-blue-50 hover:bg-blue-100'
                )}
                onClick={(e) => {
                  // Don't trigger row click if clicking the checkbox
                  if ((e.target as HTMLElement).closest('[role="checkbox"]')) {
                    return;
                  }
                  onLeadClick(lead);
                }}
              >
                <TableCell onClick={(e) => e.stopPropagation()}>
                  <Checkbox
                    checked={selectedLeads.includes(lead.id)}
                    onCheckedChange={() => handleSelectLead(lead.id)}
                    aria-label={`Select ${lead.name || lead.email}`}
                  />
                </TableCell>
                <TableCell>
                  <div className="flex flex-col">
                    <span className="font-medium text-sm">
                      {lead.name || 'Unnamed Lead'}
                    </span>
                    {lead.company && (
                      <span className="text-xs text-gray-500 flex items-center gap-1 mt-0.5">
                        <Building2 className="h-3 w-3" />
                        {lead.company}
                      </span>
                    )}
                  </div>
                </TableCell>
                <TableCell>
                  <div className="flex flex-col gap-1">
                    {lead.email && (
                      <span className="text-xs flex items-center gap-1">
                        <Mail className="h-3 w-3 text-gray-400" />
                        {lead.email}
                      </span>
                    )}
                    {lead.phone && (
                      <span className="text-xs flex items-center gap-1">
                        <Phone className="h-3 w-3 text-gray-400" />
                        {lead.phone}
                      </span>
                    )}
                  </div>
                </TableCell>
                <TableCell>
                  <Badge className={cn('text-xs', getStatusColor(lead.status))}>
                    {lead.status}
                  </Badge>
                </TableCell>
                <TableCell>
                  <span className={cn('text-xs capitalize font-medium', getPriorityColor(lead.priority))}>
                    {lead.priority}
                  </span>
                </TableCell>
                <TableCell>
                  <span className="text-xs text-gray-600">
                    {formatLeadSource(lead.source)}
                  </span>
                </TableCell>
                <TableCell>
                  <div className="flex items-center gap-1">
                    <Star className={cn(
                      'h-3 w-3',
                      lead.score >= 80 ? 'text-green-600' :
                      lead.score >= 50 ? 'text-yellow-600' :
                      'text-gray-400'
                    )} />
                    <span className="text-xs font-medium">{lead.score}</span>
                  </div>
                </TableCell>
                <TableCell>
                  <TooltipProvider>
                    <Tooltip>
                      <TooltipTrigger asChild>
                        <div className="flex items-center gap-1 text-xs text-gray-500 cursor-help">
                          <Calendar className="h-3 w-3" />
                          {formatDetailedTimestamp(lead.createdAt, { showTime: true }).relative}
                        </div>
                      </TooltipTrigger>
                      <TooltipContent>
                        <p className="text-xs">{formatDetailedTimestamp(lead.createdAt, { showTime: true }).full}</p>
                      </TooltipContent>
                    </Tooltip>
                  </TooltipProvider>
                </TableCell>
              </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </div>
    </>
  );
}

// ==========================================
// File: components/crm/sequences/email-editor.tsx
// ==========================================


'use client';

import { useState, useEffect } from 'react';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Card, CardContent } from '@/components/ui/card';
import { 
  Copy, 
  Eye, 
  Code, 
  Bold, 
  Italic, 
  Link as LinkIcon, 
  List,
  Heading2,
  AlignLeft,
  AlignCenter
} from 'lucide-react';
import { toast } from 'sonner';
import { MERGE_TAGS } from '@/lib/sequence-types';

interface EmailEditorProps {
  subject: string;
  content: string;
  onSubjectChange: (subject: string) => void;
  onContentChange: (content: string) => void;
  stepIndex?: number;
}

export function EmailEditor({ 
  subject, 
  content, 
  onSubjectChange, 
  onContentChange,
  stepIndex 
}: EmailEditorProps) {
  const [activeTab, setActiveTab] = useState<'editor' | 'preview'>('editor');
  const [textareaRef, setTextareaRef] = useState<HTMLTextAreaElement | null>(null);

  // Convert plain text to HTML format
  const formatContentAsHTML = (text: string): string => {
    if (!text) return '';
    
    // Basic formatting
    let html = text
      .replace(/\n\n/g, '</p><p>')
      .replace(/\n/g, '<br />');
    
    // Wrap in paragraphs
    html = `<p>${html}</p>`;
    
    // Replace merge tags with styled versions
    html = html.replace(/\{\{(\w+)\}\}/g, '<strong style="color: #2563eb;">{{$1}}</strong>');
    
    return html;
  };

  // Generate full HTML email template
  const generateFullHTMLEmail = (): string => {
    const bodyContent = formatContentAsHTML(content);
    
    return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${subject}</title>
</head>
<body style="margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f5f5f5;">
    <table role="presentation" style="width: 100%; border-collapse: collapse;">
        <tr>
            <td style="padding: 20px 0; text-align: center; background-color: #1a1a1a;">
                <h1 style="color: #ffffff; margin: 0; font-size: 24px;">CDM Suite</h1>
            </td>
        </tr>
    </table>
    
    <table role="presentation" style="max-width: 600px; margin: 20px auto; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <tr>
            <td style="padding: 40px 30px;">
                <div style="color: #333333; font-size: 16px; line-height: 1.6;">
                    ${bodyContent}
                </div>
            </td>
        </tr>
    </table>
    
    <table role="presentation" style="max-width: 600px; margin: 0 auto; padding: 20px;">
        <tr>
            <td style="text-align: center; color: #666666; font-size: 12px;">
                <p style="margin: 0;">¬© ${new Date().getFullYear()} CDM Suite. All rights reserved.</p>
                <p style="margin: 10px 0 0 0;">
                    <a href="{{unsubscribeLink}}" style="color: #666666; text-decoration: underline;">Unsubscribe</a>
                </p>
            </td>
        </tr>
    </table>
</body>
</html>`;
  };

  const handleCopyHTML = () => {
    const fullHTML = generateFullHTMLEmail();
    navigator.clipboard.writeText(fullHTML);
    toast.success('Full HTML email copied to clipboard!');
  };

  const handleCopyFormattedBody = () => {
    const formattedBody = formatContentAsHTML(content);
    navigator.clipboard.writeText(formattedBody);
    toast.success('Formatted email body copied to clipboard!');
  };

  const insertAtCursor = (text: string) => {
    if (!textareaRef) return;
    
    const start = textareaRef.selectionStart;
    const end = textareaRef.selectionEnd;
    const newContent = content.substring(0, start) + text + content.substring(end);
    
    onContentChange(newContent);
    
    // Set cursor position after inserted text
    setTimeout(() => {
      if (textareaRef) {
        textareaRef.focus();
        textareaRef.setSelectionRange(start + text.length, start + text.length);
      }
    }, 0);
  };

  const insertMergeTag = (tag: string) => {
    insertAtCursor(tag);
  };

  const insertFormatting = (format: string) => {
    if (!textareaRef) return;
    
    const start = textareaRef.selectionStart;
    const end = textareaRef.selectionEnd;
    const selectedText = content.substring(start, end);
    
    if (!selectedText) {
      toast.error('Please select text first');
      return;
    }
    
    let wrappedText = '';
    switch (format) {
      case 'bold':
        wrappedText = `**${selectedText}**`;
        break;
      case 'italic':
        wrappedText = `*${selectedText}*`;
        break;
      case 'heading':
        wrappedText = `\n## ${selectedText}\n`;
        break;
      case 'link':
        wrappedText = `[${selectedText}](https://example.com)`;
        break;
      default:
        wrappedText = selectedText;
    }
    
    const newContent = content.substring(0, start) + wrappedText + content.substring(end);
    onContentChange(newContent);
  };

  // Process markdown-style formatting for preview
  const processMarkdownForPreview = (text: string): string => {
    let processed = text;
    
    // Bold
    processed = processed.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    // Italic
    processed = processed.replace(/\*(.+?)\*/g, '<em>$1</em>');
    // Headings
    processed = processed.replace(/^## (.+)$/gm, '<h2 style="font-size: 20px; font-weight: bold; margin: 20px 0 10px 0; color: #1a1a1a;">$1</h2>');
    // Links
    processed = processed.replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2" style="color: #2563eb; text-decoration: underline;">$1</a>');
    
    return processed;
  };

  const getPreviewHTML = (): string => {
    let processed = processMarkdownForPreview(content);
    processed = formatContentAsHTML(processed);
    return processed;
  };

  return (
    <div className="space-y-4">
      {/* Subject Line */}
      <div className="space-y-2">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <Label>Email Subject*</Label>
          <div className="text-xs text-muted-foreground">
            {subject.length} characters
          </div>
        </div>
        <input
          type="text"
          className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
          placeholder="e.g., Welcome to CDM Suite, {{firstName}}!"
          value={subject}
          onChange={(e) => onSubjectChange(e.target.value)}
        />
      </div>

      {/* Email Content with Tabs */}
      <div className="space-y-2">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <Label>Email Content*</Label>
          <div className="flex gap-2 flex-wrap">
            <Button
              type="button"
              variant="outline"
              size="sm"
              onClick={handleCopyFormattedBody}
              className="text-xs"
            >
              <Copy className="h-3 w-3 sm:mr-1" />
              <span className="hidden sm:inline">Copy Body</span>
            </Button>
            <Button
              type="button"
              variant="outline"
              size="sm"
              onClick={handleCopyHTML}
              className="text-xs"
            >
              <Copy className="h-3 w-3 sm:mr-1" />
              <span className="hidden sm:inline">Copy Full HTML</span>
            </Button>
          </div>
        </div>

        <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as 'editor' | 'preview')} className="w-full">
          <TabsList className="grid w-full grid-cols-2">
            <TabsTrigger value="editor">
              <Code className="h-4 w-4 mr-2" />
              Edit
            </TabsTrigger>
            <TabsTrigger value="preview">
              <Eye className="h-4 w-4 mr-2" />
              Preview
            </TabsTrigger>
          </TabsList>

          <TabsContent value="editor" className="space-y-3 mt-3">
            {/* Formatting Toolbar */}
            <div className="flex flex-wrap gap-1 sm:gap-2 p-2 sm:p-3 border rounded-md bg-muted/30">
              <div className="flex gap-1 flex-wrap">
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => insertFormatting('bold')}
                  title="Bold - **text**"
                  className="h-8 w-8 sm:h-9 sm:w-9 p-0"
                >
                  <Bold className="h-3 w-3 sm:h-4 sm:w-4" />
                </Button>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => insertFormatting('italic')}
                  title="Italic - *text*"
                  className="h-8 w-8 sm:h-9 sm:w-9 p-0"
                >
                  <Italic className="h-3 w-3 sm:h-4 sm:w-4" />
                </Button>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => insertFormatting('heading')}
                  title="Heading - ## text"
                  className="h-8 w-8 sm:h-9 sm:w-9 p-0"
                >
                  <Heading2 className="h-3 w-3 sm:h-4 sm:w-4" />
                </Button>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => insertFormatting('link')}
                  title="Link - [text](url)"
                  className="h-8 w-8 sm:h-9 sm:w-9 p-0"
                >
                  <LinkIcon className="h-3 w-3 sm:h-4 sm:w-4" />
                </Button>
              </div>
            </div>

            {/* Editor Textarea */}
            <Textarea
              ref={setTextareaRef}
              placeholder={`Hi {{firstName}},

Welcome to CDM Suite! We're excited to help you grow your business.

## Here's what you can expect:

**Professional service** - We deliver results
**Expert support** - Always here to help
**Proven strategies** - That actually work

Ready to get started? [Click here](https://cdmsuite.com) to schedule a call.

Best regards,
{{assignedTo}}
CDM Suite Team`}
              value={content}
              onChange={(e) => onContentChange(e.target.value)}
              rows={12}
              className="font-mono text-sm"
            />

            {/* Merge Tags */}
            <div className="space-y-2">
              <div className="text-xs sm:text-sm font-medium">Quick Insert Merge Tags:</div>
              <div className="flex flex-wrap gap-1.5 sm:gap-2">
                {MERGE_TAGS.map((tag) => (
                  <Badge
                    key={tag.value}
                    variant="secondary"
                    className="cursor-pointer hover:bg-primary hover:text-primary-foreground transition-colors text-xs touch-manipulation"
                    onClick={() => insertMergeTag(tag.value)}
                  >
                    {tag.label}
                  </Badge>
                ))}
              </div>
            </div>

            {/* Formatting Help */}
            <Card>
              <CardContent className="pt-3 sm:pt-4 px-3 sm:px-6">
                <div className="text-xs space-y-1">
                  <p className="font-semibold mb-2">Formatting Guide:</p>
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1.5 sm:gap-y-1 text-muted-foreground">
                    <div className="text-xs"><code className="text-[10px] sm:text-xs">**bold text**</code> ‚Üí <strong>bold text</strong></div>
                    <div className="text-xs"><code className="text-[10px] sm:text-xs">*italic text*</code> ‚Üí <em>italic text</em></div>
                    <div className="text-xs"><code className="text-[10px] sm:text-xs">## Heading</code> ‚Üí <strong>Heading</strong></div>
                    <div className="text-xs"><code className="text-[10px] sm:text-xs">[link](url)</code> ‚Üí <span className="text-blue-600 underline">link</span></div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="preview" className="mt-3">
            <Card>
              <CardContent className="pt-4 sm:pt-6 px-2 sm:px-6">
                {/* Email Preview */}
                <div className="border rounded-lg overflow-hidden">
                  {/* Email Header */}
                  <div className="bg-[#1a1a1a] text-white text-center py-3 sm:py-4 px-4 sm:px-6">
                    <h2 className="text-lg sm:text-xl font-bold">CDM Suite</h2>
                  </div>

                  {/* Email Body */}
                  <div className="bg-white p-4 sm:p-8">
                    {/* Subject as Header */}
                    {subject && (
                      <div className="mb-4 sm:mb-6 pb-3 sm:pb-4 border-b">
                        <p className="text-xs sm:text-sm text-muted-foreground mb-1">Subject:</p>
                        <p className="font-semibold text-base sm:text-lg break-words">{subject}</p>
                      </div>
                    )}

                    {/* Content */}
                    <div 
                      className="prose prose-sm max-w-none"
                      style={{
                        color: '#333333',
                        fontSize: '14px',
                        lineHeight: '1.6',
                      }}
                      dangerouslySetInnerHTML={{ __html: getPreviewHTML() }}
                    />
                  </div>

                  {/* Email Footer */}
                  <div className="bg-gray-50 text-center py-3 sm:py-4 px-4 sm:px-6 text-xs text-gray-600">
                    <p>¬© {new Date().getFullYear()} CDM Suite. All rights reserved.</p>
                    <p className="mt-2">
                      <a href="#" className="text-gray-600 underline">Unsubscribe</a>
                    </p>
                  </div>
                </div>

                <div className="mt-3 sm:mt-4 p-2.5 sm:p-3 bg-blue-50 dark:bg-blue-950 rounded-md">
                  <p className="text-xs sm:text-sm text-blue-900 dark:text-blue-100">
                    üí° This preview shows how your email will appear to recipients. 
                    Merge tags like <strong>{'{{firstName}}'}</strong> will be replaced with actual data when sent.
                  </p>
                </div>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

// ==========================================
// File: components/crm/sequences/wysiwyg-email-editor.tsx
// ==========================================


'use client';

import { useState, useEffect, useRef } from 'react';
import { Label } from '@/components/ui/label';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Card, CardContent } from '@/components/ui/card';
import { 
  Copy, 
  Wand2,
  Loader2,
  Eye,
  Edit3,
  Bold,
  Italic,
  Underline,
  List,
  ListOrdered,
  Link as LinkIcon,
  Type,
} from 'lucide-react';
import { toast } from 'sonner';
import { MERGE_TAGS } from '@/lib/sequence-types';

interface WYSIWYGEmailEditorProps {
  subject: string;
  content: string;
  onSubjectChange: (subject: string) => void;
  onContentChange: (content: string) => void;
  stepIndex?: number;
  leadContext?: {
    name?: string;
    company?: string;
    interest?: string;
    email?: string;
  };
  proposalContext?: {
    title?: string;
    clientName?: string;
    clientCompany?: string;
    total?: number;
    items?: any[];
  };
}

export function WYSIWYGEmailEditor({ 
  subject, 
  content, 
  onSubjectChange, 
  onContentChange,
  stepIndex,
  leadContext,
  proposalContext,
}: WYSIWYGEmailEditorProps) {
  const [isGenerating, setIsGenerating] = useState(false);
  const [previewMode, setPreviewMode] = useState(false);
  const editorRef = useRef<HTMLDivElement>(null);

  // Initialize editor content
  useEffect(() => {
    if (editorRef.current && editorRef.current.innerHTML !== content) {
      editorRef.current.innerHTML = content || '';
    }
  }, [content]);

  // Handle content changes from the editor
  const handleEditorInput = () => {
    if (editorRef.current) {
      onContentChange(editorRef.current.innerHTML);
    }
  };

  // Format commands for the rich text editor
  const execCommand = (command: string, value?: string) => {
    document.execCommand(command, false, value);
    editorRef.current?.focus();
  };

  const insertLink = () => {
    const url = prompt('Enter URL:');
    if (url) {
      execCommand('createLink', url);
    }
  };

  const changeFontSize = (size: string) => {
    execCommand('fontSize', size);
  };

  // Generate full HTML email template
  const generateFullHTMLEmail = (): string => {
    return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${subject}</title>
</head>
<body style="margin: 0; padding: 0; font-family: 'Arial', 'Helvetica', sans-serif; background-color: #f5f5f5;">
    <table role="presentation" style="width: 100%; border-collapse: collapse;">
        <tr>
            <td style="padding: 30px 0; text-align: center; background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);">
                <h1 style="color: #ffffff; margin: 0; font-size: 28px; font-weight: bold;">CDM Suite</h1>
                <p style="color: #e0e0e0; margin: 8px 0 0 0; font-size: 14px;">Your Digital Marketing Partner</p>
            </td>
        </tr>
    </table>
    
    <table role="presentation" style="max-width: 600px; margin: 20px auto; background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <tr>
            <td style="padding: 40px 30px;">
                <div style="color: #333333; font-size: 16px; line-height: 1.6;">
                    ${content}
                </div>
            </td>
        </tr>
    </table>
    
    <table role="presentation" style="max-width: 600px; margin: 0 auto; padding: 20px;">
        <tr>
            <td style="text-align: center; color: #666666; font-size: 12px;">
                <p style="margin: 0;"><strong>CDM Suite</strong> | Full Service Digital Marketing Agency</p>
                <p style="margin: 8px 0;">Data-driven strategies that deliver measurable results</p>
                <p style="margin: 10px 0 0 0;">
                    <a href="tel:8622727623" style="color: #2563eb; text-decoration: none; margin: 0 10px;">(862) 272-7623</a> | 
                    <a href="mailto:info@cdmsuite.com" style="color: #2563eb; text-decoration: none; margin: 0 10px;">info@cdmsuite.com</a>
                </p>
                <p style="margin: 15px 0 0 0;">
                    <a href="{{unsubscribeLink}}" style="color: #666666; text-decoration: underline; font-size: 11px;">Unsubscribe</a>
                </p>
                <p style="margin: 10px 0 0 0; font-size: 11px;">¬© ${new Date().getFullYear()} CDM Suite. All rights reserved.</p>
            </td>
        </tr>
    </table>
</body>
</html>`;
  };

  const handleCopyHTML = async () => {
    const fullHTML = generateFullHTMLEmail();
    let copySuccessful = false;
    
    // Method 1: Try modern Clipboard API
    try {
      if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
        await navigator.clipboard.writeText(fullHTML);
        copySuccessful = true;
        toast.success('‚úì Full HTML email copied! Ready to send to your client.');
        return;
      }
    } catch (clipboardError) {
      console.warn('Clipboard API failed:', clipboardError);
    }
    
    // Method 2: Try textarea with execCommand (works on most mobile devices)
    if (!copySuccessful) {
      try {
        const textarea = document.createElement('textarea');
        textarea.value = fullHTML;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        textarea.style.fontSize = '12pt'; // Prevent zooming on iOS
        
        document.body.appendChild(textarea);
        
        // iOS specific handling
        if (navigator.userAgent.match(/ipad|iphone/i)) {
          const range = document.createRange();
          range.selectNodeContents(textarea);
          const selection = window.getSelection();
          selection?.removeAllRanges();
          selection?.addRange(range);
          textarea.setSelectionRange(0, fullHTML.length);
        } else {
          textarea.select();
        }
        
        copySuccessful = document.execCommand('copy');
        document.body.removeChild(textarea);
        
        if (copySuccessful) {
          toast.success('‚úì Full HTML email copied! Ready to send to your client.');
          return;
        }
      } catch (execError) {
        console.warn('execCommand failed:', execError);
      }
    }
    
    // Method 3: Download as file (last resort)
    if (!copySuccessful) {
      try {
        const blob = new Blob([fullHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `email-template-${Date.now()}.html`;
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        
        setTimeout(() => {
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, 100);
        
        toast.success('üì• Email HTML downloaded as file (clipboard not available)');
      } catch (downloadError) {
        console.error('All copy methods failed:', downloadError);
        toast.error('‚ùå Could not copy or download. Please try again.');
      }
    }
  };

  const handleGenerateWithAI = async () => {
    setIsGenerating(true);
    try {
      const response = await fetch('/api/ai/generate-compelling-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          leadContext,
          proposalContext,
          stepIndex,
        }),
      });

      if (!response.ok) {
        throw new Error('Failed to generate email');
      }

      const data = await response.json();
      onSubjectChange(data.subject);
      onContentChange(data.content);
      toast.success('AI generated a compelling email! Review and edit as needed.');
    } catch (error) {
      console.error('AI generation error:', error);
      toast.error('Failed to generate email. Please try again.');
    } finally {
      setIsGenerating(false);
    }
  };

  const insertMergeTag = (tag: string) => {
    if (editorRef.current) {
      editorRef.current.focus();
      // Insert at cursor position
      const selection = window.getSelection();
      if (selection && selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        range.deleteContents();
        const tagNode = document.createTextNode(' ' + tag + ' ');
        range.insertNode(tagNode);
        range.setStartAfter(tagNode);
        range.setEndAfter(tagNode);
        selection.removeAllRanges();
        selection.addRange(range);
      } else {
        // Fallback: append at the end
        editorRef.current.innerHTML += ' ' + tag + ' ';
      }
      handleEditorInput();
      toast.success('Merge tag inserted!');
    }
  };

  return (
    <div className="space-y-4">
      {/* AI Generation Button */}
      <Card className="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950 dark:to-purple-950 border-blue-200 dark:border-blue-800">
        <CardContent className="pt-4 pb-4">
          <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-1">
                <Wand2 className="h-5 w-5 text-blue-600 dark:text-blue-400" />
                <span className="font-semibold text-sm">AI-Powered Email Generator</span>
              </div>
              <p className="text-xs text-muted-foreground">
                Let AI create a compelling, sales-focused email that promotes your products effectively
              </p>
            </div>
            <Button
              type="button"
              onClick={handleGenerateWithAI}
              disabled={isGenerating}
              className="shrink-0"
            >
              {isGenerating ? (
                <>
                  <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                  Generating...
                </>
              ) : (
                <>
                  <Wand2 className="h-4 w-4 mr-2" />
                  Generate Email
                </>
              )}
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Subject Line */}
      <div className="space-y-2">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <Label>Email Subject*</Label>
          <div className="text-xs text-muted-foreground">
            {subject.length} characters (aim for 40-60 for best open rates)
          </div>
        </div>
        <input
          type="text"
          className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
          placeholder="e.g., Your Exclusive Proposal from CDM Suite - Limited Time Offer!"
          value={subject}
          onChange={(e) => onSubjectChange(e.target.value)}
        />
      </div>

      {/* Email Content Editor */}
      <div className="space-y-2">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <Label>Email Content*</Label>
          <div className="flex gap-2">
            <Button
              type="button"
              variant="outline"
              size="sm"
              onClick={() => setPreviewMode(!previewMode)}
              className="text-xs"
            >
              {previewMode ? (
                <>
                  <Edit3 className="h-3 w-3 sm:mr-1" />
                  <span className="hidden sm:inline">Edit</span>
                </>
              ) : (
                <>
                  <Eye className="h-3 w-3 sm:mr-1" />
                  <span className="hidden sm:inline">Preview</span>
                </>
              )}
            </Button>
            <Button
              type="button"
              variant="outline"
              size="sm"
              onClick={handleCopyHTML}
              className="text-xs"
            >
              <Copy className="h-3 w-3 sm:mr-1" />
              <span className="hidden sm:inline">Copy Full Email</span>
            </Button>
          </div>
        </div>

        {!previewMode ? (
          <>
            <div className="border rounded-md overflow-hidden bg-white dark:bg-gray-900">
              {/* Formatting Toolbar */}
              <div className="flex flex-wrap gap-1 p-2 border-b bg-gray-50 dark:bg-gray-800">
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => execCommand('bold')}
                  className="h-8 w-8 p-0"
                  title="Bold"
                >
                  <Bold className="h-4 w-4" />
                </Button>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => execCommand('italic')}
                  className="h-8 w-8 p-0"
                  title="Italic"
                >
                  <Italic className="h-4 w-4" />
                </Button>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => execCommand('underline')}
                  className="h-8 w-8 p-0"
                  title="Underline"
                >
                  <Underline className="h-4 w-4" />
                </Button>
                <div className="w-px h-8 bg-gray-300 dark:bg-gray-600 mx-1" />
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => execCommand('insertUnorderedList')}
                  className="h-8 w-8 p-0"
                  title="Bullet List"
                >
                  <List className="h-4 w-4" />
                </Button>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => execCommand('insertOrderedList')}
                  className="h-8 w-8 p-0"
                  title="Numbered List"
                >
                  <ListOrdered className="h-4 w-4" />
                </Button>
                <div className="w-px h-8 bg-gray-300 dark:bg-gray-600 mx-1" />
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={insertLink}
                  className="h-8 w-8 p-0"
                  title="Insert Link"
                >
                  <LinkIcon className="h-4 w-4" />
                </Button>
                <select
                  onChange={(e) => changeFontSize(e.target.value)}
                  className="h-8 px-2 text-xs border rounded bg-background"
                  title="Font Size"
                >
                  <option value="">Size</option>
                  <option value="1">Small</option>
                  <option value="3">Normal</option>
                  <option value="5">Large</option>
                  <option value="7">X-Large</option>
                </select>
                <input
                  type="color"
                  onChange={(e) => execCommand('foreColor', e.target.value)}
                  className="h-8 w-8 border rounded cursor-pointer"
                  title="Text Color"
                />
              </div>

              {/* Content Editable Area */}
              <div
                ref={editorRef}
                contentEditable
                onInput={handleEditorInput}
                className="min-h-[300px] p-4 focus:outline-none prose prose-sm max-w-none"
                style={{
                  fontSize: '15px',
                  lineHeight: '1.6',
                }}
                suppressContentEditableWarning
              />
            </div>

            {/* Merge Tags */}
            <div className="space-y-2 mt-3">
              <div className="text-xs sm:text-sm font-medium">Quick Insert Merge Tags:</div>
              <div className="flex flex-wrap gap-1.5 sm:gap-2">
                {MERGE_TAGS.map((tag) => (
                  <Badge
                    key={tag.value}
                    variant="secondary"
                    className="cursor-pointer hover:bg-primary hover:text-primary-foreground transition-colors text-xs touch-manipulation"
                    onClick={() => insertMergeTag(tag.value)}
                  >
                    {tag.label}
                  </Badge>
                ))}
              </div>
              <p className="text-xs text-muted-foreground">
                üí° Merge tags like <strong>{'{{firstName}}'}</strong> will be automatically replaced with real data when sent
              </p>
            </div>
          </>
        ) : (
          <Card>
            <CardContent className="pt-6 px-2 sm:px-6">
              {/* Email Preview */}
              <div className="border rounded-lg overflow-hidden">
                {/* Email Header */}
                <div 
                  className="text-white text-center py-4 sm:py-5 px-4 sm:px-6"
                  style={{
                    background: 'linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)'
                  }}
                >
                  <h2 className="text-xl sm:text-2xl font-bold">CDM Suite</h2>
                  <p className="text-sm text-gray-200 mt-1">Your Digital Marketing Partner</p>
                </div>

                {/* Email Body */}
                <div className="bg-white p-6 sm:p-10">
                  {/* Subject as Header */}
                  {subject && (
                    <div className="mb-6 pb-4 border-b">
                      <p className="text-xs sm:text-sm text-muted-foreground mb-1">Subject:</p>
                      <p className="font-semibold text-base sm:text-lg break-words">{subject}</p>
                    </div>
                  )}

                  {/* Content */}
                  <div 
                    className="prose prose-sm max-w-none"
                    style={{
                      color: '#333333',
                      fontSize: '16px',
                      lineHeight: '1.6',
                    }}
                    dangerouslySetInnerHTML={{ __html: content }}
                  />
                </div>

                {/* Email Footer */}
                <div className="bg-gray-50 text-center py-4 px-4 sm:px-6 text-xs text-gray-600">
                  <p className="font-semibold">CDM Suite | Full Service Digital Marketing Agency</p>
                  <p className="mt-1">Data-driven strategies that deliver measurable results</p>
                  <p className="mt-2">
                    <a href="tel:8622727623" className="text-blue-600 mx-2">(862) 272-7623</a> | 
                    <a href="mailto:info@cdmsuite.com" className="text-blue-600 mx-2">info@cdmsuite.com</a>
                  </p>
                  <p className="mt-3 text-[11px]">
                    <a href="#" className="text-gray-600 underline">Unsubscribe</a>
                  </p>
                  <p className="mt-2 text-[11px]">¬© {new Date().getFullYear()} CDM Suite. All rights reserved.</p>
                </div>
              </div>

              <div className="mt-4 p-3 bg-blue-50 dark:bg-blue-950 rounded-md">
                <p className="text-xs sm:text-sm text-blue-900 dark:text-blue-100">
                  üëÅÔ∏è This is exactly how your email will look to clients. 
                  Click "Edit" to make changes.
                </p>
              </div>
            </CardContent>
          </Card>
        )}
      </div>

      {/* Editor Tips */}
      <Card>
        <CardContent className="pt-4 px-4 sm:px-6">
          <div className="text-xs space-y-2">
            <p className="font-semibold mb-2">üìù Email Best Practices:</p>
            <ul className="list-disc list-inside space-y-1 text-muted-foreground">
              <li>Keep subject lines under 60 characters for mobile</li>
              <li>Start with the client's biggest pain point or desire</li>
              <li>Highlight specific benefits and results they'll get</li>
              <li>Include a clear call-to-action (schedule call, review proposal, pay now)</li>
              <li>Mention "no refunds" policy clearly for transparency</li>
              <li>Use formatting (bold, colors) to emphasize key points</li>
            </ul>
          </div>
        </CardContent>
      </Card>

    </div>
  );
}

// ==========================================
// File: components/dashboard/affiliate-client.tsx
// ==========================================


"use client";

import { useEffect, useState } from "react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import {
  Users,
  DollarSign,
  TrendingUp,
  Copy,
  Check,
  Mail,
  Share2,
  Gift,
  ExternalLink,
  Loader2,
  Clock,
  CheckCircle2,
  XCircle,
} from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { format } from "date-fns";

interface AffiliateData {
  affiliateCode: string | null;
  commissionRate: number;
  referredBy: string | null;
  earnings: number;
  stats: {
    totalReferrals: number;
    convertedReferrals: number;
    pendingReferrals: number;
    totalEarnings: number;
    unpaidEarnings: number;
  };
  referrals: Array<{
    id: string;
    email: string;
    status: string;
    tier: string | null;
    commission: number;
    date: Date;
  }>;
}

export function AffiliateClient({ user }: { user: any }) {
  const [data, setData] = useState<AffiliateData | null>(null);
  const [loading, setLoading] = useState(true);
  const [generating, setGenerating] = useState(false);
  const [copied, setCopied] = useState<string | null>(null);
  const { toast } = useToast();

  const baseUrl = typeof window !== 'undefined' ? window.location.origin : 'https://cdmsuite.abacusai.app';

  useEffect(() => {
    fetchAffiliateData();
  }, []);

  const fetchAffiliateData = async () => {
    try {
      const response = await fetch("/api/affiliate");
      if (response.ok) {
        const affiliateData = await response.json();
        setData(affiliateData);
      }
    } catch (error) {
      console.error("Failed to fetch affiliate data:", error);
      toast({
        title: "Error",
        description: "Failed to load affiliate data",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  const generateAffiliateCode = async () => {
    setGenerating(true);
    try {
      const response = await fetch("/api/affiliate/generate-code", {
        method: "POST",
      });
      
      if (response.ok) {
        const result = await response.json();
        toast({
          title: "Success!",
          description: result.isNew 
            ? "Your affiliate code has been generated" 
            : "Your affiliate code is ready",
        });
        await fetchAffiliateData();
      } else {
        throw new Error("Failed to generate code");
      }
    } catch (error) {
      toast({
        title: "Error",
        description: "Failed to generate affiliate code",
        variant: "destructive",
      });
    } finally {
      setGenerating(false);
    }
  };

  const copyToClipboard = async (text: string, type: string) => {
    try {
      await navigator.clipboard.writeText(text);
      setCopied(type);
      toast({
        title: "Copied!",
        description: `${type} copied to clipboard`,
      });
      setTimeout(() => setCopied(null), 2000);
    } catch (error) {
      toast({
        title: "Error",
        description: "Failed to copy to clipboard",
        variant: "destructive",
      });
    }
  };

  const shareViaEmail = () => {
    const subject = encodeURIComponent("Check out CDM Suite - Complete Digital Marketing Platform");
    const body = encodeURIComponent(
      `Hi!\n\nI've been using CDM Suite for my digital marketing needs and thought you might find it useful too.\n\nCDM Suite offers:\n‚Ä¢ AI-powered website builder\n‚Ä¢ Professional marketing services\n‚Ä¢ SEO optimization\n‚Ä¢ Social media management\n‚Ä¢ And much more!\n\nUse my referral link to get started:\n${baseUrl}/auth/signup?ref=${data?.affiliateCode}\n\nBest regards,\n${user.name || 'Your friend'}`
    );
    window.location.href = `mailto:?subject=${subject}&body=${body}`;
  };

  const shareOnSocial = (platform: string) => {
    const url = `${baseUrl}/auth/signup?ref=${data?.affiliateCode}`;
    const text = "Check out CDM Suite - Complete Digital Marketing Platform! üöÄ";
    
    const shareUrls: Record<string, string> = {
      twitter: `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`,
      linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`,
      facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`,
    };

    if (shareUrls[platform]) {
      window.open(shareUrls[platform], '_blank', 'width=600,height=400');
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case "converted":
      case "paid":
        return <CheckCircle2 className="w-4 h-4 text-green-600" />;
      case "pending":
        return <Clock className="w-4 h-4 text-yellow-600" />;
      default:
        return <XCircle className="w-4 h-4 text-gray-400" />;
    }
  };

  const getStatusBadge = (status: string) => {
    const variants: Record<string, any> = {
      converted: "default",
      paid: "default",
      pending: "secondary",
    };
    
    return (
      <Badge variant={variants[status] || "outline"} className="capitalize">
        {status}
      </Badge>
    );
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <Loader2 className="w-8 h-8 animate-spin text-blue-600" />
      </div>
    );
  }

  // No affiliate code yet
  if (!data?.affiliateCode) {
    return (
      <div className="space-y-6">
        <div>
          <h1 className="text-3xl font-bold text-gray-900">Affiliate Program</h1>
          <p className="text-gray-600 mt-1">
            Earn 20% commission on every referral
          </p>
        </div>

        <Card className="border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50">
          <CardHeader className="text-center">
            <div className="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
              <Gift className="w-8 h-8 text-white" />
            </div>
            <CardTitle className="text-2xl">Join Our Affiliate Program</CardTitle>
            <CardDescription className="text-base mt-2">
              Earn 20% recurring commission for every customer you refer to CDM Suite
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="grid md:grid-cols-3 gap-4">
              <div className="text-center p-4 bg-white rounded-lg">
                <Users className="w-8 h-8 text-blue-600 mx-auto mb-2" />
                <h4 className="font-semibold mb-1">Share Your Link</h4>
                <p className="text-sm text-muted-foreground">
                  Get a unique referral link to share
                </p>
              </div>
              <div className="text-center p-4 bg-white rounded-lg">
                <TrendingUp className="w-8 h-8 text-green-600 mx-auto mb-2" />
                <h4 className="font-semibold mb-1">They Subscribe</h4>
                <p className="text-sm text-muted-foreground">
                  Your referrals sign up and subscribe
                </p>
              </div>
              <div className="text-center p-4 bg-white rounded-lg">
                <DollarSign className="w-8 h-8 text-purple-600 mx-auto mb-2" />
                <h4 className="font-semibold mb-1">Earn Commission</h4>
                <p className="text-sm text-muted-foreground">
                  Get 20% of their subscription fee
                </p>
              </div>
            </div>

            <div className="bg-white p-6 rounded-lg space-y-3">
              <h4 className="font-semibold">Program Benefits:</h4>
              <ul className="space-y-2">
                <li className="flex items-start gap-2">
                  <Check className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                  <span className="text-sm">20% recurring commission on all paid plans</span>
                </li>
                <li className="flex items-start gap-2">
                  <Check className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                  <span className="text-sm">Commission on upgrades and renewals</span>
                </li>
                <li className="flex items-start gap-2">
                  <Check className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                  <span className="text-sm">Real-time tracking dashboard</span>
                </li>
                <li className="flex items-start gap-2">
                  <Check className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                  <span className="text-sm">Marketing materials provided</span>
                </li>
                <li className="flex items-start gap-2">
                  <Check className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                  <span className="text-sm">No limit on earnings</span>
                </li>
              </ul>
            </div>

            <Button
              size="lg"
              className="w-full"
              onClick={generateAffiliateCode}
              disabled={generating}
            >
              {generating ? (
                <>
                  <Loader2 className="w-5 h-5 mr-2 animate-spin" />
                  Generating...
                </>
              ) : (
                <>
                  <Gift className="w-5 h-5 mr-2" />
                  Get My Affiliate Code
                </>
              )}
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  const referralUrl = `${baseUrl}/auth/signup?ref=${data.affiliateCode}`;
  const commissionPercentage = (data.commissionRate * 100).toFixed(0);

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl sm:text-3xl font-bold text-gray-900">Affiliate Program</h1>
        <p className="text-sm sm:text-base text-gray-600 mt-1">
          Earn {commissionPercentage}% commission on every referral
        </p>
      </div>

      {/* Stats Overview */}
      <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6">
        <Card>
          <CardHeader className="pb-2">
            <CardDescription>Total Referrals</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-between">
              <div className="text-3xl font-bold">{data.stats.totalReferrals}</div>
              <Users className="w-10 h-10 text-blue-600 opacity-20" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardDescription>Converted</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-between">
              <div className="text-3xl font-bold text-green-600">
                {data.stats.convertedReferrals}
              </div>
              <CheckCircle2 className="w-10 h-10 text-green-600 opacity-20" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardDescription>Total Earnings</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-between">
              <div className="text-3xl font-bold text-purple-600">
                ${data.stats.totalEarnings.toFixed(2)}
              </div>
              <DollarSign className="w-10 h-10 text-purple-600 opacity-20" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardDescription>Pending Payout</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center justify-between">
              <div className="text-3xl font-bold text-orange-600">
                ${data.stats.unpaidEarnings.toFixed(2)}
              </div>
              <Clock className="w-10 h-10 text-orange-600 opacity-20" />
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Referral Link */}
      <Card>
        <CardHeader>
          <CardTitle>Your Referral Link</CardTitle>
          <CardDescription>
            Share this link to earn {commissionPercentage}% commission on every subscription
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {/* Affiliate Code */}
          <div>
            <label className="text-sm font-medium text-gray-700 mb-2 block">
              Affiliate Code
            </label>
            <div className="flex gap-2">
              <Input
                value={data.affiliateCode}
                readOnly
                className="font-mono font-bold text-lg"
              />
              <Button
                variant="outline"
                onClick={() => copyToClipboard(data.affiliateCode!, "Code")}
              >
                {copied === "Code" ? (
                  <Check className="w-4 h-4" />
                ) : (
                  <Copy className="w-4 h-4" />
                )}
              </Button>
            </div>
          </div>

          {/* Referral URL */}
          <div>
            <label className="text-sm font-medium text-gray-700 mb-2 block">
              Referral URL
            </label>
            <div className="flex gap-2">
              <Input value={referralUrl} readOnly className="font-mono" />
              <Button
                variant="outline"
                onClick={() => copyToClipboard(referralUrl, "Link")}
              >
                {copied === "Link" ? (
                  <Check className="w-4 h-4" />
                ) : (
                  <Copy className="w-4 h-4" />
                )}
              </Button>
            </div>
          </div>

          {/* Share Buttons */}
          <div>
            <label className="text-sm font-medium text-gray-700 mb-2 block">
              Share Your Link
            </label>
            <div className="flex flex-wrap gap-2">
              <Button variant="outline" onClick={shareViaEmail}>
                <Mail className="w-4 h-4 mr-2" />
                Email
              </Button>
              <Button variant="outline" onClick={() => shareOnSocial('twitter')}>
                <Share2 className="w-4 h-4 mr-2" />
                Twitter
              </Button>
              <Button variant="outline" onClick={() => shareOnSocial('linkedin')}>
                <Share2 className="w-4 h-4 mr-2" />
                LinkedIn
              </Button>
              <Button variant="outline" onClick={() => shareOnSocial('facebook')}>
                <Share2 className="w-4 h-4 mr-2" />
                Facebook
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Referral History */}
      <Card>
        <CardHeader>
          <CardTitle>Referral History</CardTitle>
          <CardDescription>
            Track your referrals and their status
          </CardDescription>
        </CardHeader>
        <CardContent>
          {data.referrals.length > 0 ? (
            <div className="space-y-3">
              {data.referrals.map((referral) => (
                <div
                  key={referral.id}
                  className="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition"
                >
                  <div className="flex items-center gap-3 flex-1">
                    {getStatusIcon(referral.status)}
                    <div>
                      <p className="font-medium">{referral.email}</p>
                      <p className="text-sm text-muted-foreground">
                        {format(new Date(referral.date), "MMM dd, yyyy")}
                      </p>
                    </div>
                  </div>
                  <div className="flex items-center gap-4">
                    {referral.tier && (
                      <Badge variant="outline" className="capitalize">
                        {referral.tier}
                      </Badge>
                    )}
                    {getStatusBadge(referral.status)}
                    {referral.commission > 0 && (
                      <div className="text-right min-w-[80px]">
                        <p className="font-bold text-green-600">
                          ${referral.commission.toFixed(2)}
                        </p>
                      </div>
                    )}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center py-12">
              <Users className="w-12 h-12 text-gray-400 mx-auto mb-4" />
              <p className="text-muted-foreground mb-4">
                No referrals yet. Start sharing your link to earn commissions!
              </p>
              <Button onClick={() => copyToClipboard(referralUrl, "Link")}>
                <Copy className="w-4 h-4 mr-2" />
                Copy Referral Link
              </Button>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Commission Info */}
      <Card className="bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200">
        <CardHeader>
          <CardTitle>How It Works</CardTitle>
        </CardHeader>
        <CardContent className="space-y-3">
          <div className="flex items-start gap-3">
            <div className="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">
              1
            </div>
            <div>
              <h4 className="font-semibold">Share Your Link</h4>
              <p className="text-sm text-muted-foreground">
                Share your unique referral link via email, social media, or your website
              </p>
            </div>
          </div>
          <div className="flex items-start gap-3">
            <div className="w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">
              2
            </div>
            <div>
              <h4 className="font-semibold">They Subscribe</h4>
              <p className="text-sm text-muted-foreground">
                When someone signs up using your link and subscribes to a paid plan
              </p>
            </div>
          </div>
          <div className="flex items-start gap-3">
            <div className="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">
              3
            </div>
            <div>
              <h4 className="font-semibold">Earn Commission</h4>
              <p className="text-sm text-muted-foreground">
                You earn {commissionPercentage}% of their subscription fee, including renewals and upgrades
              </p>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/dashboard/affiliate-dashboard.tsx
// ==========================================



"use client";

import { useState, useEffect } from "react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Alert, AlertDescription } from "@/components/ui/alert";
import {
  Users,
  DollarSign,
  Link as LinkIcon,
  Copy,
  CheckCircle2,
  TrendingUp,
  Clock,
  Share2,
  Mail,
} from "lucide-react";
import { toast } from "react-hot-toast";

interface AffiliateData {
  affiliateCode: string | null;
  commissionRate: number;
  earnings: number;
  stats: {
    totalReferrals: number;
    convertedReferrals: number;
    pendingReferrals: number;
    unpaidEarnings: number;
  };
  referrals: Array<{
    id: string;
    email: string;
    status: string;
    tier: string | null;
    commission: number;
    date: string;
  }>;
}

export function AffiliateDashboard() {
  const [data, setData] = useState<AffiliateData | null>(null);
  const [loading, setLoading] = useState(true);
  const [generating, setGenerating] = useState(false);
  const [copied, setCopied] = useState(false);

  useEffect(() => {
    fetchAffiliateData();
  }, []);

  async function fetchAffiliateData() {
    try {
      const response = await fetch("/api/affiliate");
      if (response.ok) {
        const data = await response.json();
        setData(data);
      }
    } catch (error) {
      console.error("Failed to fetch affiliate data:", error);
    } finally {
      setLoading(false);
    }
  }

  async function generateAffiliateCode() {
    setGenerating(true);
    try {
      const response = await fetch("/api/affiliate/generate-code", {
        method: "POST",
      });
      if (response.ok) {
        const result = await response.json();
        toast.success(
          result.isNew
            ? "Affiliate code generated!"
            : "Your affiliate code is ready"
        );
        await fetchAffiliateData();
      } else {
        toast.error("Failed to generate affiliate code");
      }
    } catch (error) {
      toast.error("Failed to generate affiliate code");
    } finally {
      setGenerating(false);
    }
  }

  function copyAffiliateLink() {
    if (!data?.affiliateCode) return;
    
    const affiliateLink = `${window.location.origin}/auth/signup?ref=${data.affiliateCode}`;
    navigator.clipboard.writeText(affiliateLink);
    setCopied(true);
    toast.success("Affiliate link copied to clipboard!");
    setTimeout(() => setCopied(false), 2000);
  }

  function shareViaEmail() {
    if (!data?.affiliateCode) return;
    
    const affiliateLink = `${window.location.origin}/auth/signup?ref=${data.affiliateCode}`;
    const subject = "Build Your Website with CDM Suite";
    const body = `I've been using CDM Suite to build professional websites with AI, and I think you'd love it!\n\nSign up using my link and get started: ${affiliateLink}\n\nYou'll get access to powerful marketing tools and AI-powered website builder.`;
    
    window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  }

  if (loading) {
    return (
      <Card>
        <CardHeader>
          <CardTitle>Affiliate Program</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-center py-8 text-gray-500">Loading...</div>
        </CardContent>
      </Card>
    );
  }

  if (!data?.affiliateCode) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Share2 className="w-5 h-5" />
            Join Our Affiliate Program
          </CardTitle>
          <CardDescription>
            Earn {data?.commissionRate ? `${(data.commissionRate * 100).toFixed(0)}%` : "20%"} commission on every referral
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Alert className="mb-4">
            <TrendingUp className="h-4 w-4" />
            <AlertDescription>
              Share CDM Suite with your network and earn money for every paid subscription.
              Get your unique referral link to start earning!
            </AlertDescription>
          </Alert>

          <div className="space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="text-center p-4 bg-blue-50 rounded-lg">
                <div className="text-2xl font-bold text-blue-600">20%</div>
                <div className="text-sm text-gray-600">Commission Rate</div>
              </div>
              <div className="text-center p-4 bg-green-50 rounded-lg">
                <div className="text-2xl font-bold text-green-600">$49-249</div>
                <div className="text-sm text-gray-600">Per Referral</div>
              </div>
              <div className="text-center p-4 bg-purple-50 rounded-lg">
                <div className="text-2xl font-bold text-purple-600">‚àû</div>
                <div className="text-sm text-gray-600">Unlimited Earnings</div>
              </div>
            </div>

            <Button
              onClick={generateAffiliateCode}
              disabled={generating}
              className="w-full"
              size="lg"
            >
              {generating ? "Generating..." : "Get My Affiliate Link"}
            </Button>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <div className="space-y-6">
      {/* Stats Overview */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Total Earnings
            </CardTitle>
            <DollarSign className="w-4 h-4 text-green-500" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">${data.earnings.toFixed(2)}</div>
            <p className="text-xs text-gray-500 mt-1">All-time earnings</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Total Referrals
            </CardTitle>
            <Users className="w-4 h-4 text-blue-500" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{data.stats.totalReferrals}</div>
            <p className="text-xs text-gray-500 mt-1">People referred</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Converted
            </CardTitle>
            <CheckCircle2 className="w-4 h-4 text-purple-500" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{data.stats.convertedReferrals}</div>
            <p className="text-xs text-gray-500 mt-1">Paid customers</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Pending
            </CardTitle>
            <Clock className="w-4 h-4 text-orange-500" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">${data.stats.unpaidEarnings.toFixed(2)}</div>
            <p className="text-xs text-gray-500 mt-1">Unpaid earnings</p>
          </CardContent>
        </Card>
      </div>

      {/* Affiliate Link */}
      <Card>
        <CardHeader>
          <CardTitle>Your Affiliate Link</CardTitle>
          <CardDescription>
            Share this link to earn {(data.commissionRate * 100).toFixed(0)}% commission on referrals
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex gap-2">
            <div className="flex-1 p-3 bg-gray-50 rounded-lg border font-mono text-sm overflow-x-auto">
              {window.location.origin}/auth/signup?ref={data.affiliateCode}
            </div>
            <Button
              onClick={copyAffiliateLink}
              variant="outline"
              className="flex-shrink-0"
            >
              {copied ? (
                <CheckCircle2 className="h-4 w-4" />
              ) : (
                <Copy className="h-4 w-4" />
              )}
            </Button>
          </div>

          <div className="flex gap-2">
            <Button onClick={shareViaEmail} variant="outline" className="flex-1">
              <Mail className="mr-2 h-4 w-4" />
              Share via Email
            </Button>
            <Button
              onClick={() => {
                const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(
                  `Build professional websites with AI! Sign up for CDM Suite using my link: ${window.location.origin}/auth/signup?ref=${data.affiliateCode}`
                )}`;
                window.open(url, "_blank");
              }}
              variant="outline"
              className="flex-1"
            >
              <Share2 className="mr-2 h-4 w-4" />
              Share on X
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Referrals List */}
      <Card>
        <CardHeader>
          <CardTitle>Recent Referrals</CardTitle>
          <CardDescription>
            Track your referrals and earnings
          </CardDescription>
        </CardHeader>
        <CardContent>
          {data.referrals.length === 0 ? (
            <div className="text-center py-8 text-gray-500">
              No referrals yet. Start sharing your affiliate link!
            </div>
          ) : (
            <div className="space-y-4">
              {data.referrals.map((referral) => (
                <div
                  key={referral.id}
                  className="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors"
                >
                  <div className="flex-1">
                    <div className="font-medium">{referral.email}</div>
                    <div className="text-sm text-gray-500">
                      {new Date(referral.date).toLocaleDateString()}
                    </div>
                  </div>
                  <div className="flex items-center gap-4">
                    {referral.tier && (
                      <Badge variant="outline" className="capitalize">
                        {referral.tier}
                      </Badge>
                    )}
                    <Badge
                      variant={
                        referral.status === "converted" || referral.status === "paid"
                          ? "default"
                          : "secondary"
                      }
                    >
                      {referral.status}
                    </Badge>
                    <div className="font-bold text-green-600 min-w-[80px] text-right">
                      ${referral.commission.toFixed(2)}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/dashboard/analytics-dashboard-client.tsx
// ==========================================



'use client';

import { useEffect, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Badge } from '@/components/ui/badge';
import {
  BarChart3,
  TrendingUp,
  Users,
  Globe,
  ArrowUp,
  ArrowDown,
  ExternalLink,
  RefreshCw,
  MousePointerClick,
  Eye,
  Clock,
  UserCheck,
} from 'lucide-react';
import { toast } from 'sonner';

interface AnalyticsData {
  visits: number;
  uniqueVisitors: number;
  pageViews: number;
  avgSessionDuration: number;
  bounceRate: number;
  conversions: number;
  conversionRate: number;
  topPages: Array<{ path: string; views: number }>;
  deviceBreakdown: { desktop: number; mobile: number; tablet: number };
  trafficSources: Array<{ source: string; visits: number }>;
  recentActivity: Array<{ event: string; timestamp: string; page: string }>;
}

export function AnalyticsDashboardClient() {
  const [loading, setLoading] = useState(true);
  const [refreshing, setRefreshing] = useState(false);
  const [analyticsData, setAnalyticsData] = useState<AnalyticsData>({
    visits: 0,
    uniqueVisitors: 0,
    pageViews: 0,
    avgSessionDuration: 0,
    bounceRate: 0,
    conversions: 0,
    conversionRate: 0,
    topPages: [],
    deviceBreakdown: { desktop: 0, mobile: 0, tablet: 0 },
    trafficSources: [],
    recentActivity: [],
  });
  const [dateRange, setDateRange] = useState<'7d' | '30d' | '90d'>('30d');

  useEffect(() => {
    fetchAnalytics();
  }, [dateRange]);

  const fetchAnalytics = async () => {
    try {
      setLoading(true);
      const res = await fetch(`/api/analytics/dashboard?range=${dateRange}`);
      if (res.ok) {
        const data = await res.json();
        setAnalyticsData(data);
      } else {
        toast.error('Failed to load analytics data');
      }
    } catch (error) {
      console.error('Error fetching analytics:', error);
      toast.error('Failed to load analytics data');
    } finally {
      setLoading(false);
      setRefreshing(false);
    }
  };

  const handleRefresh = () => {
    setRefreshing(true);
    fetchAnalytics();
  };

  const formatDuration = (seconds: number) => {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes}m ${remainingSeconds}s`;
  };

  const formatNumber = (num: number) => {
    if (num >= 1000000) {
      return `${(num / 1000000).toFixed(1)}M`;
    }
    if (num >= 1000) {
      return `${(num / 1000).toFixed(1)}K`;
    }
    return num.toLocaleString();
  };

  if (loading) {
    return (
      <div className="space-y-6">
        <div className="animate-pulse space-y-4">
          <div className="h-8 bg-gray-200 rounded w-1/4"></div>
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
            {[1, 2, 3, 4].map((i) => (
              <div key={i} className="h-32 bg-gray-200 rounded"></div>
            ))}
          </div>
          <div className="h-64 bg-gray-200 rounded"></div>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header with Actions */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 className="text-2xl sm:text-3xl font-bold text-gray-900">Analytics Dashboard</h1>
          <p className="text-sm sm:text-base text-gray-600 mt-1">
            Track CDM Suite performance and insights
          </p>
        </div>
        <div className="flex items-center gap-3">
          <Button
            variant="outline"
            size="sm"
            onClick={handleRefresh}
            disabled={refreshing}
          >
            <RefreshCw className={`h-4 w-4 mr-2 ${refreshing ? 'animate-spin' : ''}`} />
            Refresh
          </Button>
          <div className="flex gap-1 border rounded-lg p-1">
            <Button
              variant={dateRange === '7d' ? 'secondary' : 'ghost'}
              size="sm"
              onClick={() => setDateRange('7d')}
              className="text-xs"
            >
              7D
            </Button>
            <Button
              variant={dateRange === '30d' ? 'secondary' : 'ghost'}
              size="sm"
              onClick={() => setDateRange('30d')}
              className="text-xs"
            >
              30D
            </Button>
            <Button
              variant={dateRange === '90d' ? 'secondary' : 'ghost'}
              size="sm"
              onClick={() => setDateRange('90d')}
              className="text-xs"
            >
              90D
            </Button>
          </div>
        </div>
      </div>

      {/* Quick Links to Analytics Platforms */}
      <Card>
        <CardHeader className="pb-3">
          <CardTitle className="text-base">Analytics Platforms</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex flex-wrap gap-2">
            <Button variant="outline" size="sm" asChild>
              <a
                href="https://analytics.google.com/analytics/web/#/p466166639/reports/intelligenthome"
                target="_blank"
                rel="noopener noreferrer"
              >
                <BarChart3 className="h-4 w-4 mr-2" />
                Google Analytics
                <ExternalLink className="h-3 w-3 ml-2" />
              </a>
            </Button>
            <Button variant="outline" size="sm" asChild>
              <a
                href="https://us.posthog.com/project/90964"
                target="_blank"
                rel="noopener noreferrer"
              >
                <TrendingUp className="h-4 w-4 mr-2" />
                PostHog
                <ExternalLink className="h-3 w-3 ml-2" />
              </a>
            </Button>
            <Button variant="outline" size="sm" asChild>
              <a
                href="https://clarity.microsoft.com/projects/view/tp19j9wv7x/dashboard"
                target="_blank"
                rel="noopener noreferrer"
              >
                <Eye className="h-4 w-4 mr-2" />
                Microsoft Clarity
                <ExternalLink className="h-3 w-3 ml-2" />
              </a>
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Key Metrics */}
      <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6">
        <Card>
          <CardHeader className="pb-2">
            <CardDescription className="flex items-center gap-2">
              <Globe className="h-4 w-4" />
              Total Visits
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold">{formatNumber(analyticsData.visits)}</div>
            <div className="flex items-center gap-1 text-sm text-green-600 mt-1">
              <ArrowUp className="w-4 h-4" />
              <span>vs previous period</span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardDescription className="flex items-center gap-2">
              <Users className="h-4 w-4" />
              Unique Visitors
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold">{formatNumber(analyticsData.uniqueVisitors)}</div>
            <div className="flex items-center gap-1 text-sm text-green-600 mt-1">
              <ArrowUp className="w-4 h-4" />
              <span>vs previous period</span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardDescription className="flex items-center gap-2">
              <MousePointerClick className="h-4 w-4" />
              Conversions
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold">{formatNumber(analyticsData.conversions)}</div>
            <div className="flex items-center gap-1 text-sm text-green-600 mt-1">
              <ArrowUp className="w-4 h-4" />
              <span>{analyticsData.conversionRate.toFixed(1)}% rate</span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardDescription className="flex items-center gap-2">
              <Clock className="h-4 w-4" />
              Avg. Session
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold">{formatDuration(analyticsData.avgSessionDuration)}</div>
            <div className="flex items-center gap-1 text-sm text-muted-foreground mt-1">
              <span>{analyticsData.bounceRate.toFixed(1)}% bounce rate</span>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Detailed Analytics Tabs */}
      <Tabs defaultValue="overview" className="space-y-4">
        <TabsList>
          <TabsTrigger value="overview">Overview</TabsTrigger>
          <TabsTrigger value="pages">Top Pages</TabsTrigger>
          <TabsTrigger value="traffic">Traffic Sources</TabsTrigger>
          <TabsTrigger value="devices">Devices</TabsTrigger>
        </TabsList>

        <TabsContent value="overview" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>CDM Suite Performance Summary</CardTitle>
              <CardDescription>
                Real-time analytics for cdmsuite.com tracked across Google Analytics, PostHog, and Microsoft Clarity
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              <div className="grid gap-4 md:grid-cols-2">
                <div className="space-y-2">
                  <h4 className="text-sm font-semibold">Page Views</h4>
                  <div className="text-2xl font-bold">{formatNumber(analyticsData.pageViews)}</div>
                  <p className="text-xs text-muted-foreground">
                    Total pages viewed in the selected period
                  </p>
                </div>
                <div className="space-y-2">
                  <h4 className="text-sm font-semibold">Engagement Rate</h4>
                  <div className="text-2xl font-bold">
                    {(100 - analyticsData.bounceRate).toFixed(1)}%
                  </div>
                  <p className="text-xs text-muted-foreground">
                    Users engaging with multiple pages
                  </p>
                </div>
              </div>

              <div className="pt-4 border-t">
                <h4 className="text-sm font-semibold mb-3">Recent Activity</h4>
                <div className="space-y-2">
                  {analyticsData.recentActivity.length > 0 ? (
                    analyticsData.recentActivity.slice(0, 5).map((activity, index) => (
                      <div key={index} className="flex items-start justify-between text-sm p-2 rounded-lg hover:bg-muted">
                        <div className="flex-1 min-w-0">
                          <p className="font-medium truncate">{activity.event}</p>
                          <p className="text-xs text-muted-foreground truncate">{activity.page}</p>
                        </div>
                        <span className="text-xs text-muted-foreground flex-shrink-0 ml-2">
                          {new Date(activity.timestamp).toLocaleTimeString()}
                        </span>
                      </div>
                    ))
                  ) : (
                    <p className="text-sm text-muted-foreground">No recent activity data available</p>
                  )}
                </div>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="pages" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Top Performing Pages</CardTitle>
              <CardDescription>Most visited pages on cdmsuite.com</CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {analyticsData.topPages.length > 0 ? (
                  analyticsData.topPages.map((page, index) => (
                    <div key={index} className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex-1 min-w-0">
                        <p className="font-medium truncate">{page.path}</p>
                      </div>
                      <Badge variant="secondary">{formatNumber(page.views)} views</Badge>
                    </div>
                  ))
                ) : (
                  <p className="text-sm text-muted-foreground text-center py-8">
                    No page data available yet
                  </p>
                )}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="traffic" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Traffic Sources</CardTitle>
              <CardDescription>Where your visitors are coming from</CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {analyticsData.trafficSources.length > 0 ? (
                  analyticsData.trafficSources.map((source, index) => (
                    <div key={index} className="flex items-center justify-between p-3 border rounded-lg">
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center">
                          <Globe className="h-5 w-5 text-primary" />
                        </div>
                        <div>
                          <p className="font-medium capitalize">{source.source}</p>
                        </div>
                      </div>
                      <Badge variant="secondary">{formatNumber(source.visits)} visits</Badge>
                    </div>
                  ))
                ) : (
                  <p className="text-sm text-muted-foreground text-center py-8">
                    No traffic source data available yet
                  </p>
                )}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="devices" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Device Breakdown</CardTitle>
              <CardDescription>Visitor device types</CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                <div className="flex items-center justify-between p-3 border rounded-lg">
                  <div className="flex items-center gap-3">
                    <div className="text-2xl">üíª</div>
                    <span className="font-medium">Desktop</span>
                  </div>
                  <Badge variant="secondary">{analyticsData.deviceBreakdown.desktop}%</Badge>
                </div>
                <div className="flex items-center justify-between p-3 border rounded-lg">
                  <div className="flex items-center gap-3">
                    <div className="text-2xl">üì±</div>
                    <span className="font-medium">Mobile</span>
                  </div>
                  <Badge variant="secondary">{analyticsData.deviceBreakdown.mobile}%</Badge>
                </div>
                <div className="flex items-center justify-between p-3 border rounded-lg">
                  <div className="flex items-center gap-3">
                    <div className="text-2xl">üì±</div>
                    <span className="font-medium">Tablet</span>
                  </div>
                  <Badge variant="secondary">{analyticsData.deviceBreakdown.tablet}%</Badge>
                </div>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>

      {/* Info Banner */}
      <Card className="bg-blue-50 border-blue-200">
        <CardContent className="pt-6">
          <div className="flex items-start gap-3">
            <BarChart3 className="h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5" />
            <div>
              <h4 className="font-semibold text-blue-900">Live Analytics Integration</h4>
              <p className="text-sm text-blue-700 mt-1">
                This dashboard aggregates data from Google Analytics, PostHog, and Microsoft Clarity. 
                Click the platform buttons above to access detailed analytics and advanced features.
              </p>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}


// ==========================================
// File: components/dashboard/credits-card.tsx
// ==========================================



"use client";

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Coins, Plus, TrendingUp } from "lucide-react";
import Link from "next/link";

interface CreditsCardProps {
  credits: number;
  tier: string;
}

export function CreditsCard({ credits, tier }: CreditsCardProps) {
  const tierLimits: Record<string, number> = {
    free: 1,
    starter: 5,
    growth: 20,
    pro: 50,
    enterprise: 999,
  };

  const maxCredits = tierLimits[tier] || 1;
  const percentageUsed = Math.min((credits / maxCredits) * 100, 100);
  const needsUpgrade = credits === 0;

  return (
    <Card className={needsUpgrade ? "border-orange-300 bg-orange-50" : ""}>
      <CardHeader className="flex flex-row items-center justify-between pb-2">
        <div>
          <CardTitle className="text-sm font-medium text-gray-600">
            Project Credits
          </CardTitle>
          <CardDescription className="text-xs">
            Use credits to create websites
          </CardDescription>
        </div>
        <Coins className={`w-5 h-5 ${needsUpgrade ? "text-orange-500" : "text-blue-500"}`} />
      </CardHeader>
      <CardContent>
        <div className="flex items-baseline gap-2 mb-2">
          <span className="text-3xl font-bold">{credits}</span>
          <span className="text-sm text-gray-500">/ {maxCredits}</span>
        </div>

        {/* Progress bar */}
        <div className="w-full bg-gray-200 rounded-full h-2 mb-3">
          <div
            className={`h-2 rounded-full transition-all ${
              percentageUsed < 20 ? "bg-orange-500" : 
              percentageUsed < 50 ? "bg-yellow-500" : 
              "bg-blue-500"
            }`}
            style={{ width: `${percentageUsed}%` }}
          />
        </div>

        {needsUpgrade ? (
          <Button asChild size="sm" className="w-full" variant="outline">
            <Link href="/dashboard/billing">
              <Plus className="mr-2 h-4 w-4" />
              Get More Credits
            </Link>
          </Button>
        ) : (
          <p className="text-xs text-gray-500">
            Each website creation uses 1 credit
          </p>
        )}
      </CardContent>
    </Card>
  );
}

// ==========================================
// File: components/dashboard/dashboard-layout.tsx
// ==========================================


"use client";

import { useState } from "react";
import Link from "next/link";
import { usePathname } from "next/navigation";
import { signOut } from "next-auth/react";
import {
  LayoutDashboard,
  FolderKanban,
  BarChart3,
  Zap,
  CreditCard,
  Settings,
  HelpCircle,
  LogOut,
  Menu,
  X,
  Crown,
  Rocket,
  Users,
  ShoppingBag,
  Search,
  GitBranch,
  FileText,
  ClipboardList,
  FileEdit,
  FileImage,
  User,
  ChevronDown,
  Bot,
  Briefcase,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { cn } from "@/lib/utils";
import { getTierConfig } from "@/lib/tier-config";
import { AIAssistantButton } from "@/components/assistant/ai-assistant-button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";

interface DashboardLayoutProps {
  user: any;
  children: React.ReactNode;
}

export function DashboardLayout({ user, children }: DashboardLayoutProps) {
  const pathname = usePathname();
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const userTier = user?.tier || "free";
  const tierConfig = getTierConfig(userTier);

  const isEmployee = user?.role?.toUpperCase() === "ADMIN" || user?.role?.toUpperCase() === "EMPLOYEE";

  const workManagementNav = [
    {
      name: "Dashboard",
      href: "/dashboard",
      icon: LayoutDashboard,
      enabled: true,
      badge: null as string | null,
    },
    {
      name: "Lead CRM",
      href: "/dashboard/crm",
      icon: Users,
      enabled: isEmployee,
      badge: null as string | null,
    },
    {
      name: "Proposals",
      href: "/dashboard/proposals",
      icon: FileText,
      enabled: isEmployee,
      badge: null as string | null,
    },
    {
      name: "Bid Proposals",
      href: "/dashboard/bid-proposals",
      icon: Briefcase,
      enabled: isEmployee,
      badge: null as string | null,
    },
    {
      name: "Sequences",
      href: "/dashboard/crm/sequences",
      icon: GitBranch,
      enabled: isEmployee,
      badge: null as string | null,
    },
    {
      name: "Workflows",
      href: "/dashboard/workflows",
      icon: ClipboardList,
      enabled: true,
      badge: null as string | null,
    },
    {
      name: "Team Workload",
      href: "/dashboard/team",
      icon: Users,
      enabled: isEmployee,
      badge: null as string | null,
    },
    {
      name: "Website Audits",
      href: "/dashboard/audits",
      icon: Search,
      enabled: true,
      badge: null as string | null,
    },
    {
      name: "Page Builder",
      href: "/dashboard/pages",
      icon: FileEdit,
      enabled: user?.role === 'admin',
      badge: null as string | null,
    },
    {
      name: "Content Manager",
      href: "/dashboard/content/case-studies",
      icon: FileImage,
      enabled: isEmployee,
      badge: null as string | null,
    },
  ];

  const serviceFulfillmentNav = [
    {
      name: "My Services",
      href: "/dashboard/my-services",
      icon: ShoppingBag,
      enabled: !isEmployee, // Only show for clients
      badge: null,
    },
    {
      name: "Self-Service Tools",
      href: "/dashboard/self-service",
      icon: Zap,
      enabled: !isEmployee, // Only show for clients
      badge: null,
    },
    {
      name: "Projects",
      href: "/dashboard/projects",
      icon: FolderKanban,
      enabled: userTier !== "free",
      badge: userTier === "free" ? "Upgrade" : null,
    },
    {
      name: "Services",
      href: "/dashboard/services",
      icon: ShoppingBag,
      enabled: isEmployee, // Only show for employees
      badge: null,
    },
    {
      name: "AI Website Builder",
      href: "/dashboard/builder",
      icon: Zap,
      enabled: tierConfig.limits.builderAccess,
      badge: !tierConfig.limits.builderAccess ? "Upgrade" : null,
    },
    {
      name: "AI Agent Builder",
      href: "/dashboard/ai-agents",
      icon: Bot,
      enabled: tierConfig.limits.builderAccess,
      badge: !tierConfig.limits.builderAccess ? "Upgrade" : null,
    },
    {
      name: "Analytics",
      href: "/dashboard/analytics",
      icon: BarChart3,
      enabled: tierConfig.limits.analyticsAccess,
      badge: !tierConfig.limits.analyticsAccess ? "Upgrade" : null,
    },
  ];

  const accountNav = [
    {
      name: "Affiliate",
      href: "/dashboard/affiliate",
      icon: Users,
      enabled: true,
      badge: null as string | null,
    },
    {
      name: "Billing",
      href: "/dashboard/billing",
      icon: CreditCard,
      enabled: true,
      badge: null as string | null,
    },
    {
      name: "Settings",
      href: "/dashboard/settings",
      icon: Settings,
      enabled: true,
      badge: null as string | null,
    },
  ];

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Mobile sidebar backdrop */}
      {sidebarOpen && (
        <div
          className="fixed inset-0 bg-black/50 z-40 lg:hidden"
          onClick={() => setSidebarOpen(false)}
        />
      )}

      {/* Sidebar */}
      <aside
        className={cn(
          "fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 transform transition-transform duration-300 lg:translate-x-0",
          sidebarOpen ? "translate-x-0" : "-translate-x-full"
        )}
      >
        <div className="flex flex-col h-full">
          {/* Logo */}
          <div className="flex items-center justify-between h-16 px-6 border-b border-gray-200">
            <Link href="/" className="flex items-center gap-2">
              <div className="w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg" />
              <span className="font-bold text-xl">CDM Suite</span>
            </Link>
            <button
              onClick={() => setSidebarOpen(false)}
              className="lg:hidden"
            >
              <X className="w-5 h-5" />
            </button>
          </div>

          {/* Tier badge */}
          <div className="px-6 py-4 border-b border-gray-200">
            <div className="flex items-center gap-2 text-sm">
              <div
                className={cn(
                  "px-3 py-1 rounded-full font-medium flex items-center gap-1",
                  userTier === "free" && "bg-gray-100 text-gray-700",
                  userTier === "starter" && "bg-blue-100 text-blue-700",
                  (userTier === "growth" ||
                    userTier === "pro" ||
                    userTier === "enterprise") &&
                    "bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700"
                )}
              >
                {(userTier === "pro" || userTier === "enterprise") && (
                  <Crown className="w-3 h-3" />
                )}
                {tierConfig.name}
              </div>
            </div>
            {userTier === "free" && (
              <Button
                size="sm"
                className="w-full mt-3"
                asChild
              >
                <Link href="/dashboard/billing">
                  <Rocket className="w-4 h-4 mr-2" />
                  Upgrade Now
                </Link>
              </Button>
            )}
          </div>

          {/* Navigation */}
          <nav className="flex-1 px-4 py-4 space-y-6 overflow-y-auto">
            {/* Work Management Section */}
            {isEmployee && (
              <div className="space-y-1">
                <div className="px-3 mb-2">
                  <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wider">
                    Work Management
                  </h3>
                </div>
                {workManagementNav.map((item) => {
                  const Icon = item.icon;
                  const isActive = pathname === item.href;
                  const isDisabled = !item.enabled;

                  return (
                    <Link
                      key={item.name}
                      href={isDisabled ? "#" : item.href}
                      onClick={(e) => {
                        if (isDisabled) {
                          e.preventDefault();
                        }
                        setSidebarOpen(false);
                      }}
                      className={cn(
                        "flex items-center justify-between gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors",
                        isActive && "bg-blue-50 text-blue-700",
                        !isActive && !isDisabled && "text-gray-700 hover:bg-gray-50",
                        isDisabled && "text-gray-400 cursor-not-allowed opacity-60"
                      )}
                    >
                      <div className="flex items-center gap-3">
                        <Icon className="w-5 h-5" />
                        {item.name}
                      </div>
                      {item.badge && (
                        <span className="px-2 py-0.5 text-xs font-medium bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full">
                          {item.badge}
                        </span>
                      )}
                    </Link>
                  );
                })}
              </div>
            )}

            {/* Non-employee navigation (no sections) */}
            {!isEmployee && (
              <div className="space-y-1">
                {workManagementNav
                  .filter((item) => item.enabled)
                  .map((item) => {
                    const Icon = item.icon;
                    const isActive = pathname === item.href;

                    return (
                      <Link
                        key={item.name}
                        href={item.href}
                        onClick={() => setSidebarOpen(false)}
                        className={cn(
                          "flex items-center justify-between gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors",
                          isActive && "bg-blue-50 text-blue-700",
                          !isActive && "text-gray-700 hover:bg-gray-50"
                        )}
                      >
                        <div className="flex items-center gap-3">
                          <Icon className="w-5 h-5" />
                          {item.name}
                        </div>
                      </Link>
                    );
                  })}
              </div>
            )}

            {/* Service Fulfillment Section */}
            <div className="space-y-1">
              {isEmployee && (
                <div className="px-3 mb-2">
                  <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wider">
                    Service Fulfillment
                  </h3>
                </div>
              )}
              {serviceFulfillmentNav.map((item) => {
                const Icon = item.icon;
                const isActive = pathname === item.href;
                const isDisabled = !item.enabled;

                return (
                  <Link
                    key={item.name}
                    href={isDisabled ? "#" : item.href}
                    onClick={(e) => {
                      if (isDisabled) {
                        e.preventDefault();
                      }
                      setSidebarOpen(false);
                    }}
                    className={cn(
                      "flex items-center justify-between gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors",
                      isActive && "bg-blue-50 text-blue-700",
                      !isActive && !isDisabled && "text-gray-700 hover:bg-gray-50",
                      isDisabled && "text-gray-400 cursor-not-allowed opacity-60"
                    )}
                  >
                    <div className="flex items-center gap-3">
                      <Icon className="w-5 h-5" />
                      {item.name}
                    </div>
                    {item.badge && (
                      <span className="px-2 py-0.5 text-xs font-medium bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full">
                        {item.badge}
                      </span>
                    )}
                  </Link>
                );
              })}
            </div>

            {/* Account Section */}
            <div className="space-y-1">
              {isEmployee && (
                <div className="px-3 mb-2">
                  <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wider">
                    Account
                  </h3>
                </div>
              )}
              {accountNav.map((item) => {
                const Icon = item.icon;
                const isActive = pathname === item.href;
                const isDisabled = !item.enabled;

                return (
                  <Link
                    key={item.name}
                    href={isDisabled ? "#" : item.href}
                    onClick={(e) => {
                      if (isDisabled) {
                        e.preventDefault();
                      }
                      setSidebarOpen(false);
                    }}
                    className={cn(
                      "flex items-center justify-between gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors",
                      isActive && "bg-blue-50 text-blue-700",
                      !isActive && !isDisabled && "text-gray-700 hover:bg-gray-50",
                      isDisabled && "text-gray-400 cursor-not-allowed opacity-60"
                    )}
                  >
                    <div className="flex items-center gap-3">
                      <Icon className="w-5 h-5" />
                      {item.name}
                    </div>
                    {item.badge && (
                      <span className="px-2 py-0.5 text-xs font-medium bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full">
                        {item.badge}
                      </span>
                    )}
                  </Link>
                );
              })}
            </div>
          </nav>

          {/* Help & Logout */}
          <div className="px-4 py-4 border-t border-gray-200 space-y-1">
            <Link
              href="/contact"
              className="flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50"
            >
              <HelpCircle className="w-5 h-5" />
              Help & Support
            </Link>
            <button
              onClick={() => signOut({ callbackUrl: "/" })}
              className="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50"
            >
              <LogOut className="w-5 h-5" />
              Logout
            </button>
          </div>
        </div>
      </aside>

      {/* Main content */}
      <div className="lg:pl-64">
        {/* Top bar */}
        <header className="sticky top-0 z-30 flex items-center justify-between h-16 px-4 bg-white border-b border-gray-200 sm:px-6 lg:px-8">
          <button
            onClick={() => setSidebarOpen(true)}
            className="lg:hidden p-2 -ml-2 rounded-lg hover:bg-gray-100"
          >
            <Menu className="w-6 h-6" />
          </button>

          <div className="flex items-center gap-2 sm:gap-4 ml-auto">
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <button className="flex items-center gap-2 sm:gap-3 hover:bg-gray-50 rounded-lg p-2 transition-colors">
                  <div className="text-right hidden sm:block">
                    <p className="text-sm font-medium text-gray-900 truncate max-w-[150px]">
                      {user?.name || "User"}
                    </p>
                    <p className="text-xs text-gray-500 truncate max-w-[150px]">{user?.email || ""}</p>
                  </div>
                  <div className="w-10 h-10 flex-shrink-0 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-semibold">
                    {user?.name?.[0]?.toUpperCase() || "U"}
                  </div>
                  <ChevronDown className="w-4 h-4 text-gray-500 hidden sm:block" />
                </button>
              </DropdownMenuTrigger>
              <DropdownMenuContent align="end" className="w-56">
                <DropdownMenuLabel>
                  <div className="flex flex-col space-y-1">
                    <p className="text-sm font-medium leading-none">{user?.name || "User"}</p>
                    <p className="text-xs leading-none text-muted-foreground">
                      {user?.email || ""}
                    </p>
                  </div>
                </DropdownMenuLabel>
                <DropdownMenuSeparator />
                <DropdownMenuItem asChild>
                  <Link href="/dashboard/settings" className="cursor-pointer">
                    <User className="w-4 h-4 mr-2" />
                    Profile & Settings
                  </Link>
                </DropdownMenuItem>
                <DropdownMenuItem asChild>
                  <Link href="/dashboard/billing" className="cursor-pointer">
                    <CreditCard className="w-4 h-4 mr-2" />
                    Billing
                  </Link>
                </DropdownMenuItem>
                <DropdownMenuItem asChild>
                  <Link href="/contact" className="cursor-pointer">
                    <HelpCircle className="w-4 h-4 mr-2" />
                    Help & Support
                  </Link>
                </DropdownMenuItem>
                <DropdownMenuSeparator />
                <DropdownMenuItem
                  onClick={() => signOut({ callbackUrl: "/" })}
                  className="text-red-600 focus:text-red-600 focus:bg-red-50 cursor-pointer"
                >
                  <LogOut className="w-4 h-4 mr-2" />
                  Logout
                </DropdownMenuItem>
              </DropdownMenuContent>
            </DropdownMenu>
          </div>
        </header>

        {/* Page content */}
        <main className="p-4 sm:p-6 lg:p-8">{children}</main>
      </div>

      {/* AI Assistant */}
      <AIAssistantButton user={user} />
    </div>
  );
}

// ==========================================
// File: components/dashboard/employee-dashboard.tsx
// ==========================================


"use client";

import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import {
  Users,
  FileText,
  GitBranch,
  TrendingUp,
  Activity,
  DollarSign,
  Target,
  Clock,
  CheckCircle2,
  AlertCircle,
} from "lucide-react";
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { formatDistanceToNow } from "date-fns";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip";
import { formatDetailedTimestamp } from "@/lib/utils";

interface EmployeeStats {
  leads: {
    total: number;
    new: number;
    contacted: number;
    qualified: number;
  };
  proposals: {
    total: number;
    draft: number;
    sent: number;
    accepted: number;
    totalValue: number;
    conversionRate: string;
  };
  sequences: {
    active: number;
  };
  recentActivities: Array<{
    id: string;
    leadId: string;
    type: string;
    notes: string;
    createdAt: string;
    leadName: string;
    leadEmail: string;
  }>;
}

export function EmployeeDashboard({ user }: { user: any }) {
  const router = useRouter();
  const [stats, setStats] = useState<EmployeeStats | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchStats();
  }, []);

  const fetchStats = async () => {
    try {
      const response = await fetch("/api/dashboard/employee-stats");
      if (response.ok) {
        const data = await response.json();
        setStats(data);
      }
    } catch (error) {
      console.error("Error fetching stats:", error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading dashboard...</p>
        </div>
      </div>
    );
  }

  if (!stats) {
    return (
      <div className="text-center py-12">
        <AlertCircle className="w-16 h-16 text-gray-400 mx-auto mb-4" />
        <p className="text-gray-600">Failed to load dashboard data</p>
        <Button onClick={fetchStats} className="mt-4">
          Try Again
        </Button>
      </div>
    );
  }

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat("en-US", {
      style: "currency",
      currency: "USD",
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(amount);
  };

  const getActivityIcon = (type: string) => {
    switch (type) {
      case "CALL":
        return "üìû";
      case "EMAIL":
        return "üìß";
      case "MEETING":
        return "ü§ù";
      case "NOTE":
        return "üìù";
      default:
        return "‚Ä¢";
    }
  };

  return (
    <div className="space-y-6">
      {/* Welcome Header */}
      <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-6 text-white">
        <h1 className="text-2xl font-bold mb-2">
          Welcome back, {user?.name?.split(" ")[0] || "there"}! üëã
        </h1>
        <p className="text-blue-100">
          Here's your work overview for today
        </p>
      </div>

      {/* Quick Stats Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {/* Total Leads */}
        <Link href="/dashboard/crm" className="block">
          <Card className="hover:shadow-lg transition-shadow cursor-pointer hover:border-blue-300 border-2 border-transparent">
            <CardContent className="p-6">
            <div className="flex items-center justify-between mb-4">
              <div className="p-3 bg-blue-100 rounded-lg">
                <Users className="w-6 h-6 text-blue-600" />
              </div>
              <span className="text-xs font-medium text-green-600 bg-green-100 px-2 py-1 rounded">
                +{stats.leads.new} new
              </span>
            </div>
            <div className="space-y-1">
              <p className="text-sm text-gray-600 font-medium">Total Leads</p>
              <p className="text-3xl font-bold text-gray-900">
                {stats.leads.total}
              </p>
            </div>
            <div className="mt-4 pt-4 border-t border-gray-100 flex justify-between text-xs text-gray-600">
              <span>Contacted: {stats.leads.contacted}</span>
              <span>Qualified: {stats.leads.qualified}</span>
            </div>
          </CardContent>
        </Card>
        </Link>

        {/* Proposals */}
        <Link href="/dashboard/proposals" className="block">
          <Card className="hover:shadow-lg transition-shadow cursor-pointer hover:border-blue-300 border-2 border-transparent">
            <CardContent className="p-6">
            <div className="flex items-center justify-between mb-4">
              <div className="p-3 bg-purple-100 rounded-lg">
                <FileText className="w-6 h-6 text-purple-600" />
              </div>
              <span className="text-xs font-medium text-orange-600 bg-orange-100 px-2 py-1 rounded">
                {stats.proposals.draft} draft
              </span>
            </div>
            <div className="space-y-1">
              <p className="text-sm text-gray-600 font-medium">Proposals</p>
              <p className="text-3xl font-bold text-gray-900">
                {stats.proposals.total}
              </p>
            </div>
            <div className="mt-4 pt-4 border-t border-gray-100 flex justify-between text-xs text-gray-600">
              <span>Sent: {stats.proposals.sent}</span>
              <span>Accepted: {stats.proposals.accepted}</span>
            </div>
          </CardContent>
        </Card>
        </Link>

        {/* Proposals Value */}
        <Link href="/dashboard/proposals" className="block">
          <Card className="hover:shadow-lg transition-shadow cursor-pointer hover:border-blue-300 border-2 border-transparent">
            <CardContent className="p-6">
            <div className="flex items-center justify-between mb-4">
              <div className="p-3 bg-green-100 rounded-lg">
                <DollarSign className="w-6 h-6 text-green-600" />
              </div>
              <span className="text-xs font-medium text-blue-600 bg-blue-100 px-2 py-1 rounded">
                {stats.proposals.conversionRate}% rate
              </span>
            </div>
            <div className="space-y-1">
              <p className="text-sm text-gray-600 font-medium">Pipeline Value</p>
              <p className="text-3xl font-bold text-gray-900">
                {formatCurrency(stats.proposals.totalValue)}
              </p>
            </div>
            <div className="mt-4 pt-4 border-t border-gray-100 text-xs text-gray-600">
              Active proposals in pipeline
            </div>
          </CardContent>
        </Card>
        </Link>

        {/* Active Sequences */}
        <Link href="/dashboard/sequences" className="block">
          <Card className="hover:shadow-lg transition-shadow cursor-pointer hover:border-blue-300 border-2 border-transparent">
            <CardContent className="p-6">
            <div className="flex items-center justify-between mb-4">
              <div className="p-3 bg-orange-100 rounded-lg">
                <GitBranch className="w-6 h-6 text-orange-600" />
              </div>
              <CheckCircle2 className="w-5 h-5 text-green-600" />
            </div>
            <div className="space-y-1">
              <p className="text-sm text-gray-600 font-medium">
                Active Sequences
              </p>
              <p className="text-3xl font-bold text-gray-900">
                {stats.sequences.active}
              </p>
            </div>
            <div className="mt-4 pt-4 border-t border-gray-100 text-xs text-gray-600">
              Automated outreach campaigns
            </div>
          </CardContent>
        </Card>
        </Link>
      </div>

      {/* Main Content Grid */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Lead Status Breakdown */}
        <Card className="lg:col-span-2">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Target className="w-5 h-5 text-blue-600" />
              Lead Pipeline Overview
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              {/* Progress Bar */}
              <div className="space-y-2">
                <div className="flex justify-between text-sm">
                  <span className="font-medium text-gray-700">
                    Pipeline Progress
                  </span>
                  <span className="text-gray-600">
                    {stats.leads.qualified}/{stats.leads.total} qualified
                  </span>
                </div>
                <div className="h-3 bg-gray-100 rounded-full overflow-hidden">
                  <div
                    className="h-full bg-gradient-to-r from-blue-600 to-purple-600 rounded-full transition-all"
                    style={{
                      width: `${
                        stats.leads.total > 0
                          ? (stats.leads.qualified / stats.leads.total) * 100
                          : 0
                      }%`,
                    }}
                  />
                </div>
              </div>

              {/* Status Cards */}
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 pt-4">
                <div className="text-center p-4 bg-blue-50 rounded-lg">
                  <div className="text-2xl font-bold text-blue-600">
                    {stats.leads.total}
                  </div>
                  <div className="text-xs text-gray-600 mt-1">Total Leads</div>
                </div>
                <div className="text-center p-4 bg-green-50 rounded-lg">
                  <div className="text-2xl font-bold text-green-600">
                    {stats.leads.new}
                  </div>
                  <div className="text-xs text-gray-600 mt-1">New (7 days)</div>
                </div>
                <div className="text-center p-4 bg-purple-50 rounded-lg">
                  <div className="text-2xl font-bold text-purple-600">
                    {stats.leads.contacted}
                  </div>
                  <div className="text-xs text-gray-600 mt-1">Contacted</div>
                </div>
                <div className="text-center p-4 bg-orange-50 rounded-lg">
                  <div className="text-2xl font-bold text-orange-600">
                    {stats.leads.qualified}
                  </div>
                  <div className="text-xs text-gray-600 mt-1">Qualified</div>
                </div>
              </div>

              {/* Quick Actions */}
              <div className="flex gap-3 pt-4 border-t">
                <Button asChild className="flex-1">
                  <Link href="/dashboard/crm">View All Leads</Link>
                </Button>
                <Button asChild variant="outline" className="flex-1">
                  <Link href="/dashboard/proposals">View Proposals</Link>
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Proposals Summary */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <FileText className="w-5 h-5 text-purple-600" />
              Proposals at a Glance
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              <div className="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                <div className="flex items-center gap-3">
                  <Clock className="w-5 h-5 text-orange-600" />
                  <div>
                    <div className="font-semibold text-gray-900">
                      {stats.proposals.draft}
                    </div>
                    <div className="text-xs text-gray-600">Draft</div>
                  </div>
                </div>
                <Button asChild variant="ghost" size="sm">
                  <Link href="/dashboard/proposals?status=draft">View</Link>
                </Button>
              </div>

              <div className="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                <div className="flex items-center gap-3">
                  <TrendingUp className="w-5 h-5 text-blue-600" />
                  <div>
                    <div className="font-semibold text-gray-900">
                      {stats.proposals.sent}
                    </div>
                    <div className="text-xs text-gray-600">Sent</div>
                  </div>
                </div>
                <Button asChild variant="ghost" size="sm">
                  <Link href="/dashboard/proposals?status=sent">View</Link>
                </Button>
              </div>

              <div className="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                <div className="flex items-center gap-3">
                  <CheckCircle2 className="w-5 h-5 text-green-600" />
                  <div>
                    <div className="font-semibold text-gray-900">
                      {stats.proposals.accepted}
                    </div>
                    <div className="text-xs text-gray-600">Accepted</div>
                  </div>
                </div>
                <Button asChild variant="ghost" size="sm">
                  <Link href="/dashboard/proposals?status=accepted">View</Link>
                </Button>
              </div>

              <div className="pt-4 border-t">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm text-gray-600">
                    Conversion Rate
                  </span>
                  <span className="font-bold text-green-600">
                    {stats.proposals.conversionRate}%
                  </span>
                </div>
                <div className="h-2 bg-gray-100 rounded-full overflow-hidden">
                  <div
                    className="h-full bg-green-600 rounded-full"
                    style={{ width: `${stats.proposals.conversionRate}%` }}
                  />
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Recent Activities */}
      <Card>
        <CardHeader>
          <div className="flex items-center justify-between">
            <CardTitle className="flex items-center gap-2">
              <Activity className="w-5 h-5 text-blue-600" />
              Recent Activities
            </CardTitle>
            <Button asChild variant="outline" size="sm">
              <Link href="/dashboard/crm">View All</Link>
            </Button>
          </div>
        </CardHeader>
        <CardContent>
          {stats.recentActivities.length === 0 ? (
            <div className="text-center py-8">
              <Activity className="w-12 h-12 text-gray-300 mx-auto mb-3" />
              <p className="text-gray-600">No recent activities</p>
              <Button asChild className="mt-4" size="sm">
                <Link href="/dashboard/crm">Add First Activity</Link>
              </Button>
            </div>
          ) : (
            <div className="space-y-3">
              {stats.recentActivities.map((activity) => (
                <div
                  key={activity.id}
                  onClick={() => router.push(`/dashboard/crm?leadId=${activity.leadId}`)}
                  className="flex items-start gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer"
                >
                  <div className="text-2xl">{getActivityIcon(activity.type)}</div>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-start justify-between gap-2">
                      <div className="flex-1">
                        <p className="font-medium text-gray-900">
                          {activity.leadName}
                        </p>
                        <p className="text-sm text-gray-600 line-clamp-2">
                          {activity.notes}
                        </p>
                      </div>
                      <TooltipProvider>
                        <Tooltip>
                          <TooltipTrigger asChild>
                            <span className="text-xs text-gray-500 whitespace-nowrap cursor-help">
                              {formatDetailedTimestamp(activity.createdAt, { showTime: true }).relative}
                            </span>
                          </TooltipTrigger>
                          <TooltipContent>
                            <p className="text-xs">{formatDetailedTimestamp(activity.createdAt, { showTime: true }).full}</p>
                          </TooltipContent>
                        </Tooltip>
                      </TooltipProvider>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/dashboard/free-dashboard.tsx
// ==========================================


"use client";

import Link from "next/link";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import {
  Lock,
  Rocket,
  CheckCircle2,
  TrendingUp,
  Zap,
  BarChart3,
  Sparkles,
  ArrowRight,
} from "lucide-react";

export function FreeDashboard({ user }: { user: any }) {
  return (
    <div className="space-y-6">
      {/* Welcome banner */}
      <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-6 text-white">
        <h1 className="text-2xl font-bold mb-2">
          Welcome to CDM Suite, {user.name?.split(" ")[0] || "there"}! üëã
        </h1>
        <p className="text-blue-100 mb-4">
          You're on the Free plan. Upgrade to unlock powerful marketing tools
          and AI-powered website builder.
        </p>
        <Button
          asChild
          size="lg"
          className="bg-white text-blue-600 hover:bg-gray-100"
        >
          <Link href="/dashboard/billing">
            <Rocket className="mr-2 h-5 w-5" />
            Try DIY Builder - $29/mo
          </Link>
        </Button>
      </div>

      {/* Professional Services CTA */}
      <Card className="border-2 border-blue-300 bg-gradient-to-br from-white to-blue-50">
        <CardContent className="p-6">
          <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-2">
                <Sparkles className="w-6 h-6 text-blue-600" />
                <h3 className="text-xl font-bold text-gray-900">
                  Need Professional Results?
                </h3>
              </div>
              <p className="text-gray-700 mb-2">
                Skip the DIY and let our expert team build your custom website, 
                handle your marketing, or develop your mobile app.
              </p>
              <div className="flex flex-wrap gap-2 text-sm text-gray-600">
                <span className="flex items-center gap-1">
                  <CheckCircle2 className="w-4 h-4 text-green-600" />
                  Websites from $420
                </span>
                <span className="flex items-center gap-1">
                  <CheckCircle2 className="w-4 h-4 text-green-600" />
                  Marketing from $175/mo
                </span>
                <span className="flex items-center gap-1">
                  <CheckCircle2 className="w-4 h-4 text-green-600" />
                  Apps from $1,225
                </span>
              </div>
            </div>
            <div className="flex flex-col sm:flex-row gap-3">
              <Button asChild variant="default" size="lg" className="bg-gradient-to-r from-blue-600 to-purple-600">
                <Link href="/dashboard/services">
                  Browse Services
                  <ArrowRight className="ml-2 w-4 h-4" />
                </Link>
              </Button>
              <Button asChild variant="outline" size="lg">
                <Link href="/contact?subject=Professional%20Services">
                  Talk to Team
                </Link>
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Quick actions */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <CheckCircle2 className="w-5 h-5 text-green-600" />
              Free Audit
            </CardTitle>
            <CardDescription>
              Get your website analyzed for free
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild className="w-full">
              <Link href="/auditor">Run Free Audit</Link>
            </Button>
          </CardContent>
        </Card>

        <Card className="relative overflow-hidden">
          <div className="absolute top-4 right-4">
            <Lock className="w-5 h-5 text-gray-400" />
          </div>
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-gray-400">
              <Zap className="w-5 h-5" />
              AI Website Builder
            </CardTitle>
            <CardDescription>Build stunning sites with AI</CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild variant="outline" className="w-full">
              <Link href="/dashboard/billing">Unlock with Starter</Link>
            </Button>
          </CardContent>
        </Card>

        <Card className="relative overflow-hidden">
          <div className="absolute top-4 right-4">
            <Lock className="w-5 h-5 text-gray-400" />
          </div>
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-gray-400">
              <BarChart3 className="w-5 h-5" />
              Analytics Dashboard
            </CardTitle>
            <CardDescription>Track your performance</CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild variant="outline" className="w-full">
              <Link href="/dashboard/billing">Unlock with Starter</Link>
            </Button>
          </CardContent>
        </Card>
      </div>

      {/* Upgrade benefits */}
      <Card>
        <CardHeader>
          <CardTitle>Unlock Premium Features</CardTitle>
          <CardDescription>
            See what you'll get with a paid plan
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                <CheckCircle2 className="w-5 h-5 text-blue-600" />
              </div>
              <div>
                <h4 className="font-medium mb-1">AI Website Builder</h4>
                <p className="text-sm text-gray-600">
                  Build professional websites with AI assistance in minutes
                </p>
              </div>
            </div>
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0">
                <CheckCircle2 className="w-5 h-5 text-purple-600" />
              </div>
              <div>
                <h4 className="font-medium mb-1">Advanced SEO Tools</h4>
                <p className="text-sm text-gray-600">
                  Optimize your site for search engines with powerful tools
                </p>
              </div>
            </div>
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                <CheckCircle2 className="w-5 h-5 text-green-600" />
              </div>
              <div>
                <h4 className="font-medium mb-1">Analytics & Reporting</h4>
                <p className="text-sm text-gray-600">
                  Track visitors, leads, and conversions in real-time
                </p>
              </div>
            </div>
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center flex-shrink-0">
                <CheckCircle2 className="w-5 h-5 text-orange-600" />
              </div>
              <div>
                <h4 className="font-medium mb-1">Priority Support</h4>
                <p className="text-sm text-gray-600">
                  Get help when you need it from our expert team
                </p>
              </div>
            </div>
          </div>

          <div className="mt-6 pt-6 border-t">
            <Button asChild size="lg" className="w-full sm:w-auto">
              <Link href="/dashboard/billing">
                <TrendingUp className="mr-2 h-5 w-5" />
                View All Plans & Pricing
              </Link>
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/dashboard/growth-dashboard.tsx
// ==========================================


"use client";

import Link from "next/link";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import {
  FolderKanban,
  TrendingUp,
  BarChart3,
  Globe,
  Target,
  DollarSign,
  Zap,
  Users,
} from "lucide-react";

export function GrowthDashboard({ user }: { user: any }) {
  const tierConfig = {
    growth: { projects: 3, name: "Growth" },
    pro: { projects: -1, name: "Pro" },
    enterprise: { projects: -1, name: "Enterprise" },
  };

  const config =
    tierConfig[user.tier as keyof typeof tierConfig] || tierConfig.growth;

  return (
    <div className="space-y-6">
      {/* Welcome banner */}
      <div className="bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 rounded-xl p-6 text-white">
        <h1 className="text-2xl font-bold mb-2">
          {user.name?.split(" ")[0] || "Welcome"}'s Command Center üéØ
        </h1>
        <p className="text-purple-100">
          You're on the <strong>{config.name} Plan</strong>. Full access to all
          marketing tools and analytics.
        </p>
      </div>

      {/* Stats overview */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Active Projects
            </CardTitle>
            <FolderKanban className="w-4 h-4 text-gray-400" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              0 {config.projects > 0 && `/ ${config.projects}`}
            </div>
            <p className="text-xs text-green-600 mt-1 font-medium">
              {config.projects === -1 ? "Unlimited" : `${config.projects} slots available`}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Total Visitors
            </CardTitle>
            <TrendingUp className="w-4 h-4 text-gray-400" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">0</div>
            <p className="text-xs text-gray-500 mt-1">This month</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Leads Captured
            </CardTitle>
            <Users className="w-4 h-4 text-gray-400" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">0</div>
            <p className="text-xs text-green-600 mt-1 font-medium">
              +0% from last month
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Ad Spend ROI
            </CardTitle>
            <DollarSign className="w-4 h-4 text-gray-400" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">0x</div>
            <p className="text-xs text-gray-500 mt-1">Return on ad spend</p>
          </CardContent>
        </Card>
      </div>

      {/* Quick actions */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card className="hover:shadow-lg transition-shadow cursor-pointer">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Zap className="w-5 h-5 text-blue-600" />
              AI Website Builder
            </CardTitle>
            <CardDescription>
              Create a new website with AI assistance
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild className="w-full">
              <Link href="/dashboard/builder">Start Building</Link>
            </Button>
          </CardContent>
        </Card>

        <Card className="hover:shadow-lg transition-shadow cursor-pointer">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Target className="w-5 h-5 text-purple-600" />
              Manage Ad Campaigns
            </CardTitle>
            <CardDescription>
              Create and optimize your ad campaigns
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild variant="outline" className="w-full">
              <Link href="/dashboard/ads">View Campaigns</Link>
            </Button>
          </CardContent>
        </Card>

        <Card className="hover:shadow-lg transition-shadow cursor-pointer">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <BarChart3 className="w-5 h-5 text-green-600" />
              Analytics & Reports
            </CardTitle>
            <CardDescription>
              Deep dive into your performance data
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild variant="outline" className="w-full">
              <Link href="/dashboard/analytics">View Analytics</Link>
            </Button>
          </CardContent>
        </Card>
      </div>

      {/* Projects list */}
      <Card>
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle>Your Projects</CardTitle>
              <CardDescription>
                Manage your websites, campaigns, and apps
              </CardDescription>
            </div>
            <Button asChild>
              <Link href="/dashboard/projects">
                <FolderKanban className="mr-2 h-4 w-4" />
                View All Projects
              </Link>
            </Button>
          </div>
        </CardHeader>
        <CardContent>
          <div className="text-center py-12 text-gray-500">
            <Globe className="w-12 h-12 mx-auto mb-4 text-gray-300" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">
              No projects yet
            </h3>
            <p className="text-sm mb-4">
              Create your first project to get started with CDM Suite
            </p>
            <Button asChild>
              <Link href="/dashboard/builder">Create Your First Project</Link>
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/dashboard/pro-dashboard.tsx
// ==========================================


export { GrowthDashboard as ProDashboard } from "./growth-dashboard";

// ==========================================
// File: components/dashboard/project-card.tsx
// ==========================================



"use client";

import { useState } from "react";
import Link from "next/link";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";
import { Edit, Eye, ExternalLink, Trash2, Globe } from "lucide-react";
import { toast } from "react-hot-toast";

interface ProjectCardProps {
  project: {
    id: string;
    name: string;
    type: string;
    status: string;
    subdomain: string | null;
    customDomain: string | null;
    createdAt: string;
    updatedAt: string;
  };
  onDelete?: (id: string) => void;
}

export function ProjectCard({ project, onDelete }: ProjectCardProps) {
  const [showDeleteDialog, setShowDeleteDialog] = useState(false);
  const [deleting, setDeleting] = useState(false);

  const handleDelete = async () => {
    setDeleting(true);
    try {
      const response = await fetch(`/api/projects/${project.id}`, {
        method: "DELETE",
      });

      if (response.ok) {
        toast.success("Project deleted successfully");
        onDelete?.(project.id);
        setShowDeleteDialog(false);
      } else {
        const data = await response.json();
        toast.error(data.error || "Failed to delete project");
      }
    } catch (error) {
      toast.error("Failed to delete project");
    } finally {
      setDeleting(false);
    }
  };

  const projectUrl = project.customDomain
    ? `https://${project.customDomain}`
    : project.subdomain
    ? `https://${project.subdomain}.cdmsuite.com`
    : null;

  return (
    <>
      <Card className="hover:shadow-lg transition-shadow">
        <CardHeader>
          <div className="flex items-start justify-between">
            <div className="flex-1">
              <CardTitle className="text-lg flex items-center gap-2">
                <Globe className="w-4 h-4 text-gray-400" />
                {project.name}
              </CardTitle>
              <CardDescription className="text-xs mt-1">
                Created {new Date(project.createdAt).toLocaleDateString()}
              </CardDescription>
            </div>
            <Badge
              variant={
                project.status === "active"
                  ? "default"
                  : project.status === "draft"
                  ? "secondary"
                  : "outline"
              }
            >
              {project.status}
            </Badge>
          </div>
        </CardHeader>
        <CardContent>
          <div className="space-y-3">
            {/* Project URL */}
            {projectUrl && (
              <div className="text-sm text-gray-600 truncate">
                <a
                  href={projectUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="hover:text-blue-600 flex items-center gap-1"
                >
                  <ExternalLink className="w-3 h-3" />
                  {projectUrl.replace("https://", "")}
                </a>
              </div>
            )}

            {/* Actions */}
            <div className="flex gap-2 pt-2">
              <Button asChild size="sm" variant="outline" className="flex-1">
                <Link href={`/builder/editor/${project.id}`}>
                  <Edit className="mr-2 h-4 w-4" />
                  Edit
                </Link>
              </Button>
              {projectUrl && (
                <Button asChild size="sm" variant="outline" className="flex-1">
                  <a href={projectUrl} target="_blank" rel="noopener noreferrer">
                    <Eye className="mr-2 h-4 w-4" />
                    View
                  </a>
                </Button>
              )}
              <Button
                size="sm"
                variant="outline"
                className="text-red-600 hover:text-red-700 hover:bg-red-50"
                onClick={() => setShowDeleteDialog(true)}
              >
                <Trash2 className="h-4 w-4" />
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Delete Confirmation Dialog */}
      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Are you sure?</AlertDialogTitle>
            <AlertDialogDescription>
              This will permanently delete the project "{project.name}". This action cannot be
              undone.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel disabled={deleting}>Cancel</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDelete}
              disabled={deleting}
              className="bg-red-600 hover:bg-red-700"
            >
              {deleting ? "Deleting..." : "Delete Project"}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  );
}

// ==========================================
// File: components/dashboard/projects-list.tsx
// ==========================================


"use client";

import Link from "next/link";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import {
  Globe,
  Edit,
  Eye,
  Trash2,
  ExternalLink,
  Plus,
  Calendar,
  TrendingUp,
} from "lucide-react";

interface ProjectsListProps {
  projects: any[];
  user: any;
}

export function ProjectsList({ projects, user }: ProjectsListProps) {
  const projectLimit = user.tier === "starter" ? 1 : user.tier === "growth" ? 3 : 999;

  return (
    <div className="space-y-4 sm:space-y-6">
      {/* Header with create button */}
      <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">
        <div>
          <p className="text-xs sm:text-sm text-muted-foreground">
            {projects.length} of {projectLimit === 999 ? "unlimited" : projectLimit} project
            {projectLimit !== 1 ? "s" : ""} used
          </p>
        </div>
        {projects.length < projectLimit && (
          <Button asChild className="w-full sm:w-auto">
            <Link href="/builder">
              <Plus className="w-4 h-4 mr-2" />
              Create New Website
            </Link>
          </Button>
        )}
      </div>

      {/* Projects grid */}
      {projects.length === 0 ? (
        <Card className="p-8 sm:p-12 text-center">
          <div className="w-16 h-16 sm:w-20 sm:h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <Globe className="w-8 h-8 sm:w-10 sm:h-10 text-gray-400" />
          </div>
          <h3 className="text-lg sm:text-xl font-bold mb-2">No projects yet</h3>
          <p className="text-sm sm:text-base text-muted-foreground mb-4 sm:mb-6">
            Create your first website with our AI builder
          </p>
          <Button asChild size="lg" className="w-full sm:w-auto">
            <Link href="/builder">
              <Plus className="w-4 h-4 sm:w-5 sm:h-5 mr-2" />
              Build Your First Website
            </Link>
          </Button>
        </Card>
      ) : (
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
          {projects.map((project) => (
            <Card key={project.id} className="overflow-hidden hover:shadow-lg transition-shadow">
              {/* Project preview */}
              <div className="aspect-video bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center border-b">
                <Globe className="w-10 h-10 sm:w-12 sm:h-12 text-blue-600 opacity-50" />
              </div>

              {/* Project details */}
              <div className="p-4 sm:p-6">
                <div className="flex items-start justify-between mb-2 gap-2">
                  <h3 className="font-bold text-base sm:text-lg truncate flex-1">{project.name}</h3>
                  <Badge
                    variant={
                      project.status === "active"
                        ? "default"
                        : project.status === "draft"
                        ? "secondary"
                        : "outline"
                    }
                    className="text-xs flex-shrink-0"
                  >
                    {project.status}
                  </Badge>
                </div>

                {project.subdomain && (
                  <a
                    href={`https://${project.subdomain}.cdmsuite.com`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-xs sm:text-sm text-blue-600 hover:underline flex items-center gap-1 mb-3 sm:mb-4 break-all"
                  >
                    <span className="truncate">{project.subdomain}.cdmsuite.com</span>
                    <ExternalLink className="w-3 h-3 flex-shrink-0" />
                  </a>
                )}

                {/* Stats */}
                <div className="grid grid-cols-3 gap-1.5 sm:gap-2 mb-3 sm:mb-4 text-center">
                  <div className="bg-muted rounded-lg p-1.5 sm:p-2">
                    <p className="text-[10px] sm:text-xs text-muted-foreground">Visits</p>
                    <p className="text-sm sm:text-base font-semibold">{project.visits}</p>
                  </div>
                  <div className="bg-muted rounded-lg p-1.5 sm:p-2">
                    <p className="text-[10px] sm:text-xs text-muted-foreground">Leads</p>
                    <p className="text-sm sm:text-base font-semibold">{project.leads}</p>
                  </div>
                  <div className="bg-muted rounded-lg p-1.5 sm:p-2">
                    <p className="text-[10px] sm:text-xs text-muted-foreground">Conv.</p>
                    <p className="text-sm sm:text-base font-semibold">{project.conversions}</p>
                  </div>
                </div>

                {/* Meta info */}
                <div className="flex items-center gap-2 text-[10px] sm:text-xs text-muted-foreground mb-3 sm:mb-4">
                  <Calendar className="w-3 h-3 flex-shrink-0" />
                  <span className="truncate">
                    Created {new Date(project.createdAt).toLocaleDateString()}
                  </span>
                </div>

                {/* Actions */}
                <div className="flex gap-2">
                  <Button asChild variant="outline" size="sm" className="flex-1 text-xs sm:text-sm h-8 sm:h-9">
                    <Link href={`/builder/preview/${project.id}`}>
                      <Eye className="w-3 h-3 sm:w-4 sm:h-4 mr-1" />
                      <span className="hidden sm:inline">Preview</span>
                      <span className="sm:hidden">View</span>
                    </Link>
                  </Button>
                  <Button asChild size="sm" className="flex-1 text-xs sm:text-sm h-8 sm:h-9">
                    <Link href={`/builder/editor/${project.id}`}>
                      <Edit className="w-3 h-3 sm:w-4 sm:h-4 mr-1" />
                      Edit
                    </Link>
                  </Button>
                </div>
              </div>
            </Card>
          ))}
        </div>
      )}

      {/* Upgrade prompt */}
      {projects.length >= projectLimit && projectLimit < 999 && (
        <Card className="p-6 bg-gradient-to-r from-blue-50 to-purple-50 border-blue-200">
          <div className="flex items-start gap-4">
            <div className="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
              <TrendingUp className="w-6 h-6 text-white" />
            </div>
            <div className="flex-1">
              <h3 className="font-bold text-lg mb-2">Project Limit Reached</h3>
              <p className="text-muted-foreground mb-4">
                You've used all {projectLimit} project slots in your {user.tier} plan. 
                Upgrade to create more websites!
              </p>
              <Button asChild>
                <Link href="/dashboard/billing">
                  Upgrade Plan
                </Link>
              </Button>
            </div>
          </div>
        </Card>
      )}
    </div>
  );
}

// ==========================================
// File: components/dashboard/settings-client.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Label } from "@/components/ui/label";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Settings, User, Bell, Lock, Palette, Loader2, Save } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { useRouter } from "next/navigation";

interface SettingsClientProps {
  user: any;
}

export function SettingsClient({ user }: SettingsClientProps) {
  const { toast } = useToast();
  const router = useRouter();

  // Profile form state
  const [profileData, setProfileData] = useState({
    name: user.name || "",
    company: user.company || "",
    phone: user.phone || "",
    industry: user.industry || "",
  });
  const [profileLoading, setProfileLoading] = useState(false);

  // Password form state
  const [passwordData, setPasswordData] = useState({
    currentPassword: "",
    newPassword: "",
    confirmPassword: "",
  });
  const [passwordLoading, setPasswordLoading] = useState(false);

  const handleProfileUpdate = async (e: React.FormEvent) => {
    e.preventDefault();
    setProfileLoading(true);

    try {
      const response = await fetch("/api/user/update-profile", {
        method: "PATCH",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(profileData),
      });

      const data = await response.json();

      if (response.ok) {
        toast({
          title: "Profile Updated",
          description: "Your profile information has been saved successfully",
        });
        router.refresh();
      } else {
        toast({
          title: "Error",
          description: data.error || "Failed to update profile",
          variant: "destructive",
        });
      }
    } catch (error) {
      console.error("Profile update error:", error);
      toast({
        title: "Error",
        description: "Failed to update profile. Please try again.",
        variant: "destructive",
      });
    } finally {
      setProfileLoading(false);
    }
  };

  const handlePasswordChange = async (e: React.FormEvent) => {
    e.preventDefault();

    if (passwordData.newPassword.length < 8) {
      toast({
        title: "Error",
        description: "New password must be at least 8 characters long",
        variant: "destructive",
      });
      return;
    }

    if (passwordData.newPassword !== passwordData.confirmPassword) {
      toast({
        title: "Error",
        description: "New passwords do not match",
        variant: "destructive",
      });
      return;
    }

    setPasswordLoading(true);

    try {
      const response = await fetch("/api/user/change-password", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          currentPassword: passwordData.currentPassword,
          newPassword: passwordData.newPassword,
        }),
      });

      const data = await response.json();

      if (response.ok) {
        toast({
          title: "Password Changed",
          description: "Your password has been updated successfully",
        });
        setPasswordData({
          currentPassword: "",
          newPassword: "",
          confirmPassword: "",
        });
      } else {
        toast({
          title: "Error",
          description: data.error || "Failed to change password",
          variant: "destructive",
        });
      }
    } catch (error) {
      console.error("Password change error:", error);
      toast({
        title: "Error",
        description: "Failed to change password. Please try again.",
        variant: "destructive",
      });
    } finally {
      setPasswordLoading(false);
    }
  };

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl sm:text-3xl font-bold text-gray-900">Settings</h1>
        <p className="text-sm sm:text-base text-gray-600 mt-1">
          Manage your account settings and preferences
        </p>
      </div>

      <div className="grid gap-4 sm:gap-6">
        {/* Profile Settings */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <User className="w-5 h-5" />
              Profile Information
            </CardTitle>
            <CardDescription>
              Update your personal information and contact details
            </CardDescription>
          </CardHeader>
          <CardContent>
            <form onSubmit={handleProfileUpdate} className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <Label htmlFor="name">Full Name</Label>
                  <Input
                    id="name"
                    value={profileData.name}
                    onChange={(e) =>
                      setProfileData({ ...profileData, name: e.target.value })
                    }
                    placeholder="John Doe"
                    disabled={profileLoading}
                  />
                </div>
                <div>
                  <Label htmlFor="email">Email Address</Label>
                  <Input
                    id="email"
                    type="email"
                    value={user.email || ""}
                    disabled
                  />
                  <p className="text-xs text-muted-foreground mt-1">
                    Contact support to change your email
                  </p>
                </div>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <Label htmlFor="company">Company Name</Label>
                  <Input
                    id="company"
                    value={profileData.company}
                    onChange={(e) =>
                      setProfileData({ ...profileData, company: e.target.value })
                    }
                    placeholder="Acme Inc."
                    disabled={profileLoading}
                  />
                </div>
                <div>
                  <Label htmlFor="phone">Phone Number</Label>
                  <Input
                    id="phone"
                    value={profileData.phone}
                    onChange={(e) =>
                      setProfileData({ ...profileData, phone: e.target.value })
                    }
                    placeholder="+1 (555) 123-4567"
                    disabled={profileLoading}
                  />
                </div>
              </div>
              <div>
                <Label htmlFor="industry">Industry</Label>
                <Input
                  id="industry"
                  value={profileData.industry}
                  onChange={(e) =>
                    setProfileData({ ...profileData, industry: e.target.value })
                  }
                  placeholder="Digital Marketing"
                  disabled={profileLoading}
                />
              </div>
              <Button type="submit" disabled={profileLoading}>
                {profileLoading ? (
                  <>
                    <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                    Saving...
                  </>
                ) : (
                  <>
                    <Save className="w-4 h-4 mr-2" />
                    Save Changes
                  </>
                )}
              </Button>
            </form>
          </CardContent>
        </Card>

        {/* Security Settings */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Lock className="w-5 h-5" />
              Security
            </CardTitle>
            <CardDescription>
              Manage your password and security settings
            </CardDescription>
          </CardHeader>
          <CardContent>
            <form onSubmit={handlePasswordChange} className="space-y-4">
              <div>
                <Label htmlFor="current-password">Current Password</Label>
                <Input
                  id="current-password"
                  type="password"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  value={passwordData.currentPassword}
                  onChange={(e) =>
                    setPasswordData({
                      ...passwordData,
                      currentPassword: e.target.value,
                    })
                  }
                  disabled={passwordLoading}
                  required
                />
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <Label htmlFor="new-password">New Password</Label>
                  <Input
                    id="new-password"
                    type="password"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    value={passwordData.newPassword}
                    onChange={(e) =>
                      setPasswordData({
                        ...passwordData,
                        newPassword: e.target.value,
                      })
                    }
                    disabled={passwordLoading}
                    minLength={8}
                    required
                  />
                  <p className="text-xs text-muted-foreground mt-1">
                    Must be at least 8 characters
                  </p>
                </div>
                <div>
                  <Label htmlFor="confirm-password">Confirm Password</Label>
                  <Input
                    id="confirm-password"
                    type="password"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    value={passwordData.confirmPassword}
                    onChange={(e) =>
                      setPasswordData({
                        ...passwordData,
                        confirmPassword: e.target.value,
                      })
                    }
                    disabled={passwordLoading}
                    minLength={8}
                    required
                  />
                </div>
              </div>
              <Button type="submit" variant="outline" disabled={passwordLoading}>
                {passwordLoading ? (
                  <>
                    <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                    Updating...
                  </>
                ) : (
                  <>
                    <Lock className="w-4 h-4 mr-2" />
                    Update Password
                  </>
                )}
              </Button>
            </form>
          </CardContent>
        </Card>

        {/* Notification Settings (UI Only - Backend will be added later) */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Bell className="w-5 h-5" />
              Notifications
            </CardTitle>
            <CardDescription>
              Choose what notifications you want to receive (Coming Soon)
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="flex items-center justify-between opacity-60">
              <div>
                <h4 className="font-medium">Email Notifications</h4>
                <p className="text-sm text-muted-foreground">
                  Receive updates about your projects and campaigns
                </p>
              </div>
              <input type="checkbox" disabled defaultChecked />
            </div>
            <div className="flex items-center justify-between opacity-60">
              <div>
                <h4 className="font-medium">Marketing Emails</h4>
                <p className="text-sm text-muted-foreground">
                  Get tips, guides, and product updates
                </p>
              </div>
              <input type="checkbox" disabled />
            </div>
            <div className="flex items-center justify-between opacity-60">
              <div>
                <h4 className="font-medium">Weekly Reports</h4>
                <p className="text-sm text-muted-foreground">
                  Receive weekly performance reports
                </p>
              </div>
              <input type="checkbox" disabled defaultChecked />
            </div>
            <p className="text-xs text-muted-foreground">
              Email notification preferences will be available soon
            </p>
          </CardContent>
        </Card>

        {/* Preferences (UI Only - Backend will be added later) */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Palette className="w-5 h-5" />
              Preferences
            </CardTitle>
            <CardDescription>
              Customize your dashboard experience (Coming Soon)
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4 opacity-60">
            <div>
              <Label htmlFor="timezone">Timezone</Label>
              <select
                id="timezone"
                disabled
                className="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"
              >
                <option>UTC (GMT+0:00)</option>
                <option>Eastern Time (GMT-5:00)</option>
                <option>Pacific Time (GMT-8:00)</option>
                <option>Central European (GMT+1:00)</option>
              </select>
            </div>
            <div>
              <Label htmlFor="language">Language</Label>
              <select
                id="language"
                disabled
                className="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md"
              >
                <option>English</option>
                <option>Spanish</option>
                <option>French</option>
                <option>German</option>
              </select>
            </div>
            <p className="text-xs text-muted-foreground">
              Timezone and language preferences will be available soon
            </p>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

// ==========================================
// File: components/dashboard/starter-dashboard.tsx
// ==========================================


"use client";

import Link from "next/link";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import {
  Zap,
  FolderKanban,
  TrendingUp,
  BarChart3,
  Globe,
  Crown,
  AlertCircle,
  Plus,
  Edit,
  Eye,
  ExternalLink,
} from "lucide-react";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { Badge } from "@/components/ui/badge";
import { TrialCountdown } from "@/components/trial/trial-countdown";
import { TrialProgressCard } from "@/components/trial/trial-progress-card";
import { CreditsCard } from "@/components/dashboard/credits-card";
import { ProjectCard } from "@/components/dashboard/project-card";
import { useEffect, useState } from "react";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { AffiliateDashboard } from "@/components/dashboard/affiliate-dashboard";

export function StarterDashboard({ user }: { user: any }) {
  const [projects, setProjects] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const [credits, setCredits] = useState(user.credits || 0);

  useEffect(() => {
    async function fetchProjects() {
      try {
        const response = await fetch("/api/projects");
        if (response.ok) {
          const data = await response.json();
          setProjects(data.projects || []);
        }
      } catch (error) {
        console.error("Failed to fetch projects:", error);
      } finally {
        setLoading(false);
      }
    }
    fetchProjects();
    fetchCredits();
  }, []);

  async function fetchCredits() {
    try {
      const response = await fetch("/api/credits");
      if (response.ok) {
        const data = await response.json();
        setCredits(data.credits);
      }
    } catch (error) {
      console.error("Failed to fetch credits:", error);
    }
  }

  function handleProjectDelete(projectId: string) {
    setProjects(projects.filter(p => p.id !== projectId));
  }

  const isTrialing = user.subscriptionStatus === "trialing";
  const trialDaysLeft = user.trialEndsAt
    ? Math.ceil(
        (new Date(user.trialEndsAt).getTime() - Date.now()) /
          (1000 * 60 * 60 * 24)
      )
    : 0;

  const projectLimit = 1; // Starter plan limit

  return (
    <div className="space-y-6">
      {/* Trial Countdown */}
      {isTrialing && trialDaysLeft > 0 && <TrialCountdown user={user} />}

      {/* Welcome banner */}
      <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-6 text-white">
        <h1 className="text-2xl font-bold mb-2">
          Welcome to your Dashboard, {user.name?.split(" ")[0] || "there"}! üöÄ
        </h1>
        <p className="text-blue-100">
          You're on the <strong>Starter Plan</strong>. Start building your
          first website with AI!
        </p>
      </div>

      {/* Stats overview */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
        <CreditsCard credits={credits} tier={user.tier} />

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Visitors
            </CardTitle>
            <TrendingUp className="w-4 h-4 text-gray-400" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              {projects.reduce((sum, p) => sum + (p.visits || 0), 0)}
            </div>
            <p className="text-xs text-gray-500 mt-1">This month</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Leads
            </CardTitle>
            <Globe className="w-4 h-4 text-gray-400" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              {projects.reduce((sum, p) => sum + (p.leads || 0), 0)}
            </div>
            <p className="text-xs text-gray-500 mt-1">Total captured</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-600">
              Conversions
            </CardTitle>
            <BarChart3 className="w-4 h-4 text-gray-400" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              {projects.reduce((sum, p) => sum + (p.conversions || 0), 0)}%
            </div>
            <p className="text-xs text-gray-500 mt-1">Conversion rate</p>
          </CardContent>
        </Card>
      </div>

      {/* Projects & Affiliate Tabs */}
      <Tabs defaultValue="projects" className="w-full">
        <TabsList className="grid w-full grid-cols-2 max-w-md">
          <TabsTrigger value="projects">My Projects</TabsTrigger>
          <TabsTrigger value="affiliate">Affiliate Program</TabsTrigger>
        </TabsList>

        <TabsContent value="projects" className="space-y-4">
          <Card>
            <CardHeader>
              <div className="flex items-center justify-between">
                <div>
                  <CardTitle className="flex items-center gap-2">
                    <Globe className="w-5 h-5" />
                    My Projects
                  </CardTitle>
                  <CardDescription>
                    Manage your websites - {projects.length} project{projects.length !== 1 ? "s" : ""} created
                  </CardDescription>
                </div>
                {credits > 0 && (
                  <Button asChild>
                    <Link href="/builder">
                      <Plus className="w-4 h-4 mr-2" />
                      Create Website
                    </Link>
                  </Button>
                )}
              </div>
            </CardHeader>
            <CardContent>
              {loading ? (
                <div className="text-center py-8 text-muted-foreground">
                  Loading projects...
                </div>
              ) : projects.length === 0 ? (
                <div className="text-center py-12">
                  <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <Globe className="w-8 h-8 text-gray-400" />
                  </div>
                  <h3 className="text-lg font-semibold mb-2">No projects yet</h3>
                  <p className="text-muted-foreground mb-6">
                    Create your first website with our AI builder
                  </p>
                  {credits > 0 ? (
                    <Button asChild size="lg">
                      <Link href="/builder">
                        <Zap className="w-5 h-5 mr-2" />
                        Build Your First Website
                      </Link>
                    </Button>
                  ) : (
                    <Button asChild size="lg" variant="outline">
                      <Link href="/dashboard/billing">
                        <Crown className="w-5 h-5 mr-2" />
                        Get Credits to Start Building
                      </Link>
                    </Button>
                  )}
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {projects.map((project) => (
                    <ProjectCard
                      key={project.id}
                      project={project}
                      onDelete={handleProjectDelete}
                    />
                  ))}
                </div>
              )}

              {/* Out of credits alert */}
              {credits === 0 && (
                <Alert className="mt-4 border-orange-200 bg-orange-50">
                  <AlertCircle className="w-4 h-4 text-orange-600" />
                  <AlertDescription>
                    <p className="font-medium text-orange-900 mb-1">
                      Out of credits
                    </p>
                    <p className="text-sm text-orange-700 mb-2">
                      Upgrade your plan to get more credits and create additional websites!
                    </p>
                    <Button asChild size="sm" variant="default">
                      <Link href="/dashboard/billing">
                        <Crown className="w-4 h-4 mr-2" />
                        Upgrade Now
                      </Link>
                    </Button>
                  </AlertDescription>
                </Alert>
              )}
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="affiliate">
          <AffiliateDashboard />
        </TabsContent>
      </Tabs>

      {/* Quick actions */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Zap className="w-5 h-5 text-blue-600" />
              {projects.length === 0 ? "Build Your First Website" : "Create Another Site"}
            </CardTitle>
            <CardDescription>
              Let AI create a professional website for your business
            </CardDescription>
          </CardHeader>
          <CardContent>
            {projects.length < projectLimit ? (
              <Button asChild className="w-full" size="lg">
                <Link href="/builder">
                  Start Building with AI
                </Link>
              </Button>
            ) : (
              <Button asChild variant="outline" className="w-full" size="lg">
                <Link href="/dashboard/billing">
                  <Crown className="w-4 h-4 mr-2" />
                  Upgrade to Create More
                </Link>
              </Button>
            )}
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Crown className="w-5 h-5 text-purple-600" />
              Unlock More Features
            </CardTitle>
            <CardDescription>
              Get unlimited projects, advanced SEO, ads management & more
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild variant="outline" className="w-full" size="lg">
              <Link href="/dashboard/billing">View Upgrade Options</Link>
            </Button>
          </CardContent>
        </Card>
      </div>

      {/* Getting Started */}
      <Card>
        <CardHeader>
          <CardTitle>Getting Started</CardTitle>
          <CardDescription>
            Complete these steps to make the most of CDM Suite
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {[
              {
                title: "Complete your profile",
                description: "Add your business details",
                href: "/dashboard/settings",
                done: !!user.company,
              },
              {
                title: "Build your first website",
                description: "Use AI to create a professional site",
                href: "/builder",
                done: projects.length > 0,
              },
              {
                title: "Customize with visual editor",
                description: "Make it yours with drag-and-drop editing",
                href: projects.length > 0 ? `/builder/editor/${projects[0].id}` : "/builder",
                done: false,
              },
              {
                title: "Publish your site",
                description: "Go live and share with the world",
                href: "/dashboard/projects",
                done: projects.some(p => p.status === "active"),
              },
            ].map((step, i) => (
              <Link
                key={i}
                href={step.href}
                className="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors"
              >
                <div className="flex items-center gap-4">
                  <div
                    className={`w-8 h-8 rounded-full flex items-center justify-center ${
                      step.done
                        ? "bg-green-100 text-green-600"
                        : "bg-gray-100 text-gray-400"
                    }`}
                  >
                    {i + 1}
                  </div>
                  <div>
                    <h4 className="font-medium">{step.title}</h4>
                    <p className="text-sm text-gray-600">{step.description}</p>
                  </div>
                </div>
                <div
                  className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                    step.done
                      ? "bg-green-100 border-green-600"
                      : "border-gray-300"
                  }`}
                >
                  {step.done && (
                    <svg
                      className="w-4 h-4 text-green-600"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M5 13l4 4L19 7"
                      />
                    </svg>
                  )}
                </div>
              </Link>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

// ==========================================
// File: components/exit-intent-popup.tsx
// ==========================================



'use client';

import { useState, useEffect } from 'react';
import { X, AlertCircle, TrendingUp } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { useRouter } from 'next/navigation';

export function ExitIntentPopup() {
  const [isVisible, setIsVisible] = useState(false);
  const router = useRouter();

  useEffect(() => {
    let exitIntentTriggered = false;

    const handleMouseLeave = (e: MouseEvent) => {
      // Check if mouse is leaving from the top of the viewport
      if (e.clientY <= 0 && !exitIntentTriggered) {
        const hasSeenExitPopup = localStorage.getItem('exit_popup_seen');
        
        if (!hasSeenExitPopup) {
          exitIntentTriggered = true;
          setIsVisible(true);
        }
      }
    };

    // Add event listener
    document.addEventListener('mouseleave', handleMouseLeave);

    return () => {
      document.removeEventListener('mouseleave', handleMouseLeave);
    };
  }, []);

  const handleClose = () => {
    setIsVisible(false);
    localStorage.setItem('exit_popup_seen', 'true');
  };

  const handleGetAudit = () => {
    handleClose();
    router.push('/auditor');
  };

  if (!isVisible) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300">
      <div className="bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden animate-in zoom-in-95 duration-300 relative">
        <button
          onClick={handleClose}
          className="absolute top-4 right-4 z-10 hover:bg-gray-100 rounded-full p-2 transition-colors"
          aria-label="Close popup"
        >
          <X className="w-5 h-5 text-gray-600" />
        </button>

        <div className="p-8 text-center">
          {/* Icon */}
          <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-blue-100 to-purple-100 mb-4">
            <TrendingUp className="w-8 h-8 text-blue-600" />
          </div>

          {/* Headline */}
          <h2 className="text-3xl font-bold text-gray-900 mb-2">Wait! Before You Go...</h2>
          <p className="text-xl text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 font-semibold mb-6">
            See How Your Website Performs in 60 Seconds!
          </p>

          {/* Benefits */}
          <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-6 text-left">
            <p className="text-gray-700 mb-4 font-medium">
              Our FREE Website Auditor analyzes:
            </p>
            <ul className="space-y-2 text-gray-600">
              <li className="flex items-start gap-2">
                <span className="text-green-600 font-bold">‚úì</span>
                <span>SEO performance & keyword opportunities</span>
              </li>
              <li className="flex items-start gap-2">
                <span className="text-green-600 font-bold">‚úì</span>
                <span>Page speed & user experience issues</span>
              </li>
              <li className="flex items-start gap-2">
                <span className="text-green-600 font-bold">‚úì</span>
                <span>Mobile responsiveness & security gaps</span>
              </li>
              <li className="flex items-start gap-2">
                <span className="text-green-600 font-bold">‚úì</span>
                <span>Personalized action plan to increase conversions</span>
              </li>
            </ul>
          </div>

          <Button
            onClick={handleGetAudit}
            className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-6 text-lg"
          >
            Analyze My Website Now - FREE!
          </Button>

          <button 
            onClick={handleClose}
            className="w-full mt-3 text-sm text-gray-500 hover:text-gray-700 transition-colors"
          >
            Maybe later
          </button>

          <p className="text-xs text-gray-500 mt-4">
            ‚ö° Over 1,000 businesses have improved their websites with our auditor
          </p>
        </div>
      </div>
    </div>
  );
}

// ==========================================
// File: components/faq-section.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import { useState } from "react";
import { Plus, Minus } from "lucide-react";

const FAQSection = () => {
  const [openItems, setOpenItems] = useState<Record<string, boolean>>({});

  const toggleItem = (id: string) => {
    setOpenItems(prev => ({
      ...prev,
      [id]: !prev[id]
    }));
  };

  const faqCategories = [
    {
      title: "About Working With Us",
      faqs: [
        {
          id: "work-1",
          question: "How do we get started working together?",
          answer: "Getting started is simple! Contact us for a free consultation where we'll discuss your goals, current challenges, and how our services can help. We'll then provide a customized proposal outlining our recommended strategy and timeline."
        },
        {
          id: "work-2",
          question: "What's your typical project timeline?",
          answer: "Project timelines vary based on scope and complexity. Website projects typically take 4-8 weeks, while comprehensive digital marketing campaigns can be launched within 2-4 weeks. We'll provide a detailed timeline during our initial consultation."
        },
        {
          id: "work-3",
          question: "Do you work with businesses in my industry?",
          answer: "We work with businesses across various industries including healthcare, technology, retail, professional services, and more. Our approach adapts to any industry's unique requirements and challenges."
        },
        {
          id: "work-4",
          question: "What level of involvement do you expect from us?",
          answer: "We handle the heavy lifting, but we value your input. Expect weekly check-ins, monthly strategy reviews, and collaboration on major decisions. Your industry expertise combined with our marketing knowledge creates the best results."
        },
        {
          id: "work-5",
          question: "How do you measure and report success?",
          answer: "We use powerful tracking tools to monitor KPIs relevant to your goals - whether that's website traffic, lead generation, sales conversions, or brand awareness. You'll receive detailed monthly reports with actionable insights."
        }
      ]
    },
    {
      title: "Services & Process",
      faqs: [
        {
          id: "service-1",
          question: "What digital marketing services do you offer?",
          answer: "We offer complete digital marketing services including responsive web design, digital advertising campaigns (PPC, social media), mobile app development, AI implementation, SEO, content marketing, and marketing automation."
        },
        {
          id: "service-2",
          question: "Can you help with both website design and digital marketing?",
          answer: "Absolutely! We can handle everything from website design and development to complete digital marketing campaigns. This integrated approach ensures consistency and better results."
        },
        {
          id: "service-3",
          question: "Do you provide ongoing support after project completion?",
          answer: "Yes, we offer ongoing support and maintenance for all our services. This includes regular updates, performance monitoring, troubleshooting, and smart improvements to ensure continued success."
        },
        {
          id: "service-4",
          question: "What makes your approach different from other agencies?",
          answer: "Our approach is numbers driven, not guesswork. We focus on measurable results, transparent reporting, and month to month contracts with no long term lock ins. Our team combines creative expertise with careful analysis."
        },
        {
          id: "service-5",
          question: "Do you handle both B2B and B2C marketing?",
          answer: "Yes, we have extensive experience with both B2B and B2C marketing strategies. Our approach adapts to your specific audience, sales cycle, and business model to deliver optimal results."
        },
        {
          id: "service-6",
          question: "Can you integrate AI into our existing business processes?",
          answer: "Yes, our AI implementation services help businesses automate processes, improve decision-making, and enhance customer experiences. We assess your current operations and recommend custom AI solutions that fit your needs."
        }
      ]
    },
    {
      title: "Investment & Contracts",
      faqs: [
        {
          id: "investment-1",
          question: "What's your pricing structure?",
          answer: "Our pricing varies based on services and scope. Web design projects typically start at $5,000, while ongoing digital marketing services start at $2,000/month. We provide custom quotes after understanding your specific needs and goals."
        },
        {
          id: "investment-2",
          question: "Do you require long term contracts?",
          answer: "No, we offer month to month contracts for our services. We believe in earning your business every month through results, not locking you into long term agreements you might not need."
        },
        {
          id: "investment-3",
          question: "What's included in your monthly retainer?",
          answer: "Monthly retainers typically include strategy development, campaign management, content creation, performance monitoring, monthly reporting, and ongoing improvements. Specific inclusions depend on your chosen service package."
        },
        {
          id: "investment-4",
          question: "Are there any setup fees or hidden costs?",
          answer: "We're transparent about all costs upfront. Some services may include one time setup fees (clearly outlined in proposals), but there are no hidden costs. All ongoing expenses are discussed and approved before implementation."
        },
        {
          id: "investment-5",
          question: "What kind of ROI can I expect?",
          answer: "While results vary by industry and goals, our clients typically see 150-300% ROI within 6-12 months. We focus on measurable outcomes and provide detailed tracking to demonstrate value and return on investment."
        },
        {
          id: "investment-6",
          question: "Do you offer guarantees on your work?",
          answer: "We guarantee the quality of our work and stand behind our deliverables. While we can't guarantee specific results (as marketing involves many variables), we do guarantee our commitment to achieving your goals through smart strategies."
        }
      ]
    }
  ];

  return (
    <section className="py-20 bg-gradient-to-b from-white via-cool-gray to-secondary/5 relative overflow-hidden">
      {/* Decorative background */}
      <div className="absolute inset-0 opacity-20">
        <div className="absolute top-1/4 left-10 w-80 h-80 bg-gradient-to-br from-secondary to-accent rounded-full mix-blend-multiply filter blur-3xl animate-pulse"></div>
        <div className="absolute bottom-1/4 right-10 w-80 h-80 bg-gradient-to-br from-primary to-secondary rounded-full mix-blend-multiply filter blur-3xl animate-pulse" style={{animationDelay: '1.5s'}}></div>
      </div>
      
      <div className="section-container relative z-10">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mb-16"
        >
          <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
            Frequently Asked Questions
          </h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            Get answers to common questions about our digital marketing services, 
            process, and partnership approach.
          </p>
        </motion.div>

        <div className="space-y-12">
          {faqCategories.map((category, categoryIndex) => (
            <motion.div
              key={categoryIndex}
              initial={{ opacity: 0, y: 30 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: categoryIndex * 0.2 }}
              viewport={{ once: true }}
              className="bg-white rounded-lg shadow-lg p-8"
            >
              <h3 className="text-2xl font-semibold text-gray-900 mb-8 pb-4 border-b border-gray-200">
                {category.title}
              </h3>
              
              <div className="space-y-4">
                {category.faqs.map((faq, faqIndex) => (
                  <div
                    key={faq.id}
                    className="border border-gray-200 rounded-lg overflow-hidden"
                  >
                    <button
                      type="button"
                      onClick={() => toggleItem(faq.id)}
                      className="w-full text-left p-6 hover:bg-gray-50 transition-colors focus:outline-none focus:bg-gray-50"
                      aria-expanded={openItems[faq.id]}
                      aria-controls={`faq-answer-${faq.id}`}
                    >
                      <div className="flex items-center justify-between">
                        <h4 className="text-lg font-medium text-gray-900 pr-4">
                          {faq.question}
                        </h4>
                        {openItems[faq.id] ? (
                          <Minus className="h-5 w-5 text-primary flex-shrink-0" />
                        ) : (
                          <Plus className="h-5 w-5 text-primary flex-shrink-0" />
                        )}
                      </div>
                    </button>
                    
                    <motion.div
                      id={`faq-answer-${faq.id}`}
                      initial={false}
                      animate={{
                        height: openItems[faq.id] ? "auto" : 0,
                        opacity: openItems[faq.id] ? 1 : 0
                      }}
                      transition={{ duration: 0.3 }}
                      className="overflow-hidden"
                    >
                      <div className="px-6 pb-6">
                        <p className="text-gray-600 leading-relaxed">
                          {faq.answer}
                        </p>
                      </div>
                    </motion.div>
                  </div>
                ))}
              </div>
            </motion.div>
          ))}
        </div>

        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mt-16"
        >
          <h3 className="text-2xl font-semibold text-gray-900 mb-4">
            Still Have Questions?
          </h3>
          <p className="text-gray-600 mb-6">
            Can't find what you're looking for? We're here to help with personalized answers.
          </p>
          <motion.a
            href="/contact"
            whileHover={{ scale: 1.05 }}
            whileTap={{ scale: 0.95 }}
            className="inline-block bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal px-10 py-4 rounded-lg font-bold shadow-xl hover:shadow-2xl transition-all btn-breathe btn-glow text-lg"
          >
            Contact Us Today
          </motion.a>
        </motion.div>
      </div>
    </section>
  );
};

export default FAQSection;

// ==========================================
// File: components/file-upload.tsx
// ==========================================


'use client';

import { useState, useRef, ChangeEvent } from 'react';
import { Upload, X, Image as ImageIcon } from 'lucide-react';
import { Button } from '@/components/ui/button';
import Image from 'next/image';

interface FileUploadProps {
  value?: string;
  onChange: (cloudStoragePath: string) => void;
  accept?: string;
  maxSizeMB?: number;
  label?: string;
  description?: string;
}

export function FileUpload({
  value,
  onChange,
  accept = 'image/*',
  maxSizeMB = 10,
  label = 'Upload Image',
  description = 'Click to upload or drag and drop'
}: FileUploadProps) {
  const [uploading, setUploading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [preview, setPreview] = useState<string | null>(value || null);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleFileChange = async (e: ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    // Validate file size
    const maxSize = maxSizeMB * 1024 * 1024;
    if (file.size > maxSize) {
      setError(`File size must be less than ${maxSizeMB}MB`);
      return;
    }

    setError(null);
    setUploading(true);

    try {
      // Create preview
      const reader = new FileReader();
      reader.onloadend = () => {
        setPreview(reader.result as string);
      };
      reader.readAsDataURL(file);

      // Upload to server
      const formData = new FormData();
      formData.append('file', file);

      const response = await fetch('/api/upload', {
        method: 'POST',
        body: formData,
      });

      if (!response.ok) {
        const data = await response.json();
        throw new Error(data.error || 'Upload failed');
      }

      const data = await response.json();
      onChange(data.cloudStoragePath);

    } catch (err) {
      console.error('Upload error:', err);
      setError(err instanceof Error ? err.message : 'Upload failed');
      setPreview(null);
    } finally {
      setUploading(false);
    }
  };

  const handleRemove = () => {
    setPreview(null);
    onChange('');
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  const handleClick = () => {
    fileInputRef.current?.click();
  };

  return (
    <div className="space-y-2">
      {label && (
        <label className="text-sm font-medium text-gray-700">
          {label}
        </label>
      )}

      <div className="relative">
        {preview ? (
          <div className="relative group">
            <div className="relative w-full h-64 rounded-lg overflow-hidden bg-gray-100 border-2 border-gray-200">
              <Image
                src={preview.startsWith('uploads/') ? `/api/file/${encodeURIComponent(preview)}` : preview}
                alt="Preview"
                fill
                className="object-contain"
              />
            </div>
            <div className="absolute top-2 right-2 flex gap-2">
              <Button
                type="button"
                size="sm"
                variant="destructive"
                onClick={handleRemove}
                disabled={uploading}
              >
                <X className="h-4 w-4" />
              </Button>
            </div>
          </div>
        ) : (
          <div
            onClick={handleClick}
            className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer"
          >
            <div className="flex flex-col items-center gap-2">
              {uploading ? (
                <>
                  <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                  <p className="text-sm text-gray-600">Uploading...</p>
                </>
              ) : (
                <>
                  <ImageIcon className="h-12 w-12 text-gray-400" />
                  <div>
                    <p className="text-sm font-medium text-gray-700">{description}</p>
                    <p className="text-xs text-gray-500 mt-1">
                      Max size: {maxSizeMB}MB
                    </p>
                  </div>
                </>
              )}
            </div>
          </div>
        )}

        <input
          ref={fileInputRef}
          type="file"
          accept={accept}
          onChange={handleFileChange}
          className="hidden"
          disabled={uploading}
        />
      </div>

      {error && (
        <p className="text-sm text-red-600">{error}</p>
      )}
    </div>
  );
}

// ==========================================
// File: components/fomo-notifications.tsx
// ==========================================


"use client";

import { useState, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { CheckCircle, TrendingUp, Sparkles } from "lucide-react";

interface Notification {
  id: string;
  name: string;
  tool: string;
  location: string;
  timestamp: string;
}

const TOOLS = [
  "ROI Calculator",
  "SEO Checker",
  "Website Auditor",
  "Email Tester",
  "Conversion Analyzer",
  "Budget Calculator"
];

const LOCATIONS = [
  "New York, NY",
  "Los Angeles, CA",
  "Chicago, IL",
  "Houston, TX",
  "Phoenix, AZ",
  "Philadelphia, PA",
  "San Antonio, TX",
  "San Diego, CA",
  "Dallas, TX",
  "Miami, FL",
  "Austin, TX",
  "Seattle, WA",
  "Denver, CO",
  "Boston, MA",
  "Portland, OR"
];

const NAMES = [
  "Michael",
  "Sarah",
  "Jennifer",
  "David",
  "Jessica",
  "James",
  "Emily",
  "Robert",
  "Lisa",
  "William",
  "Karen",
  "Daniel",
  "Amanda",
  "Thomas",
  "Melissa"
];

const generateNotification = (): Notification => {
  const name = NAMES[Math.floor(Math.random() * NAMES.length)];
  const tool = TOOLS[Math.floor(Math.random() * TOOLS.length)];
  const location = LOCATIONS[Math.floor(Math.random() * LOCATIONS.length)];
  const minutesAgo = Math.floor(Math.random() * 15) + 1;
  
  return {
    id: Date.now().toString(),
    name,
    tool,
    location,
    timestamp: minutesAgo === 1 ? "Just now" : `${minutesAgo} min ago`
  };
};

export default function FOMONotifications() {
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [currentNotification, setCurrentNotification] = useState<Notification | null>(null);

  useEffect(() => {
    // Show first notification after 5 seconds
    const firstTimeout = setTimeout(() => {
      const notification = generateNotification();
      setCurrentNotification(notification);
      setNotifications(prev => [notification, ...prev]);
    }, 5000);

    return () => clearTimeout(firstTimeout);
  }, []);

  useEffect(() => {
    if (currentNotification) {
      // Hide after 6 seconds
      const hideTimeout = setTimeout(() => {
        setCurrentNotification(null);
      }, 6000);

      // Show next notification after 15-30 seconds
      const nextTimeout = setTimeout(() => {
        const notification = generateNotification();
        setCurrentNotification(notification);
        setNotifications(prev => [notification, ...prev].slice(0, 10));
      }, Math.random() * 15000 + 15000);

      return () => {
        clearTimeout(hideTimeout);
        clearTimeout(nextTimeout);
      };
    }
  }, [currentNotification]);

  return (
    <AnimatePresence>
      {currentNotification && (
        <motion.div
          initial={{ x: -400, opacity: 0 }}
          animate={{ x: 0, opacity: 1 }}
          exit={{ x: -400, opacity: 0 }}
          transition={{ duration: 0.5, ease: "easeOut" }}
          className="fixed bottom-4 left-4 z-50 max-w-sm"
        >
          <div className="bg-white rounded-xl shadow-2xl border-2 border-gray-200 p-4 pr-6">
            <div className="flex items-start gap-3">
              {/* Icon */}
              <div className="flex-shrink-0 bg-gradient-to-br from-green-600 to-emerald-600 p-2 rounded-lg">
                <CheckCircle className="h-5 w-5 text-white" />
              </div>

              {/* Content */}
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2 mb-1">
                  <p className="text-sm font-semibold text-gray-900">
                    {currentNotification.name}
                  </p>
                  <span className="flex items-center gap-1 text-xs text-gray-500">
                    <Sparkles className="h-3 w-3" />
                    {currentNotification.timestamp}
                  </span>
                </div>
                <p className="text-sm text-gray-600">
                  Just used <span className="font-semibold text-green-700">{currentNotification.tool}</span>
                </p>
                <p className="text-xs text-gray-500 mt-1">
                  üìç {currentNotification.location}
                </p>
              </div>

              {/* Pulse indicator */}
              <div className="flex-shrink-0 relative">
                <span className="relative flex h-3 w-3">
                  <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-500 opacity-75"></span>
                  <span className="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                </span>
              </div>
            </div>

            {/* Trust Badge */}
            <div className="mt-3 pt-3 border-t border-gray-100 flex items-center justify-between text-xs text-gray-500">
              <div className="flex items-center gap-1">
                <TrendingUp className="h-3 w-3 text-green-600" />
                <span className="font-semibold">2,847 users</span> in last 7 days
              </div>
              <span className="text-green-700 font-semibold">üî• Active</span>
            </div>
          </div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}

// ==========================================
// File: components/footer.tsx
// ==========================================

"use client";

import Link from "next/link";
import { Phone, Mail, MapPin } from "lucide-react";
import { useState, useEffect } from "react";

const Footer = () => {
  const [currentYear, setCurrentYear] = useState<number>(2025);
  
  useEffect(() => {
    setCurrentYear(new Date().getFullYear());
  }, []);

  return (
    <footer className="bg-charcoal text-white py-12">
      <div className="section-container">
        <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
          {/* Company Info */}
          <div className="md:col-span-2">
            <div className="flex items-center space-x-2 mb-4">
              <div className="bg-gradient-to-r from-secondary to-accent text-charcoal px-3 py-1 rounded font-bold text-lg">
                CDM
              </div>
              <span className="font-semibold text-xl">Suite</span>
            </div>
            <p className="text-gray-300 mb-6 max-w-md">
              Digital marketing agency delivering real results. 
              We help businesses grow through smart web design, digital advertising, 
              mobile app development, and AI implementation services.
            </p>
            
            {/* Contact Info */}
            <div className="space-y-3">
              <a 
                href="tel:8622727623" 
                className="flex items-center gap-3 text-gray-300 hover:text-white transition-colors group"
              >
                <div className="bg-secondary/20 p-2 rounded group-hover:bg-secondary/30 transition-colors">
                  <Phone className="w-5 h-5" />
                </div>
                <div>
                  <div className="text-sm text-gray-400">Call us now</div>
                  <div className="font-bold text-lg">(862) 272-7623</div>
                </div>
              </a>
              
              <a 
                href="mailto:hello@cdmsuite.com" 
                className="flex items-center gap-3 text-gray-300 hover:text-white transition-colors group"
              >
                <div className="bg-secondary/20 p-2 rounded group-hover:bg-secondary/30 transition-colors">
                  <Mail className="w-5 h-5" />
                </div>
                <div>
                  <div className="text-sm text-gray-400">Email us</div>
                  <div className="font-semibold">hello@cdmsuite.com</div>
                </div>
              </a>
              
              <div className="flex items-center gap-3 text-gray-300">
                <div className="bg-secondary/20 p-2 rounded">
                  <MapPin className="w-5 h-5" />
                </div>
                <div>
                  <div className="text-sm text-gray-400">Serving</div>
                  <div className="font-semibold">USA & Central America</div>
                </div>
              </div>
            </div>
          </div>

          {/* Services */}
          <div>
            <h4 className="font-semibold text-lg mb-4">Services</h4>
            <ul className="space-y-2 text-gray-300">
              <li><Link href="/#services" className="hover:text-white transition-colors">Responsive Web Design</Link></li>
              <li><Link href="/#services" className="hover:text-white transition-colors">Digital Advertising</Link></li>
              <li><Link href="/#services" className="hover:text-white transition-colors">Mobile App Development</Link></li>
              <li><Link href="/#services" className="hover:text-white transition-colors">AI Implementation</Link></li>
            </ul>
          </div>

          {/* Company */}
          <div>
            <h4 className="font-semibold text-lg mb-4">Company</h4>
            <ul className="space-y-2 text-gray-300">
              <li><Link href="/about" className="hover:text-white transition-colors">About CDM Suite</Link></li>
              <li><Link href="/tools" className="hover:text-white transition-colors">Free Tools</Link></li>
              <li><Link href="/case-studies" className="hover:text-white transition-colors">Case Studies</Link></li>
              <li><Link href="/blog" className="hover:text-white transition-colors">Blog</Link></li>
              <li><Link href="/contact" className="hover:text-white transition-colors">Contact</Link></li>
            </ul>
          </div>
        </div>

        <div className="border-t border-gray-700 mt-8 pt-8 text-center">
          <p className="text-gray-400">
            ¬© {currentYear} CDM Suite. All rights reserved.
          </p>
        </div>
      </div>
    </footer>
  );
};

export default Footer;

// ==========================================
// File: components/gallery/agent-gallery-client.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Bot, MessageSquare, Users, Star, Search } from "lucide-react";
import Image from "next/image";

export function AgentGalleryClient({ agents: initialAgents }: { agents: any[] }) {
  const [agents, setAgents] = useState(initialAgents);
  const [search, setSearch] = useState("");
  const [selectedType, setSelectedType] = useState("all");

  const types = ["all", ...Array.from(new Set(agents.map(a => a.agentType)))];

  const filteredAgents = agents.filter(agent => {
    const matchesSearch = agent.name.toLowerCase().includes(search.toLowerCase()) ||
                          (agent.galleryDescription && agent.galleryDescription.toLowerCase().includes(search.toLowerCase()));
    const matchesType = selectedType === "all" || agent.agentType === selectedType;
    return matchesSearch && matchesType;
  });

  return (
    <div className="min-h-screen py-12">
      <div className="container mx-auto px-4">
        {/* Header */}
        <div className="text-center mb-12">
          <h1 className="text-4xl md:text-5xl font-bold mb-4">
            AI Agent Gallery
          </h1>
          <p className="text-xl text-muted-foreground max-w-2xl mx-auto">
            Discover powerful AI agents built with CDM Suite AI Agent Builder
          </p>
        </div>

        {/* Filters */}
        <div className="mb-8 space-y-4">
          <div className="relative max-w-md mx-auto">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5" />
            <Input
              placeholder="Search agents..."
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="pl-10"
            />
          </div>

          <div className="flex flex-wrap justify-center gap-2">
            {types.map(type => (
              <Button
                key={type}
                variant={selectedType === type ? "default" : "outline"}
                size="sm"
                onClick={() => setSelectedType(type)}
              >
                {type === "all" ? "All" : type.split('-').map((word: string) => 
                  word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ')}
              </Button>
            ))}
          </div>
        </div>

        {/* Gallery Grid */}
        {filteredAgents.length === 0 ? (
          <div className="text-center py-12">
            <Bot className="w-16 h-16 mx-auto text-muted-foreground mb-4" />
            <p className="text-muted-foreground">No agents found</p>
          </div>
        ) : (
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredAgents.map((agent) => (
              <Card key={agent.id} className="p-6 hover:shadow-xl transition-shadow">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center">
                    <Bot className="w-6 h-6 text-white" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-lg font-semibold mb-1">
                      {agent.galleryTitle || agent.name}
                    </h3>
                    <p className="text-sm text-muted-foreground capitalize">
                      {agent.agentType.replace(/-/g, " ")}
                    </p>
                  </div>
                </div>

                <p className="text-sm text-muted-foreground mb-4">
                  {agent.galleryDescription || `An AI agent for ${agent.agentType.replace(/-/g, " ")}`}
                </p>

                <div className="grid grid-cols-3 gap-2 mb-4 text-sm">
                  <div className="text-center p-2 bg-muted rounded-lg">
                    <MessageSquare className="w-4 h-4 mx-auto mb-1 text-primary" />
                    <p className="font-semibold">{agent.totalConversations}</p>
                    <p className="text-xs text-muted-foreground">Convos</p>
                  </div>
                  <div className="text-center p-2 bg-muted rounded-lg">
                    <Users className="w-4 h-4 mx-auto mb-1 text-primary" />
                    <p className="font-semibold">{agent.totalLeadsCaptured}</p>
                    <p className="text-xs text-muted-foreground">Leads</p>
                  </div>
                  <div className="text-center p-2 bg-muted rounded-lg">
                    <Star className="w-4 h-4 mx-auto mb-1 text-primary" />
                    <p className="font-semibold">
                      {agent.satisfactionRating ? agent.satisfactionRating.toFixed(1) : "N/A"}
                    </p>
                    <p className="text-xs text-muted-foreground">Rating</p>
                  </div>
                </div>

                {agent.galleryTags && agent.galleryTags.length > 0 && (
                  <div className="flex flex-wrap gap-1 mb-4">
                    {agent.galleryTags.slice(0, 3).map((tag: string) => (
                      <span
                        key={tag}
                        className="px-2 py-1 text-xs bg-primary/10 text-primary rounded-full"
                      >
                        {tag}
                      </span>
                    ))}
                  </div>
                )}

                <Button variant="outline" className="w-full">
                  View Agent
                </Button>
              </Card>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

// ==========================================
// File: components/gallery/website-gallery-client.tsx
// ==========================================


"use client";

import { useState } from "react";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Globe, Eye, Heart, ExternalLink, Search } from "lucide-react";
import Image from "next/image";
import Link from "next/link";

export function WebsiteGalleryClient({ websites: initialWebsites }: { websites: any[] }) {
  const [websites, setWebsites] = useState(initialWebsites);
  const [search, setSearch] = useState("");
  const [selectedCategory, setSelectedCategory] = useState("all");

  const categories = ["all", ...Array.from(new Set(websites.map(w => w.category)))];

  const filteredWebsites = websites.filter(website => {
    const matchesSearch = website.title.toLowerCase().includes(search.toLowerCase()) ||
                          website.description.toLowerCase().includes(search.toLowerCase());
    const matchesCategory = selectedCategory === "all" || website.category === selectedCategory;
    return matchesSearch && matchesCategory;
  });

  return (
    <div className="min-h-screen py-12">
      <div className="container mx-auto px-4">
        {/* Header */}
        <div className="text-center mb-12">
          <h1 className="text-4xl md:text-5xl font-bold mb-4">
            Website Gallery
          </h1>
          <p className="text-xl text-muted-foreground max-w-2xl mx-auto">
            Explore stunning websites built with CDM Suite AI Website Builder
          </p>
        </div>

        {/* Filters */}
        <div className="mb-8 space-y-4">
          <div className="relative max-w-md mx-auto">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5" />
            <Input
              placeholder="Search websites..."
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="pl-10"
            />
          </div>

          <div className="flex flex-wrap justify-center gap-2">
            {categories.map(category => (
              <Button
                key={category}
                variant={selectedCategory === category ? "default" : "outline"}
                size="sm"
                onClick={() => setSelectedCategory(category)}
              >
                {category === "all" ? "All" : category.charAt(0).toUpperCase() + category.slice(1)}
              </Button>
            ))}
          </div>
        </div>

        {/* Gallery Grid */}
        {filteredWebsites.length === 0 ? (
          <div className="text-center py-12">
            <Globe className="w-16 h-16 mx-auto text-muted-foreground mb-4" />
            <p className="text-muted-foreground">No websites found</p>
          </div>
        ) : (
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredWebsites.map((website) => (
              <Card key={website.id} className="overflow-hidden hover:shadow-xl transition-shadow">
                <div className="relative aspect-video bg-muted">
                  {website.thumbnail && (
                    <Image
                      src={website.thumbnail}
                      alt={website.title}
                      fill
                      className="object-cover"
                    />
                  )}
                </div>
                <div className="p-6">
                  <div className="flex justify-between items-start mb-3">
                    <div>
                      <h3 className="text-lg font-semibold mb-1">{website.title}</h3>
                      <p className="text-sm text-muted-foreground capitalize">
                        {website.category}
                        {website.industry && ` ‚Ä¢ ${website.industry}`}
                      </p>
                    </div>
                    {website.isFeatured && (
                      <span className="px-2 py-1 text-xs bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300 rounded-full">
                        Featured
                      </span>
                    )}
                  </div>

                  <p className="text-sm text-muted-foreground mb-4 line-clamp-2">
                    {website.description}
                  </p>

                  <div className="flex items-center justify-between text-sm text-muted-foreground mb-4">
                    <div className="flex items-center gap-4">
                      <span className="flex items-center gap-1">
                        <Eye className="w-4 h-4" />
                        {website.views}
                      </span>
                      <span className="flex items-center gap-1">
                        <Heart className="w-4 h-4" />
                        {website.likes}
                      </span>
                    </div>
                  </div>

                  {website.liveUrl && (
                    <a
                      href={website.liveUrl}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="block"
                    >
                      <Button variant="outline" className="w-full">
                        <ExternalLink className="w-4 h-4 mr-2" />
                        View Live Site
                      </Button>
                    </a>
                  )}
                </div>
              </Card>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

// ==========================================
// File: components/hero-section.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Link from "next/link";
import Image from "next/image";
import { Button } from "@/components/ui/button";
import { ArrowRight, CheckCircle } from "lucide-react";

const HeroSection = () => {
  return (
    <section className="relative min-h-[75vh] md:min-h-[85vh] flex items-center justify-center overflow-hidden pt-20 md:pt-0">
      {/* Background Image - More Approachable */}
      <div className="absolute inset-0 z-0">
        <div className="relative w-full h-full">
          <Image
            src="https://cdn.abacus.ai/images/e82e2d74-297b-40c9-838d-190a47e307dd.png"
            alt="Diverse team of Black professionals collaborating in modern office"
            fill
            className="object-cover brightness-95"
            priority
          />
          {/* Lighter overlay for more approachable feel */}
          <div className="absolute inset-0 bg-gradient-to-r from-gray-900/80 via-gray-900/60 to-gray-900/40"></div>
        </div>
      </div>

      {/* Content */}
      <div className="relative z-10 section-container text-white">
        <div className="grid lg:grid-cols-2 gap-12 items-center">
          <motion.div
            initial={{ opacity: 0, x: -30 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8, delay: 0.2 }}
          >
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: 0.3 }}
              className="inline-block bg-secondary/20 backdrop-blur-sm border border-secondary/30 rounded-full px-4 py-2 mb-3 md:mb-6"
            >
              <span className="text-secondary font-semibold text-sm md:text-base">üöÄ Your Growth Partner</span>
            </motion.div>
            
            <motion.h1 
              className="text-3xl md:text-5xl lg:text-6xl font-bold mb-3 md:mb-6 leading-tight"
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.4 }}
            >
              Enterprise-Grade Digital Solutions
              <br />
              <span className="bg-gradient-to-r from-secondary via-accent to-secondary bg-clip-text text-transparent">Backed by Infrastructure Expertise</span>
            </motion.h1>
            
            <motion.p 
              className="text-base md:text-xl mb-4 md:mb-8 text-gray-200 leading-relaxed hidden md:block"
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.6 }}
            >
              Our leadership team combines multi-billion dollar infrastructure program experience with proven sales and operations management expertise. This unique blend ensures every digital solution is delivered with rigorous planning, strategic financial oversight, and the same execution standards used in landmark public sector and enterprise projects.
            </motion.p>

            {/* Shortened version for mobile */}
            <motion.p 
              className="text-base mb-4 text-gray-200 leading-relaxed md:hidden"
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.6 }}
            >
              Multi-billion dollar infrastructure expertise meets proven sales and operations management. Enterprise-grade delivery standards for your digital solutions.
            </motion.p>

            {/* Trust Indicators - CRO Optimization */}
            <motion.div 
              className="flex flex-wrap gap-2 md:gap-4 mb-4 md:mb-8"
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.7 }}
            >
              <div className="flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-3 md:px-4 py-1.5 md:py-2">
                <CheckCircle className="h-4 w-4 md:h-5 md:w-5 text-accent" />
                <span className="text-xs md:text-sm font-medium">$9B+ Infrastructure</span>
              </div>
              <div className="flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-3 md:px-4 py-1.5 md:py-2">
                <CheckCircle className="h-4 w-4 md:h-5 md:w-5 text-accent" />
                <span className="text-xs md:text-sm font-medium">$2.4M+ Sales</span>
              </div>
              <div className="flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-3 md:px-4 py-1.5 md:py-2">
                <CheckCircle className="h-4 w-4 md:h-5 md:w-5 text-accent" />
                <span className="text-xs md:text-sm font-medium">120%+ Growth</span>
              </div>
            </motion.div>
            
            <motion.div 
              className="flex flex-col sm:flex-row gap-3 md:gap-4"
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.8 }}
            >
              <Link href="/contact" className="w-full sm:w-auto">
                <Button size="lg" className="w-full sm:w-auto bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold shadow-xl hover:shadow-2xl transition-all duration-300 group text-base md:text-lg px-6 md:px-8 py-5 md:py-6 btn-breathe btn-glow">
                  Get Your Free Strategy Call
                  <ArrowRight className="ml-2 h-4 w-4 md:h-5 md:w-5 group-hover:translate-x-1 transition-transform" />
                </Button>
              </Link>
              <Link href="/services" className="w-full sm:w-auto hidden sm:block">
                <Button size="lg" variant="outline" className="w-full sm:w-auto bg-white/10 backdrop-blur-sm border-2 border-secondary/50 text-white hover:bg-secondary hover:text-charcoal text-base md:text-lg px-6 md:px-8 py-5 md:py-6 font-semibold">
                  View Our Services
                </Button>
              </Link>
            </motion.div>

            {/* Social Proof */}
            <motion.p
              className="mt-4 md:mt-6 text-xs md:text-sm text-gray-300"
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ duration: 0.8, delay: 1 }}
            >
              ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Trusted by businesses across industries
            </motion.p>
          </motion.div>

          {/* Stats Card - CRO Element */}
          <motion.div
            initial={{ opacity: 0, x: 30 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8, delay: 0.4 }}
            className="hidden lg:block"
          >
            <div className="bg-white/95 backdrop-blur-sm rounded-2xl p-8 shadow-2xl">
              <h3 className="text-2xl font-bold text-gray-900 mb-6">Why Work With CDM Suite</h3>
              <div className="space-y-6">
                <div className="flex items-start gap-4">
                  <div className="flex-shrink-0 w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center">
                    <span className="text-2xl">üèóÔ∏è</span>
                  </div>
                  <div>
                    <h4 className="font-semibold text-gray-900 mb-1">Infrastructure-Grade Standards</h4>
                    <p className="text-gray-600 text-sm">Rigorous project controls from $9B+ infrastructure programs</p>
                  </div>
                </div>
                <div className="flex items-start gap-4">
                  <div className="flex-shrink-0 w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center">
                    <span className="text-2xl">üíº</span>
                  </div>
                  <div>
                    <h4 className="font-semibold text-gray-900 mb-1">Sales & Financial Planning</h4>
                    <p className="text-gray-600 text-sm">Licensed financial expertise with $2.4M+ in documented results</p>
                  </div>
                </div>
                <div className="flex items-start gap-4">
                  <div className="flex-shrink-0 w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center">
                    <span className="text-2xl">üìà</span>
                  </div>
                  <div>
                    <h4 className="font-semibold text-gray-900 mb-1">Operations Excellence</h4>
                    <p className="text-gray-600 text-sm">Proven 120%+ profit growth through strategic management</p>
                  </div>
                </div>
                <div className="flex items-start gap-4">
                  <div className="flex-shrink-0 w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center">
                    <span className="text-2xl">üë•</span>
                  </div>
                  <div>
                    <h4 className="font-semibold text-gray-900 mb-1">Team Leadership</h4>
                    <p className="text-gray-600 text-sm">Experience managing 50+ person teams across sectors</p>
                  </div>
                </div>
              </div>
              <div className="mt-8 pt-6 border-t border-gray-200">
                <p className="text-sm text-gray-600 text-center font-medium">
                  üîí Professional Service ‚Ä¢ Reliable Delivery
                </p>
              </div>
            </div>
          </motion.div>
        </div>
      </div>
    </section>
  );
};

export default HeroSection;

// ==========================================
// File: components/loading-animation.tsx
// ==========================================


'use client';

import { motion, AnimatePresence } from 'framer-motion';
import { Loader2, Sparkles, TrendingUp, Zap, Target, Award } from 'lucide-react';

interface LoadingAnimationProps {
  toolName: string;
  messages?: string[];
  duration?: number;
}

export default function LoadingAnimation({ 
  toolName, 
  messages,
  duration = 5000 
}: LoadingAnimationProps) {
  const defaultMessages = [
    { text: "üîç Scanning your data...", icon: Sparkles },
    { text: "üìä Analyzing metrics...", icon: TrendingUp },
    { text: "‚ö° Optimizing results...", icon: Zap },
    { text: "üéØ Generating insights...", icon: Target },
    { text: "‚ú® Almost there...", icon: Award }
  ];

  const displayMessages = messages || defaultMessages.map(m => m.text);
  const messageInterval = duration / displayMessages.length;

  return (
    <div className="fixed inset-0 bg-gradient-to-br from-primary/95 via-charcoal/95 to-accent/95 backdrop-blur-lg z-50 flex items-center justify-center p-4">
      <motion.div
        initial={{ opacity: 0, scale: 0.9 }}
        animate={{ opacity: 1, scale: 1 }}
        exit={{ opacity: 0, scale: 0.9 }}
        className="max-w-md w-full"
      >
        <div className="bg-white rounded-2xl shadow-2xl p-8 md:p-12 text-center">
          {/* Animated Logo/Icon */}
          <motion.div
            animate={{ 
              rotate: 360,
              scale: [1, 1.1, 1]
            }}
            transition={{ 
              rotate: { duration: 2, repeat: Infinity, ease: "linear" },
              scale: { duration: 1, repeat: Infinity, ease: "easeInOut" }
            }}
            className="w-20 h-20 md:w-24 md:h-24 mx-auto mb-6 bg-gradient-to-br from-accent to-secondary rounded-full flex items-center justify-center shadow-xl"
          >
            <Loader2 className="w-10 h-10 md:w-12 md:h-12 text-white" />
          </motion.div>

          {/* Main Heading */}
          <h3 className="text-2xl md:text-3xl font-bold text-charcoal mb-4">
            Analyzing Your {toolName}...
          </h3>

          {/* FOMO Subtitle */}
          <p className="text-base md:text-lg text-gray-600 mb-8">
            üî• <span className="font-semibold">167 businesses</span> used this tool in the last 24 hours
          </p>

          {/* Progress Bar */}
          <div className="relative h-3 bg-gray-200 rounded-full overflow-hidden mb-6">
            <motion.div
              initial={{ width: "0%" }}
              animate={{ width: "100%" }}
              transition={{ duration: duration / 1000, ease: "linear" }}
              className="absolute inset-y-0 left-0 bg-gradient-to-r from-accent via-secondary to-accent bg-[length:200%_100%] animate-shimmer"
            />
          </div>

          {/* Rotating Messages */}
          <div className="h-16 md:h-20 flex items-center justify-center">
            <AnimatePresence mode="wait">
              {defaultMessages.map((msg, index) => (
                <motion.div
                  key={index}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ 
                    opacity: 1, 
                    y: 0,
                    transition: { 
                      delay: (messageInterval * index) / 1000,
                      duration: 0.5 
                    }
                  }}
                  exit={{ opacity: 0, y: -20 }}
                  className="absolute flex items-center gap-3 text-gray-700 text-base md:text-lg font-medium"
                  style={{
                    animationDelay: `${(messageInterval * index) / 1000}s`,
                    animationDuration: `${messageInterval / 1000}s`,
                    animationIterationCount: 1,
                    animationFillMode: 'both',
                    animationName: index < displayMessages.length - 1 ? 'fadeInOut' : 'fadeIn'
                  }}
                >
                  <msg.icon className="w-5 h-5 md:w-6 md:h-6 text-accent animate-pulse" />
                  <span>{msg.text}</span>
                </motion.div>
              ))}
            </AnimatePresence>
          </div>

          {/* Trust Indicators */}
          <div className="mt-8 pt-6 border-t border-gray-200">
            <div className="grid grid-cols-3 gap-4 text-center">
              <div>
                <div className="text-xl md:text-2xl font-bold text-accent">50K+</div>
                <div className="text-xs md:text-sm text-gray-500">Audits</div>
              </div>
              <div>
                <div className="text-xl md:text-2xl font-bold text-secondary">4.9‚òÖ</div>
                <div className="text-xs md:text-sm text-gray-500">Rating</div>
              </div>
              <div>
                <div className="text-xl md:text-2xl font-bold text-accent">98%</div>
                <div className="text-xs md:text-sm text-gray-500">Satisfied</div>
              </div>
            </div>
          </div>

          {/* Small Print */}
          <p className="mt-6 text-xs md:text-sm text-gray-400">
            ‚ö° This usually takes less than 5 seconds
          </p>
        </div>
      </motion.div>

      <style jsx>{`
        @keyframes fadeInOut {
          0%, 100% { opacity: 0; transform: translateY(20px); }
          20%, 80% { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
          0% { opacity: 0; transform: translateY(20px); }
          100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes shimmer {
          0% { background-position: -200% 0; }
          100% { background-position: 200% 0; }
        }
        .animate-shimmer {
          animation: shimmer 2s linear infinite;
        }
      `}</style>
    </div>
  );
}

// ==========================================
// File: components/marketing-assessment-client.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { 
  CheckCircle2, 
  ArrowRight, 
  ArrowLeft, 
  Sparkles,
  TrendingUp,
  Target,
  Zap,
  Download,
  Mail
} from 'lucide-react';
import { useToast } from '@/hooks/use-toast';
import { trackRedditLead } from '@/lib/reddit-tracking';
import { trackConversion } from '@/lib/analytics';

interface Question {
  id: string;
  question: string;
  options: { value: string; label: string; score: number }[];
  category: string;
}

const questions: Question[] = [
  {
    id: 'website_traffic',
    question: 'How much traffic does your website get monthly?',
    category: 'Traffic',
    options: [
      { value: 'none', label: 'Less than 1,000 visitors', score: 1 },
      { value: 'low', label: '1,000 - 5,000 visitors', score: 2 },
      { value: 'medium', label: '5,000 - 20,000 visitors', score: 3 },
      { value: 'high', label: '20,000+ visitors', score: 4 },
    ],
  },
  {
    id: 'conversion_rate',
    question: 'What\'s your website conversion rate?',
    category: 'Conversions',
    options: [
      { value: 'dont_know', label: 'I don\'t know', score: 0 },
      { value: 'very_low', label: 'Less than 1%', score: 1 },
      { value: 'low', label: '1% - 3%', score: 2 },
      { value: 'good', label: '3% - 5%', score: 3 },
      { value: 'excellent', label: 'More than 5%', score: 4 },
    ],
  },
  {
    id: 'social_media',
    question: 'How active is your social media presence?',
    category: 'Social Media',
    options: [
      { value: 'none', label: 'No social media presence', score: 0 },
      { value: 'minimal', label: 'Post occasionally (once a week or less)', score: 1 },
      { value: 'moderate', label: 'Regular posting (2-3 times a week)', score: 2 },
      { value: 'active', label: 'Daily engagement and content', score: 3 },
      { value: 'very_active', label: 'Multiple posts daily with strong engagement', score: 4 },
    ],
  },
  {
    id: 'email_marketing',
    question: 'Do you have an email marketing strategy?',
    category: 'Email Marketing',
    options: [
      { value: 'none', label: 'No email marketing at all', score: 0 },
      { value: 'basic', label: 'Small list, send occasionally', score: 1 },
      { value: 'growing', label: 'Growing list, regular newsletters', score: 2 },
      { value: 'strategic', label: 'Segmented campaigns with automation', score: 3 },
      { value: 'advanced', label: 'Advanced automation with personalization', score: 4 },
    ],
  },
  {
    id: 'seo',
    question: 'How would you rate your SEO efforts?',
    category: 'SEO',
    options: [
      { value: 'none', label: 'What\'s SEO?', score: 0 },
      { value: 'basic', label: 'Basic meta tags only', score: 1 },
      { value: 'moderate', label: 'Regular content with keywords', score: 2 },
      { value: 'good', label: 'Strategic content + technical SEO', score: 3 },
      { value: 'excellent', label: 'Comprehensive SEO strategy with analytics', score: 4 },
    ],
  },
  {
    id: 'paid_ads',
    question: 'What\'s your paid advertising situation?',
    category: 'Paid Ads',
    options: [
      { value: 'none', label: 'No paid advertising', score: 0 },
      { value: 'testing', label: 'Testing with small budget', score: 1 },
      { value: 'regular', label: 'Regular campaigns on 1-2 platforms', score: 2 },
      { value: 'multi', label: 'Multiple platforms with optimization', score: 3 },
      { value: 'advanced', label: 'Advanced targeting and retargeting', score: 4 },
    ],
  },
  {
    id: 'content',
    question: 'How often do you create new content?',
    category: 'Content',
    options: [
      { value: 'never', label: 'Rarely or never', score: 0 },
      { value: 'monthly', label: 'Once a month', score: 1 },
      { value: 'weekly', label: 'Weekly content', score: 2 },
      { value: 'multiple', label: 'Multiple times per week', score: 3 },
      { value: 'daily', label: 'Daily content across platforms', score: 4 },
    ],
  },
  {
    id: 'analytics',
    question: 'Do you track and analyze your marketing data?',
    category: 'Analytics',
    options: [
      { value: 'none', label: 'No tracking at all', score: 0 },
      { value: 'basic', label: 'Basic Google Analytics', score: 1 },
      { value: 'regular', label: 'Regular reporting and review', score: 2 },
      { value: 'data_driven', label: 'Data-driven decision making', score: 3 },
      { value: 'advanced', label: 'Advanced attribution and optimization', score: 4 },
    ],
  },
];

export function MarketingAssessmentClient() {
  const [step, setStep] = useState(0);
  const [answers, setAnswers] = useState<Record<string, string>>({});
  const [contactInfo, setContactInfo] = useState({ name: '', email: '', company: '' });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [isComplete, setIsComplete] = useState(false);
  const [score, setScore] = useState(0);
  const [recommendations, setRecommendations] = useState<string[]>([]);
  const { toast } = useToast();

  const totalSteps = questions.length + 2; // questions + contact info + results
  const progress = ((step + 1) / totalSteps) * 100;

  const handleAnswerSelect = (value: string) => {
    setAnswers({ ...answers, [questions[step].id]: value });
  };

  const handleNext = () => {
    if (step < questions.length - 1) {
      setStep(step + 1);
    } else if (step === questions.length - 1) {
      // Move to contact info step
      setStep(questions.length);
    } else if (step === questions.length) {
      // Submit assessment
      handleSubmit();
    }
  };

  const handleBack = () => {
    if (step > 0) {
      setStep(step - 1);
    }
  };

  const calculateScore = () => {
    let totalScore = 0;
    let maxScore = 0;

    questions.forEach((question) => {
      const answer = answers[question.id];
      const option = question.options.find((opt) => opt.value === answer);
      if (option) {
        totalScore += option.score;
      }
      maxScore += 4; // Max score per question
    });

    return Math.round((totalScore / maxScore) * 100);
  };

  const generateRecommendations = (finalScore: number) => {
    const recs: string[] = [];

    if (finalScore < 25) {
      recs.push('Build a strong digital foundation with a professional website');
      recs.push('Set up basic SEO and analytics tracking');
      recs.push('Start email marketing with lead magnets');
      recs.push('Create a content strategy for consistent publishing');
    } else if (finalScore < 50) {
      recs.push('Optimize your conversion funnel to increase ROI');
      recs.push('Implement marketing automation for efficiency');
      recs.push('Expand your content marketing efforts');
      recs.push('Start or scale your paid advertising campaigns');
    } else if (finalScore < 75) {
      recs.push('Fine-tune your attribution and analytics');
      recs.push('Implement advanced retargeting campaigns');
      recs.push('Develop a comprehensive social media strategy');
      recs.push('Create a customer loyalty program');
    } else {
      recs.push('Implement AI-powered personalization');
      recs.push('Expand into new marketing channels');
      recs.push('Develop strategic partnerships');
      recs.push('Focus on lifetime value optimization');
    }

    return recs;
  };

  const handleSubmit = async () => {
    setIsSubmitting(true);

    try {
      const finalScore = calculateScore();
      const recs = generateRecommendations(finalScore);

      // Submit to API
      const response = await fetch('/api/marketing-assessment', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ...contactInfo,
          responses: answers,
          score: finalScore,
          recommendations: recs,
        }),
      });

      if (!response.ok) throw new Error('Failed to submit assessment');

      // Track lead conversion - dual tracking (client-side + server-side)
      trackRedditLead(contactInfo.email);
      trackConversion('marketing_assessment', undefined, 'USD', {
        email: contactInfo.email,
        score: finalScore,
        company: contactInfo.company,
      });

      setScore(finalScore);
      setRecommendations(recs);
      setIsComplete(true);
      setStep(totalSteps - 1);

      toast({
        title: 'Assessment Complete!',
        description: 'Your personalized report is ready. Check your email for the full analysis.',
      });
    } catch (error) {
      toast({
        title: 'Error',
        description: 'Failed to submit assessment. Please try again.',
        variant: 'destructive',
      });
    } finally {
      setIsSubmitting(false);
    }
  };

  const canProceed = () => {
    if (step < questions.length) {
      return !!answers[questions[step].id];
    } else if (step === questions.length) {
      return contactInfo.name && contactInfo.email;
    }
    return true;
  };

  return (
    <div className="container mx-auto px-4 py-20">
      {/* Header */}
      {!isComplete && (
        <div className="max-w-3xl mx-auto mb-8">
          <motion.div
            initial={{ opacity: 0, y: -20 }}
            animate={{ opacity: 1, y: 0 }}
            className="text-center mb-8"
          >
            <h1 className="text-4xl font-bold mb-4">
              <Sparkles className="inline-block mr-2 h-8 w-8 text-primary" />
              3-Minute Marketing Assessment
            </h1>
            <p className="text-xl text-muted-foreground">
              Discover your marketing maturity score and get personalized recommendations
            </p>
          </motion.div>

          <Progress value={progress} className="h-2 mb-6" />
          <p className="text-center text-sm text-muted-foreground">
            Step {step + 1} of {totalSteps}
          </p>
        </div>
      )}

      {/* Questions */}
      <div className="max-w-2xl mx-auto">
        <AnimatePresence mode="wait">
          {!isComplete && step < questions.length && (
            <motion.div
              key={step}
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -20 }}
              transition={{ duration: 0.3 }}
            >
              <Card className="border-2">
                <CardHeader>
                  <CardTitle className="text-2xl">{questions[step].question}</CardTitle>
                  <CardDescription>Select the option that best describes your situation</CardDescription>
                </CardHeader>
                <CardContent>
                  <RadioGroup
                    value={answers[questions[step].id]}
                    onValueChange={handleAnswerSelect}
                    className="space-y-3"
                  >
                    {questions[step].options.map((option) => (
                      <div
                        key={option.value}
                        className="flex items-center space-x-3 p-4 rounded-lg border-2 hover:border-primary transition-colors cursor-pointer"
                      >
                        <RadioGroupItem value={option.value} id={option.value} />
                        <Label
                          htmlFor={option.value}
                          className="flex-1 cursor-pointer text-base"
                        >
                          {option.label}
                        </Label>
                      </div>
                    ))}
                  </RadioGroup>
                </CardContent>
              </Card>
            </motion.div>
          )}

          {/* Contact Info Step */}
          {!isComplete && step === questions.length && (
            <motion.div
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -20 }}
            >
              <Card className="border-2">
                <CardHeader>
                  <CardTitle className="text-2xl">Get Your Personalized Report</CardTitle>
                  <CardDescription>
                    Enter your details to receive your marketing assessment results and custom recommendations
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div>
                    <Label htmlFor="name">Full Name *</Label>
                    <Input
                      id="name"
                      value={contactInfo.name}
                      onChange={(e) => setContactInfo({ ...contactInfo, name: e.target.value })}
                      placeholder="John Doe"
                      required
                    />
                  </div>
                  <div>
                    <Label htmlFor="email">Email Address *</Label>
                    <Input
                      id="email"
                      type="email"
                      value={contactInfo.email}
                      onChange={(e) => setContactInfo({ ...contactInfo, email: e.target.value })}
                      placeholder="john@company.com"
                      required
                    />
                  </div>
                  <div>
                    <Label htmlFor="company">Company Name (Optional)</Label>
                    <Input
                      id="company"
                      value={contactInfo.company}
                      onChange={(e) => setContactInfo({ ...contactInfo, company: e.target.value })}
                      placeholder="Acme Inc."
                    />
                  </div>
                </CardContent>
              </Card>
            </motion.div>
          )}

          {/* Results */}
          {isComplete && (
            <motion.div
              initial={{ opacity: 0, scale: 0.95 }}
              animate={{ opacity: 1, scale: 1 }}
              className="space-y-8"
            >
              <Card className="border-2 border-primary">
                <CardHeader className="text-center">
                  <div className="flex justify-center mb-4">
                    <CheckCircle2 className="h-16 w-16 text-green-500" />
                  </div>
                  <CardTitle className="text-3xl">Your Marketing Maturity Score</CardTitle>
                </CardHeader>
                <CardContent className="text-center">
                  <div className="text-7xl font-bold text-primary mb-4">{score}%</div>
                  <p className="text-xl text-muted-foreground mb-6">
                    {score < 25 && 'Foundation Building Stage'}
                    {score >= 25 && score < 50 && 'Growth Stage'}
                    {score >= 50 && score < 75 && 'Optimization Stage'}
                    {score >= 75 && 'Advanced Marketing Stage'}
                  </p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Target className="h-6 w-6 text-primary" />
                    Your Personalized Recommendations
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <ul className="space-y-3">
                    {recommendations.map((rec, idx) => (
                      <li key={idx} className="flex items-start gap-3">
                        <TrendingUp className="h-5 w-5 text-primary mt-1 flex-shrink-0" />
                        <span className="text-lg">{rec}</span>
                      </li>
                    ))}
                  </ul>
                </CardContent>
              </Card>

              <Card className="bg-gradient-to-r from-primary/10 to-purple-500/10">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Zap className="h-6 w-6 text-primary" />
                    Next Steps
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <p className="text-lg">
                    We have sent a detailed report to <strong>{contactInfo.email}</strong> with:
                  </p>
                  <ul className="space-y-2 ml-4">
                    <li>‚úÖ Complete marketing audit</li>
                    <li>‚úÖ Actionable improvement strategies</li>
                    <li>‚úÖ Industry benchmarks</li>
                    <li>‚úÖ Timeline and budget recommendations</li>
                  </ul>
                  <div className="flex gap-4 pt-4">
                    <Button size="lg" className="flex-1" asChild>
                      <a href="/contact">
                        <Mail className="mr-2 h-5 w-5" />
                        Schedule Strategy Call
                      </a>
                    </Button>
                    <Button size="lg" variant="outline" className="flex-1">
                      <Download className="mr-2 h-5 w-5" />
                      Download PDF Report
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </motion.div>
          )}
        </AnimatePresence>

        {/* Navigation */}
        {!isComplete && (
          <div className="flex justify-between mt-8">
            <Button
              variant="outline"
              onClick={handleBack}
              disabled={step === 0}
            >
              <ArrowLeft className="mr-2 h-4 w-4" />
              Back
            </Button>
            <Button
              onClick={handleNext}
              disabled={!canProceed() || isSubmitting}
            >
              {isSubmitting ? (
                'Submitting...'
              ) : step === questions.length ? (
                <>
                  Get Results
                  <Sparkles className="ml-2 h-4 w-4" />
                </>
              ) : (
                <>
                  Next
                  <ArrowRight className="ml-2 h-4 w-4" />
                </>
              )}
            </Button>
          </div>
        )}
      </div>
    </div>
  );
}

// ==========================================
// File: components/marketing-automation.tsx
// ==========================================


'use client';

import { AIChatbot } from './ai-chatbot';
import { WelcomePopup } from './welcome-popup';
import { ExitIntentPopup } from './exit-intent-popup';

export function MarketingAutomation() {
  return (
    <>
      <AIChatbot />
      <WelcomePopup />
      <ExitIntentPopup />
    </>
  );
}

// ==========================================
// File: components/mini-offer.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { Check, ArrowRight, Zap } from "lucide-react";

const MiniOffer = () => {
  return (
    <section className="relative py-8 md:py-12 lg:py-16 bg-gradient-to-br from-charcoal via-gray-900 to-charcoal overflow-hidden">
      {/* Animated Background Elements */}
      <div className="absolute inset-0 opacity-10">
        <div className="absolute top-10 left-10 w-72 h-72 bg-accent rounded-full blur-3xl animate-pulse"></div>
        <div className="absolute bottom-10 right-10 w-96 h-96 bg-secondary rounded-full blur-3xl animate-pulse delay-1000"></div>
      </div>

      <div className="relative z-10 section-container">
        <div className="max-w-5xl mx-auto">
          {/* Header */}
          <motion.div 
            className="text-center mb-6 md:mb-8"
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
          >
            <div className="inline-flex items-center gap-2 bg-accent/20 backdrop-blur-sm border border-accent/30 rounded-full px-3 py-1.5 md:px-4 md:py-2 mb-3 md:mb-4">
              <Zap className="h-3 w-3 md:h-4 md:w-4 text-accent" />
              <span className="text-accent font-bold text-xs md:text-sm uppercase tracking-wider">Limited Time Offer</span>
            </div>
            <h2 className="text-2xl md:text-3xl lg:text-4xl xl:text-5xl font-bold text-white mb-2 md:mb-3 px-4">
              Get Everything You Need to
              <br className="hidden sm:block" />
              <span className="bg-gradient-to-r from-accent via-secondary to-accent bg-clip-text text-transparent">
                Dominate Your Market
              </span>
            </h2>
            <p className="text-gray-300 text-sm md:text-base lg:text-lg xl:text-xl max-w-3xl mx-auto px-4">
              The exact system we used to manage $9B+ in infrastructure programs and achieve 120%+ profit growth - now available for your business.
            </p>
          </motion.div>

          {/* Offer Box */}
          <motion.div 
            className="bg-white/5 backdrop-blur-lg border-2 border-accent/30 rounded-xl md:rounded-2xl p-4 md:p-6 lg:p-10 shadow-2xl"
            initial={{ opacity: 0, scale: 0.95 }}
            whileInView={{ opacity: 1, scale: 1 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.2 }}
          >
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
              {/* What You Get */}
              <div>
                <h3 className="text-xl md:text-2xl font-bold text-white mb-4 md:mb-6 flex items-center gap-2">
                  <span className="bg-accent/20 p-1.5 md:p-2 rounded-lg text-lg md:text-xl">üì¶</span>
                  What You Get:
                </h3>
                <div className="space-y-3 md:space-y-4">
                  {[
                    { item: "Complete Marketing Strategy Session", value: "$2,500" },
                    { item: "Custom Growth Plan & Roadmap", value: "$1,500" },
                    { item: "Competitive Market Analysis", value: "$1,000" },
                    { item: "Lead Generation Framework", value: "$2,000" },
                    { item: "Sales Process Optimization", value: "$1,500" },
                    { item: "30-Day Action Plan", value: "$500" },
                  ].map((item, index) => (
                    <motion.div
                      key={index}
                      className="flex items-start gap-2 md:gap-3 bg-white/5 rounded-lg p-2.5 md:p-3"
                      initial={{ opacity: 0, x: -20 }}
                      whileInView={{ opacity: 1, x: 0 }}
                      viewport={{ once: true }}
                      transition={{ duration: 0.4, delay: 0.1 * index }}
                    >
                      <div className="flex-shrink-0 w-5 h-5 md:w-6 md:h-6 bg-accent rounded-full flex items-center justify-center mt-0.5">
                        <Check className="h-3 w-3 md:h-4 md:w-4 text-charcoal" />
                      </div>
                      <div className="flex-1">
                        <p className="text-white font-medium text-sm md:text-base">{item.item}</p>
                        <p className="text-gray-400 text-xs md:text-sm">(Value: {item.value})</p>
                      </div>
                    </motion.div>
                  ))}
                </div>
              </div>

              {/* Value Stack */}
              <div className="flex flex-col justify-between">
                <div>
                  <h3 className="text-xl md:text-2xl font-bold text-white mb-4 md:mb-6 flex items-center gap-2">
                    <span className="bg-accent/20 p-1.5 md:p-2 rounded-lg text-lg md:text-xl">üí∞</span>
                    The Math:
                  </h3>
                  
                  <div className="space-y-3 md:space-y-4 mb-6 md:mb-8">
                    <div className="bg-white/5 rounded-lg p-3 md:p-4 border border-white/10">
                      <div className="flex justify-between items-center mb-2">
                        <span className="text-gray-300 text-sm md:text-base">Total Value:</span>
                        <span className="text-white font-bold text-xl md:text-2xl line-through decoration-red-500">$9,000</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-accent font-bold text-base md:text-lg">Your Investment:</span>
                        <span className="text-accent font-bold text-3xl md:text-4xl">$0</span>
                      </div>
                    </div>

                    <div className="bg-accent/10 border-2 border-accent rounded-lg p-3 md:p-4">
                      <p className="text-white font-bold text-lg md:text-xl mb-2">You Save: $9,000</p>
                      <p className="text-gray-300 text-xs md:text-sm">
                        That's right - EVERYTHING is 100% FREE for qualified businesses. No credit card required.
                      </p>
                    </div>
                  </div>
                </div>

                {/* CTA */}
                <div className="space-y-3 md:space-y-4">
                  <Link href="/contact" className="block">
                    <Button 
                      size="lg" 
                      className="w-full bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold text-base md:text-lg py-6 md:py-7 shadow-xl hover:shadow-2xl transition-all duration-300 group"
                    >
                      <span className="block md:inline">Claim Your Free Strategy Session Now</span>
                      <ArrowRight className="ml-2 h-4 w-4 md:h-5 md:w-5 group-hover:translate-x-1 transition-transform inline-block" />
                    </Button>
                  </Link>
                  <p className="text-center text-gray-400 text-xs md:text-sm">
                    ‚è∞ Only 5 spots available this month ‚Ä¢ No strings attached
                  </p>
                </div>
              </div>
            </div>

            {/* Social Proof Footer */}
            <div className="mt-6 md:mt-8 pt-4 md:pt-6 border-t border-white/10">
              <div className="flex flex-wrap items-center justify-center gap-3 md:gap-4 lg:gap-8 text-xs md:text-sm text-gray-300">
                <div className="flex items-center gap-1.5 md:gap-2">
                  <Check className="h-4 w-4 md:h-5 md:w-5 text-accent flex-shrink-0" />
                  <span>$9B+ Projects Managed</span>
                </div>
                <div className="flex items-center gap-1.5 md:gap-2">
                  <Check className="h-4 w-4 md:h-5 md:w-5 text-accent flex-shrink-0" />
                  <span>120%+ Proven Growth</span>
                </div>
                <div className="flex items-center gap-1.5 md:gap-2">
                  <Check className="h-4 w-4 md:h-5 md:w-5 text-accent flex-shrink-0" />
                  <span>$2.4M+ in Sales</span>
                </div>
              </div>
            </div>
          </motion.div>

          {/* Urgency Footer */}
          <motion.div
            className="text-center mt-4 md:mt-6 px-4"
            initial={{ opacity: 0 }}
            whileInView={{ opacity: 1 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6, delay: 0.4 }}
          >
            <p className="text-gray-400 text-xs md:text-sm lg:text-base">
              <span className="text-accent font-bold">WARNING:</span> We can only take on 5 new strategy sessions per month to ensure quality. 
              <br className="hidden sm:block" />
              Spots fill up fast. Apply now to secure your session before they're gone.
            </p>
          </motion.div>
        </div>
      </div>
    </section>
  );
};

export default MiniOffer;

// ==========================================
// File: components/navigation.tsx
// ==========================================



"use client";

import { useState, useEffect } from "react";
import Link from "next/link";
import { useSession } from "next-auth/react";
import { Menu, X, ChevronDown, Sparkles, User, LogIn, Phone } from "lucide-react";
import { Button } from "@/components/ui/button";
import { cn } from "@/lib/utils";
import {
  NavigationMenu,
  NavigationMenuContent,
  NavigationMenuItem,
  NavigationMenuLink,
  NavigationMenuList,
  NavigationMenuTrigger,
} from "@/components/ui/navigation-menu";

const Navigation = () => {
  const { data: session, status } = useSession();
  const [isOpen, setIsOpen] = useState(false);
  const [isScrolled, setIsScrolled] = useState(false);
  const [servicesOpen, setServicesOpen] = useState(false);
  const isAuthenticated = status === "authenticated";

  useEffect(() => {
    const handleScroll = () => {
      setIsScrolled(window.scrollY > 10);
    };
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  // Prevent body scroll when mobile menu is open
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = 'unset';
    }
    return () => {
      document.body.style.overflow = 'unset';
    };
  }, [isOpen]);

  const navItems = [
    { name: "About", href: "/about" },
    { name: "Free Tools", href: "/tools" },
    { name: "Case Studies", href: "/case-studies" },
    { name: "Blog", href: "/blog" },
    { name: "Contact", href: "/contact" },
  ];

  const galleryItems = [
    { name: "Website Gallery", href: "/gallery/websites", description: "Explore AI-built websites" },
    { name: "AI Agent Gallery", href: "/gallery/ai-agents", description: "Discover AI agents" },
  ];

  const serviceCategories = [
    {
      title: "Website Services",
      items: [
        { name: "Website Creation", href: "/services/website-creation-starter", description: "Build your online presence" },
        { name: "Website Maintenance", href: "/services/website-maintenance-basic", description: "Keep your site running smoothly" },
      ]
    },
    {
      title: "Marketing Services",
      items: [
        { name: "SEO Services", href: "/services/seo-local-basic", description: "Rank higher in search results" },
        { name: "Social Media", href: "/services/social-media-basic", description: "Grow your social presence" },
        { name: "Ad Management", href: "/services/ad-management-starter", description: "Maximize your ad ROI" },
      ]
    },
    {
      title: "App Services",
      items: [
        { name: "Mobile Apps", href: "/services/app-creation-mvp", description: "Build custom mobile solutions" },
        { name: "App Maintenance", href: "/services/app-maintenance-basic", description: "Keep your app updated" },
      ]
    },
    {
      title: "Bundle Packages",
      items: [
        { name: "Launch Package", href: "/services/bundle-launch", description: "Everything to get started" },
      ]
    }
  ];

  const serviceItems = [
    { name: "All Services & Pricing", href: "/pricing" },
    { name: "Website Maintenance", href: "/services/website-maintenance-basic" },
    { name: "Website Creation", href: "/services/website-creation-starter" },
    { name: "SEO Services", href: "/services/seo-local-basic" },
    { name: "Social Media", href: "/services/social-media-basic" },
    { name: "Ad Management", href: "/services/ad-management-starter" },
    { name: "Mobile Apps", href: "/services/app-creation-mvp" },
    { name: "App Maintenance", href: "/services/app-maintenance-basic" },
    { name: "Bundle Packages", href: "/services/bundle-launch" },
  ];

  return (
    <header
      className={cn(
        "sticky top-0 z-50 w-full transition-all duration-300",
        isScrolled
          ? "bg-charcoal shadow-xl border-b border-secondary/30"
          : "bg-charcoal backdrop-blur-lg"
      )}
    >
      <div className="section-container">
        {/* Top Bar with Phone Number */}
        <div className="hidden xl:flex items-center justify-end py-3 border-b border-white/10">
          <a 
            href="tel:8622727623" 
            className="flex items-center gap-3 text-white/90 hover:text-accent transition-colors text-sm font-medium group"
          >
            <div className="p-1.5 rounded-full bg-gradient-to-r from-secondary to-accent group-hover:scale-110 transition-transform">
              <Phone className="w-3.5 h-3.5 text-charcoal" />
            </div>
            <span className="font-bold text-base text-accent">(862) 272-7623</span>
            <span className="text-white/60 ml-1">‚Ä¢ Call us now for a free consultation</span>
          </a>
        </div>

        <nav className="flex items-center justify-between h-16 xl:h-[88px] gap-2 xl:gap-4">
          {/* Logo */}
          <Link href="/" className="flex items-center space-x-2 xl:space-x-3 group flex-shrink-0">
            <div className="bg-gradient-to-br from-accent to-secondary text-charcoal px-3 xl:px-4 py-1.5 xl:py-2 rounded-xl font-bold text-lg xl:text-xl shadow-lg group-hover:shadow-accent/50 transition-all duration-300 btn-breathe">
              CDM
            </div>
            <span className="font-bold text-xl xl:text-2xl text-white group-hover:text-accent transition-colors duration-300">Suite</span>
          </Link>

          {/* Desktop Navigation */}
          <div className="hidden xl:flex items-center space-x-3 2xl:space-x-4 flex-grow justify-center">
            {/* Services Dropdown with Radix UI */}
            <NavigationMenu>
              <NavigationMenuList>
                <NavigationMenuItem>
                  <NavigationMenuTrigger className="px-3 2xl:px-4 py-2 text-sm 2xl:text-base text-white/90 hover:text-accent transition-colors duration-200 font-medium rounded-lg hover:bg-white/5 bg-transparent data-[state=open]:bg-white/5 data-[state=open]:text-accent">
                    Services
                  </NavigationMenuTrigger>
                  <NavigationMenuContent>
                    <div className="w-[700px] p-4">
                      {/* View All Services Header */}
                      <Link
                        href="/services"
                        className="block p-4 mb-2 rounded-lg bg-gradient-to-r from-secondary/10 to-accent/10 hover:from-secondary/20 hover:to-accent/20 transition-all group"
                      >
                        <div className="font-bold text-lg text-royal-blue group-hover:text-secondary mb-1">
                          View All Services & Pricing
                        </div>
                        <p className="text-sm text-gray-600">
                          Explore our complete range of digital services
                        </p>
                      </Link>
                      
                      {/* Service Categories Grid */}
                      <div className="grid grid-cols-2 gap-3">
                        {serviceCategories.map((category) => (
                          <div key={category.title} className="space-y-2">
                            <h4 className="font-semibold text-sm text-gray-900 px-2">
                              {category.title}
                            </h4>
                            <div className="space-y-1">
                              {category.items.map((item) => (
                                <NavigationMenuLink key={item.name} asChild>
                                  <Link
                                    href={item.href}
                                    className="block px-3 py-2 rounded-lg hover:bg-gradient-to-r hover:from-secondary/10 hover:to-accent/10 transition-all group"
                                  >
                                    <div className="font-medium text-sm text-gray-700 group-hover:text-royal-blue">
                                      {item.name}
                                    </div>
                                    <p className="text-xs text-gray-500 mt-0.5">
                                      {item.description}
                                    </p>
                                  </Link>
                                </NavigationMenuLink>
                              ))}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </NavigationMenuContent>
                </NavigationMenuItem>
              </NavigationMenuList>
            </NavigationMenu>

            {/* Gallery Dropdown */}
            <NavigationMenu>
              <NavigationMenuList>
                <NavigationMenuItem>
                  <NavigationMenuTrigger className="px-3 2xl:px-4 py-2 text-sm 2xl:text-base text-white/90 hover:text-accent transition-colors duration-200 font-medium rounded-lg hover:bg-white/5 bg-transparent data-[state=open]:bg-white/5 data-[state=open]:text-accent">
                    Gallery
                  </NavigationMenuTrigger>
                  <NavigationMenuContent>
                    <div className="w-[400px] p-4">
                      <div className="space-y-2">
                        {galleryItems.map((item) => (
                          <NavigationMenuLink key={item.name} asChild>
                            <Link
                              href={item.href}
                              className="block px-4 py-3 rounded-lg hover:bg-gradient-to-r hover:from-secondary/10 hover:to-accent/10 transition-all group"
                            >
                              <div className="font-medium text-base text-gray-700 group-hover:text-royal-blue">
                                {item.name}
                              </div>
                              <p className="text-sm text-gray-500 mt-1">
                                {item.description}
                              </p>
                            </Link>
                          </NavigationMenuLink>
                        ))}
                      </div>
                    </div>
                  </NavigationMenuContent>
                </NavigationMenuItem>
              </NavigationMenuList>
            </NavigationMenu>
            
            {navItems.map((item) => (
              <Link
                key={item.name}
                href={item.href}
                className="px-3 2xl:px-4 py-2 text-sm 2xl:text-base text-white/90 hover:text-accent hover:bg-white/5 transition-colors duration-200 font-medium rounded-lg whitespace-nowrap"
              >
                {item.name}
              </Link>
            ))}

            {/* Free Audit CTA */}
            <Link href="/auditor">
              <Button className="ml-2 2xl:ml-3 bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold shadow-lg hover:shadow-accent/50 transition-all duration-300 group btn-breathe px-4 2xl:px-5 text-sm 2xl:text-base">
                <Sparkles className="w-3.5 h-3.5 2xl:w-4 2xl:h-4 mr-1.5 2xl:mr-2 group-hover:rotate-12 transition-transform float-animation" />
                Free Audit
              </Button>
            </Link>
          </div>

          {/* Desktop CTA Buttons */}
          <div className="hidden xl:flex items-center space-x-2 2xl:space-x-3 flex-shrink-0">
            {isAuthenticated ? (
              <Link href="/dashboard">
                <Button className="bg-gradient-to-r from-secondary to-accent hover:from-secondary/90 hover:to-accent/90 text-charcoal font-bold shadow-lg hover:shadow-accent/50 transition-all duration-300 btn-breathe px-4 2xl:px-5 text-sm 2xl:text-base">
                  <User className="w-3.5 h-3.5 2xl:w-4 2xl:h-4 mr-1.5 2xl:mr-2" />
                  Dashboard
                </Button>
              </Link>
            ) : (
              <>
                <Link href="/auth/login">
                  <Button className="bg-white/5 hover:bg-white/10 text-white border-2 border-secondary/60 hover:border-accent font-semibold transition-all duration-300 px-4 2xl:px-5 text-sm 2xl:text-base">
                    <LogIn className="w-3.5 h-3.5 2xl:w-4 2xl:h-4 mr-1.5 2xl:mr-2" />
                    Login
                  </Button>
                </Link>
                <Link href="/auth/signup">
                  <Button className="bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold shadow-lg hover:shadow-accent/50 transition-all duration-300 btn-breathe btn-glow px-4 2xl:px-5 text-sm 2xl:text-base whitespace-nowrap">
                    Get Started
                  </Button>
                </Link>
              </>
            )}
          </div>

          {/* Mobile Menu Button */}
          <button
            className="xl:hidden p-2 hover:bg-white/10 rounded-lg transition-colors text-white flex-shrink-0"
            onClick={() => setIsOpen(!isOpen)}
            aria-label="Toggle mobile menu"
          >
            {isOpen ? <X size={24} /> : <Menu size={24} />}
          </button>
        </nav>

        {/* Mobile Navigation */}
        {isOpen && (
          <div className="xl:hidden bg-charcoal border-t border-white/10 py-6 animate-in slide-in-from-top duration-200 max-h-[calc(100vh-4rem)] overflow-y-auto">
            <div className="flex flex-col space-y-2">
              {/* Phone Number - Mobile */}
              <a
                href="tel:8622727623"
                className="flex items-center gap-3 px-6 py-4 bg-gradient-to-r from-secondary to-accent text-charcoal font-bold rounded-lg mx-3 mb-3 shadow-lg hover:shadow-accent/50 transition-all"
              >
                <div className="p-1.5 rounded-full bg-charcoal/20">
                  <Phone className="w-4 h-4" />
                </div>
                <span>Call (862) 272-7623</span>
              </a>

              {/* Free Audit - Featured */}
              <Link
                href="/auditor"
                className="flex items-center gap-3 px-6 py-4 bg-gradient-to-r from-accent to-secondary text-charcoal font-bold rounded-lg mx-3 mb-3 btn-breathe shadow-lg hover:shadow-accent/50 transition-all"
                onClick={() => setIsOpen(false)}
              >
                <Sparkles className="w-4 h-4 float-animation" />
                Free Website Audit
              </Link>

              {/* Services Mobile Dropdown */}
              <div className="px-3">
                <button 
                  onClick={() => setServicesOpen(!servicesOpen)}
                  aria-expanded={servicesOpen}
                  aria-controls="mobile-services-menu"
                  aria-label="Toggle services menu"
                  className="flex items-center justify-between w-full px-5 py-3.5 text-white/90 hover:text-accent hover:bg-white/5 rounded-lg transition-colors duration-200 font-medium"
                >
                  Services
                  <ChevronDown className={cn("h-4 w-4 transition-transform", servicesOpen && "rotate-180")} />
                </button>
                {servicesOpen && (
                  <div id="mobile-services-menu" className="ml-4 mt-2 space-y-1">
                    {serviceItems.map((item) => (
                      <Link
                        key={item.name}
                        href={item.href}
                        className="block px-5 py-3 text-white/80 hover:text-accent hover:bg-white/5 rounded-lg transition-colors duration-200"
                        onClick={() => {
                          setIsOpen(false);
                          setServicesOpen(false);
                        }}
                      >
                        {item.name}
                      </Link>
                    ))}
                  </div>
                )}
              </div>

              {navItems.map((item) => (
                <Link
                  key={item.name}
                  href={item.href}
                  className="px-8 py-3.5 text-white/90 hover:text-accent hover:bg-white/5 rounded-lg transition-colors duration-200 font-medium"
                  onClick={() => setIsOpen(false)}
                >
                  {item.name}
                </Link>
              ))}

              <div className="flex flex-col space-y-3 pt-6 px-3 border-t border-white/10 mt-4">
                {isAuthenticated ? (
                  <Link href="/dashboard" onClick={() => setIsOpen(false)}>
                    <Button className="w-full bg-gradient-to-r from-secondary to-accent hover:from-secondary/90 hover:to-accent/90 text-charcoal font-bold shadow-lg btn-breathe py-6">
                      <User className="w-4 h-4 mr-2" />
                      Go to Dashboard
                    </Button>
                  </Link>
                ) : (
                  <>
                    <Link href="/auth/login" onClick={() => setIsOpen(false)}>
                      <Button className="w-full bg-white/5 hover:bg-white/10 text-white border-2 border-secondary/60 hover:border-accent font-semibold py-6">
                        <LogIn className="w-4 h-4 mr-2" />
                        Login
                      </Button>
                    </Link>
                    <Link href="/auth/signup" onClick={() => setIsOpen(false)}>
                      <Button className="w-full bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold shadow-lg btn-breathe btn-glow py-6">
                        Get Started Free
                      </Button>
                    </Link>
                  </>
                )}
              </div>
            </div>
          </div>
        )}
      </div>
    </header>
  );
};

export default Navigation;

// ==========================================
// File: components/page-builder/blocks/button-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, ButtonProps } from '@/lib/page-builder-types';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';

interface ButtonBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const ButtonBlock = forwardRef<HTMLDivElement, ButtonBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as ButtonProps;

    const style: React.CSSProperties = {
      margin: props.margin,
      padding: props.padding,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    const handleClick = (e: React.MouseEvent) => {
      if (!isPreview) {
        e.preventDefault();
        onClick?.();
      }
    };

    return (
      <div
        ref={ref}
        onClick={handleClick}
        className={cn(
          'relative inline-block',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600'
        )}
        style={style}
      >
        <Button
          asChild={isPreview}
          variant={props.variant === 'primary' ? 'default' : props.variant === 'secondary' ? 'secondary' : 'outline'}
          size={props.size === 'md' ? 'default' : props.size}
          className={props.className}
        >
          {isPreview ? (
            <a href={props.href}>{props.text}</a>
          ) : (
            <span>{props.text}</span>
          )}
        </Button>
      </div>
    );
  }
);

ButtonBlock.displayName = 'ButtonBlock';

// ==========================================
// File: components/page-builder/blocks/columns-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, ColumnsProps } from '@/lib/page-builder-types';
import { cn } from '@/lib/utils';
import { EditableBlock } from '../editable-block';

interface ColumnsBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
  onUpdate?: (block: PageBlock) => void;
}

export const ColumnsBlock = forwardRef<HTMLDivElement, ColumnsBlockProps>(
  ({ block, isSelected, isPreview, onClick, onUpdate }, ref) => {
    const props = block.props as ColumnsProps;

    const style: React.CSSProperties = {
      display: 'grid',
      gridTemplateColumns: `repeat(${props.columns}, 1fr)`,
      gap: props.gap,
      padding: props.padding,
      margin: props.margin,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={(e) => {
          e.stopPropagation();
          onClick?.();
        }}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        {block.children && block.children.length > 0 ? (
          block.children.map((childBlock) => (
            <div key={childBlock.id} className="min-h-[100px]">
              <EditableBlock
                block={childBlock}
                isPreview={isPreview}
              />
            </div>
          ))
        ) : (
          !isPreview && (
            <div className="col-span-full p-8 border-2 border-dashed border-gray-300 text-center text-gray-400">
              Drop blocks into columns
            </div>
          )
        )}
      </div>
    );
  }
);

ColumnsBlock.displayName = 'ColumnsBlock';

// ==========================================
// File: components/page-builder/blocks/container-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock } from '@/lib/page-builder-types';
import { cn } from '@/lib/utils';
import { EditableBlock } from '../editable-block';

interface ContainerBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
  onUpdate?: (block: PageBlock) => void;
}

export const ContainerBlock = forwardRef<HTMLDivElement, ContainerBlockProps>(
  ({ block, isSelected, isPreview, onClick, onUpdate }, ref) => {
    const props = block.props;

    const style: React.CSSProperties = {
      padding: props.padding,
      margin: props.margin,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={(e) => {
          e.stopPropagation();
          onClick?.();
        }}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        {block.children && block.children.length > 0 ? (
          block.children.map((childBlock) => (
            <EditableBlock
              key={childBlock.id}
              block={childBlock}
              isPreview={isPreview}
            />
          ))
        ) : (
          !isPreview && (
            <div className="p-8 border-2 border-dashed border-gray-300 text-center text-gray-400">
              Drop blocks here
            </div>
          )
        )}
      </div>
    );
  }
);

ContainerBlock.displayName = 'ContainerBlock';

// ==========================================
// File: components/page-builder/blocks/cta-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, CTAProps } from '@/lib/page-builder-types';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';

interface CTABlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const CTABlock = forwardRef<HTMLDivElement, CTABlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as CTAProps;

    const style: React.CSSProperties = {
      padding: props.padding || '4rem 2rem',
      margin: props.margin,
      backgroundColor: props.backgroundColor || '#f3f4f6',
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        <div className="max-w-3xl mx-auto text-center">
          <h2 className="text-3xl md:text-4xl font-bold mb-4">
            {props.title}
          </h2>
          {props.description && (
            <p className="text-xl text-gray-600 mb-8">{props.description}</p>
          )}
          <Button
            size="lg"
            variant={props.variant === 'secondary' ? 'secondary' : 'default'}
            asChild={isPreview}
          >
            {isPreview ? (
              <a href={props.buttonHref}>{props.buttonText}</a>
            ) : (
              <span>{props.buttonText}</span>
            )}
          </Button>
        </div>
      </div>
    );
  }
);

CTABlock.displayName = 'CTABlock';

// ==========================================
// File: components/page-builder/blocks/features-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, FeaturesProps } from '@/lib/page-builder-types';
import { cn } from '@/lib/utils';

interface FeaturesBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const FeaturesBlock = forwardRef<HTMLDivElement, FeaturesBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as FeaturesProps;

    const style: React.CSSProperties = {
      padding: props.padding || '4rem 2rem',
      margin: props.margin,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        {props.title && (
          <h2 className="text-3xl md:text-4xl font-bold text-center mb-12">
            {props.title}
          </h2>
        )}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
          {props.features.map((feature, index) => (
            <div key={index} className="text-center">
              {feature.icon && (
                <div className="text-5xl mb-4">{feature.icon}</div>
              )}
              <h3 className="text-xl font-bold mb-2">{feature.title}</h3>
              <p className="text-gray-600">{feature.description}</p>
            </div>
          ))}
        </div>
      </div>
    );
  }
);

FeaturesBlock.displayName = 'FeaturesBlock';

// ==========================================
// File: components/page-builder/blocks/form-block.tsx
// ==========================================


'use client';

import React, { forwardRef, useState } from 'react';
import { PageBlock, FormProps } from '@/lib/page-builder-types';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { cn } from '@/lib/utils';

interface FormBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const FormBlock = forwardRef<HTMLDivElement, FormBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as FormProps;
    const [formData, setFormData] = useState<Record<string, string>>({});

    const style: React.CSSProperties = {
      padding: props.padding || '4rem 2rem',
      margin: props.margin,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    const handleSubmit = async (e: React.FormEvent) => {
      e.preventDefault();
      if (!isPreview) return;

      try {
        const response = await fetch(props.submitEndpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData),
        });
        
        if (response.ok) {
          alert('Form submitted successfully!');
          setFormData({});
        }
      } catch (error) {
        alert('Failed to submit form');
      }
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        <div className="max-w-2xl mx-auto">
          {props.title && (
            <h2 className="text-3xl font-bold text-center mb-8">
              {props.title}
            </h2>
          )}
          <form onSubmit={handleSubmit} className="space-y-6">
            {props.fields.map((field, index) => (
              <div key={index}>
                <Label htmlFor={field.name}>
                  {field.label}
                  {field.required && <span className="text-red-500 ml-1">*</span>}
                </Label>
                {field.type === 'textarea' ? (
                  <Textarea
                    id={field.name}
                    name={field.name}
                    required={field.required}
                    value={formData[field.name] || ''}
                    onChange={(e) =>
                      setFormData({ ...formData, [field.name]: e.target.value })
                    }
                    disabled={!isPreview}
                  />
                ) : field.type === 'select' ? (
                  <Select
                    value={formData[field.name] || ''}
                    onValueChange={(value) =>
                      setFormData({ ...formData, [field.name]: value })
                    }
                    disabled={!isPreview}
                  >
                    <SelectTrigger>
                      <SelectValue placeholder="Select an option" />
                    </SelectTrigger>
                    <SelectContent>
                      {field.options?.map((option, oIndex) => (
                        <SelectItem key={oIndex} value={option}>
                          {option}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                ) : (
                  <Input
                    id={field.name}
                    name={field.name}
                    type={field.type}
                    required={field.required}
                    value={formData[field.name] || ''}
                    onChange={(e) =>
                      setFormData({ ...formData, [field.name]: e.target.value })
                    }
                    disabled={!isPreview}
                  />
                )}
              </div>
            ))}
            <Button type="submit" className="w-full" disabled={!isPreview}>
              {props.submitText}
            </Button>
          </form>
        </div>
      </div>
    );
  }
);

FormBlock.displayName = 'FormBlock';

// ==========================================
// File: components/page-builder/blocks/heading-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, HeadingProps } from '@/lib/page-builder-types';
import { cn } from '@/lib/utils';

interface HeadingBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const HeadingBlock = forwardRef<HTMLDivElement, HeadingBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as HeadingProps;
    const Tag = `h${props.level}` as 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6';

    const style: React.CSSProperties = {
      textAlign: props.align,
      color: props.color,
      margin: props.margin,
      padding: props.padding,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600'
        )}
      >
        <Tag
          className={cn(
            'font-bold',
            props.level === 1 && 'text-4xl md:text-6xl',
            props.level === 2 && 'text-3xl md:text-5xl',
            props.level === 3 && 'text-2xl md:text-4xl',
            props.level === 4 && 'text-xl md:text-3xl',
            props.level === 5 && 'text-lg md:text-2xl',
            props.level === 6 && 'text-base md:text-xl',
            props.className
          )}
          style={style}
        >
          {props.text}
        </Tag>
      </div>
    );
  }
);

HeadingBlock.displayName = 'HeadingBlock';

// ==========================================
// File: components/page-builder/blocks/hero-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, HeroProps } from '@/lib/page-builder-types';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';

interface HeroBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const HeroBlock = forwardRef<HTMLDivElement, HeroBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as HeroProps;

    const style: React.CSSProperties = {
      backgroundImage: props.backgroundImage ? `url(${props.backgroundImage})` : undefined,
      backgroundSize: 'cover',
      backgroundPosition: 'center',
      margin: props.margin,
      padding: props.padding || '4rem 2rem',
      backgroundColor: props.backgroundColor || '#f3f4f6',
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        {props.overlay && props.backgroundImage && (
          <div
            className="absolute inset-0 bg-black"
            style={{ opacity: props.overlayOpacity || 0.5 }}
          />
        )}
        <div className="relative z-10 max-w-4xl mx-auto text-center">
          <h1 className="text-4xl md:text-6xl font-bold mb-4 text-white">
            {props.title}
          </h1>
          {props.subtitle && (
            <p className="text-xl md:text-2xl mb-8 text-white/90">
              {props.subtitle}
            </p>
          )}
          {props.buttonText && (
            <Button size="lg" asChild={isPreview}>
              {isPreview ? (
                <a href={props.buttonHref}>{props.buttonText}</a>
              ) : (
                <span>{props.buttonText}</span>
              )}
            </Button>
          )}
        </div>
      </div>
    );
  }
);

HeroBlock.displayName = 'HeroBlock';

// ==========================================
// File: components/page-builder/blocks/image-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import Image from 'next/image';
import { PageBlock, ImageProps } from '@/lib/page-builder-types';
import { cn } from '@/lib/utils';

interface ImageBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const ImageBlock = forwardRef<HTMLDivElement, ImageBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as ImageProps;

    const style: React.CSSProperties = {
      margin: props.margin,
      padding: props.padding,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        <div className={cn('relative', props.rounded && 'rounded-lg overflow-hidden')}>
          {props.src ? (
            <Image
              src={props.src}
              alt={props.alt || 'Image'}
              width={props.width === '100%' ? 800 : parseInt(props.width || '800')}
              height={props.height === 'auto' ? 600 : parseInt(props.height || '600')}
              className="w-full h-auto"
              style={{ objectFit: props.objectFit }}
            />
          ) : (
            <div className="w-full h-64 bg-gray-200 flex items-center justify-center">
              <p className="text-gray-500">No image selected</p>
            </div>
          )}
        </div>
      </div>
    );
  }
);

ImageBlock.displayName = 'ImageBlock';

// ==========================================
// File: components/page-builder/blocks/pricing-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, PricingProps } from '@/lib/page-builder-types';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';
import { Check } from 'lucide-react';

interface PricingBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const PricingBlock = forwardRef<HTMLDivElement, PricingBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as PricingProps;

    const style: React.CSSProperties = {
      padding: props.padding || '4rem 2rem',
      margin: props.margin,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
          {props.tiers.map((tier, index) => (
            <div
              key={index}
              className={cn(
                'border rounded-lg p-8',
                tier.highlighted && 'border-blue-600 shadow-xl scale-105'
              )}
            >
              <h3 className="text-2xl font-bold mb-2">{tier.name}</h3>
              <div className="mb-4">
                <span className="text-4xl font-bold">{tier.price}</span>
                {tier.period && (
                  <span className="text-gray-600 ml-2">{tier.period}</span>
                )}
              </div>
              <ul className="space-y-3 mb-6">
                {tier.features.map((feature, fIndex) => (
                  <li key={fIndex} className="flex items-start gap-2">
                    <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                    <span>{feature}</span>
                  </li>
                ))}
              </ul>
              <Button
                className="w-full"
                variant={tier.highlighted ? 'default' : 'outline'}
                asChild={isPreview}
              >
                {isPreview ? (
                  <a href={tier.buttonHref}>{tier.buttonText}</a>
                ) : (
                  <span>{tier.buttonText}</span>
                )}
              </Button>
            </div>
          ))}
        </div>
      </div>
    );
  }
);

PricingBlock.displayName = 'PricingBlock';

// ==========================================
// File: components/page-builder/blocks/spacer-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, SpacerProps } from '@/lib/page-builder-types';
import { cn } from '@/lib/utils';

interface SpacerBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const SpacerBlock = forwardRef<HTMLDivElement, SpacerBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as SpacerProps;

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600'
        )}
        style={{ height: props.height }}
      >
        {!isPreview && (
          <div className="absolute inset-0 flex items-center justify-center text-gray-400 text-sm">
            Spacer ({props.height})
          </div>
        )}
      </div>
    );
  }
);

SpacerBlock.displayName = 'SpacerBlock';

// ==========================================
// File: components/page-builder/blocks/testimonial-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import Image from 'next/image';
import { PageBlock, TestimonialProps } from '@/lib/page-builder-types';
import { cn } from '@/lib/utils';

interface TestimonialBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const TestimonialBlock = forwardRef<HTMLDivElement, TestimonialBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as TestimonialProps;

    const style: React.CSSProperties = {
      padding: props.padding || '4rem 2rem',
      margin: props.margin,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        <div className="max-w-3xl mx-auto text-center">
          <blockquote className="text-xl md:text-2xl italic mb-6">
            "{props.quote}"
          </blockquote>
          <div className="flex items-center justify-center gap-4">
            {props.image && (
              <Image
                src={props.image}
                alt={props.author}
                width={60}
                height={60}
                className="rounded-full"
              />
            )}
            <div className="text-left">
              <p className="font-bold">{props.author}</p>
              {props.role && (
                <p className="text-sm text-gray-600">{props.role}</p>
              )}
            </div>
          </div>
        </div>
      </div>
    );
  }
);

TestimonialBlock.displayName = 'TestimonialBlock';

// ==========================================
// File: components/page-builder/blocks/text-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, TextProps } from '@/lib/page-builder-types';
import { cn } from '@/lib/utils';

interface TextBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const TextBlock = forwardRef<HTMLDivElement, TextBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as TextProps;

    const style: React.CSSProperties = {
      textAlign: props.align,
      color: props.color,
      fontSize: props.fontSize,
      margin: props.margin,
      padding: props.padding,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
      >
        <div
          style={style}
          dangerouslySetInnerHTML={{ __html: props.content }}
        />
      </div>
    );
  }
);

TextBlock.displayName = 'TextBlock';

// ==========================================
// File: components/page-builder/blocks/video-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock, VideoProps } from '@/lib/page-builder-types';
import { cn } from '@/lib/utils';

interface VideoBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
}

export const VideoBlock = forwardRef<HTMLDivElement, VideoBlockProps>(
  ({ block, isSelected, isPreview, onClick }, ref) => {
    const props = block.props as VideoProps;

    const style: React.CSSProperties = {
      padding: props.padding,
      margin: props.margin,
      backgroundColor: props.backgroundColor,
      ...props.style,
    };

    return (
      <div
        ref={ref}
        onClick={onClick}
        className={cn(
          'relative',
          !isPreview && 'hover:outline hover:outline-2 hover:outline-blue-400 cursor-pointer',
          isSelected && 'outline outline-2 outline-blue-600',
          props.className
        )}
        style={style}
      >
        {props.src ? (
          <video
            src={props.src}
            autoPlay={props.autoplay}
            controls={props.controls}
            loop={props.loop}
            muted={props.muted}
            className="w-full h-auto"
          />
        ) : (
          <div className="w-full h-64 bg-gray-200 flex items-center justify-center">
            <p className="text-gray-500">No video selected</p>
          </div>
        )}
      </div>
    );
  }
);

VideoBlock.displayName = 'VideoBlock';

// ==========================================
// File: components/page-builder/editable-block.tsx
// ==========================================


'use client';

import React, { forwardRef } from 'react';
import { PageBlock } from '@/lib/page-builder-types';
import { HeadingBlock } from './blocks/heading-block';
import { TextBlock } from './blocks/text-block';
import { ButtonBlock } from './blocks/button-block';
import { ImageBlock } from './blocks/image-block';
import { SpacerBlock } from './blocks/spacer-block';
import { ContainerBlock } from './blocks/container-block';
import { ColumnsBlock } from './blocks/columns-block';
import { HeroBlock } from './blocks/hero-block';
import { FeaturesBlock } from './blocks/features-block';
import { CTABlock } from './blocks/cta-block';
import { TestimonialBlock } from './blocks/testimonial-block';
import { PricingBlock } from './blocks/pricing-block';
import { FormBlock } from './blocks/form-block';
import { VideoBlock } from './blocks/video-block';

interface EditableBlockProps {
  block: PageBlock;
  isSelected?: boolean;
  isPreview?: boolean;
  onClick?: () => void;
  onUpdate?: (block: PageBlock) => void;
}

export const EditableBlock = forwardRef<HTMLDivElement, EditableBlockProps>(
  ({ block, isSelected, isPreview, onClick, onUpdate }, ref) => {
    const commonProps = {
      block,
      isSelected,
      isPreview,
      onClick,
      onUpdate,
      ref,
    };

    switch (block.type) {
      case 'heading':
        return <HeadingBlock {...commonProps} />;
      case 'text':
        return <TextBlock {...commonProps} />;
      case 'button':
        return <ButtonBlock {...commonProps} />;
      case 'image':
        return <ImageBlock {...commonProps} />;
      case 'spacer':
        return <SpacerBlock {...commonProps} />;
      case 'container':
        return <ContainerBlock {...commonProps} />;
      case 'columns':
        return <ColumnsBlock {...commonProps} />;
      case 'hero':
        return <HeroBlock {...commonProps} />;
      case 'features':
        return <FeaturesBlock {...commonProps} />;
      case 'cta':
        return <CTABlock {...commonProps} />;
      case 'testimonial':
        return <TestimonialBlock {...commonProps} />;
      case 'pricing':
        return <PricingBlock {...commonProps} />;
      case 'form':
        return <FormBlock {...commonProps} />;
      case 'video':
        return <VideoBlock {...commonProps} />;
      default:
        return (
          <div className="p-4 border border-red-300 bg-red-50">
            Unknown block type: {block.type}
          </div>
        );
    }
  }
);

EditableBlock.displayName = 'EditableBlock';

// ==========================================
// File: components/page-builder/new-page-form.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { toast } from 'react-hot-toast';

export function NewPageForm() {
  const router = useRouter();
  const [isCreating, setIsCreating] = useState(false);
  const [title, setTitle] = useState('');
  const [slug, setSlug] = useState('');
  const [description, setDescription] = useState('');

  const generateSlug = (title: string) => {
    return title
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-|-$/g, '');
  };

  const handleTitleChange = (value: string) => {
    setTitle(value);
    if (!slug) {
      setSlug(generateSlug(value));
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!title || !slug) {
      toast.error('Please fill in all required fields');
      return;
    }

    setIsCreating(true);

    try {
      const response = await fetch('/api/page-builder/pages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          title,
          slug,
          description,
          content: JSON.stringify({ sections: [], version: '1.0' }),
          status: 'draft',
        }),
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'Failed to create page');
      }

      const data = await response.json();
      toast.success('Page created successfully!');
      router.push(`/dashboard/pages/edit/${data.page.id}`);
    } catch (error: any) {
      console.error('Error creating page:', error);
      toast.error(error.message || 'Failed to create page');
    } finally {
      setIsCreating(false);
    }
  };

  return (
    <Card className="max-w-2xl">
      <CardHeader>
        <CardTitle>Page Details</CardTitle>
        <CardDescription>
          Enter the basic information for your new page
        </CardDescription>
      </CardHeader>
      <CardContent>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="title">
              Page Title <span className="text-destructive">*</span>
            </Label>
            <Input
              id="title"
              value={title}
              onChange={(e) => handleTitleChange(e.target.value)}
              placeholder="e.g., About Us, Contact, Services"
              required
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="slug">
              URL Slug <span className="text-destructive">*</span>
            </Label>
            <Input
              id="slug"
              value={slug}
              onChange={(e) => setSlug(e.target.value.toLowerCase().replace(/\s+/g, '-'))}
              placeholder="e.g., about-us"
              required
            />
            <p className="text-xs text-muted-foreground">
              Page will be accessible at: /{slug || 'your-slug'}
            </p>
          </div>

          <div className="space-y-2">
            <Label htmlFor="description">Description (optional)</Label>
            <Textarea
              id="description"
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              placeholder="Brief description of what this page is about"
              rows={3}
            />
          </div>

          <div className="flex gap-2 pt-4">
            <Button
              type="button"
              variant="outline"
              onClick={() => router.back()}
              disabled={isCreating}
            >
              Cancel
            </Button>
            <Button type="submit" disabled={isCreating}>
              {isCreating ? 'Creating...' : 'Create Page'}
            </Button>
          </div>
        </form>
      </CardContent>
    </Card>
  );
}

// ==========================================
// File: components/page-builder/page-editor-client.tsx
// ==========================================


'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { SectionEditor } from './section-editor';
import { SectionPreview } from './section-preview';
import { Section, SectionType, sectionTemplates, createSection } from '@/lib/page-templates';
import { Save, Eye, Plus, Settings } from 'lucide-react';
import { toast } from 'react-hot-toast';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';

interface PageEditorClientProps {
  page: {
    id: string;
    title: string;
    slug: string;
    description?: string | null;
    content: string;
    metaTitle?: string | null;
    metaDescription?: string | null;
    status: string;
  };
}

export function PageEditorClient({ page }: PageEditorClientProps) {
  const router = useRouter();
  const [title, setTitle] = useState(page.title);
  const [slug, setSlug] = useState(page.slug);
  const [description, setDescription] = useState(page.description || '');
  const [metaTitle, setMetaTitle] = useState(page.metaTitle || '');
  const [metaDescription, setMetaDescription] = useState(page.metaDescription || '');
  const [status, setStatus] = useState(page.status);
  const [sections, setSections] = useState<Section[]>([]);
  const [isSaving, setIsSaving] = useState(false);
  const [showPreview, setShowPreview] = useState(false);

  useEffect(() => {
    try {
      const parsedContent = JSON.parse(page.content);
      setSections(parsedContent.sections || []);
    } catch (error) {
      console.error('Error parsing page content:', error);
      setSections([]);
    }
  }, [page.content]);

  const addSection = (type: SectionType) => {
    const newSection = createSection(type);
    newSection.order = sections.length;
    setSections([...sections, newSection]);
  };

  const updateSection = (index: number, updatedSection: Section) => {
    const newSections = [...sections];
    newSections[index] = updatedSection;
    setSections(newSections);
  };

  const deleteSection = (index: number) => {
    const newSections = sections.filter((_, i) => i !== index);
    // Update order
    newSections.forEach((section, i) => {
      section.order = i;
    });
    setSections(newSections);
  };

  const moveSection = (index: number, direction: 'up' | 'down') => {
    if (
      (direction === 'up' && index === 0) ||
      (direction === 'down' && index === sections.length - 1)
    ) {
      return;
    }

    const newSections = [...sections];
    const targetIndex = direction === 'up' ? index - 1 : index + 1;
    [newSections[index], newSections[targetIndex]] = [
      newSections[targetIndex],
      newSections[index],
    ];

    // Update order
    newSections.forEach((section, i) => {
      section.order = i;
    });

    setSections(newSections);
  };

  const handleSave = async (newStatus?: string) => {
    setIsSaving(true);
    try {
      const content = JSON.stringify({
        sections,
        version: '1.0',
      });

      const response = await fetch(`/api/page-builder/pages/${page.id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          title,
          slug,
          description,
          content,
          metaTitle: metaTitle || title,
          metaDescription: metaDescription || description,
          status: newStatus || status,
        }),
      });

      if (!response.ok) {
        throw new Error('Failed to save page');
      }

      toast.success('Page saved successfully!');
      
      if (newStatus === 'published') {
        toast.success('Page is now live!');
      }
      
      router.refresh();
    } catch (error) {
      console.error('Error saving page:', error);
      toast.error('Failed to save page');
    } finally {
      setIsSaving(false);
    }
  };

  return (
    <div className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Settings className="w-5 h-5" />
            Page Settings
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label>Page Title</Label>
              <Input
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                placeholder="About Us"
              />
            </div>
            <div className="space-y-2">
              <Label>URL Slug</Label>
              <Input
                value={slug}
                onChange={(e) => setSlug(e.target.value.toLowerCase().replace(/\s+/g, '-'))}
                placeholder="about-us"
              />
              <p className="text-xs text-muted-foreground">
                Page will be accessible at: /{slug}
              </p>
            </div>
          </div>
          <div className="space-y-2">
            <Label>Description (optional)</Label>
            <Textarea
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              placeholder="Brief description of the page"
              rows={2}
            />
          </div>
          <div className="grid grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label>Meta Title (SEO)</Label>
              <Input
                value={metaTitle}
                onChange={(e) => setMetaTitle(e.target.value)}
                placeholder="Leave blank to use page title"
              />
            </div>
            <div className="space-y-2">
              <Label>Status</Label>
              <Select value={status} onValueChange={setStatus}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="draft">Draft</SelectItem>
                  <SelectItem value="published">Published</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          <div className="space-y-2">
            <Label>Meta Description (SEO)</Label>
            <Textarea
              value={metaDescription}
              onChange={(e) => setMetaDescription(e.target.value)}
              placeholder="Leave blank to use page description"
              rows={2}
            />
          </div>
        </CardContent>
      </Card>

      <Tabs defaultValue="edit" className="space-y-4">
        <div className="flex items-center justify-between">
          <TabsList>
            <TabsTrigger value="edit">Edit</TabsTrigger>
            <TabsTrigger value="preview">Preview</TabsTrigger>
          </TabsList>
          <div className="flex gap-2">
            <Button
              variant="outline"
              onClick={() => handleSave('draft')}
              disabled={isSaving}
            >
              Save Draft
            </Button>
            <Button onClick={() => handleSave('published')} disabled={isSaving}>
              {isSaving ? 'Saving...' : 'Save & Publish'}
            </Button>
          </div>
        </div>

        <TabsContent value="edit" className="space-y-6">
          <Card>
            <CardHeader>
              <div className="flex items-center justify-between">
                <CardTitle>Add Section</CardTitle>
              </div>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                {(Object.keys(sectionTemplates) as SectionType[]).map((type) => (
                  <Button
                    key={type}
                    variant="outline"
                    onClick={() => addSection(type)}
                    className="h-auto flex-col py-3"
                  >
                    <Plus className="w-4 h-4 mb-1" />
                    <span className="text-xs">{sectionTemplates[type].name}</span>
                  </Button>
                ))}
              </div>
            </CardContent>
          </Card>

          {sections.length === 0 ? (
            <Card>
              <CardContent className="py-12 text-center">
                <p className="text-muted-foreground mb-4">
                  No sections yet. Add your first section to get started.
                </p>
                <Button onClick={() => addSection('hero')}>
                  <Plus className="w-4 h-4 mr-2" />
                  Add Hero Section
                </Button>
              </CardContent>
            </Card>
          ) : (
            <div className="space-y-4">
              {sections.map((section, index) => (
                <SectionEditor
                  key={section.id}
                  section={section}
                  onUpdate={(updated) => updateSection(index, updated)}
                  onDelete={() => deleteSection(index)}
                  onMoveUp={() => moveSection(index, 'up')}
                  onMoveDown={() => moveSection(index, 'down')}
                  isFirst={index === 0}
                  isLast={index === sections.length - 1}
                />
              ))}
            </div>
          )}
        </TabsContent>

        <TabsContent value="preview" className="space-y-4">
          <Card>
            <CardContent className="p-0">
              <div className="bg-background">
                {sections.length === 0 ? (
                  <div className="py-12 text-center">
                    <p className="text-muted-foreground">
                      No content to preview. Add sections in the Edit tab.
                    </p>
                  </div>
                ) : (
                  <div className="space-y-0">
                    {sections.map((section) => (
                      <SectionPreview key={section.id} section={section} />
                    ))}
                  </div>
                )}
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  );
}

// ==========================================
// File: components/page-builder/page-list.tsx
// ==========================================

'use client';

import React, { useState, useEffect } from 'react';
import Link from 'next/link';
import { useRouter } from 'next/navigation';
import { Button } from '@/components/ui/button';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { Badge } from '@/components/ui/badge';
import { Plus, MoreVertical, Eye, Edit, Trash2, Copy } from 'lucide-react';
import { format } from 'date-fns';
import { toast } from 'sonner';

interface Page {
  id: string;
  title: string;
  slug: string;
  description?: string;
  status: string;
  views: number;
  publishedAt?: string;
  createdAt: string;
  updatedAt: string;
}

export function PageList() {
  const router = useRouter();
  const [pages, setPages] = useState<Page[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchPages();
  }, []);

  const fetchPages = async () => {
    try {
      const response = await fetch('/api/page-builder/pages');
      const data = await response.json();
      setPages(data.pages);
    } catch (error) {
      toast.error('Failed to load pages');
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id: string) => {
    if (!confirm('Are you sure you want to delete this page?')) return;

    try {
      await fetch(`/api/page-builder/pages/${id}`, {
        method: 'DELETE',
      });
      toast.success('Page deleted successfully');
      fetchPages();
    } catch (error) {
      toast.error('Failed to delete page');
    }
  };

  const handleDuplicate = async (page: Page) => {
    try {
      const response = await fetch(`/api/page-builder/pages/${page.id}`);
      const { page: originalPage } = await response.json();

      const duplicateResponse = await fetch('/api/page-builder/pages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          title: `${originalPage.title} (Copy)`,
          slug: `${originalPage.slug}-copy-${Date.now()}`,
          description: originalPage.description,
          content: originalPage.content,
          settings: originalPage.settings,
          metaTitle: originalPage.metaTitle,
          metaDescription: originalPage.metaDescription,
        }),
      });

      if (duplicateResponse.ok) {
        toast.success('Page duplicated successfully');
        fetchPages();
      }
    } catch (error) {
      toast.error('Failed to duplicate page');
    }
  };

  if (loading) {
    return <div className="p-8">Loading...</div>;
  }

  return (
    <div className="p-6 space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold">Pages</h1>
          <p className="text-muted-foreground mt-1">
            Create and manage your custom pages
          </p>
        </div>
        <Link href="/dashboard/pages/new">
          <Button>
            <Plus className="w-4 h-4 mr-2" />
            New Page
          </Button>
        </Link>
      </div>

      {pages.length === 0 ? (
        <div className="text-center py-12 border border-dashed rounded-lg">
          <p className="text-muted-foreground mb-4">
            No pages yet. Create your first page!
          </p>
          <Link href="/dashboard/pages/new">
            <Button>
              <Plus className="w-4 h-4 mr-2" />
              Create Page
            </Button>
          </Link>
        </div>
      ) : (
        <div className="border rounded-lg">
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead>Title</TableHead>
                <TableHead>Slug</TableHead>
                <TableHead>Status</TableHead>
                <TableHead>Views</TableHead>
                <TableHead>Updated</TableHead>
                <TableHead className="w-[70px]"></TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {pages.map((page) => (
                <TableRow key={page.id}>
                  <TableCell className="font-medium">{page.title}</TableCell>
                  <TableCell>
                    <code className="text-sm">/{page.slug}</code>
                  </TableCell>
                  <TableCell>
                    <Badge
                      variant={
                        page.status === 'published'
                          ? 'default'
                          : page.status === 'draft'
                          ? 'secondary'
                          : 'outline'
                      }
                    >
                      {page.status}
                    </Badge>
                  </TableCell>
                  <TableCell>{page.views}</TableCell>
                  <TableCell>
                    {format(new Date(page.updatedAt), 'MMM d, yyyy')}
                  </TableCell>
                  <TableCell>
                    <DropdownMenu>
                      <DropdownMenuTrigger asChild>
                        <Button variant="ghost" size="sm">
                          <MoreVertical className="w-4 h-4" />
                        </Button>
                      </DropdownMenuTrigger>
                      <DropdownMenuContent align="end">
                        <DropdownMenuItem
                          onClick={() =>
                            router.push(`/dashboard/pages/edit/${page.id}`)
                          }
                        >
                          <Edit className="w-4 h-4 mr-2" />
                          Edit
                        </DropdownMenuItem>
                        {page.status === 'published' && (
                          <DropdownMenuItem
                            onClick={() =>
                              window.open(`/p/${page.slug}`, '_blank')
                            }
                          >
                            <Eye className="w-4 h-4 mr-2" />
                            View
                          </DropdownMenuItem>
                        )}
                        <DropdownMenuItem onClick={() => handleDuplicate(page)}>
                          <Copy className="w-4 h-4 mr-2" />
                          Duplicate
                        </DropdownMenuItem>
                        <DropdownMenuItem
                          onClick={() => handleDelete(page.id)}
                          className="text-red-600"
                        >
                          <Trash2 className="w-4 h-4 mr-2" />
                          Delete
                        </DropdownMenuItem>
                      </DropdownMenuContent>
                    </DropdownMenu>
                  </TableCell>
                </TableRow>
              ))}
            </TableBody>
          </Table>
        </div>
      )}
    </div>
  );
}

// ==========================================
// File: components/page-builder/section-editor.tsx
// ==========================================


'use client';

import { Section, SectionType, sectionTemplates } from '@/lib/page-templates';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Trash2, ChevronUp, ChevronDown, Plus, Minus } from 'lucide-react';
import { FileUpload } from '@/components/file-upload';

interface SectionEditorProps {
  section: Section;
  onUpdate: (section: Section) => void;
  onDelete: () => void;
  onMoveUp: () => void;
  onMoveDown: () => void;
  isFirst: boolean;
  isLast: boolean;
}

export function SectionEditor({
  section,
  onUpdate,
  onDelete,
  onMoveUp,
  onMoveDown,
  isFirst,
  isLast,
}: SectionEditorProps) {
  const updateData = (key: string, value: any) => {
    onUpdate({
      ...section,
      data: {
        ...section.data,
        [key]: value,
      },
    });
  };

  const updateNestedData = (path: (string | number)[], value: any) => {
    const newData = { ...section.data };
    let current: any = newData;
    
    for (let i = 0; i < path.length - 1; i++) {
      current = current[path[i]];
    }
    
    current[path[path.length - 1]] = value;
    
    onUpdate({
      ...section,
      data: newData,
    });
  };

  const addArrayItem = (key: string, defaultItem: any) => {
    const currentArray = section.data[key] || [];
    updateData(key, [...currentArray, JSON.parse(JSON.stringify(defaultItem))]);
  };

  const removeArrayItem = (key: string, index: number) => {
    const currentArray = section.data[key] || [];
    updateData(key, currentArray.filter((_: any, i: number) => i !== index));
  };

  const renderFieldEditor = () => {
    const template = sectionTemplates[section.type];

    switch (section.type) {
      case 'hero':
        return (
          <>
            <div className="space-y-2">
              <Label>Headline</Label>
              <Input
                value={section.data.headline || ''}
                onChange={(e) => updateData('headline', e.target.value)}
                placeholder="Main headline"
              />
            </div>
            <div className="space-y-2">
              <Label>Subheading</Label>
              <Textarea
                value={section.data.subheading || ''}
                onChange={(e) => updateData('subheading', e.target.value)}
                placeholder="Supporting text"
                rows={2}
              />
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label>CTA Text</Label>
                <Input
                  value={section.data.ctaText || ''}
                  onChange={(e) => updateData('ctaText', e.target.value)}
                  placeholder="Get Started"
                />
              </div>
              <div className="space-y-2">
                <Label>CTA Link</Label>
                <Input
                  value={section.data.ctaLink || ''}
                  onChange={(e) => updateData('ctaLink', e.target.value)}
                  placeholder="/contact"
                />
              </div>
            </div>
            <div className="space-y-2">
              <FileUpload
                value={section.data.backgroundImage || ''}
                onChange={(value) => updateData('backgroundImage', value)}
                label="Background Image"
                description="Click to upload or drag and drop"
              />
            </div>
            <div className="space-y-2">
              <Label>Text Alignment</Label>
              <Select
                value={section.data.alignment || 'center'}
                onValueChange={(value) => updateData('alignment', value)}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="left">Left</SelectItem>
                  <SelectItem value="center">Center</SelectItem>
                  <SelectItem value="right">Right</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </>
        );

      case 'text':
        return (
          <>
            <div className="space-y-2">
              <Label>Content</Label>
              <Textarea
                value={section.data.content || ''}
                onChange={(e) => updateData('content', e.target.value)}
                placeholder="Enter your text content..."
                rows={8}
              />
              <p className="text-xs text-muted-foreground">
                Supports basic HTML: &lt;p&gt;, &lt;h2&gt;, &lt;strong&gt;, &lt;em&gt;, &lt;ul&gt;, &lt;ol&gt;, &lt;li&gt;
              </p>
            </div>
            <div className="space-y-2">
              <Label>Alignment</Label>
              <Select
                value={section.data.alignment || 'left'}
                onValueChange={(value) => updateData('alignment', value)}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="left">Left</SelectItem>
                  <SelectItem value="center">Center</SelectItem>
                  <SelectItem value="right">Right</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </>
        );

      case 'features':
        return (
          <>
            <div className="space-y-2">
              <Label>Section Title</Label>
              <Input
                value={section.data.title || ''}
                onChange={(e) => updateData('title', e.target.value)}
                placeholder="Our Services"
              />
            </div>
            <div className="space-y-2">
              <Label>Subtitle</Label>
              <Input
                value={section.data.subtitle || ''}
                onChange={(e) => updateData('subtitle', e.target.value)}
                placeholder="Everything you need..."
              />
            </div>
            <div className="space-y-2">
              <Label>Columns</Label>
              <Select
                value={String(section.data.columns || 3)}
                onValueChange={(value) => updateData('columns', parseInt(value))}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value={"2"}>2 Columns</SelectItem>
                  <SelectItem value={"3"}>3 Columns</SelectItem>
                  <SelectItem value={"4"}>4 Columns</SelectItem>
                </SelectContent>
              </Select>
            </div>
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <Label>Feature Items</Label>
                <Button
                  size="sm"
                  variant="outline"
                  onClick={() =>
                    addArrayItem('items', {
                      icon: 'üöÄ',
                      title: 'New Feature',
                      description: 'Feature description',
                    })
                  }
                >
                  <Plus className="w-4 h-4 mr-1" /> Add Item
                </Button>
              </div>
              {(section.data.items || []).map((item: any, index: number) => (
                <Card key={index}>
                  <CardContent className="pt-4 space-y-3">
                    <div className="flex items-center justify-between">
                      <span className="text-sm font-medium">Item {index + 1}</span>
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={() => removeArrayItem('items', index)}
                      >
                        <Minus className="w-4 h-4" />
                      </Button>
                    </div>
                    <Input
                      placeholder="Icon (emoji)"
                      value={item.icon || ''}
                      onChange={(e) =>
                        updateNestedData(['items', index, 'icon'], e.target.value)
                      }
                    />
                    <Input
                      placeholder="Title"
                      value={item.title || ''}
                      onChange={(e) =>
                        updateNestedData(['items', index, 'title'], e.target.value)
                      }
                    />
                    <Textarea
                      placeholder="Description"
                      value={item.description || ''}
                      onChange={(e) =>
                        updateNestedData(['items', index, 'description'], e.target.value)
                      }
                      rows={2}
                    />
                  </CardContent>
                </Card>
              ))}
            </div>
          </>
        );

      case 'cta':
        return (
          <>
            <div className="space-y-2">
              <Label>Headline</Label>
              <Input
                value={section.data.headline || ''}
                onChange={(e) => updateData('headline', e.target.value)}
                placeholder="Ready to Get Started?"
              />
            </div>
            <div className="space-y-2">
              <Label>Subheadline</Label>
              <Input
                value={section.data.subheadline || ''}
                onChange={(e) => updateData('subheadline', e.target.value)}
                placeholder="Join hundreds of satisfied clients"
              />
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label>Button Text</Label>
                <Input
                  value={section.data.buttonText || ''}
                  onChange={(e) => updateData('buttonText', e.target.value)}
                  placeholder="Start Now"
                />
              </div>
              <div className="space-y-2">
                <Label>Button Link</Label>
                <Input
                  value={section.data.buttonLink || ''}
                  onChange={(e) => updateData('buttonLink', e.target.value)}
                  placeholder="/contact"
                />
              </div>
            </div>
            <div className="space-y-2">
              <Label>Background Color</Label>
              <Select
                value={section.data.backgroundColor || 'blue'}
                onValueChange={(value) => updateData('backgroundColor', value)}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="blue">Blue</SelectItem>
                  <SelectItem value="purple">Purple</SelectItem>
                  <SelectItem value="green">Green</SelectItem>
                  <SelectItem value="gray">Gray</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </>
        );

      case 'image':
        return (
          <>
            <div className="space-y-2">
              <FileUpload
                value={section.data.src || ''}
                onChange={(value) => updateData('src', value)}
                label="Image"
                description="Click to upload or drag and drop"
              />
            </div>
            <div className="space-y-2">
              <Label>Alt Text</Label>
              <Input
                value={section.data.alt || ''}
                onChange={(e) => updateData('alt', e.target.value)}
                placeholder="Image description"
              />
            </div>
            <div className="space-y-2">
              <Label>Caption (optional)</Label>
              <Input
                value={section.data.caption || ''}
                onChange={(e) => updateData('caption', e.target.value)}
                placeholder="Image caption"
              />
            </div>
            <div className="space-y-2">
              <Label>Width</Label>
              <Select
                value={section.data.width || 'large'}
                onValueChange={(value) => updateData('width', value)}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="small">Small</SelectItem>
                  <SelectItem value="medium">Medium</SelectItem>
                  <SelectItem value="large">Large</SelectItem>
                  <SelectItem value="full">Full Width</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </>
        );

      default:
        return (
          <div className="text-sm text-muted-foreground">
            Editor for {section.type} - Coming soon
          </div>
        );
    }
  };

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="text-base">
            {sectionTemplates[section.type].name}
          </CardTitle>
          <div className="flex items-center gap-1">
            <Button
              size="sm"
              variant="ghost"
              onClick={onMoveUp}
              disabled={isFirst}
            >
              <ChevronUp className="w-4 h-4" />
            </Button>
            <Button
              size="sm"
              variant="ghost"
              onClick={onMoveDown}
              disabled={isLast}
            >
              <ChevronDown className="w-4 h-4" />
            </Button>
            <Button size="sm" variant="ghost" onClick={onDelete}>
              <Trash2 className="w-4 h-4" />
            </Button>
          </div>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">{renderFieldEditor()}</CardContent>
    </Card>
  );
}

// ==========================================
// File: components/page-builder/section-preview.tsx
// ==========================================


'use client';

import { Section } from '@/lib/page-templates';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { CheckCircle2 } from 'lucide-react';
import Image from 'next/image';

interface SectionPreviewProps {
  section: Section;
}

export function SectionPreview({ section }: SectionPreviewProps) {
  const renderSection = () => {
    // Helper function to get correct image URL
    const getImageUrl = (path: string) => {
      if (!path) return '';
      return path.startsWith('uploads/') ? `/api/file/${encodeURIComponent(path)}` : path;
    };

    switch (section.type) {
      case 'hero':
        return (
          <div
            className="relative py-20 px-4"
            style={{
              backgroundImage: section.data.backgroundImage
                ? `url(${getImageUrl(section.data.backgroundImage)})`
                : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
              backgroundSize: 'cover',
              backgroundPosition: 'center',
            }}
          >
            <div className="absolute inset-0 bg-black/50" />
            <div
              className="relative max-w-4xl mx-auto"
              style={{ textAlign: section.data.alignment || 'center' }}
            >
              <h1 className="text-4xl md:text-5xl font-bold text-white mb-4">
                {section.data.headline || 'Hero Headline'}
              </h1>
              <p className="text-xl text-white/90 mb-8">
                {section.data.subheading || 'Hero subheading'}
              </p>
              {section.data.ctaText && (
                <Button size="lg">
                  {section.data.ctaText}
                </Button>
              )}
            </div>
          </div>
        );

      case 'text':
        return (
          <div className="py-12 px-4">
            <div
              className="prose max-w-4xl mx-auto"
              style={{ textAlign: section.data.alignment || 'left' }}
              dangerouslySetInnerHTML={{ __html: section.data.content || '<p>Text content</p>' }}
            />
          </div>
        );

      case 'features':
        return (
          <div className="py-16 px-4">
            <div className="max-w-6xl mx-auto">
              {section.data.title && (
                <div className="text-center mb-12">
                  <h2 className="text-3xl font-bold mb-2">{section.data.title}</h2>
                  {section.data.subtitle && (
                    <p className="text-lg text-muted-foreground">{section.data.subtitle}</p>
                  )}
                </div>
              )}
              <div
                className="grid gap-8"
                style={{
                  gridTemplateColumns: `repeat(${section.data.columns || 3}, minmax(0, 1fr))`,
                }}
              >
                {(section.data.items || []).map((item: any, index: number) => (
                  <Card key={index}>
                    <CardContent className="pt-6 text-center">
                      <div className="text-4xl mb-4">{item.icon || 'üì¶'}</div>
                      <h3 className="text-xl font-semibold mb-2">{item.title || 'Feature'}</h3>
                      <p className="text-muted-foreground">
                        {item.description || 'Feature description'}
                      </p>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </div>
          </div>
        );

      case 'cta':
        const bgColors: Record<string, string> = {
          blue: 'bg-blue-600',
          purple: 'bg-purple-600',
          green: 'bg-green-600',
          gray: 'bg-gray-800',
        };
        return (
          <div className={`py-16 px-4 ${bgColors[section.data.backgroundColor] || 'bg-blue-600'}`}>
            <div className="max-w-4xl mx-auto text-center">
              <h2 className="text-3xl font-bold text-white mb-4">
                {section.data.headline || 'Ready to get started?'}
              </h2>
              {section.data.subheadline && (
                <p className="text-xl text-white/90 mb-8">{section.data.subheadline}</p>
              )}
              {section.data.buttonText && (
                <Button size="lg" variant="secondary">
                  {section.data.buttonText}
                </Button>
              )}
            </div>
          </div>
        );

      case 'image':
        const widthClasses: Record<string, string> = {
          small: 'max-w-md',
          medium: 'max-w-2xl',
          large: 'max-w-4xl',
          full: 'max-w-full',
        };
        return (
          <div className="py-8 px-4">
            <div className={`mx-auto ${widthClasses[section.data.width] || 'max-w-4xl'}`}>
              {section.data.src ? (
                <div className="relative aspect-video bg-muted rounded-lg overflow-hidden">
                  <Image
                    src={getImageUrl(section.data.src)}
                    alt={section.data.alt || ''}
                    fill
                    className="object-cover"
                  />
                </div>
              ) : (
                <div className="aspect-video bg-muted rounded-lg flex items-center justify-center">
                  <p className="text-muted-foreground">No image selected</p>
                </div>
              )}
              {section.data.caption && (
                <p className="text-sm text-muted-foreground text-center mt-2">
                  {section.data.caption}
                </p>
              )}
            </div>
          </div>
        );

      default:
        return (
          <div className="py-12 px-4 bg-muted/50">
            <div className="max-w-4xl mx-auto text-center">
              <p className="text-muted-foreground">
                Preview for {section.type} section
              </p>
            </div>
          </div>
        );
    }
  };

  return <div className="border rounded-lg overflow-hidden">{renderSection()}</div>;
}

// ==========================================
// File: components/process-section.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Image from "next/image";
import { Search, Settings, BarChart3, TrendingUp } from "lucide-react";

const ProcessSection = () => {
  const steps = [
    {
      number: "01",
      title: "Discovery & Strategy",
      description: "We begin by understanding your business goals, target audience, and competitive landscape. Through detailed analysis and consultation, we create a custom digital marketing plan.",
      image: "https://cdn.abacus.ai/images/9df22544-e703-4ebc-bc82-dc1f7c981cb2.png",
      icon: Search,
      highlights: ["Business Analysis", "Competitor Research", "Goal Setting", "Plan Development"],
    },
    {
      number: "02",
      title: "Implementation",
      description: "Our expert team brings your plan to life with careful execution. We build, design, develop, and launch your digital marketing campaigns with attention to every detail.",
      image: "https://cdn.abacus.ai/images/5ef14ad7-9da8-4b73-9465-fc86cd14d901.png",
      icon: Settings,
      highlights: ["Campaign Setup", "Creative Development", "Technical Setup", "Quality Checks"],
    },
    {
      number: "03",
      title: "Analysis & Reporting",
      description: "We continuously monitor performance using powerful tracking tools. Regular reporting keeps you informed of progress, ROI, and key performance indicators across all channels.",
      image: "https://cdn.abacus.ai/images/3cec4c59-bcd5-4c35-9049-305d3d21700b.png",
      icon: BarChart3,
      highlights: ["Performance Monitoring", "Number Analysis", "ROI Tracking", "Regular Reporting"],
    },
    {
      number: "04",
      title: "Optimization",
      description: "Based on what the numbers tell us, we continuously improve campaigns for better performance. Testing, refinement, and smart adjustments ensure maximum results and ROI.",
      image: "https://cdn.abacus.ai/images/694f115c-6997-4b80-b2ec-6c3e1189115c.png",
      icon: TrendingUp,
      highlights: ["A/B Testing", "Performance Tuning", "Smart Adjustments", "Continuous Improvement"],
    },
  ];

  return (
    <section id="process" className="py-20 bg-gradient-to-b from-cool-gray to-white relative overflow-hidden">
      {/* Decorative background */}
      <div className="absolute inset-0 opacity-20">
        <div className="absolute top-20 right-10 w-64 h-64 bg-gradient-to-br from-secondary to-accent rounded-full mix-blend-multiply filter blur-2xl animate-pulse"></div>
        <div className="absolute bottom-20 left-10 w-64 h-64 bg-gradient-to-br from-primary to-secondary rounded-full mix-blend-multiply filter blur-2xl animate-pulse" style={{animationDelay: '1.5s'}}></div>
      </div>
      
      <div className="section-container relative z-10">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mb-16"
        >
          <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
            Our Proven Process
          </h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            A simple path to digital marketing success. Our four step process ensures 
            consistent results and measurable growth for every client.
          </p>
        </motion.div>

        <div className="space-y-16">
          {steps.map((step, index) => (
            <motion.div
              key={index}
              initial={{ opacity: 0, y: 30 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: index * 0.2 }}
              viewport={{ once: true }}
              className={`flex flex-col ${
                index % 2 === 0 ? "lg:flex-row" : "lg:flex-row-reverse"
              } items-center gap-12`}
            >
              {/* Content */}
              <div className="lg:w-1/2">
                <div className="flex items-center mb-6">
                  <div className="bg-gradient-to-r from-accent to-secondary text-charcoal w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mr-4 shadow-lg float-animation">
                    {step.number}
                  </div>
                  <step.icon className="h-8 w-8 text-primary float-animation" />
                </div>
                
                <h3 className="text-3xl font-semibold text-gray-900 mb-4">
                  {step.title}
                </h3>
                
                <p className="text-lg text-gray-600 mb-6 leading-relaxed">
                  {step.description}
                </p>
                
                <div className="grid grid-cols-2 gap-4">
                  {step.highlights.map((highlight, idx) => (
                    <div key={idx} className="flex items-center text-gray-700">
                      <div className="w-2 h-2 bg-primary rounded-full mr-3"></div>
                      <span className="font-medium">{highlight}</span>
                    </div>
                  ))}
                </div>
              </div>

              {/* Image */}
              <div className="lg:w-1/2">
                <motion.div
                  whileHover={{ scale: 1.05 }}
                  transition={{ duration: 0.3 }}
                  className="relative aspect-[4/3] bg-gray-100 rounded-lg overflow-hidden shadow-lg"
                >
                  <Image
                    src={step.image}
                    alt={step.title}
                    fill
                    className="object-cover"
                  />
                </motion.div>
              </div>
            </motion.div>
          ))}
        </div>

        {/* Call to Action */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mt-16 p-8 bg-primary/5 rounded-lg"
        >
          <h3 className="text-2xl font-semibold text-gray-900 mb-4">
            Ready to Start Your Digital Marketing Journey?
          </h3>
          <p className="text-gray-600 mb-6">
            Let's discuss how our proven process can help grow your business.
          </p>
          <motion.a
            href="/contact"
            whileHover={{ scale: 1.05 }}
            whileTap={{ scale: 0.95 }}
            className="inline-block bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal px-8 py-3 rounded-md font-bold transition-all shadow-lg hover:shadow-xl"
          >
            Start Your Project Today
          </motion.a>
        </motion.div>
      </div>
    </section>
  );
};

export default ProcessSection;

// ==========================================
// File: components/proposals/bulk-proposal-import-dialog.tsx
// ==========================================


'use client';

import { useState } from 'react';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Input } from '@/components/ui/input';
import { Upload, CheckCircle2, AlertCircle } from 'lucide-react';
import { toast } from 'sonner';
import { parseBulkLeadData, mapServicesToProposalItems } from '@/lib/bulk-import-parser';
import { generateProposalNumber, DEFAULT_TERMS } from '@/lib/proposal-types';

interface BulkProposalImportDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onImportComplete: () => void;
}

export function BulkProposalImportDialog({
  open,
  onOpenChange,
  onImportComplete,
}: BulkProposalImportDialogProps) {
  const [bulkData, setBulkData] = useState('');
  const [importing, setImporting] = useState(false);
  const [results, setResults] = useState<any>(null);
  const [defaultTitle, setDefaultTitle] = useState('Service Proposal');

  const handleImport = async () => {
    if (!bulkData.trim()) {
      toast.error('Please enter some data to import');
      return;
    }

    setImporting(true);
    setResults(null);

    try {
      // Parse the bulk data
      const parsedLeads = parseBulkLeadData(bulkData);

      if (parsedLeads.length === 0) {
        toast.error('No valid data found in the input');
        setImporting(false);
        return;
      }

      const createdProposals = [];
      const errors = [];

      // Create proposals for each parsed entry
      for (const parsedLead of parsedLeads) {
        try {
          const items = mapServicesToProposalItems(parsedLead.serviceKeywords);

          // Calculate totals
          const subtotal = items.reduce((sum, item) => sum + item.total, 0);
          const tax = 0;
          const discount = 0;
          const total = subtotal;

          const proposalData = {
            clientName: parsedLead.name,
            clientEmail: parsedLead.email || `noemail-${Date.now()}@placeholder.com`,
            clientPhone: parsedLead.phone,
            clientCompany: parsedLead.company,
            title: `${defaultTitle} - ${parsedLead.name}`,
            description: `Proposal for ${parsedLead.interest}`,
            items,
            tax,
            discount,
            terms: DEFAULT_TERMS,
            notes: `Auto-generated from bulk import. Raw data: ${parsedLead.rawText}`,
          };

          const res = await fetch('/api/proposals', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(proposalData),
          });

          if (res.ok) {
            const data = await res.json();
            createdProposals.push(data.proposal);
          } else {
            const errorData = await res.json();
            errors.push({
              client: parsedLead.name,
              error: errorData.error || 'Failed to create proposal',
            });
          }
        } catch (proposalError: any) {
          console.error('Error creating proposal:', proposalError);
          errors.push({
            client: parsedLead.name,
            error: proposalError.message || 'Failed to create proposal',
          });
        }
      }

      setResults({
        proposalsCreated: createdProposals.length,
        errors: errors.length > 0 ? errors : undefined,
      });

      toast.success(`Successfully created ${createdProposals.length} proposal(s)`);
      onImportComplete();
    } catch (error) {
      console.error('Import error:', error);
      toast.error('An error occurred during import');
    } finally {
      setImporting(false);
    }
  };

  const handleClose = () => {
    setBulkData('');
    setResults(null);
    onOpenChange(false);
  };

  return (
    <Dialog open={open} onOpenChange={handleClose}>
      <DialogContent className="max-w-3xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>Bulk Import Proposals</DialogTitle>
          <DialogDescription>
            Quickly create multiple proposals from client data. Each line should contain: Name, Company, Phone,
            Email, Service Needs
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4 mt-4">
          {/* Instructions */}
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h4 className="font-medium text-blue-900 mb-2">Format Example:</h4>
            <div className="text-sm text-blue-700 font-mono space-y-1">
              <div>John Smith - Acme Corp, 555-123-4567, john@acme.com - needs website and SEO</div>
              <div>Jane Doe, 555-987-6543, jane@example.com - interested in social media marketing</div>
            </div>
            <p className="text-sm text-blue-600 mt-3">
              <strong>Keywords:</strong> Include "website", "SEO", "social media", "ads", "marketing", "app"
              to automatically add services to proposals.
            </p>
          </div>

          {/* Default Title */}
          <div>
            <Label>Default Proposal Title Prefix</Label>
            <Input
              value={defaultTitle}
              onChange={(e) => setDefaultTitle(e.target.value)}
              placeholder="Service Proposal"
              className="mt-1"
            />
            <p className="text-xs text-gray-500 mt-1">
              Client name will be appended (e.g., "Service Proposal - John Smith")
            </p>
          </div>

          {/* Input Area */}
          <div>
            <Label>Client & Service Data</Label>
            <Textarea
              value={bulkData}
              onChange={(e) => setBulkData(e.target.value)}
              placeholder="Paste your client data here... (one per line)"
              rows={10}
              className="mt-1 font-mono text-sm"
            />
          </div>

          {/* Results */}
          {results && (
            <div className="border rounded-lg p-4 bg-gray-50">
              <h4 className="font-medium mb-3">Import Results</h4>
              <div className="space-y-2">
                <div className="flex items-center gap-2 text-green-700">
                  <CheckCircle2 className="h-4 w-4" />
                  <span className="text-sm">{results.proposalsCreated} proposals created</span>
                </div>
                {results.errors && results.errors.length > 0 && (
                  <div className="mt-3">
                    <div className="flex items-center gap-2 text-orange-700 mb-2">
                      <AlertCircle className="h-4 w-4" />
                      <span className="text-sm font-medium">{results.errors.length} issue(s) found</span>
                    </div>
                    <div className="space-y-1 ml-6">
                      {results.errors.map((err: any, idx: number) => (
                        <div key={idx} className="text-sm text-gray-600">
                          {err.client}: {err.error}
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Actions */}
          <div className="flex justify-end gap-2 pt-4 border-t">
            <Button variant="outline" onClick={handleClose}>
              Close
            </Button>
            <Button onClick={handleImport} disabled={importing || !bulkData.trim()}>
              <Upload className="h-4 w-4 mr-2" />
              {importing ? 'Creating...' : 'Create Proposals'}
            </Button>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}

// ==========================================
// File: components/proposals/client-selector.tsx
// ==========================================


'use client';

import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import {
  Command,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
  CommandList,
} from '@/components/ui/command';
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Check, ChevronsUpDown, Plus, User, Mail, Phone, Building } from 'lucide-react';
import { cn } from '@/lib/utils';
import { toast } from 'sonner';

interface Lead {
  id: string;
  name: string;
  email: string;
  phone?: string;
  company?: string;
}

interface ClientSelectorProps {
  selectedClient: Lead | null;
  onClientSelect: (client: Lead | null) => void;
}

export function ClientSelector({ selectedClient, onClientSelect }: ClientSelectorProps) {
  const [open, setOpen] = useState(false);
  const [leads, setLeads] = useState<Lead[]>([]);
  const [searchQuery, setSearchQuery] = useState('');
  const [showNewCustomerDialog, setShowNewCustomerDialog] = useState(false);
  const [loading, setLoading] = useState(false);

  // New customer form
  const [newCustomerName, setNewCustomerName] = useState('');
  const [newCustomerEmail, setNewCustomerEmail] = useState('');
  const [newCustomerPhone, setNewCustomerPhone] = useState('');
  const [newCustomerCompany, setNewCustomerCompany] = useState('');

  useEffect(() => {
    fetchLeads();
  }, []);

  const fetchLeads = async () => {
    try {
      const res = await fetch('/api/crm/leads');
      if (res.ok) {
        const data = await res.json();
        setLeads(data.leads || []);
      }
    } catch (error) {
      console.error('Error fetching leads:', error);
    }
  };

  const handleCreateCustomer = async () => {
    if (!newCustomerName || !newCustomerEmail) {
      toast.error('Name and email are required');
      return;
    }

    setLoading(true);

    try {
      const res = await fetch('/api/crm/leads', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: newCustomerName,
          email: newCustomerEmail,
          phone: newCustomerPhone,
          company: newCustomerCompany,
          source: 'proposal',
          status: 'new',
          priority: 'medium',
        }),
      });

      if (res.ok) {
        const data = await res.json();
        const newLead = data.lead;
        
        // Update leads list
        setLeads([...leads, newLead]);
        
        // Select the new lead
        onClientSelect(newLead);
        
        // Close dialogs
        setShowNewCustomerDialog(false);
        setOpen(false);
        
        // Reset form
        setNewCustomerName('');
        setNewCustomerEmail('');
        setNewCustomerPhone('');
        setNewCustomerCompany('');
        
        toast.success('Customer created and added to CRM!');
      } else {
        const error = await res.json();
        toast.error(error.error || 'Failed to create customer');
      }
    } catch (error) {
      console.error('Error creating customer:', error);
      toast.error('An error occurred while creating customer');
    } finally {
      setLoading(false);
    }
  };

  const filteredLeads = leads.filter((lead) => {
    const query = searchQuery.toLowerCase();
    return (
      lead.name?.toLowerCase().includes(query) ||
      lead.email?.toLowerCase().includes(query) ||
      lead.company?.toLowerCase().includes(query)
    );
  });

  return (
    <>
      <Popover open={open} onOpenChange={setOpen}>
        <PopoverTrigger asChild>
          <Button
            variant="outline"
            role="combobox"
            aria-expanded={open}
            className="w-full justify-between"
          >
            {selectedClient ? (
              <div className="flex items-center gap-2 truncate">
                <User className="h-4 w-4 text-gray-500" />
                <span className="truncate">{selectedClient.name}</span>
                {selectedClient.company && (
                  <span className="text-gray-500 text-sm truncate">- {selectedClient.company}</span>
                )}
              </div>
            ) : (
              <span className="text-gray-500">Select or add a customer...</span>
            )}
            <ChevronsUpDown className="ml-2 h-4 w-4 shrink-0 opacity-50" />
          </Button>
        </PopoverTrigger>
        <PopoverContent className="w-[400px] p-0" align="start">
          <Command>
            <CommandInput
              placeholder="Search customers..."
              value={searchQuery}
              onValueChange={setSearchQuery}
            />
            <CommandList>
              <CommandEmpty>
                <div className="text-center py-6">
                  <p className="text-sm text-gray-500 mb-3">No customers found</p>
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={() => {
                      setShowNewCustomerDialog(true);
                      setOpen(false);
                    }}
                  >
                    <Plus className="h-4 w-4 mr-2" />
                    Create New Customer
                  </Button>
                </div>
              </CommandEmpty>
              <CommandGroup>
                {filteredLeads.map((lead) => (
                  <CommandItem
                    key={lead.id}
                    value={lead.id}
                    onSelect={() => {
                      onClientSelect(lead.id === selectedClient?.id ? null : lead);
                      setOpen(false);
                    }}
                  >
                    <div className="flex items-center gap-2 flex-1">
                      <Check
                        className={cn(
                          'h-4 w-4',
                          selectedClient?.id === lead.id ? 'opacity-100' : 'opacity-0'
                        )}
                      />
                      <div className="flex flex-col flex-1 min-w-0">
                        <div className="flex items-center gap-2">
                          <User className="h-4 w-4 text-gray-400" />
                          <span className="font-medium truncate">{lead.name}</span>
                        </div>
                        <div className="flex items-center gap-2 text-xs text-gray-500">
                          <Mail className="h-3 w-3" />
                          <span className="truncate">{lead.email}</span>
                        </div>
                        {lead.company && (
                          <div className="flex items-center gap-2 text-xs text-gray-500">
                            <Building className="h-3 w-3" />
                            <span className="truncate">{lead.company}</span>
                          </div>
                        )}
                      </div>
                    </div>
                  </CommandItem>
                ))}
              </CommandGroup>
              <CommandGroup>
                <CommandItem
                  onSelect={() => {
                    setShowNewCustomerDialog(true);
                    setOpen(false);
                  }}
                  className="bg-blue-50 text-blue-600 hover:bg-blue-100 border-t"
                >
                  <Plus className="h-4 w-4 mr-2" />
                  <span className="font-medium">New Customer</span>
                </CommandItem>
              </CommandGroup>
            </CommandList>
          </Command>
        </PopoverContent>
      </Popover>

      {/* New Customer Dialog */}
      <Dialog open={showNewCustomerDialog} onOpenChange={setShowNewCustomerDialog}>
        <DialogContent className="sm:max-w-[500px]">
          <DialogHeader>
            <DialogTitle>Create New Customer</DialogTitle>
            <DialogDescription>
              Add a new customer to your CRM and use them in this proposal.
            </DialogDescription>
          </DialogHeader>
          <div className="grid gap-4 py-4">
            <div className="grid gap-2">
              <Label htmlFor="name">
                Customer Name <span className="text-red-500">*</span>
              </Label>
              <div className="relative">
                <User className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  id="name"
                  value={newCustomerName}
                  onChange={(e) => setNewCustomerName(e.target.value)}
                  placeholder="John Doe"
                  className="pl-9"
                  required
                />
              </div>
            </div>
            <div className="grid gap-2">
              <Label htmlFor="email">
                Email Address <span className="text-red-500">*</span>
              </Label>
              <div className="relative">
                <Mail className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  id="email"
                  type="email"
                  value={newCustomerEmail}
                  onChange={(e) => setNewCustomerEmail(e.target.value)}
                  placeholder="john@example.com"
                  className="pl-9"
                  required
                />
              </div>
            </div>
            <div className="grid gap-2">
              <Label htmlFor="phone">Phone Number</Label>
              <div className="relative">
                <Phone className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  id="phone"
                  value={newCustomerPhone}
                  onChange={(e) => setNewCustomerPhone(e.target.value)}
                  placeholder="+1 (555) 123-4567"
                  className="pl-9"
                />
              </div>
            </div>
            <div className="grid gap-2">
              <Label htmlFor="company">Company Name</Label>
              <div className="relative">
                <Building className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  id="company"
                  value={newCustomerCompany}
                  onChange={(e) => setNewCustomerCompany(e.target.value)}
                  placeholder="Acme Corporation"
                  className="pl-9"
                />
              </div>
            </div>
          </div>
          <DialogFooter>
            <Button
              type="button"
              variant="outline"
              onClick={() => setShowNewCustomerDialog(false)}
              disabled={loading}
            >
              Cancel
            </Button>
            <Button onClick={handleCreateCustomer} disabled={loading}>
              {loading ? (
                <>
                  <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2" />
                  Creating...
                </>
              ) : (
                <>
                  <Plus className="h-4 w-4 mr-2" />
                  Create Customer
                </>
              )}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </>
  );
}

// ==========================================
// File: components/providers.tsx
// ==========================================


"use client";

import { SessionProvider } from "next-auth/react";

export function Providers({ children }: { children: React.ReactNode }) {
  return <SessionProvider>{children}</SessionProvider>;
}

// ==========================================
// File: components/roi-calculator.tsx
// ==========================================


"use client";

import { motion, AnimatePresence } from "framer-motion";
import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Slider } from "@/components/ui/slider";
import { Calculator, TrendingUp, DollarSign, Users, ArrowRight } from "lucide-react";
import Link from "next/link";
import LoadingAnimation from "./loading-animation";

const ROICalculator = () => {
  const [monthlyVisitors, setMonthlyVisitors] = useState(5000);
  const [conversionRate, setConversionRate] = useState(2);
  const [averageOrderValue, setAverageOrderValue] = useState(150);
  const [showResults, setShowResults] = useState(false);
  const [isCalculating, setIsCalculating] = useState(false);

  // Conservative improvement estimates based on industry benchmarks
  const conversionImprovement = 1.5; // 50% improvement (conservative)
  const trafficImprovement = 1.3; // 30% improvement (conservative)

  // Current metrics
  const currentLeads = monthlyVisitors * (conversionRate / 100);
  const currentRevenue = currentLeads * averageOrderValue;

  // Projected metrics with CDM Suite
  const projectedVisitors = monthlyVisitors * trafficImprovement;
  const projectedConversionRate = conversionRate * conversionImprovement;
  const projectedLeads = projectedVisitors * (projectedConversionRate / 100);
  const projectedRevenue = projectedLeads * averageOrderValue;

  // Growth metrics
  const additionalLeads = projectedLeads - currentLeads;
  const additionalRevenue = projectedRevenue - currentRevenue;
  const yearlyAdditionalRevenue = additionalRevenue * 12;

  const handleCalculate = () => {
    setIsCalculating(true);
    // Simulate calculation time for better UX
    setTimeout(() => {
      setIsCalculating(false);
      setShowResults(true);
    }, 3000);
  };

  const formatCurrency = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  const formatNumber = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  return (
    <>
      <AnimatePresence>
        {isCalculating && (
          <LoadingAnimation 
            toolName="ROI Analysis"
            messages={[
              'üí∞ Calculating revenue potential...',
              'üìà Analyzing growth metrics...',
              'üéØ Forecasting conversions...',
              '‚ú® Preparing your custom report...'
            ]}
            duration={3000}
          />
        )}
      </AnimatePresence>
      
      <section className="py-16 md:py-24 bg-gradient-to-br from-primary via-charcoal to-charcoal relative overflow-hidden">
      {/* Decorative elements */}
      <div className="absolute inset-0 opacity-10">
        <div className="absolute top-0 right-0 w-96 h-96 bg-accent rounded-full filter blur-3xl"></div>
        <div className="absolute bottom-0 left-0 w-96 h-96 bg-secondary rounded-full filter blur-3xl"></div>
      </div>

      <div className="section-container relative z-10">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mb-8 md:mb-12 px-4"
        >
          <div className="inline-flex items-center gap-2 bg-accent/20 backdrop-blur-sm rounded-full px-4 md:px-6 py-2 mb-4 md:mb-6">
            <Calculator className="h-4 w-4 md:h-5 md:w-5 text-accent" />
            <span className="text-accent font-semibold text-sm md:text-base">Interactive ROI Calculator</span>
          </div>
          <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4 md:mb-6 leading-tight">
            See Your Potential ROI With CDM Suite
          </h2>
          <p className="text-base md:text-lg lg:text-xl text-gray-300 max-w-3xl mx-auto">
            Get a realistic estimate of how much additional revenue you could generate with 
            our digital marketing services. These projections are based on conservative industry benchmarks.
          </p>
        </motion.div>

        <div className="grid lg:grid-cols-2 gap-8 md:gap-12 items-start px-4">
          {/* Calculator Input */}
          <motion.div
            initial={{ opacity: 0, x: -30 }}
            whileInView={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="bg-white rounded-xl md:rounded-2xl p-6 md:p-8 shadow-2xl"
          >
            <h3 className="text-xl md:text-2xl font-bold text-gray-900 mb-4 md:mb-6">Your Current Metrics</h3>
            
            <div className="space-y-8">
              {/* Monthly Visitors */}
              <div>
                <Label htmlFor="visitors" className="text-gray-900 font-semibold mb-3 block">
                  Monthly Website Visitors
                </Label>
                <div className="flex items-center gap-4 mb-3">
                  <Slider
                    id="visitors"
                    min={100}
                    max={100000}
                    step={100}
                    value={[monthlyVisitors]}
                    onValueChange={(value) => setMonthlyVisitors(value[0])}
                    className="flex-1"
                  />
                  <Input
                    type="number"
                    value={monthlyVisitors}
                    onChange={(e) => setMonthlyVisitors(Number(e.target.value))}
                    className="w-32"
                  />
                </div>
                <p className="text-sm text-gray-500">
                  Not sure? Check your Google Analytics or estimate based on your industry.
                </p>
              </div>

              {/* Conversion Rate */}
              <div>
                <Label htmlFor="conversion" className="text-gray-900 font-semibold mb-3 block">
                  Current Conversion Rate (%)
                </Label>
                <div className="flex items-center gap-4 mb-3">
                  <Slider
                    id="conversion"
                    min={0.5}
                    max={10}
                    step={0.1}
                    value={[conversionRate]}
                    onValueChange={(value) => setConversionRate(value[0])}
                    className="flex-1"
                  />
                  <Input
                    type="number"
                    value={conversionRate}
                    onChange={(e) => setConversionRate(Number(e.target.value))}
                    className="w-32"
                    step="0.1"
                  />
                </div>
                <p className="text-sm text-gray-500">
                  Industry average is 2-3%. This is the % of visitors who become leads/customers.
                </p>
              </div>

              {/* Average Order Value */}
              <div>
                <Label htmlFor="aov" className="text-gray-900 font-semibold mb-3 block">
                  Average Customer Value ($)
                </Label>
                <div className="flex items-center gap-4 mb-3">
                  <Slider
                    id="aov"
                    min={50}
                    max={5000}
                    step={10}
                    value={[averageOrderValue]}
                    onValueChange={(value) => setAverageOrderValue(value[0])}
                    className="flex-1"
                  />
                  <Input
                    type="number"
                    value={averageOrderValue}
                    onChange={(e) => setAverageOrderValue(Number(e.target.value))}
                    className="w-32"
                  />
                </div>
                <p className="text-sm text-gray-500">
                  Average revenue per customer or average order value.
                </p>
              </div>

              <Button 
                onClick={handleCalculate}
                className="w-full bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold py-6 text-lg btn-breathe btn-glow"
              >
                Calculate My Potential ROI
                <Calculator className="ml-2 h-5 w-5" />
              </Button>
            </div>
          </motion.div>

          {/* Results */}
          <motion.div
            initial={{ opacity: 0, x: 30 }}
            whileInView={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className={`bg-gradient-to-br from-accent/10 to-secondary/10 backdrop-blur-sm rounded-2xl p-8 border-2 border-accent/20 ${
              showResults ? "block" : "hidden lg:block"
            }`}
          >
            <h3 className="text-2xl font-bold text-white mb-6">Your Projected Growth</h3>
            
            {showResults ? (
              <div className="space-y-6">
                {/* Current vs Projected */}
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4">
                    <p className="text-gray-300 text-sm mb-1">Current Monthly Revenue</p>
                    <p className="text-2xl font-bold text-white">{formatCurrency(currentRevenue)}</p>
                  </div>
                  <div className="bg-gradient-to-br from-accent to-secondary rounded-xl p-4 shadow-lg">
                    <p className="text-charcoal text-sm mb-1 font-medium">Projected Monthly Revenue</p>
                    <p className="text-2xl font-bold text-charcoal">{formatCurrency(projectedRevenue)}</p>
                  </div>
                </div>

                {/* Key Metrics */}
                <div className="space-y-4">
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <div className="flex items-center gap-3 mb-3">
                      <div className="bg-accent rounded-full p-2">
                        <DollarSign className="h-5 w-5 text-charcoal" />
                      </div>
                      <div>
                        <p className="text-gray-300 text-sm">Additional Monthly Revenue</p>
                        <p className="text-3xl font-bold text-white">{formatCurrency(additionalRevenue)}</p>
                      </div>
                    </div>
                    <p className="text-accent text-sm font-semibold">
                      That's {formatCurrency(yearlyAdditionalRevenue)} per year!
                    </p>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <div className="flex items-center gap-3 mb-2">
                      <div className="bg-secondary rounded-full p-2">
                        <Users className="h-5 w-5 text-charcoal" />
                      </div>
                      <div>
                        <p className="text-gray-300 text-sm">Additional Monthly Leads</p>
                        <p className="text-3xl font-bold text-white">{formatNumber(additionalLeads)}</p>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <div className="flex items-center gap-3 mb-2">
                      <div className="bg-accent rounded-full p-2">
                        <TrendingUp className="h-5 w-5 text-charcoal" />
                      </div>
                      <div>
                        <p className="text-gray-300 text-sm">Projected Revenue Growth</p>
                        <p className="text-3xl font-bold text-white">
                          {((projectedRevenue / currentRevenue - 1) * 100).toFixed(0)}%
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Disclaimer */}
                <div className="bg-white/5 backdrop-blur-sm rounded-xl p-4 border border-white/10">
                  <p className="text-gray-300 text-sm leading-relaxed">
                    <span className="font-semibold text-accent">Note:</span> These projections are based on 
                    conservative industry benchmarks (30% traffic increase, 50% conversion rate improvement). 
                    Actual results may vary based on your industry, current performance, and engagement level.
                  </p>
                </div>

                {/* CTA */}
                <Link href="/contact">
                  <Button className="w-full bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold py-6 text-lg shadow-xl btn-breathe btn-glow">
                    Let's Make This Happen
                    <ArrowRight className="ml-2 h-5 w-5" />
                  </Button>
                </Link>
              </div>
            ) : (
              <div className="flex items-center justify-center h-full min-h-[400px]">
                <div className="text-center">
                  <Calculator className="h-16 w-16 text-accent mx-auto mb-4 opacity-50" />
                  <p className="text-gray-300 text-lg">
                    Enter your metrics to see your potential ROI
                  </p>
                </div>
              </div>
            )}
          </motion.div>
        </div>

        {/* Additional Trust Elements */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="mt-16 text-center"
        >
          <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-8 max-w-4xl mx-auto">
            <h4 className="text-2xl font-bold text-white mb-4">Why Our Estimates Are Conservative</h4>
            <p className="text-gray-300 leading-relaxed mb-6">
              We've seen many clients exceed these projections significantly. Our calculator uses industry-standard 
              benchmarks and assumes you'll work with us consistently. Real results depend on your current situation, 
              industry, competition, and how actively we collaborate.
            </p>
            <div className="grid md:grid-cols-3 gap-4 text-center">
              <div>
                <p className="text-3xl font-bold text-accent mb-1">30%</p>
                <p className="text-gray-300 text-sm">Estimated Traffic Increase</p>
              </div>
              <div>
                <p className="text-3xl font-bold text-secondary mb-1">50%</p>
                <p className="text-gray-300 text-sm">Conversion Rate Improvement</p>
              </div>
              <div>
                <p className="text-3xl font-bold text-accent mb-1">6-12</p>
                <p className="text-gray-300 text-sm">Months to Full Results</p>
              </div>
            </div>
          </div>
        </motion.div>
      </div>
    </section>
    </>
  );
};

export default ROICalculator;

// ==========================================
// File: components/service-consultation-dialog.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Loader2, Send, CheckCircle, Calendar } from 'lucide-react';
import { useToast } from '@/hooks/use-toast';
import Script from 'next/script';

interface ServiceConsultationDialogProps {
  isOpen: boolean;
  onClose: () => void;
  serviceName: string;
  serviceId: string;
  tierName?: string;
}

export function ServiceConsultationDialog({ 
  isOpen, 
  onClose, 
  serviceName, 
  serviceId,
  tierName 
}: ServiceConsultationDialogProps) {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    phone: '',
    company: '',
    message: `I'm interested in learning more about ${serviceName}${tierName ? ` - ${tierName} tier` : ''}.`,
    formType: 'service-consultation',
    serviceId,
    serviceName,
    tierName: tierName || ''
  });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [isSubmitted, setIsSubmitted] = useState(false);
  const { toast } = useToast();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSubmitting(true);

    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData),
      });

      if (response.ok) {
        setIsSubmitted(true);
        toast({
          title: 'Consultation request sent!',
          description: "We'll contact you within 24 hours to schedule your consultation.",
        });
      } else {
        throw new Error('Failed to send request');
      }
    } catch (error) {
      console.error('Error:', error);
      toast({
        title: 'Error sending request',
        description: 'Please try again or contact us directly.',
        variant: 'destructive',
      });
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    setFormData(prev => ({
      ...prev,
      [e.target.name]: e.target.value
    }));
  };

  const resetAndClose = () => {
    setIsSubmitted(false);
    setFormData({
      name: '',
      email: '',
      phone: '',
      company: '',
      message: `I'm interested in learning more about ${serviceName}${tierName ? ` - ${tierName} tier` : ''}.`,
      formType: 'service-consultation',
      serviceId,
      serviceName,
      tierName: tierName || ''
    });
    onClose();
  };

  if (isSubmitted) {
    return (
      <Dialog open={isOpen} onOpenChange={resetAndClose}>
        <DialogContent className="max-w-md">
          <div className="text-center py-6">
            <CheckCircle className="h-16 w-16 text-green-600 mx-auto mb-4" />
            <h2 className="text-2xl font-bold text-gray-900 mb-3">
              Request Received!
            </h2>
            <p className="text-gray-600 mb-6">
              We'll review your consultation request and reach out within 24 hours to schedule 
              your personalized strategy session.
            </p>
            <Button onClick={resetAndClose} className="w-full">
              Close
            </Button>
          </div>
        </DialogContent>
      </Dialog>
    );
  }

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle className="text-2xl font-bold">
            Book a Consultation
          </DialogTitle>
          <DialogDescription className="text-base">
            Schedule a free consultation to discuss {serviceName}
            {tierName && ` (${tierName} tier)`}
          </DialogDescription>
        </DialogHeader>

        <div className="grid md:grid-cols-2 gap-6 mt-4">
          {/* Consultation Form */}
          <div>
            <form onSubmit={handleSubmit} className="space-y-4">
              <div>
                <Label htmlFor="name">Full Name *</Label>
                <Input
                  id="name"
                  name="name"
                  type="text"
                  value={formData.name}
                  onChange={handleChange}
                  required
                  className="mt-1"
                  placeholder="Your full name"
                />
              </div>

              <div>
                <Label htmlFor="email">Email Address *</Label>
                <Input
                  id="email"
                  name="email"
                  type="email"
                  value={formData.email}
                  onChange={handleChange}
                  required
                  className="mt-1"
                  placeholder="your@email.com"
                />
              </div>

              <div>
                <Label htmlFor="phone">Phone Number</Label>
                <Input
                  id="phone"
                  name="phone"
                  type="tel"
                  value={formData.phone}
                  onChange={handleChange}
                  className="mt-1"
                  placeholder="(555) 123-4567"
                />
              </div>

              <div>
                <Label htmlFor="company">Company Name</Label>
                <Input
                  id="company"
                  name="company"
                  type="text"
                  value={formData.company}
                  onChange={handleChange}
                  className="mt-1"
                  placeholder="Your company"
                />
              </div>

              <div>
                <Label htmlFor="message">Additional Details</Label>
                <Textarea
                  id="message"
                  name="message"
                  value={formData.message}
                  onChange={handleChange}
                  className="mt-1 min-h-[80px]"
                  placeholder="Tell us about your goals..."
                />
              </div>

              <Button
                type="submit"
                disabled={isSubmitting}
                className="w-full"
                size="lg"
              >
                {isSubmitting ? (
                  <>
                    <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                    Sending...
                  </>
                ) : (
                  <>
                    Request Consultation
                    <Send className="ml-2 h-4 w-4" />
                  </>
                )}
              </Button>
            </form>
          </div>

          {/* Calendly Widget */}
          <div className="bg-gradient-to-br from-blue-50 to-purple-50 p-6 rounded-lg">
            <div className="flex items-center gap-2 mb-3">
              <Calendar className="w-5 h-5 text-primary" />
              <h3 className="text-lg font-semibold">
                Or Book Instantly
              </h3>
            </div>
            <p className="text-sm text-gray-600 mb-4">
              Schedule a 30-minute strategy session right now:
            </p>
            <div 
              className="calendly-inline-widget" 
              data-url="https://calendly.com/cdm-creativemedia/digital-marketing-power-session?hide_event_type_details=1&hide_gdpr_banner=1" 
              style={{minWidth: '280px', height: '550px'}}
            ></div>
            <Script
              src="https://assets.calendly.com/assets/external/widget.js"
              strategy="lazyOnload"
            />
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}

// ==========================================
// File: components/service-cta-buttons.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { useSession } from 'next-auth/react';
import { Button } from '@/components/ui/button';
import { toast } from 'react-hot-toast';
import { ShoppingCart, Calendar, MessageSquare, Loader2 } from 'lucide-react';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';

interface ServiceCTAButtonsProps {
  serviceId?: string;
  price: number;
  serviceName: string;
  onScheduleClick?: () => void;
  variant?: 'inline' | 'stacked';
  className?: string;
}

export function ServiceCTAButtons({
  serviceId,
  price,
  serviceName,
  onScheduleClick,
  variant = 'inline',
  className = '',
}: ServiceCTAButtonsProps) {
  const [loading, setLoading] = useState(false);
  const [showOptions, setShowOptions] = useState(false);
  const { data: session, status } = useSession();
  const router = useRouter();

  const handleCheckout = async () => {
    setLoading(true);
    
    try {
      // Create checkout session for guest or logged-in user
      const response = await fetch('/api/create-checkout-session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ serviceId }),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'Failed to create checkout session');
      }

      // Redirect to Stripe Checkout
      window.location.href = data.url;
    } catch (error: any) {
      console.error('Checkout error:', error);
      toast.error(error.message || 'Failed to initiate checkout');
      setLoading(false);
    }
  };

  const handleGetStarted = () => {
    if (status === 'authenticated') {
      // User is logged in, show options
      setShowOptions(true);
    } else {
      // User not logged in, show options dialog
      setShowOptions(true);
    }
  };

  const handleContactSales = () => {
    router.push('/contact');
  };

  if (variant === 'inline') {
    return (
      <>
        <div className={`flex flex-col sm:flex-row gap-4 justify-center ${className}`}>
          <Button 
            onClick={handleGetStarted}
            disabled={loading}
            size="lg" 
            className="bg-primary hover:bg-primary/90 text-white font-bold py-6 px-8 rounded-full transition-transform duration-300 transform hover:scale-105"
          >
            {loading ? (
              <>
                <Loader2 className="w-5 h-5 mr-2 animate-spin" />
                Processing...
              </>
            ) : (
              <>
                <ShoppingCart className="w-5 h-5 mr-2" />
                Get Started Now
              </>
            )}
          </Button>
          {onScheduleClick && (
            <Button 
              onClick={onScheduleClick}
              size="lg" 
              variant="outline"
              className="border-primary text-primary hover:bg-primary hover:text-white font-bold py-6 px-8 rounded-full"
            >
              <Calendar className="w-5 h-5 mr-2" />
              Schedule a Call
            </Button>
          )}
        </div>

        <Dialog open={showOptions} onOpenChange={setShowOptions}>
          <DialogContent className="sm:max-w-md">
            <DialogHeader>
              <DialogTitle>How would you like to proceed?</DialogTitle>
              <DialogDescription>
                Choose the option that works best for you
              </DialogDescription>
            </DialogHeader>
            <div className="space-y-3 py-4">
              <Button
                onClick={() => {
                  setShowOptions(false);
                  handleCheckout();
                }}
                disabled={loading}
                className="w-full justify-start h-auto py-4 px-4 text-left"
                variant="outline"
              >
                <ShoppingCart className="w-5 h-5 mr-3 flex-shrink-0" />
                <div>
                  <div className="font-semibold">Purchase Now</div>
                  <div className="text-sm text-gray-500">Secure checkout ‚Ä¢ Get started immediately</div>
                </div>
              </Button>
              
              {onScheduleClick && (
                <Button
                  onClick={() => {
                    setShowOptions(false);
                    onScheduleClick();
                  }}
                  className="w-full justify-start h-auto py-4 px-4 text-left"
                  variant="outline"
                >
                  <Calendar className="w-5 h-5 mr-3 flex-shrink-0" />
                  <div>
                    <div className="font-semibold">Schedule a Free Consultation</div>
                    <div className="text-sm text-gray-500">Let's discuss your needs first</div>
                  </div>
                </Button>
              )}
              
              <Button
                onClick={() => {
                  setShowOptions(false);
                  handleContactSales();
                }}
                className="w-full justify-start h-auto py-4 px-4 text-left"
                variant="outline"
              >
                <MessageSquare className="w-5 h-5 mr-3 flex-shrink-0" />
                <div>
                  <div className="font-semibold">Contact Sales</div>
                  <div className="text-sm text-gray-500">Custom solutions or have questions?</div>
                </div>
              </Button>

              {status !== 'authenticated' && (
                <Button
                  onClick={() => {
                    router.push('/auth/login?redirect=' + encodeURIComponent(window.location.pathname));
                  }}
                  className="w-full justify-start h-auto py-4 px-4 text-left"
                  variant="ghost"
                >
                  <div className="text-sm text-gray-600">
                    Already have an account? <span className="text-primary font-semibold">Sign in</span>
                  </div>
                </Button>
              )}
            </div>
          </DialogContent>
        </Dialog>
      </>
    );
  }

  // Stacked variant for mobile or compact layouts
  return (
    <>
      <div className={`flex flex-col gap-3 ${className}`}>
        <Button 
          onClick={handleGetStarted}
          disabled={loading}
          className="w-full bg-primary hover:bg-primary/90"
        >
          {loading ? (
            <>
              <Loader2 className="w-4 h-4 mr-2 animate-spin" />
              Processing...
            </>
          ) : (
            <>
              <ShoppingCart className="w-4 h-4 mr-2" />
              Get Started
            </>
          )}
        </Button>
        
        {onScheduleClick && (
          <Button 
            onClick={onScheduleClick}
            variant="outline"
            className="w-full"
          >
            <Calendar className="w-4 h-4 mr-2" />
            Schedule Call
          </Button>
        )}
      </div>

      <Dialog open={showOptions} onOpenChange={setShowOptions}>
        <DialogContent className="sm:max-w-md">
          <DialogHeader>
            <DialogTitle>How would you like to proceed?</DialogTitle>
            <DialogDescription>
              Choose the option that works best for you
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-3 py-4">
            <Button
              onClick={() => {
                setShowOptions(false);
                handleCheckout();
              }}
              disabled={loading}
              className="w-full justify-start h-auto py-4 px-4 text-left"
              variant="outline"
            >
              <ShoppingCart className="w-5 h-5 mr-3 flex-shrink-0" />
              <div>
                <div className="font-semibold">Purchase Now</div>
                <div className="text-sm text-gray-500">Secure checkout ‚Ä¢ Get started immediately</div>
              </div>
            </Button>
            
            {onScheduleClick && (
              <Button
                onClick={() => {
                  setShowOptions(false);
                  onScheduleClick();
                }}
                className="w-full justify-start h-auto py-4 px-4 text-left"
                variant="outline"
              >
                <Calendar className="w-5 h-5 mr-3 flex-shrink-0" />
                <div>
                  <div className="font-semibold">Schedule a Free Consultation</div>
                  <div className="text-sm text-gray-500">Let's discuss your needs first</div>
                </div>
              </Button>
            )}
            
            <Button
              onClick={() => {
                setShowOptions(false);
                handleContactSales();
              }}
              className="w-full justify-start h-auto py-4 px-4 text-left"
              variant="outline"
            >
              <MessageSquare className="w-5 h-5 mr-3 flex-shrink-0" />
              <div>
                <div className="font-semibold">Contact Sales</div>
                <div className="text-sm text-gray-500">Custom solutions or have questions?</div>
              </div>
            </Button>

            {status !== 'authenticated' && (
              <Button
                onClick={() => {
                  router.push('/auth/login?redirect=' + encodeURIComponent(window.location.pathname));
                }}
                className="w-full justify-start h-auto py-4 px-4 text-left"
                variant="ghost"
              >
                <div className="text-sm text-gray-600">
                  Already have an account? <span className="text-primary font-semibold">Sign in</span>
                </div>
              </Button>
            )}
          </div>
        </DialogContent>
      </Dialog>
    </>
  );
}

// ==========================================
// File: components/service-modal.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Check, ExternalLink, Sparkles, ShoppingCart, Calendar, Loader2 } from 'lucide-react';
import Link from 'next/link';
import { ServiceConsultationDialog } from './service-consultation-dialog';
import { getTierById } from '@/lib/pricing-tiers';
import { useToast } from '@/hooks/use-toast';

interface ServiceModalProps {
  isOpen: boolean;
  onClose: () => void;
  service: {
    id: string;
    slug: string;
    name: string;
    description: string;
    priceRange?: string;
    features?: string[];
    popular?: boolean;
    category?: string;
  } | null;
  detailPageSlug?: string;
}

export function ServiceModal({ isOpen, onClose, service, detailPageSlug }: ServiceModalProps) {
  const [consultationOpen, setConsultationOpen] = useState(false);
  const [selectedTier, setSelectedTier] = useState<any>(null);
  const [isProcessingPayment, setIsProcessingPayment] = useState(false);
  const { toast } = useToast();

  if (!service) return null;

  const serviceName = service.name.replace(/^.*?\s-\s/, '');
  const topFeatures = service.features?.slice(0, 4) || [];

  // Get the specific tier for this service based on its slug
  const getSpecificTier = () => {
    const tier = getTierById(service.slug);
    return tier ? [tier] : []; // Return as array for consistency with existing code
  };

  const pricingTiers = getSpecificTier();

  const handlePayNow = async (tier?: any) => {
    setIsProcessingPayment(true);
    setSelectedTier(tier || null);

    try {
      // Use tier if available, otherwise use service defaults
      const payload = tier ? {
        serviceId: service.id,
        tierId: tier.id,
        tierName: tier.name,
        amount: tier.price
      } : {
        serviceId: service.id,
        tierId: service.slug,
        tierName: service.name,
        amount: parseFloat(service.priceRange?.replace(/[^0-9.-]+/g, '') || '0')
      };

      const response = await fetch('/api/create-checkout-session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'Failed to create checkout session');
      }

      if (!data.url) {
        throw new Error('No checkout URL returned');
      }

      // Redirect to Stripe Checkout
      window.location.href = data.url;
    } catch (error: any) {
      console.error('Checkout error:', error);
      toast({
        title: 'Payment Error',
        description: error.message || 'Failed to initiate checkout. Please try again.',
        variant: 'destructive',
      });
      setIsProcessingPayment(false);
      setSelectedTier(null);
    }
  };

  const handleBookConsultation = (tier?: any) => {
    setSelectedTier(tier || null);
    setConsultationOpen(true);
  };

  return (
    <>
      <Dialog open={isOpen} onOpenChange={onClose}>
        <DialogContent className="max-w-4xl max-h-[90vh] overflow-y-auto">
          <DialogHeader>
            <div className="flex items-start justify-between gap-4">
              <div className="flex-1">
                <DialogTitle className="text-2xl font-bold mb-2 flex items-center gap-2">
                  {serviceName}
                  {service.popular && (
                    <Badge className="bg-gradient-to-r from-blue-500 to-purple-600 text-white border-0">
                      <Sparkles className="w-3 h-3 mr-1" />
                      Popular
                    </Badge>
                  )}
                </DialogTitle>
              </div>
            </div>
            <DialogDescription className="text-base text-gray-600 leading-relaxed">
              {service.description}
            </DialogDescription>
          </DialogHeader>

          {topFeatures.length > 0 && (
            <div className="space-y-4 py-4">
              <h3 className="font-semibold text-lg">Key Features:</h3>
              <ul className="grid grid-cols-1 md:grid-cols-2 gap-3">
                {topFeatures.map((feature, index) => (
                  <li key={index} className="flex items-start gap-3">
                    <div className="mt-0.5 flex-shrink-0">
                      <div className="w-5 h-5 rounded-full bg-green-100 flex items-center justify-center">
                        <Check className="w-3 h-3 text-green-600" />
                      </div>
                    </div>
                    <span className="text-gray-700 leading-relaxed text-sm">{feature}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}

          {/* Pricing for Selected Tier */}
          {pricingTiers.length > 0 && (
            <div className="space-y-4 py-4 border-t">
              <h3 className="font-semibold text-lg">Pricing & Details:</h3>
              <div className="grid grid-cols-1 gap-4">
                {pricingTiers.map((tier: any) => (
                  <div
                    key={tier.id}
                    className="relative p-6 border-2 rounded-lg border-primary bg-gradient-to-br from-primary/5 to-primary/10"
                  >
                    {tier.popular && (
                      <Badge className="absolute -top-2 -right-2 bg-primary">
                        <Sparkles className="w-3 h-3 mr-1" />
                        Most Popular
                      </Badge>
                    )}
                    
                    <div className="mb-4">
                      <h4 className="font-semibold text-xl mb-3">{tier.name} Plan</h4>
                      <div className="flex items-baseline gap-2 mb-2">
                        <span className="text-4xl font-bold text-primary">
                          ${tier.price}
                        </span>
                        <span className="text-lg text-gray-500">/month</span>
                      </div>
                      <p className="text-sm text-gray-600 mt-2">{tier.description}</p>
                    </div>

                    <div className="space-y-3 mb-6">
                      <h5 className="font-semibold text-sm text-gray-700 uppercase tracking-wide">
                        What's Included:
                      </h5>
                      {tier.features.map((feature: string, idx: number) => (
                        <div key={idx} className="flex items-start gap-3">
                          <div className="mt-0.5 flex-shrink-0">
                            <div className="w-5 h-5 rounded-full bg-green-100 flex items-center justify-center">
                              <Check className="w-3 h-3 text-green-600" />
                            </div>
                          </div>
                          <span className="text-gray-700 text-sm">{feature}</span>
                        </div>
                      ))}
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <Button
                        onClick={() => handlePayNow(tier)}
                        disabled={isProcessingPayment}
                        className="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"
                        size="lg"
                      >
                        {isProcessingPayment && selectedTier?.id === tier.id ? (
                          <>
                            <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                            Processing...
                          </>
                        ) : (
                          <>
                            <ShoppingCart className="w-4 h-4 mr-2" />
                            Pay Now - ${tier.price}/mo
                          </>
                        )}
                      </Button>
                      <Button
                        onClick={() => handleBookConsultation(tier)}
                        variant="outline"
                        className="w-full border-2"
                        size="lg"
                      >
                        <Calendar className="w-4 h-4 mr-2" />
                        Book Free Consultation
                      </Button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* If no tiers, show generic options */}
          {pricingTiers.length === 0 && (
            <div className="space-y-4 pt-4 border-t">
              {service.priceRange && (
                <div className="p-6 bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg border-2 border-primary/20">
                  <p className="text-sm text-gray-600 mb-2">Starting Price:</p>
                  <p className="text-3xl font-bold text-primary mb-4">{service.priceRange}</p>
                  <p className="text-sm text-gray-600 mb-6">{service.description}</p>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <Button
                      onClick={() => handlePayNow()}
                      disabled={isProcessingPayment}
                      className="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"
                      size="lg"
                    >
                      {isProcessingPayment ? (
                        <>
                          <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                          Processing...
                        </>
                      ) : (
                        <>
                          <ShoppingCart className="w-4 h-4 mr-2" />
                          Purchase Now
                        </>
                      )}
                    </Button>
                    <Button
                      onClick={() => handleBookConsultation()}
                      variant="outline"
                      className="w-full border-2"
                      size="lg"
                    >
                      <Calendar className="mr-2 w-4 h-4" />
                      Book Consultation
                    </Button>
                  </div>
                </div>
              )}
              {!service.priceRange && (
                <div className="flex flex-col gap-3">
                  <Button
                    onClick={() => handleBookConsultation()}
                    className="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"
                    size="lg"
                  >
                    <Calendar className="mr-2 w-4 h-4" />
                    Get Custom Quote
                  </Button>
                  <Link href={`/services/${service.slug}`} className="w-full">
                    <Button variant="outline" className="w-full" size="lg">
                      View Full Details
                      <ExternalLink className="ml-2 w-4 h-4" />
                    </Button>
                  </Link>
                </div>
              )}
            </div>
          )}

          <DialogFooter className="flex-col sm:flex-row gap-3 pt-4 border-t">
            <p className="text-sm text-gray-500 text-center w-full">
              üí° Not sure which plan is right? Book a free consultation and we'll help you choose!
            </p>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      <ServiceConsultationDialog
        isOpen={consultationOpen}
        onClose={() => {
          setConsultationOpen(false);
          setSelectedTier(null);
        }}
        serviceName={serviceName}
        serviceId={service.id}
        tierName={selectedTier?.name}
      />
    </>
  );
}

// ==========================================
// File: components/service-page-client.tsx
// ==========================================

"use client";

import { useState, useMemo } from "react";
import Navigation from "@/components/navigation";
import Footer from "@/components/footer";
import CalendlyScheduler from "@/components/calendly-scheduler";
import { CheckoutButton } from "@/components/checkout-button";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { CheckCircle, TrendingUp, Target, BarChart3, Zap, Shield, Clock, Users, AlertCircle, Star, Award, ArrowRight, Gift } from "lucide-react";
import Image from "next/image";
import { 
  WEB_DEVELOPMENT_TIERS, 
  WEBSITE_MAINTENANCE_TIERS,
  APP_CREATION_TIERS,
  APP_MAINTENANCE_TIERS,
  SEO_TIERS,
  SOCIAL_MEDIA_TIERS,
  AD_MANAGEMENT_TIERS
} from "@/lib/pricing-tiers";

interface Service {
  id: string;
  slug: string;
  name: string;
  description: string;
  price: number;
  features: string[];
  popular: boolean;
}

interface ServicePageClientProps {
  service: Service;
  heroImage: string;
  category: string;
}

const categoryContent = {
  'website-maintenance': {
    tagline: 'üõ°Ô∏è Reliable Website Care',
    title: 'Keep Your Website Running Smoothly',
    subtitle: "Focus on your business while we handle the technical stuff. From security updates to performance optimization, we have got your website covered 24/7.",
    problems: [
      "Your website is slow and losing visitors before they even see your content",
      "You're constantly worried about security threats and hackers",
      "Plugin updates break your site and you don't know how to fix it",
      "You're too busy running your business to deal with technical issues",
    ],
    whyUsTitle: 'Your Website Deserves Expert Care',
    whyUsDescription: "Think of us as your website personal IT team. We monitor, update, and optimize so you never have to worry about downtime, security threats, or outdated software.",
    benefits: [
      { icon: Shield, title: 'Proactive Security', description: 'We monitor and protect your site from threats before they become problems.' },
      { icon: Clock, title: '24/7 Monitoring', description: 'Round-the-clock uptime monitoring ensures your site is always accessible.' },
      { icon: TrendingUp, title: 'Performance Optimization', description: 'Regular speed checks and optimizations keep your site fast and user-friendly.' },
      { icon: Users, title: 'Priority Support', description: 'Get help when you need it with our dedicated support team.' },
    ],
    testimonial: {
      quote: "Since CDM Suite took over our website maintenance, we haven't had a single issue. Our site is faster, more secure, and we can finally focus on growing our business.",
      author: "Sarah Johnson",
      role: "CEO, Local Boutique",
      rating: 5,
    },
  },
  'website-creation': {
    tagline: 'üöÄ Launch Your Digital Presence',
    title: 'Beautiful Websites That Convert',
    subtitle: "Your website is often the first impression customers have of your business. Let us make it count with a stunning, high-performing site that turns visitors into customers.",
    problems: [
      "Your current website looks outdated and unprofessional, scaring away potential customers",
      "Visitors leave within seconds because your site is slow or confusing",
      "You're losing sales to competitors with better-looking, modern websites",
      "Your website doesn't work well on mobile devices, costing you half your traffic",
    ],
    whyUsTitle: 'More Than Just Pretty Pixels',
    whyUsDescription: "We do not just build websites; we craft digital experiences that align with your brand and business goals. Every element is designed with your target audience and conversion goals in mind.",
    benefits: [
      { icon: Target, title: 'Conversion-Focused Design', description: 'Every element is strategically placed to guide visitors toward taking action.' },
      { icon: TrendingUp, title: 'SEO-Ready Structure', description: 'Built from the ground up with search engines in mind for better visibility.' },
      { icon: Zap, title: 'Lightning-Fast Performance', description: 'Optimized code and hosting ensure your site loads in seconds, not minutes.' },
      { icon: Shield, title: 'Secure & Scalable', description: 'Enterprise-grade security and infrastructure that grows with your business.' },
    ],
    testimonial: {
      quote: "CDM Suite built us a website that's not just beautiful‚Äîit actually brings in customers. Our conversion rate tripled within the first two months!",
      author: "Michael Chen",
      role: "Founder, TechStart Inc",
      rating: 5,
    },
  },
  'seo': {
    tagline: 'üìà Dominate Search Results',
    title: 'Get Found By Customers Searching For You',
    subtitle: "What is the point of a great website if nobody can find it? We help you climb the search rankings and attract qualified leads who are actively looking for what you offer.",
    problems: [
      "Your competitors are stealing customers because they rank higher on Google",
      "You're getting traffic, but it's the wrong people who never convert",
      "You've tried SEO before and got burned by shady 'guaranteed ranking' promises",
      "Your website is invisible in search results, leaving money on the table every single day",
    ],
    whyUsTitle: 'SEO That Actually Works',
    whyUsDescription: "Forget black-hat tricks and empty promises. We use proven, white-hat strategies that deliver sustainable, long-term growth in organic traffic and rankings.",
    benefits: [
      { icon: Target, title: 'Keyword Strategy', description: 'Target the right terms that your ideal customers are actually searching for.' },
      { icon: TrendingUp, title: 'Content Optimization', description: 'Create and optimize content that ranks well and converts visitors.' },
      { icon: BarChart3, title: 'Technical SEO', description: 'Fix the behind-the-scenes issues that hold your site back in search results.' },
      { icon: CheckCircle, title: 'Link Building', description: 'Earn high-quality backlinks that boost your authority and rankings.' },
    ],
    testimonial: {
      quote: "In 6 months, CDM Suite took us from page 3 to the top 3 results for our main keywords. Our organic leads have increased 400%!",
      author: "Jennifer Martinez",
      role: "Marketing Director, EcoHome Solutions",
      rating: 5,
    },
  },
  'social-media': {
    tagline: 'üí¨ Build Your Social Empire',
    title: 'Turn Followers Into Customers',
    subtitle: "Social media is not just about likes and shares, it is about building relationships and driving real business results. Let us create content that connects and converts.",
    problems: [
      "You're posting regularly but nobody's engaging with your content",
      "Your followers aren't turning into paying customers",
      "You're wasting hours creating content that falls flat",
      "Your competitors have thriving social communities while yours feels like a ghost town",
    ],
    whyUsTitle: 'Strategic Social Media That Sells',
    whyUsDescription: "We go beyond posting pretty pictures. Our data-driven approach ensures every post, story, and campaign is aligned with your business goals and designed to engage your target audience.",
    benefits: [
      { icon: Target, title: 'Content Strategy', description: 'Tailored content calendars that resonate with your audience and drive engagement.' },
      { icon: Users, title: 'Community Management', description: 'Build relationships and loyalty through genuine engagement and timely responses.' },
      { icon: BarChart3, title: 'Analytics & Insights', description: 'Track what works and optimize your strategy based on real data.' },
      { icon: TrendingUp, title: 'Paid Social Campaigns', description: 'Amplify your reach with targeted ads that deliver measurable ROI.' },
    ],
    testimonial: {
      quote: "Our social media was dead before CDM Suite. Now we're getting daily leads and our engagement is through the roof!",
      author: "David Thompson",
      role: "Owner, Fitness First Gym",
      rating: 5,
    },
  },
  'ad-management': {
    tagline: 'üí∞ Results-Driven Advertising',
    title: 'Turn Ad Spend Into Revenue',
    subtitle: "Stop wasting money on ads that don't work. We create, manage, and optimize campaigns that deliver real, measurable returns on your investment.",
    problems: [
      "You're burning through thousands in ad spend with little to show for it",
      "Your ads get clicks but nobody's actually buying",
      "You have no idea which ads are working and which are wasting money",
      "Managing multiple ad platforms is eating up all your time",
    ],
    whyUsTitle: 'More Than an Agency, We are Your Growth Team',
    whyUsDescription: "We do not just run ads, we become an extension of your team, obsessed with one goal: maximizing your return on ad spend through constant testing and optimization.",
    benefits: [
      { icon: Target, title: 'Multi-Platform Expertise', description: 'From Google to Meta to TikTok, we speak every platform language fluently.' },
      { icon: TrendingUp, title: 'ROAS-Focused', description: 'We optimize for revenue, not vanity metrics like clicks and impressions.' },
      { icon: BarChart3, title: 'Transparent Reporting', description: 'See exactly where your money goes and what results it generates.' },
      { icon: Zap, title: 'Continuous Optimization', description: 'Daily monitoring and tweaking to squeeze every dollar of value from your budget.' },
    ],
    testimonial: {
      quote: "We were getting a 2x ROAS before CDM Suite. Now we're consistently hitting 5-6x. They've literally transformed our business.",
      author: "Amanda Rodriguez",
      role: "CEO, Bella Fashion Boutique",
      rating: 5,
    },
  },
  'app-creation': {
    tagline: 'üì± Bring Your App Idea to Life',
    title: 'Custom Mobile Apps That Users Love',
    subtitle: "Transform your vision into a powerful mobile app that delights users and drives business growth. From concept to launch, we are with you every step of the way.",
    problems: [
      "Your app idea is stuck in your head because you don't know where to start",
      "You've been burned by developers who overpromised and underdelivered",
      "You're worried about building something users won't actually use",
      "Your competitors have apps while you're still stuck with just a website",
    ],
    whyUsTitle: 'Apps Built for Success',
    whyUsDescription: "We combine technical excellence with user-centered design to create apps that people actually want to use. Whether iOS, Android, or both, we deliver polished products that exceed expectations.",
    benefits: [
      { icon: Users, title: 'User-Centric Design', description: 'Beautiful, intuitive interfaces that users love and understand instantly.' },
      { icon: Zap, title: 'Native Performance', description: 'Fast, responsive apps that take full advantage of each platform capabilities.' },
      { icon: Shield, title: 'Secure & Reliable', description: 'Enterprise-grade security and infrastructure for peace of mind.' },
      { icon: TrendingUp, title: 'Scalable Architecture', description: 'Built to grow with your user base without breaking a sweat.' },
    ],
    testimonial: {
      quote: "From concept to launch in 4 months. CDM Suite built us an app that our customers love and keeps them coming back. Worth every penny!",
      author: "Robert Kim",
      role: "Founder, FitLife Pro",
      rating: 5,
    },
  },
  'app-maintenance': {
    tagline: 'üîß Keep Your App Running Perfectly',
    title: 'App Maintenance You Can Count On',
    subtitle: "Your app is live, great! Now let us keep it that way. We handle updates, bug fixes, and optimizations so your users always have the best experience.",
    problems: [
      "Your app crashes and users are leaving 1-star reviews",
      "You're losing users because your app doesn't work with the latest OS updates",
      "Bug fixes take forever and your users are getting frustrated",
      "Your app feels outdated compared to competitors",
    ],
    whyUsTitle: 'Peace of Mind for Your Mobile App',
    whyUsDescription: "Apps need constant care to stay compatible with new OS versions, fix bugs, and meet user expectations. We provide the ongoing support that keeps your app healthy and your users happy.",
    benefits: [
      { icon: Shield, title: 'OS Compatibility', description: 'Stay current with the latest iOS and Android updates without disruption.' },
      { icon: Clock, title: 'Quick Bug Fixes', description: 'Rapid response to issues that affect user experience and ratings.' },
      { icon: TrendingUp, title: 'Performance Monitoring', description: 'Proactive tracking to catch and fix problems before users notice them.' },
      { icon: Zap, title: 'Feature Enhancements', description: 'Regular improvements to keep your app competitive and engaging.' },
    ],
    testimonial: {
      quote: "Our app rating went from 3.2 to 4.8 stars after CDM Suite took over maintenance. They're incredibly responsive and proactive!",
      author: "Lisa Anderson",
      role: "Product Manager, ShopLocal App",
      rating: 5,
    },
  },
  'bundle': {
    tagline: 'üéÅ Complete Digital Solutions',
    title: 'Everything You Need to Succeed Online',
    subtitle: "Why piece together multiple vendors when you can get everything in one package? Our bundles combine our most powerful services for maximum impact at a better value.",
    problems: [
      "You're juggling multiple agencies and nothing works together",
      "Your marketing budget is stretched thin across different vendors",
      "You're spending more time managing vendors than growing your business",
      "Your digital presence feels disconnected and unprofessional",
    ],
    whyUsTitle: 'The Complete Package',
    whyUsDescription: "Bundles are not just about saving money, they are about synergy. When we handle your website, SEO, ads, and social media together, each piece works better and you get faster results.",
    benefits: [
      { icon: Target, title: 'Integrated Strategy', description: 'All your digital marketing working together toward common goals.' },
      { icon: TrendingUp, title: 'Better ROI', description: 'Save money while getting better results from coordinated campaigns.' },
      { icon: Users, title: 'Single Point of Contact', description: 'One team handling everything means better communication and faster execution.' },
      { icon: CheckCircle, title: 'Faster Results', description: 'Coordinated efforts across channels accelerate your growth timeline.' },
    ],
    testimonial: {
      quote: "Switching to CDM Suite's bundle package was the best decision we made. Everything works together now and we're growing faster than ever!",
      author: "Marcus Williams",
      role: "CEO, Urban Eats",
      rating: 5,
    },
  },
  'general': {
    tagline: 'üéØ Professional Digital Services',
    title: 'Elevate Your Digital Presence',
    subtitle: "Let us work together to take your digital presence to the next level with expert strategy and execution.",
    problems: [
      "Your digital marketing feels scattered and ineffective",
      "You're not sure where to invest your marketing budget",
      "You're overwhelmed by all the options and don't know where to start",
      "Your competitors are growing while you're stuck in place",
    ],
    whyUsTitle: 'Why Choose CDM Suite',
    whyUsDescription: "We combine technical expertise with strategic thinking to deliver solutions that drive real business results.",
    benefits: [
      { icon: Target, title: 'Strategic Approach', description: 'Data-driven strategies tailored to your unique goals and audience.' },
      { icon: TrendingUp, title: 'Proven Results', description: 'Track record of delivering measurable growth for our clients.' },
      { icon: Users, title: 'Dedicated Support', description: 'Responsive team that treats your success as our own.' },
      { icon: Shield, title: 'Quality Guarantee', description: 'We stand behind our work with ongoing support and optimization.' },
    ],
    testimonial: {
      quote: "CDM Suite doesn't just execute‚Äîthey think strategically about our business and help us make smart decisions. True partners!",
      author: "Emily Parker",
      role: "Director of Marketing, TechVision",
      rating: 5,
    },
  },
};

export default function ServicePageClient({ service, heroImage, category }: ServicePageClientProps) {
  const [showScheduler, setShowScheduler] = useState(false);
  const content = useMemo(() => 
    categoryContent[category as keyof typeof categoryContent] || categoryContent.general,
    [category]
  );

  const handleScheduleClick = () => {
    setShowScheduler(true);
    setTimeout(() => {
      document.getElementById('ctaSection')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  };

  // Get all tiers for the service category - memoized for performance
  const allTiers = useMemo(() => {
    switch (category) {
      case 'website-creation':
        return WEB_DEVELOPMENT_TIERS;
      case 'website-maintenance':
        return WEBSITE_MAINTENANCE_TIERS;
      case 'app-creation':
        return APP_CREATION_TIERS;
      case 'app-maintenance':
        return APP_MAINTENANCE_TIERS;
      case 'seo':
        return SEO_TIERS;
      case 'social-media':
        return SOCIAL_MEDIA_TIERS;
      case 'ad-management':
        return AD_MANAGEMENT_TIERS;
      default:
        return [];
    }
  }, [category]);

  return (
    <>
      <Navigation />
      
      {/* Hero Section with Header Image - Optimized & Compact */}
      <div className="relative bg-gray-900 overflow-hidden">
        <div className="absolute inset-0">
          <div className="relative w-full h-full">
            <Image
              src={heroImage}
              alt={`${service.name} service`}
              fill
              className="object-cover object-center"
              priority
              sizes="100vw"
              quality={75}
            />
            <div className="absolute inset-0 bg-gradient-to-b from-gray-900/70 via-gray-900/60 to-gray-900/80"></div>
          </div>
        </div>
        
        <div className="relative container mx-auto px-4 py-16 md:py-20 z-10">
          <header className="text-center max-w-3xl mx-auto">
            <div className="inline-block bg-primary/20 backdrop-blur-sm border border-primary/30 rounded-full px-3 py-1.5 mb-4">
              <span className="text-primary font-semibold text-sm">{content.tagline}</span>
            </div>
            <h1 className="text-3xl md:text-4xl font-extrabold text-white mb-3 tracking-tight">
              {content.title}
            </h1>
            <p className="text-base md:text-lg text-gray-200 mb-6 leading-relaxed">
              {content.subtitle}
            </p>
            <div className="flex flex-col sm:flex-row gap-3 justify-center">
              <CheckoutButton 
                serviceId={service.id}
                className="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-full transition-transform duration-300 transform hover:scale-105"
              />
              <Button 
                onClick={handleScheduleClick}
                size="lg" 
                variant="outline"
                className="bg-white/10 backdrop-blur-sm border-white/30 text-white hover:bg-white hover:text-gray-900 font-bold py-3 px-6 rounded-full"
              >
                Schedule a Call
              </Button>
            </div>
          </header>
        </div>
      </div>

      {/* Main Content - Compact & Optimized */}
      <div className="bg-gray-50">
        <div className="container mx-auto px-4 pb-8 md:pb-12">
          
          {/* Featured Service Card - Compact */}
          <section className="relative z-10 -mt-16 max-w-4xl mx-auto mb-8 md:mb-12 bg-white p-6 md:p-8 rounded-2xl shadow-xl">
            <div className="text-center mb-6">
              <h2 className="text-2xl md:text-3xl font-bold text-gray-900 mb-2">{service.name}</h2>
              <div className="w-16 h-1 bg-primary mx-auto rounded-full mb-4"></div>
              <p className="text-gray-600 text-base">{service.description}</p>
            </div>

            {/* Price Display - Compact */}
            <div className="text-center mb-6 p-4 bg-gradient-to-r from-primary/10 to-primary/5 rounded-xl">
              <div className="text-3xl md:text-4xl font-bold text-gray-900">
                ${service.price.toLocaleString()}
                {service.slug.includes('maintenance') || service.slug.includes('social-media') || service.slug.includes('ad-management') || service.slug.includes('seo') ? (
                  <span className="text-base text-gray-600 font-normal">/month</span>
                ) : (
                  <span className="text-base text-gray-600 font-normal"> starting</span>
                )}
              </div>
              {service.popular && (
                <div className="mt-2 inline-block bg-primary text-white text-xs font-semibold px-3 py-1 rounded-full">
                  Most Popular
                </div>
              )}
            </div>

            {/* Features List - Compact */}
            <div className="mb-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-3 text-center">What's Included</h3>
              <ul className="space-y-2">
                {service.features.map((feature, index) => (
                  <li key={index} className="flex items-start gap-2">
                    <CheckCircle className="h-4 w-4 text-primary flex-shrink-0 mt-0.5" />
                    <span className="text-gray-700 text-sm">{feature}</span>
                  </li>
                ))}
              </ul>
            </div>

            {/* CTA Button - Compact */}
            <div className="text-center">
              <CheckoutButton 
                serviceId={service.id}
                className="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-full transition-transform duration-300 transform hover:scale-105 w-full sm:w-auto"
              />
              <p className="mt-3 text-xs text-gray-500">
                üîí Secure payment processing ‚Ä¢ üíØ Satisfaction guaranteed
              </p>
            </div>
          </section>

          {/* Problem Agitation Section - Russell Brunson Method */}
          {content.problems && content.problems.length > 0 && (
            <section className="max-w-4xl mx-auto mb-8 md:mb-12 bg-gradient-to-br from-red-50 to-orange-50 border-l-4 border-red-500 p-6 md:p-8 rounded-r-xl">
              <div className="flex items-start gap-4 mb-4">
                <div className="flex-shrink-0">
                  <div className="w-12 h-12 bg-red-500/10 rounded-full flex items-center justify-center">
                    <AlertCircle className="h-6 w-6 text-red-600" />
                  </div>
                </div>
                <div>
                  <h2 className="text-2xl font-bold text-gray-900 mb-3">
                    Sound Familiar?
                  </h2>
                  <p className="text-gray-700 mb-4">
                    Many business owners struggle with these exact same challenges:
                  </p>
                </div>
              </div>
              <ul className="space-y-3">
                {content.problems.map((problem, index) => (
                  <li key={index} className="flex items-start gap-3">
                    <span className="flex-shrink-0 w-6 h-6 rounded-full bg-red-500 text-white flex items-center justify-center text-sm font-bold">
                      ‚úó
                    </span>
                    <span className="text-gray-800 font-medium">{problem}</span>
                  </li>
                ))}
              </ul>
              <div className="mt-6 p-4 bg-white rounded-lg border-2 border-primary">
                <p className="text-gray-900 font-semibold text-center">
                  <span className="text-primary">Good news:</span> There's a better way. Let us show you how. üëá
                </p>
              </div>
            </section>
          )}

          {/* All Pricing Tiers Section - Compact & Optimized */}
          {allTiers.length > 0 && (
            <section id="pricing" className="mb-10 md:mb-14">
              <div className="text-center mb-8">
                <h2 className="text-2xl md:text-3xl font-bold text-gray-900 mb-3">
                  {category === 'website-creation' && 'Website Design Packages'}
                  {category === 'website-maintenance' && 'Website Maintenance Plans'}
                  {category === 'app-creation' && 'App Development Packages'}
                  {category === 'app-maintenance' && 'App Maintenance Plans'}
                  {category === 'seo' && 'SEO Service Plans'}
                  {category === 'social-media' && 'Social Media Management Packages'}
                  {category === 'ad-management' && 'Ad Management Plans'}
                  {!['website-creation', 'website-maintenance', 'app-creation', 'app-maintenance', 'seo', 'social-media', 'ad-management'].includes(category) && 'Our Pricing Options'}
                </h2>
                <p className="text-base text-gray-600 max-w-2xl mx-auto">
                  Choose the package that best fits your needs
                </p>
              </div>
              
              <div className={`grid gap-4 max-w-6xl mx-auto ${allTiers.length === 3 ? 'md:grid-cols-3' : allTiers.length === 4 ? 'md:grid-cols-2 lg:grid-cols-4' : 'md:grid-cols-2'}`}>
                {allTiers.map((tier) => (
                  <div
                    key={tier.id}
                    className={`bg-white rounded-xl shadow-lg p-4 ${
                      tier.popular ? 'ring-2 ring-primary' : ''
                    }`}
                  >
                    {tier.popular && (
                      <div className="bg-primary text-white text-xs font-semibold px-2 py-0.5 rounded-full inline-block mb-3">
                        Most Popular
                      </div>
                    )}
                    <h3 className="text-lg font-bold text-gray-900 mb-2">
                      {tier.name}
                    </h3>
                    <p className="text-gray-600 mb-4 text-xs min-h-[36px]">
                      {tier.description}
                    </p>
                    <div className="mb-4">
                      <div className="flex items-baseline gap-1">
                        <span className="text-2xl font-bold text-gray-900">
                          ${tier.price.toLocaleString()}
                        </span>
                        <span className="text-xs text-gray-500">
                          {category.includes('maintenance') || category === 'seo' || category === 'social-media' || category === 'ad-management' ? '/month' : 'starting'}
                        </span>
                      </div>
                    </div>
                    <ul className="space-y-1.5 mb-4 max-h-48 overflow-y-auto pr-2 scrollbar-thin">
                      {tier.features.map((feature, idx) => (
                        <li key={idx} className="flex items-start gap-1.5">
                          <CheckCircle className="text-primary flex-shrink-0 mt-0.5 h-3.5 w-3.5" />
                          <span className="text-gray-700 text-xs leading-tight">
                            {feature}
                          </span>
                        </li>
                      ))}
                    </ul>
                    <Button
                      onClick={handleScheduleClick}
                      size="sm"
                      className={`w-full ${tier.popular ? 'bg-primary hover:bg-primary/90' : 'bg-gray-900 hover:bg-gray-800'} text-white text-xs py-2`}
                    >
                      Get Started
                    </Button>
                  </div>
                ))}
              </div>
            </section>
          )}

          {/* Why Choose Us Section - Compact */}
          <section className="max-w-4xl mx-auto mb-8 md:mb-12">
            <div className="text-center mb-8">
              <h2 className="text-2xl md:text-3xl font-bold text-gray-900 mb-3">
                {content.whyUsTitle}
              </h2>
              <p className="text-base text-gray-600 max-w-2xl mx-auto">
                {content.whyUsDescription}
              </p>
            </div>
            
            <div className="grid md:grid-cols-2 gap-4">
              {content.benefits.map((benefit, index) => {
                const Icon = benefit.icon;
                return (
                  <div key={index} className="flex gap-3 bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow">
                    <div className="flex-shrink-0">
                      <div className="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
                        <Icon className="h-5 w-5 text-primary" />
                      </div>
                    </div>
                    <div>
                      <h3 className="font-semibold text-base text-gray-800 mb-1">{benefit.title}</h3>
                      <p className="text-gray-600 text-sm">{benefit.description}</p>
                    </div>
                  </div>
                );
              })}
            </div>
          </section>

          {/* Social Proof / Testimonial Section - Russell Brunson Method */}
          {content.testimonial && (
            <section className="max-w-4xl mx-auto mb-8 md:mb-12 bg-gradient-to-br from-primary/5 to-primary/10 p-6 md:p-8 rounded-2xl border-2 border-primary/20">
              <div className="flex items-center justify-center gap-2 mb-4">
                <Award className="h-6 w-6 text-primary" />
                <h2 className="text-2xl font-bold text-gray-900">Real Results from Real Clients</h2>
              </div>
              
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <div className="flex items-center gap-1 mb-4 justify-center">
                  {[...Array(content.testimonial.rating)].map((_, i) => (
                    <Star key={i} className="h-5 w-5 fill-yellow-400 text-yellow-400" />
                  ))}
                </div>
                
                <blockquote className="text-center mb-6">
                  <p className="text-lg text-gray-700 italic leading-relaxed">
                    "{content.testimonial.quote}"
                  </p>
                </blockquote>
                
                <div className="text-center border-t pt-4">
                  <p className="font-semibold text-gray-900">{content.testimonial.author}</p>
                  <p className="text-sm text-gray-600">{content.testimonial.role}</p>
                </div>
              </div>

              <div className="mt-6 text-center">
                <p className="text-gray-700 font-medium">
                  Join hundreds of satisfied clients who've transformed their business with CDM Suite
                </p>
              </div>
            </section>
          )}

          {/* Quality Commitment Section */}
          <section className="max-w-4xl mx-auto mb-8 md:mb-12">
            <div className="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-500 rounded-2xl p-6 md:p-8">
              <div className="flex flex-col md:flex-row items-center gap-6">
                <div className="flex-shrink-0">
                  <div className="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center">
                    <Shield className="h-10 w-10 text-white" />
                  </div>
                </div>
                <div className="flex-1 text-center md:text-left">
                  <h3 className="text-2xl font-bold text-gray-900 mb-3">
                    Our 100% Satisfaction Commitment
                  </h3>
                  <p className="text-gray-700 leading-relaxed mb-3">
                    We're so confident you'll love working with us that we offer a complete satisfaction commitment. 
                    If you're not thrilled with our work, we'll continue working with you until you are completely satisfied with the results.
                  </p>
                  <p className="text-gray-900 font-semibold">
                    Your success is our success. We're committed to delivering exceptional results. üéØ
                  </p>
                </div>
              </div>
            </div>
          </section>

          {/* Value Stack Section - Russell Brunson Method */}
          <section className="max-w-4xl mx-auto mb-8 md:mb-12">
            <div className="bg-white border-2 border-primary rounded-2xl p-6 md:p-8">
              <div className="text-center mb-6">
                <Badge className="bg-primary text-white px-4 py-1 text-sm mb-2">LIMITED TIME BONUS</Badge>
                <h3 className="text-2xl font-bold text-gray-900">
                  What You Get When You Start Today
                </h3>
              </div>
              
              <div className="space-y-3 mb-6">
                <div className="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                  <CheckCircle className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
                  <div>
                    <span className="font-semibold text-gray-900">Core Service Package</span>
                    <span className="text-gray-600 block text-sm">Everything listed in your selected tier</span>
                  </div>
                </div>
                <div className="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                  <Gift className="h-5 w-5 text-primary flex-shrink-0 mt-0.5" />
                  <div>
                    <span className="font-semibold text-gray-900">FREE Strategy Session ($500 value)</span>
                    <span className="text-gray-600 block text-sm">60-minute deep-dive with our experts</span>
                  </div>
                </div>
                <div className="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                  <Gift className="h-5 w-5 text-primary flex-shrink-0 mt-0.5" />
                  <div>
                    <span className="font-semibold text-gray-900">FREE Website Audit ($300 value)</span>
                    <span className="text-gray-600 block text-sm">Comprehensive analysis of your current digital presence</span>
                  </div>
                </div>
                <div className="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                  <Gift className="h-5 w-5 text-primary flex-shrink-0 mt-0.5" />
                  <div>
                    <span className="font-semibold text-gray-900">Priority Support Access</span>
                    <span className="text-gray-600 block text-sm">Get answers fast with our dedicated support team</span>
                  </div>
                </div>
              </div>
              
              <div className="border-t-2 border-dashed border-gray-300 pt-4 text-center">
                <p className="text-sm text-gray-600 mb-2">Total Value: <span className="line-through">$800+</span></p>
                <p className="text-2xl font-bold text-primary">Yours FREE when you start today!</p>
              </div>
            </div>
          </section>

          {/* Urgency Section with CTA - Russell Brunson Method */}
          <section className="max-w-3xl mx-auto mb-8 md:mb-12 bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl p-1">
            <div className="bg-white rounded-xl p-6 md:p-8">
              <div className="text-center mb-4">
                <Badge className="bg-red-500 text-white px-4 py-1 text-sm mb-3 animate-pulse">‚ö° LIMITED SPOTS AVAILABLE</Badge>
                <p className="text-lg text-gray-700 font-semibold">
                  We only take on a limited number of clients each month to ensure the highest quality service.
                </p>
                <p className="text-primary font-bold text-xl mt-2">
                  Only 3 spots remaining this month!
                </p>
              </div>
            </div>
          </section>

          {/* Call to Action Section - Russell Brunson Style */}
          <section id="ctaSection" className="text-center mt-10 md:mt-14 max-w-3xl mx-auto bg-gradient-to-br from-primary to-primary/80 rounded-2xl p-1 shadow-2xl">
            <div className="bg-white rounded-xl p-6 md:p-8">
              {!showScheduler ? (
                <div id="ctaContent">
                  <div className="w-16 h-16 bg-gradient-to-r from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                    <ArrowRight className="h-8 w-8 text-white" />
                  </div>
                  <h2 className="text-3xl md:text-4xl font-bold text-gray-900 mb-3">
                    It's Decision Time
                  </h2>
                  <p className="text-gray-700 mb-2 text-lg leading-relaxed font-medium">
                    You have two choices right now:
                  </p>
                  <div className="bg-gray-50 rounded-lg p-4 mb-4 text-left max-w-xl mx-auto">
                    <p className="text-gray-600 mb-2"><span className="text-red-500 font-bold">‚ùå Choice 1:</span> Keep struggling with the same problems, watching your competitors get ahead while you waste time and money on solutions that don't work.</p>
                    <p className="text-gray-900 font-semibold"><span className="text-green-600 font-bold">‚úÖ Choice 2:</span> Take action today, get expert help, and finally see the results you deserve with our proven system and satisfaction guarantee.</p>
                  </div>
                  <p className="text-gray-900 mb-6 text-lg leading-relaxed font-semibold">
                    The choice is yours. But remember‚Äîevery day you wait is a day your competitors are getting ahead.
                  </p>
                  <div className="flex flex-col sm:flex-row gap-4 justify-center mb-4">
                    <CheckoutButton 
                      serviceId={service.id}
                      className="bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white font-bold py-4 px-8 rounded-full text-lg transition-all duration-300 transform hover:scale-105 shadow-lg"
                    />
                    <Button 
                      onClick={handleScheduleClick}
                      size="lg"
                      variant="outline"
                      className="border-2 border-primary text-primary hover:bg-primary hover:text-white font-bold py-4 px-8 rounded-full text-lg"
                    >
                      Talk to an Expert First
                    </Button>
                  </div>
                  <div className="bg-green-50 border-2 border-green-500 rounded-lg p-4 inline-block">
                    <p className="text-green-900 font-bold flex items-center gap-2 justify-center">
                      <Shield className="h-5 w-5" />
                      Backed by our 100% Satisfaction Commitment
                    </p>
                  </div>
                  <p className="mt-4 text-sm text-gray-600">
                    ‚è±Ô∏è Start seeing results in 30 days or less ‚Ä¢ üéÅ $800+ in FREE bonuses ‚Ä¢ üîí Quality guaranteed
                  </p>
                </div>
              ) : (
                <div id="scheduler">
                  <CalendlyScheduler url="https://calendly.com/cdm-creativemedia/digital-marketing-power-session" />
                </div>
              )}
            </div>
          </section>

          {/* FAQ Section - Compact */}
          <section className="max-w-3xl mx-auto mt-10 md:mt-14 border-t pt-8">
            <h2 className="text-2xl font-bold text-center text-gray-900 mb-6">Frequently Asked Questions</h2>
            <div className="space-y-4">
              <div className="bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                <h3 className="font-semibold text-base text-gray-800 mb-1 flex items-start gap-2">
                  <span className="text-primary">Q:</span>
                  How long does it take to get started?
                </h3>
                <p className="text-gray-600 pl-6 text-sm">
                  We can typically kick things off within 1-2 business days of purchase. For larger projects, we will schedule an onboarding call to ensure we understand your goals and gather any necessary information.
                </p>
              </div>
              <div className="bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                <h3 className="font-semibold text-base text-gray-800 mb-1 flex items-start gap-2">
                  <span className="text-primary">Q:</span>
                  What if I need something custom?
                </h3>
                <p className="text-gray-600 pl-6 text-sm">
                  No problem! While our packages cover most needs, we are always happy to create a custom solution tailored to your specific requirements. Just schedule a call with us to discuss your needs.
                </p>
              </div>
              <div className="bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                <h3 className="font-semibold text-base text-gray-800 mb-1 flex items-start gap-2">
                  <span className="text-primary">Q:</span>
                  Can I upgrade or downgrade later?
                </h3>
                <p className="text-gray-600 pl-6 text-sm">
                  Absolutely! Your needs may change as your business grows, and we are flexible. You can adjust your service level anytime, just reach out to your account manager or our support team.
                </p>
              </div>
            </div>
          </section>
        </div>
      </div>

      <Footer />
    </>
  );
}

// ==========================================
// File: components/services/website-fix-checkout.tsx
// ==========================================


'use client';

import { useState, useEffect, Suspense } from 'react';
import { motion } from 'framer-motion';
import { useSearchParams } from 'next/navigation';
import { 
  Check, 
  Rocket, 
  Shield, 
  Clock, 
  Award, 
  Sparkles,
  CreditCard,
  ArrowRight,
  AlertCircle
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { toast } from 'react-hot-toast';
import { useSession } from 'next-auth/react';
import Link from 'next/link';

function WebsiteFixCheckoutInner() {
  const searchParams = useSearchParams();
  const { data: session, status } = useSession();
  const isAuthenticated = status === 'authenticated';

  const [serviceType, setServiceType] = useState<'done-for-you' | 'self-service'>('done-for-you');
  const [formData, setFormData] = useState({
    email: '',
    name: '',
    company: '',
    websiteUrl: '',
    phone: ''
  });
  const [isLoading, setIsLoading] = useState(false);

  // Pre-fill from URL params or session
  useEffect(() => {
    if (searchParams) {
      const email = searchParams.get('email');
      const name = searchParams.get('name');
      const websiteUrl = searchParams.get('website');
      
      setFormData(prev => ({
        ...prev,
        email: email || session?.user?.email || '',
        name: name || session?.user?.name || '',
        websiteUrl: websiteUrl || ''
      }));
    }
  }, [searchParams, session]);

  const serviceOptions = {
    'done-for-you': {
      title: 'Done-For-You Service',
      description: 'We handle everything - you just approve',
      price: 100,
      features: [
        '‚úÖ Complete website audit & fix',
        '‚úÖ Dedicated project manager',
        '‚úÖ Priority support & updates',
        '‚úÖ Weekly progress reports',
        '‚úÖ Guaranteed launch in 7 days'
      ],
      popular: true
    },
    'self-service': {
      title: 'Self-Service Platform',
      description: 'Access our platform + guided tutorials',
      price: 50,
      features: [
        '‚úÖ Platform access & tools',
        '‚úÖ Step-by-step video tutorials',
        '‚úÖ Email support',
        '‚úÖ Community forum access',
        '‚úÖ Flexible timeline'
      ],
      popular: false
    }
  };

  const handleCheckout = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!formData.email || !formData.name || !formData.websiteUrl) {
      toast.error('Please fill in all required fields');
      return;
    }

    setIsLoading(true);

    try {
      // Create Stripe checkout session
      const response = await fetch('/api/checkout/website-fix', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ...formData,
          serviceType,
          priceId: serviceType === 'done-for-you' ? 'price_website_fix_dfy' : 'price_website_fix_self',
          userId: session?.user?.id
        })
      });

      if (!response.ok) {
        throw new Error('Failed to create checkout session');
      }

      const { checkoutUrl } = await response.json();
      
      // Redirect to Stripe checkout
      window.location.href = checkoutUrl;
    } catch (error) {
      console.error('Checkout error:', error);
      toast.error('Failed to start checkout. Please try again or contact support.');
      setIsLoading(false);
    }
  };

  const selectedService = serviceOptions[serviceType];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50 py-24 px-4">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-center mb-12"
        >
          <Badge className="mb-4 bg-green-100 text-green-700 hover:bg-green-200">
            <Clock className="w-3 h-3 mr-1" />
            Limited Time Offer
          </Badge>
          
          <h1 className="text-4xl md:text-5xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-slate-900 via-blue-800 to-slate-900">
            Website Performance Fix Service
          </h1>
          
          <p className="text-xl text-slate-600 max-w-3xl mx-auto">
            Transform your website in just 7 days. Cancel anytime, no long-term contract.
          </p>
        </motion.div>

        <div className="grid lg:grid-cols-3 gap-8">
          {/* Left Column - Service Selection & Form */}
          <div className="lg:col-span-2 space-y-6">
            {/* Service Type Selection */}
            <Card>
              <CardHeader>
                <CardTitle>Choose Your Service Type</CardTitle>
                <CardDescription>Select the option that works best for you</CardDescription>
              </CardHeader>
              <CardContent>
                <RadioGroup value={serviceType} onValueChange={(value: any) => setServiceType(value)}>
                  <div className="space-y-4">
                    {Object.entries(serviceOptions).map(([key, option]) => (
                      <div
                        key={key}
                        className={`relative border-2 rounded-lg p-5 cursor-pointer transition-all ${
                          serviceType === key
                            ? 'border-blue-600 bg-blue-50 shadow-lg'
                            : 'border-slate-200 bg-white hover:border-slate-300'
                        }`}
                        onClick={() => setServiceType(key as any)}
                      >
                        {option.popular && (
                          <Badge className="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-green-600 text-white">
                            Most Popular
                          </Badge>
                        )}
                        
                        <div className="flex items-start gap-4">
                          <RadioGroupItem value={key} id={key} className="mt-1" />
                          <div className="flex-1">
                            <label htmlFor={key} className="cursor-pointer">
                              <div className="flex items-center justify-between mb-2">
                                <h3 className="text-lg font-bold text-slate-900">{option.title}</h3>
                                <div className="text-right">
                                  <div className="text-2xl font-bold text-blue-600">${option.price}</div>
                                  <div className="text-sm text-slate-600">/month</div>
                                </div>
                              </div>
                              <p className="text-sm text-slate-600 mb-3">{option.description}</p>
                              <ul className="space-y-2">
                                {option.features.map((feature, idx) => (
                                  <li key={idx} className="text-sm text-slate-700">{feature}</li>
                                ))}
                              </ul>
                            </label>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </RadioGroup>
              </CardContent>
            </Card>

            {/* Contact Form */}
            <Card>
              <CardHeader>
                <CardTitle>Your Information</CardTitle>
                <CardDescription>We'll use this to set up your service</CardDescription>
              </CardHeader>
              <CardContent>
                <form onSubmit={handleCheckout} className="space-y-4">
                  <div className="grid md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="name">Full Name *</Label>
                      <Input
                        id="name"
                        type="text"
                        placeholder="John Smith"
                        value={formData.name}
                        onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                        required
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label htmlFor="email">Email Address *</Label>
                      <Input
                        id="email"
                        type="email"
                        placeholder="john@company.com"
                        value={formData.email}
                        onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}
                        required
                        disabled={isAuthenticated}
                      />
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="company">Company Name</Label>
                      <Input
                        id="company"
                        type="text"
                        placeholder="Your Company"
                        value={formData.company}
                        onChange={(e) => setFormData(prev => ({ ...prev, company: e.target.value }))}
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label htmlFor="phone">Phone Number</Label>
                      <Input
                        id="phone"
                        type="tel"
                        placeholder="(555) 123-4567"
                        value={formData.phone}
                        onChange={(e) => setFormData(prev => ({ ...prev, phone: e.target.value }))}
                      />
                    </div>
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="websiteUrl">Website URL *</Label>
                    <Input
                      id="websiteUrl"
                      type="url"
                      placeholder="https://yourwebsite.com"
                      value={formData.websiteUrl}
                      onChange={(e) => setFormData(prev => ({ ...prev, websiteUrl: e.target.value }))}
                      required
                    />
                  </div>

                  <Button
                    type="submit"
                    size="lg"
                    className="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800"
                    disabled={isLoading}
                  >
                    {isLoading ? (
                      <>Processing...</>
                    ) : (
                      <>
                        <CreditCard className="w-5 h-5 mr-2" />
                        Continue to Payment - ${selectedService.price}/month
                        <ArrowRight className="w-5 h-5 ml-2" />
                      </>
                    )}
                  </Button>

                  <p className="text-xs text-center text-slate-600">
                    Secured by Stripe ‚Ä¢ Cancel anytime ‚Ä¢ Quality guaranteed
                  </p>
                </form>
              </CardContent>
            </Card>
          </div>

          {/* Right Column - Summary & Guarantees */}
          <div className="space-y-6">
            {/* Order Summary */}
            <Card className="sticky top-24">
              <CardHeader className="bg-gradient-to-br from-blue-50 to-purple-50">
                <CardTitle>Order Summary</CardTitle>
              </CardHeader>
              <CardContent className="pt-6 space-y-4">
                <div className="flex items-center justify-between pb-4 border-b">
                  <div>
                    <div className="font-semibold text-slate-900">{selectedService.title}</div>
                    <div className="text-sm text-slate-600">Monthly subscription</div>
                  </div>
                  <div className="text-2xl font-bold text-blue-600">
                    ${selectedService.price}
                  </div>
                </div>

                <div className="space-y-3 text-sm">
                  <div className="flex items-start gap-2">
                    <Check className="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5" />
                    <span className="text-slate-700">No setup fees</span>
                  </div>
                  <div className="flex items-start gap-2">
                    <Check className="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5" />
                    <span className="text-slate-700">Cancel anytime</span>
                  </div>
                  <div className="flex items-start gap-2">
                    <Check className="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5" />
                    <span className="text-slate-700">Quality guarantee - we work until you're satisfied</span>
                  </div>
                  <div className="flex items-start gap-2">
                    <Check className="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5" />
                    <span className="text-slate-700">Billed monthly, not annually</span>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Guarantees */}
            <Card className="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200">
              <CardContent className="pt-6 space-y-4">
                <div className="flex items-start gap-3">
                  <Shield className="w-6 h-6 text-green-600 flex-shrink-0" />
                  <div>
                    <div className="font-semibold text-green-900 mb-1">100% Satisfaction Commitment</div>
                    <p className="text-sm text-green-800">
                      We're committed to your success. We'll work with you until you're completely satisfied with the results.
                    </p>
                  </div>
                </div>

                <div className="flex items-start gap-3">
                  <Rocket className="w-6 h-6 text-green-600 flex-shrink-0" />
                  <div>
                    <div className="font-semibold text-green-900 mb-1">Guaranteed Results</div>
                    <p className="text-sm text-green-800">
                      We guarantee at least 20-point improvement in your website score or your money back.
                    </p>
                  </div>
                </div>

                <div className="flex items-start gap-3">
                  <Clock className="w-6 h-6 text-green-600 flex-shrink-0" />
                  <div>
                    <div className="font-semibold text-green-900 mb-1">Fast Turnaround</div>
                    <p className="text-sm text-green-800">
                      Your website improvements will be completed and launched within 7 days.
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Social Proof */}
            <Card>
              <CardContent className="pt-6">
                <div className="flex items-center gap-2 mb-3">
                  <Award className="w-5 h-5 text-blue-600" />
                  <span className="font-semibold text-slate-900">Trusted by 500+ Businesses</span>
                </div>
                <p className="text-sm text-slate-600 italic mb-2">
                  "From a 52 audit score to 94 in just 5 days. Website loads 3x faster and we're getting double the leads!"
                </p>
                <p className="text-xs text-slate-500">‚Äî Jennifer M., Small Business Owner</p>
              </CardContent>
            </Card>

            {/* Support */}
            <Card className="bg-slate-50">
              <CardContent className="pt-6">
                <div className="text-center space-y-2">
                  <AlertCircle className="w-8 h-8 text-blue-600 mx-auto" />
                  <div className="font-semibold text-slate-900">Need Help?</div>
                  <p className="text-sm text-slate-600">
                    Have questions? Call us at{' '}
                    <a href="tel:8622727623" className="text-blue-600 font-semibold hover:underline">
                      (862) 272-7623
                    </a>
                    {' '}or{' '}
                    <Link href="/contact" className="text-blue-600 font-semibold hover:underline">
                      contact us
                    </Link>
                  </p>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </div>
  );
}

export default function WebsiteFixCheckout() {
  return (
    <Suspense fallback={
      <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50 py-24 px-4 flex items-center justify-center">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-slate-600">Loading checkout...</p>
        </div>
      </div>
    }>
      <WebsiteFixCheckoutInner />
    </Suspense>
  );
}

// ==========================================
// File: components/services/website-fix-success.tsx
// ==========================================


'use client';

import { useEffect, useState, Suspense } from 'react';
import { useSearchParams } from 'next/navigation';
import { motion } from 'framer-motion';
import { CheckCircle, Calendar, Mail, Phone, ArrowRight, Sparkles } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import Link from 'next/link';
import { useSession } from 'next-auth/react';

function WebsiteFixSuccessInner() {
  const searchParams = useSearchParams();
  const { data: session } = useSession();
  const [sessionData, setSessionData] = useState<any>(null);

  useEffect(() => {
    const sessionId = searchParams?.get('session_id');
    if (sessionId) {
      // Optionally fetch session details from Stripe
      // For now, we'll just show success message
      setSessionData({ id: sessionId });
    }
  }, [searchParams]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-green-50 py-24 px-4">
      <div className="max-w-4xl mx-auto">
        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          className="text-center"
        >
          {/* Success Icon */}
          <div className="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
            <CheckCircle className="w-12 h-12 text-green-600" />
          </div>

          {/* Main Message */}
          <h1 className="text-4xl md:text-5xl font-bold text-slate-900 mb-4">
            Welcome Aboard! üéâ
          </h1>
          
          <p className="text-xl text-slate-600 mb-8 max-w-2xl mx-auto">
            Your subscription is confirmed. We're excited to transform your website!
          </p>

          {/* What Happens Next */}
          <Card className="mb-8 text-left">
            <CardContent className="pt-6">
              <h2 className="text-2xl font-bold text-slate-900 mb-6 text-center">
                What Happens Next?
              </h2>
              
              <div className="space-y-4">
                <div className="flex items-start gap-4 p-4 bg-blue-50 rounded-lg">
                  <div className="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
                    1
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900 mb-1">Check Your Email</h3>
                    <p className="text-slate-600 text-sm">
                      We've sent a confirmation email with your receipt and next steps. If you don't see it, check your spam folder.
                    </p>
                  </div>
                </div>

                <div className="flex items-start gap-4 p-4 bg-purple-50 rounded-lg">
                  <div className="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
                    2
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900 mb-1">Kickoff Call (Within 24 Hours)</h3>
                    <p className="text-slate-600 text-sm">
                      Our team will reach out to schedule a quick kickoff call. We'll discuss your goals, timeline, and any specific requirements.
                    </p>
                  </div>
                </div>

                <div className="flex items-start gap-4 p-4 bg-green-50 rounded-lg">
                  <div className="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
                    3
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900 mb-1">We Get to Work</h3>
                    <p className="text-slate-600 text-sm">
                      Our team will start fixing all the critical issues identified in your audit. You'll receive daily progress updates.
                    </p>
                  </div>
                </div>

                <div className="flex items-start gap-4 p-4 bg-yellow-50 rounded-lg">
                  <div className="w-10 h-10 bg-yellow-600 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
                    4
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900 mb-1">Launch & Celebrate (Day 7)</h3>
                    <p className="text-slate-600 text-sm">
                      We'll launch your improved website within 7 days. You'll see a dramatic improvement in speed, SEO, and user experience.
                    </p>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Quick Actions */}
          <div className="grid md:grid-cols-3 gap-4 mb-8">
            <Card className="hover:shadow-lg transition-shadow">
              <CardContent className="pt-6 text-center">
                <Calendar className="w-8 h-8 text-blue-600 mx-auto mb-3" />
                <h3 className="font-semibold text-slate-900 mb-2">Schedule Your Call</h3>
                <p className="text-sm text-slate-600 mb-4">
                  Pick a time that works for you
                </p>
                <Link href="/contact">
                  <Button variant="outline" size="sm" className="w-full">
                    Schedule Now
                  </Button>
                </Link>
              </CardContent>
            </Card>

            <Card className="hover:shadow-lg transition-shadow">
              <CardContent className="pt-6 text-center">
                {session ? (
                  <>
                    <Mail className="w-8 h-8 text-purple-600 mx-auto mb-3" />
                    <h3 className="font-semibold text-slate-900 mb-2">View Dashboard</h3>
                    <p className="text-sm text-slate-600 mb-4">
                      Track your project progress
                    </p>
                    <Link href="/dashboard">
                      <Button variant="outline" size="sm" className="w-full">
                        Go to Dashboard
                      </Button>
                    </Link>
                  </>
                ) : (
                  <>
                    <Sparkles className="w-8 h-8 text-purple-600 mx-auto mb-3" />
                    <h3 className="font-semibold text-slate-900 mb-2">Create Account</h3>
                    <p className="text-sm text-slate-600 mb-4">
                      Track your project progress
                    </p>
                    <Link href="/auth/signup">
                      <Button variant="outline" size="sm" className="w-full">
                        Sign Up Free
                      </Button>
                    </Link>
                  </>
                )}
              </CardContent>
            </Card>

            <Card className="hover:shadow-lg transition-shadow">
              <CardContent className="pt-6 text-center">
                <Phone className="w-8 h-8 text-green-600 mx-auto mb-3" />
                <h3 className="font-semibold text-slate-900 mb-2">Have Questions?</h3>
                <p className="text-sm text-slate-600 mb-4">
                  We're here to help
                </p>
                <a href="tel:8622727623">
                  <Button variant="outline" size="sm" className="w-full">
                    Call Us Now
                  </Button>
                </a>
              </CardContent>
            </Card>
          </div>

          {/* Quality Assurance */}
          <Card className="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200">
            <CardContent className="pt-6">
              <div className="flex items-center justify-center gap-3 mb-2">
                <CheckCircle className="w-6 h-6 text-green-600" />
                <h3 className="text-lg font-semibold text-green-900">
                  Quality Guarantee
                </h3>
              </div>
              <p className="text-green-700 text-center">
                We're committed to delivering exceptional results. Our team will work with you until you're completely satisfied with your website improvements.
              </p>
            </CardContent>
          </Card>

          {/* CTA */}
          <div className="mt-8">
            <Link href="/">
              <Button size="lg" className="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800">
                Return to Homepage
                <ArrowRight className="w-4 h-4 ml-2" />
              </Button>
            </Link>
          </div>
        </motion.div>
      </div>
    </div>
  );
}

export default function WebsiteFixSuccess() {
  return (
    <Suspense fallback={
      <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-green-50 py-24 px-4 flex items-center justify-center">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-green-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-slate-600">Loading...</p>
        </div>
      </div>
    }>
      <WebsiteFixSuccessInner />
    </Suspense>
  );
}

// ==========================================
// File: components/services-section.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Image from "next/image";
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { ArrowRight, Monitor, Megaphone, Smartphone, Brain } from "lucide-react";

const ServicesSection = () => {
  const services = [
    {
      icon: Monitor,
      title: "Website Creation & Maintenance",
      description: "Custom sites that turn visitors into customers. Built mobile first with smooth user experience and layouts designed to convert.",
      image: "https://cdn.abacus.ai/images/be17cb63-d612-45d4-a305-c4454951de60.png",
      features: ["Mobile First Design", "SEO Optimized", "Fast Loading", "Built to Convert"],
      link: "/services/website-creation-starter",
    },
    {
      icon: Megaphone,
      title: "SEO & Digital Marketing",
      description: "Rank higher in search results and grow your social presence. Professional SEO services and social media management that delivers results.",
      image: "https://cdn.abacus.ai/images/c0201920-f2b3-4da8-b5e5-08cf4c08e5b5.png",
      features: ["Local SEO", "Social Media", "Content Marketing", "Performance Tracking"],
      link: "/services/seo-local-basic",
    },
    {
      icon: Smartphone,
      title: "Mobile App Development",
      description: "Bringing your big app idea to life. Native and multi platform mobile applications that engage users and drive business growth.",
      image: "https://cdn.abacus.ai/images/9f04f5ba-a634-414a-8344-b68ce3c2adf0.png",
      features: ["iOS & Android", "Multi Platform", "UX/UI Design", "App Store Ready"],
      link: "/services/app-creation-mvp",
    },
    {
      icon: Brain,
      title: "Ad Management & Growth",
      description: "Smart ads for measurable growth. Targeted PPC campaigns, social media advertising, and conversion tuning that delivers real ROI.",
      image: "https://cdn.abacus.ai/images/ced69fa8-5742-4173-aafb-2e0f52e13d6a.png",
      features: ["PPC Management", "Social Media Ads", "Display Advertising", "ROI Tracking"],
      link: "/services/ad-management-starter",
    },
  ];

  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.2,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 30 },
    visible: {
      opacity: 1,
      y: 0,
      transition: { duration: 0.6 },
    },
  };

  return (
    <section id="services" className="py-20 bg-gradient-to-br from-cool-gray via-secondary/5 to-accent/5 relative overflow-hidden">
      {/* Decorative background elements */}
      <div className="absolute inset-0 opacity-30">
        <div className="absolute top-10 left-10 w-72 h-72 bg-secondary rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse"></div>
        <div className="absolute top-40 right-10 w-72 h-72 bg-accent rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse" style={{animationDelay: '1s'}}></div>
        <div className="absolute bottom-10 left-1/2 w-72 h-72 bg-primary rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse" style={{animationDelay: '2s'}}></div>
      </div>
      
      <div className="section-container relative z-10">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mb-16"
        >
          <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
            Our Digital Marketing Services
          </h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            Numbers, not guesswork. We deliver measurable results through smart digital marketing 
            services designed to grow your business and maximize your return.
          </p>
        </motion.div>

        <motion.div
          variants={containerVariants}
          initial="hidden"
          whileInView="visible"
          viewport={{ once: true }}
          className="grid grid-cols-1 md:grid-cols-2 gap-8"
        >
          {services.map((service, index) => (
            <motion.div
              key={index}
              variants={itemVariants}
              className="bg-white rounded-lg shadow-lg overflow-hidden card-hover group"
            >
              <div className="relative h-64 bg-gray-100">
                <Image
                  src={service.image}
                  alt={service.title}
                  fill
                  className="object-cover group-hover:scale-105 transition-transform duration-300"
                />
                <div className="absolute top-4 left-4 bg-white p-3 rounded-full shadow-lg">
                  <service.icon className="h-6 w-6 text-primary" />
                </div>
              </div>
              
              <div className="p-8">
                <h3 className="text-2xl font-semibold text-gray-900 mb-4">
                  {service.title}
                </h3>
                <p className="text-gray-600 mb-6 leading-relaxed">
                  {service.description}
                </p>
                
                <div className="grid grid-cols-2 gap-2 mb-6">
                  {service.features.map((feature, idx) => (
                    <div key={idx} className="flex items-center text-sm text-gray-500">
                      <div className="w-2 h-2 bg-primary rounded-full mr-2"></div>
                      {feature}
                    </div>
                  ))}
                </div>
                
                <Link href={service.link}>
                  <Button className="w-full group bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold shadow-lg hover:shadow-xl transition-all btn-breathe">
                    Learn More
                    <ArrowRight className="ml-2 h-4 w-4 group-hover:translate-x-1 transition-transform" />
                  </Button>
                </Link>
              </div>
            </motion.div>
          ))}
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.4 }}
          viewport={{ once: true }}
          className="text-center mt-12 space-y-4"
        >
          <Link href="/services">
            <Button size="lg" variant="outline" className="mr-4 px-10 py-6 text-lg">
              View All Services
              <ArrowRight className="ml-2 h-5 w-5" />
            </Button>
          </Link>
          <Link href="/contact">
            <Button size="lg" className="bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold shadow-xl hover:shadow-2xl transition-all group px-10 py-6 text-lg btn-breathe btn-glow">
              Get Custom Quote
              <ArrowRight className="ml-2 h-5 w-5 group-hover:translate-x-1 transition-transform" />
            </Button>
          </Link>
        </motion.div>
      </div>
    </section>
  );
};

export default ServicesSection;

// ==========================================
// File: components/sticky-cta-button.tsx
// ==========================================


"use client";

import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { ArrowRight, Calendar } from "lucide-react";

interface StickyCTAButtonProps {
  onScheduleClick: () => void;
  serviceName: string;
  className?: string;
}

export function StickyCTAButton({ onScheduleClick, serviceName, className = "" }: StickyCTAButtonProps) {
  const [isVisible, setIsVisible] = useState(false);
  const [isAtBottom, setIsAtBottom] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      // Show button after scrolling 300px
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      setIsVisible(scrollTop > 300);

      // Hide when near the final CTA section
      const ctaSection = document.getElementById('ctaSection');
      if (ctaSection) {
        const ctaRect = ctaSection.getBoundingClientRect();
        const isNearCTA = ctaRect.top < window.innerHeight && ctaRect.bottom > 0;
        setIsAtBottom(isNearCTA);
      }
    };

    window.addEventListener('scroll', handleScroll);
    handleScroll(); // Check initial position

    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  if (!isVisible || isAtBottom) return null;

  return (
    <div className={`fixed bottom-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-sm border-t border-gray-200 shadow-lg py-4 px-4 md:px-6 ${className}`}>
      <div className="container mx-auto flex flex-col sm:flex-row items-center justify-between gap-3">
        <div className="text-center sm:text-left">
          <p className="text-sm font-semibold text-gray-900">Ready to get started with {serviceName}?</p>
          <p className="text-xs text-gray-600">Schedule a free consultation today</p>
        </div>
        <div className="flex gap-3 w-full sm:w-auto">
          <Button
            onClick={onScheduleClick}
            size="lg"
            className="flex-1 sm:flex-none bg-primary hover:bg-primary/90 text-white shadow-lg"
          >
            <Calendar className="h-4 w-4 mr-2" />
            Book Now
          </Button>
          <Button
            onClick={() => {
              document.getElementById('pricing')?.scrollIntoView({ behavior: 'smooth' });
            }}
            size="lg"
            variant="outline"
            className="flex-1 sm:flex-none"
          >
            View Pricing
            <ArrowRight className="h-4 w-4 ml-2" />
          </Button>
        </div>
      </div>
    </div>
  );
}

// ==========================================
// File: components/table-of-contents.tsx
// ==========================================


'use client';

import { useEffect, useState } from 'react';
import { cn } from '@/lib/utils';
import { ChevronDown, ChevronUp, List } from 'lucide-react';
import { Button } from '@/components/ui/button';

interface Heading {
  level: number;
  text: string;
  id: string;
}

interface TableOfContentsProps {
  headings: Heading[];
}

export function TableOfContents({ headings }: TableOfContentsProps) {
  const [activeId, setActiveId] = useState<string>('');
  const [isExpanded, setIsExpanded] = useState<boolean>(false);

  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setActiveId(entry.target.id);
          }
        });
      },
      { rootMargin: '-80px 0px -80% 0px' }
    );

    headings.forEach((heading) => {
      const element = document.getElementById(heading.id);
      if (element) observer.observe(element);
    });

    return () => observer.disconnect();
  }, [headings]);

  const handleClick = (id: string) => {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      // Close mobile menu after clicking
      if (window.innerWidth < 1024) {
        setIsExpanded(false);
      }
    }
  };

  if (headings.length === 0) return null;

  return (
    <>
      {/* Mobile Toggle Button - Fixed at bottom left */}
      <div className="lg:hidden fixed bottom-6 left-6 z-40">
        <Button
          onClick={() => setIsExpanded(!isExpanded)}
          className="shadow-lg rounded-full h-14 w-14 p-0"
          size="lg"
          variant="secondary"
        >
          <List className="h-6 w-6" />
        </Button>
      </div>

      {/* Mobile Overlay Menu */}
      {isExpanded && (
        <div className="lg:hidden fixed inset-0 bg-background/95 backdrop-blur-sm z-50 overflow-y-auto">
          <div className="container mx-auto p-6">
            <div className="flex items-center justify-between mb-6">
              <h3 className="text-2xl font-bold">Table of Contents</h3>
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setIsExpanded(false)}
              >
                <ChevronUp className="h-5 w-5" />
              </Button>
            </div>
            <nav className="space-y-3">
              {headings.map((heading) => (
                <button
                  key={heading.id}
                  onClick={() => handleClick(heading.id)}
                  className={cn(
                    'block w-full text-left text-base hover:text-primary transition-colors py-2 px-3 rounded-lg',
                    heading.level === 2 && 'pl-3 font-medium',
                    heading.level === 3 && 'pl-6',
                    heading.level > 3 && 'pl-9 text-sm',
                    activeId === heading.id
                      ? 'text-primary bg-primary/10 font-semibold'
                      : 'text-muted-foreground hover:bg-muted'
                  )}
                >
                  {heading.text}
                </button>
              ))}
            </nav>
          </div>
        </div>
      )}

      {/* Desktop Sticky Sidebar */}
      <div className="hidden lg:block sticky top-24">
        <div className="border rounded-lg p-5 bg-card shadow-sm">
          <div className="flex items-center gap-2 mb-4">
            <List className="h-4 w-4 text-primary" />
            <h3 className="font-semibold text-sm uppercase text-muted-foreground">
              Table of Contents
            </h3>
          </div>
          <nav className="space-y-2 max-h-[calc(100vh-200px)] overflow-y-auto pr-2">
            {headings.map((heading) => (
              <button
                key={heading.id}
                onClick={() => handleClick(heading.id)}
                className={cn(
                  'block w-full text-left text-sm hover:text-primary transition-colors py-1.5 px-2 rounded',
                  heading.level === 2 && 'pl-2 font-medium',
                  heading.level === 3 && 'pl-4',
                  heading.level > 3 && 'pl-6 text-xs',
                  activeId === heading.id
                    ? 'text-primary bg-primary/10 font-semibold'
                    : 'text-muted-foreground hover:bg-muted'
                )}
              >
                {heading.text}
              </button>
            ))}
          </nav>
        </div>
      </div>
    </>
  );
}

// ==========================================
// File: components/theme-provider.tsx
// ==========================================

"use client"

import * as React from "react"
import { ThemeProvider as NextThemesProvider } from "next-themes"
import { type ThemeProviderProps } from "next-themes/dist/types"

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}

// ==========================================
// File: components/tools/budget-calculator-landing.tsx
// ==========================================


"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { DollarSign, TrendingUp, ArrowRight, CheckCircle, Mail, PieChart, Target, BarChart3, Loader2 } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Slider } from "@/components/ui/slider";
import { Card, CardContent } from "@/components/ui/card";
import { toast } from "react-hot-toast";
import { trackRedditLead } from "@/lib/reddit-tracking";
import { trackConversion } from "@/lib/analytics";
import Link from "next/link";
import LoadingAnimation from "../loading-animation";
import FOMONotifications from "../fomo-notifications";
import { PieChart as RechartsPieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from "recharts";

interface BudgetResult {
  totalBudget: number;
  channels: {
    name: string;
    percentage: number;
    amount: number;
    color: string;
  }[];
  expectedROI: number;
  projectedRevenue: number;
}

const BudgetCalculatorLanding = () => {
  const [annualRevenue, setAnnualRevenue] = useState(500000);
  const [growthGoal, setGrowthGoal] = useState(25);
  const [result, setResult] = useState<BudgetResult | null>(null);
  const [email, setEmail] = useState("");
  const [name, setName] = useState("");
  const [phone, setPhone] = useState("");
  const [showLeadForm, setShowLeadForm] = useState(false);
  const [showTripwire, setShowTripwire] = useState(false);
  const [tripwireOffer, setTripwireOffer] = useState<any>(null);
  const [processingCheckout, setProcessingCheckout] = useState(false);

  const handleCalculate = (e: React.FormEvent) => {
    e.preventDefault();

    // Calculate recommended budget (5-15% of revenue based on growth goals)
    const budgetPercentage = Math.min(15, 5 + (growthGoal / 10));
    const totalBudget = annualRevenue * (budgetPercentage / 100);

    // Channel allocation based on industry best practices
    const channels = [
      { name: "SEO & Content", percentage: 25, color: "#10b981" },
      { name: "Paid Ads (PPC)", percentage: 30, color: "#3b82f6" },
      { name: "Social Media", percentage: 20, color: "#8b5cf6" },
      { name: "Email Marketing", percentage: 10, color: "#f59e0b" },
      { name: "Video/Creative", percentage: 10, color: "#ec4899" },
      { name: "Analytics/Tools", percentage: 5, color: "#6b7280" }
    ].map(channel => ({
      ...channel,
      amount: totalBudget * (channel.percentage / 100)
    }));

    // Calculate expected ROI (conservative estimate)
    const expectedROI = 350 + (growthGoal * 5); // 350-500%
    const projectedRevenue = totalBudget * (expectedROI / 100);

    setResult({
      totalBudget,
      channels,
      expectedROI,
      projectedRevenue
    });
    setShowLeadForm(true);
  };

  const handleLeadSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!email || !name) {
      toast.error("Please enter your name and email");
      return;
    }
    
    try {
      const response = await fetch('/api/send-tool-results', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email,
          name,
          phone: phone || null,
          toolName: 'Budget Calculator',
          toolData: {
            annualRevenue,
            growthGoal
          },
          results: {
            recommendedBudget: result?.totalBudget || 0,
            expectedReturn: (result?.totalBudget || 0) * 3,
            expectedROI: 300,
            breakdown: result?.channels.reduce((acc: any, channel: any) => {
              acc[channel.name] = channel.amount;
              return acc;
            }, {}) || {}
          }
        })
      });

      if (response.ok) {
        const data = await response.json();
        // Track lead conversion
        trackRedditLead(email);
        trackConversion('budget_calculator', undefined, 'USD', { email });
        
        setTripwireOffer(data.tripwireOffer);
        setShowTripwire(true);
        setShowLeadForm(false);
        toast.success("‚úÖ Your budget plan has been sent to your email!");
      } else {
        toast.error("Failed to send plan. Please try again.");
      }
    } catch (error) {
      toast.error("Failed to send plan. Please try again.");
    }
  };


  const handleTripwireCheckout = async () => {
    if (!tripwireOffer) return;
    
    setProcessingCheckout(true);
    
    try {
      const response = await fetch('/api/create-tripwire-checkout', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          offerName: tripwireOffer.offerName,
          amount: tripwireOffer.discountPrice,
          originalPrice: tripwireOffer.originalPrice,
          customerEmail: email,
          customerName: name,
        }),
      });

      if (response.ok) {
        const data = await response.json();
        if (data.url) {
          window.location.href = data.url;
        }
      } else {
        alert('Failed to create checkout session. Please try again.');
        setProcessingCheckout(false);
      }
    } catch (error) {
      console.error('Error creating checkout:', error);
      alert('Failed to create checkout session. Please try again.');
      setProcessingCheckout(false);
    }
  };
  const formatCurrency = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-charcoal via-primary to-charcoal">
      <FOMONotifications />
      {/* Hero Section */}
      <section className="pt-20 sm:pt-24 md:pt-32 pb-6 sm:pb-8 md:pb-12 relative overflow-hidden">
        <div className="absolute inset-0 opacity-5">
          <div className="absolute top-0 right-0 w-96 h-96 bg-orange-500 rounded-full blur-[80px]"></div>
          <div className="absolute bottom-0 left-0 w-96 h-96 bg-red-500 rounded-full blur-[80px]"></div>
        </div>

        <div className="section-container relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            className="text-center max-w-5xl mx-auto"
          >
            <div className="inline-flex items-center gap-2 bg-orange-500/20 backdrop-blur-none sm:backdrop-blur-sm rounded-full px-6 py-2 mb-6">
              <DollarSign className="h-5 w-5 text-orange-400" />
              <span className="text-orange-400 font-semibold">Smart Budget Planning</span>
            </div>

            <h1 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-white mb-6 leading-tight">
              Are You Wasting
              <span className="block bg-gradient-to-r from-orange-400 to-red-400 bg-clip-text text-transparent">
                Your Marketing Budget?
              </span>
            </h1>

            <p className="text-base sm:text-lg md:text-xl lg:text-2xl text-gray-300 mb-8 leading-relaxed font-semibold">
              Calculate the perfect marketing budget and see exactly how to allocate every dollar for maximum ROI.
            </p>

            <p className="text-xl text-gray-400 mb-12">
              Based on data from 1,000+ successful campaigns across every industry.
            </p>
          </motion.div>

          {/* Calculator */}
          <div className="grid lg:grid-cols-2 gap-12 max-w-7xl mx-auto">
            {/* Input Form */}
            <motion.div
              initial={{ opacity: 0, x: -30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.8, delay: 0.2 }}
            >
              <Card className="bg-white shadow-2xl sticky top-24">
                <CardContent className="p-8">
                  <h3 className="text-2xl font-bold text-gray-900 mb-6">Your Business Metrics</h3>
                  <form onSubmit={handleCalculate} className="space-y-6 sm:space-y-8">
                    <div>
                      <Label className="text-gray-900 font-semibold mb-3 block text-lg">
                        Annual Revenue
                      </Label>
                      <div className="flex items-center gap-4 mb-3">
                        <Slider
                          min={50000}
                          max={10000000}
                          step={10000}
                          value={[annualRevenue]}
                          onValueChange={(value) => setAnnualRevenue(value[0])}
                          className="flex-1"
                        />
                        <Input
                          type="number"
                          value={annualRevenue}
                          onChange={(e) => setAnnualRevenue(Number(e.target.value))}
                          className="w-40 text-lg font-bold"
                        />
                      </div>
                      <p className="text-sm text-gray-500">
                        {formatCurrency(annualRevenue)} per year
                      </p>
                    </div>

                    <div>
                      <Label className="text-gray-900 font-semibold mb-3 block text-lg">
                        Growth Goal (%)
                      </Label>
                      <div className="flex items-center gap-4 mb-3">
                        <Slider
                          min={10}
                          max={100}
                          step={5}
                          value={[growthGoal]}
                          onValueChange={(value) => setGrowthGoal(value[0])}
                          className="flex-1"
                        />
                        <Input
                          type="number"
                          value={growthGoal}
                          onChange={(e) => setGrowthGoal(Number(e.target.value))}
                          className="w-32 text-lg font-bold"
                        />
                      </div>
                      <p className="text-sm text-gray-500">
                        You want to grow by {growthGoal}% this year
                      </p>
                    </div>

                    <Button
                      type="submit"
                      className="w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-3 sm:py-4 md:py-5 text-base sm:text-lg md:text-xl"
                    >
                      Calculate My Budget
                      <DollarSign className="ml-2 h-5 w-5" />
                    </Button>
                  </form>
                </CardContent>
              </Card>
            </motion.div>

            {/* Results */}
            <motion.div
              initial={{ opacity: 0, x: 30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.8, delay: 0.4 }}
              className="space-y-6"
            >
              {result ? (
                <>
                  {/* Total Budget */}
                  <Card className="bg-gradient-to-br from-orange-500/10 to-red-500/10 backdrop-blur-none sm:backdrop-blur-sm border-2 border-orange-500/20">
                    <CardContent className="p-8 text-center">
                      <h3 className="text-2xl font-bold text-white mb-4">Recommended Annual Budget</h3>
                      <div className="text-6xl font-bold text-white mb-2">
                        {formatCurrency(result.totalBudget)}
                      </div>
                      <p className="text-gray-300 text-lg">
                        {((result.totalBudget / annualRevenue) * 100).toFixed(1)}% of revenue
                      </p>
                    </CardContent>
                  </Card>

                  {/* ROI Projection */}
                  <Card className="bg-white/10 backdrop-blur-none sm:backdrop-blur-sm border-white/20">
                    <CardContent className="p-6">
                      <div className="flex items-center gap-3 mb-4">
                        <TrendingUp className="h-6 w-6 text-orange-400" />
                        <h3 className="text-xl font-bold text-white">Expected Results</h3>
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <p className="text-gray-400 text-sm mb-1">Expected ROI</p>
                          <p className="text-3xl font-bold text-orange-400">{result.expectedROI}%</p>
                        </div>
                        <div>
                          <p className="text-gray-400 text-sm mb-1">Projected Revenue</p>
                          <p className="text-3xl font-bold text-white">{formatCurrency(result.projectedRevenue)}</p>
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  {/* Channel Allocation */}
                  <Card className="bg-white/10 backdrop-blur-none sm:backdrop-blur-sm border-white/20">
                    <CardContent className="p-6">
                      <h3 className="text-xl font-bold text-white mb-4">Recommended Channel Allocation</h3>
                      <div className="space-y-3">
                        {result.channels.map((channel, index) => (
                          <div key={index}>
                            <div className="flex justify-between mb-1">
                              <span className="text-gray-300">{channel.name}</span>
                              <span className="text-white font-bold">{formatCurrency(channel.amount)}</span>
                            </div>
                            <div className="h-2 bg-white/10 rounded-full overflow-hidden">
                              <div
                                className="h-full transition-all duration-500"
                                style={{
                                  width: `${channel.percentage}%`,
                                  backgroundColor: channel.color
                                }}
                              />
                            </div>
                          </div>
                        ))}
                      </div>
                    </CardContent>
                  </Card>

                  {/* Lead Capture */}
                  {showLeadForm && (
                    <motion.div
                      initial={{ opacity: 0, y: 30 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ duration: 0.5 }}
                      className="bg-white rounded-2xl p-8"
                    >
                      <div className="flex items-center gap-3 mb-4">
                        <Mail className="h-6 w-6 text-orange-500" />
                        <h3 className="text-2xl font-bold text-gray-900">
                          Want a Detailed Marketing Plan?
                        </h3>
                      </div>
                      <p className="text-gray-600 mb-6">
                        Get a comprehensive PDF breakdown with month-by-month execution plan and ROI projections. Plus, free consultation with our strategists.
                      </p>
                      <form onSubmit={handleLeadSubmit} className="space-y-4">
                        <Input
                          type="text"
                          placeholder="Your Name *"
                          value={name}
                          onChange={(e) => setName(e.target.value)}
                          required
                        />
                        <Input
                          type="email"
                          placeholder="Your Email *"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                          required
                        />
                        <Input
                          type="tel"
                          placeholder="Phone Number (Optional)"
                          value={phone}
                          onChange={(e) => setPhone(e.target.value)}
                        />
                        <Button
                          type="submit"
                          className="w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-6 text-lg"
                        >
                          Send Me My Marketing Plan
                          <ArrowRight className="ml-2 h-5 w-5" />
                        </Button>
                      </form>
                    </motion.div>
                  )}

                  {/* Tripwire Offer */}
                  {showTripwire && tripwireOffer && (
                    <motion.div
                      initial={{ opacity: 0, scale: 0.95 }}
                      animate={{ opacity: 1, scale: 1 }}
                      transition={{ duration: 0.5 }}
                      className="bg-gradient-to-br from-orange-500 to-red-500 rounded-2xl p-8 text-white shadow-2xl"
                    >
                      <div className="text-center mb-6">
                        <div className="inline-block bg-yellow-400 text-charcoal font-bold text-sm px-4 py-2 rounded-full mb-4">
                          {tripwireOffer.urgency}
                        </div>
                        <h2 className="text-4xl font-bold mb-3">
                          üéâ Check Your Email!
                        </h2>
                        <p className="text-xl text-white/90">
                          Your budget plan is on its way. But before you go...
                        </p>
                      </div>

                      <div className="bg-white/10 backdrop-blur-none sm:backdrop-blur-sm rounded-xl p-6 mb-6">
                        <h3 className="text-3xl font-bold mb-3">{tripwireOffer.title}</h3>
                        <div className="flex items-center gap-4 mb-4">
                          <span className="text-5xl font-bold">${tripwireOffer.discountPrice}</span>
                          <div>
                            <span className="text-xl line-through opacity-75">${tripwireOffer.originalPrice}</span>
                            <span className="ml-2 bg-red-600 text-white text-sm font-bold px-2 py-1 rounded">
                              Save ${tripwireOffer.savings}
                            </span>
                          </div>
                        </div>
                        <ul className="space-y-2 mb-6">
                          {tripwireOffer.features.map((feature: string, index: number) => (
                            <li key={index} className="flex items-start gap-2">
                              <CheckCircle className="h-5 w-5 flex-shrink-0 mt-0.5" />
                              <span>{feature}</span>
                            </li>
                          ))}
                        </ul>
                      </div>

                      <div className="grid sm:grid-cols-2 gap-4">
                        <Button
                          size="lg"
                          className="bg-white hover:bg-gray-100 text-orange-600 font-bold py-6 text-lg w-full"
                          onClick={handleTripwireCheckout}
                          disabled={processingCheckout}
                        >
                          {processingCheckout ? (
                            <>
                              <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                              Processing...
                            </>
                          ) : (
                            <>
                              {tripwireOffer.cta}
                              <ArrowRight className="ml-2 h-5 w-5" />
                            </>
                          )}
                        </Button>
                        <Button
                          size="lg"
                          variant="outline"
                          className="bg-transparent border-2 border-white text-white hover:bg-white/10 font-semibold py-6 text-lg w-full"
                          asChild
                        >
                          <Link href="/tools">
                            Maybe Later
                          </Link>
                        </Button>
                      </div>

                      <p className="text-center text-sm text-white/80 mt-4">
                        ‚ö° {tripwireOffer.urgency} ‚Ä¢ 60-Day Money-Back Guarantee
                      </p>
                    </motion.div>
                  )}
                </>
              ) : (
                <Card className="bg-white/5 backdrop-blur-none sm:backdrop-blur-sm border-white/10">
                  <CardContent className="p-12 text-center">
                    <BarChart3 className="h-16 w-16 text-orange-400 mx-auto mb-4 opacity-50" />
                    <p className="text-gray-300 text-lg">
                      Enter your metrics to see your recommended budget
                    </p>
                  </CardContent>
                </Card>
              )}
            </motion.div>
          </div>
        </div>
      </section>

      {/* CTA */}
      <section className="py-8 sm:py-12 md:py-16">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="bg-gradient-to-r from-orange-500 to-red-500 rounded-2xl sm:rounded-3xl p-6 sm:p-8 md:p-12 text-center"
          >
            <h2 className="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-6">
              Need Help Executing Your Marketing Strategy?
            </h2>
            <p className="text-xl text-white/80 mb-8 max-w-3xl mx-auto">
              We'll take your budget and turn it into campaigns that actually deliver ROI. No waste, no guesswork, just results.
            </p>
            <Button
              size="lg"
              className="bg-white hover:bg-gray-100 text-orange-600 font-bold px-6 sm:px-8 py-4 sm:py-5 md:py-6 text-base sm:text-lg"
              asChild
            >
              <Link href="/contact">
                Let's Build Your Strategy
                <ArrowRight className="ml-2 h-5 w-5" />
              </Link>
            </Button>
          </motion.div>
        </div>
      </section>
    </div>
  );
};

export default BudgetCalculatorLanding;

// ==========================================
// File: components/tools/conversion-analyzer-landing.tsx
// ==========================================


"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { BarChart3, TrendingUp, ArrowRight, Mail, Target, Users, DollarSign, AlertCircle, Loader2, CheckCircle } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Card, CardContent } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { toast } from "react-hot-toast";
import { trackRedditLead } from "@/lib/reddit-tracking";
import { trackConversion } from "@/lib/analytics";
import Link from "next/link";
import LoadingAnimation from "../loading-animation";
import FOMONotifications from "../fomo-notifications";

interface FunnelStage {
  name: string;
  visitors: number;
  conversionRate: number;
  dropOff: number;
}

interface AnalysisResult {
  stages: FunnelStage[];
  overallConversion: number;
  biggestLeaks: string[];
  improvements: { stage: string; potential: number }[];
  potentialRevenue: number;
}

const ConversionAnalyzerLanding = () => {
  const [visitors, setVisitors] = useState(10000);
  const [landingPageConv, setLandingPageConv] = useState(25);
  const [productPageConv, setProductPageConv] = useState(40);
  const [checkoutConv, setCheckoutConv] = useState(60);
  const [avgOrderValue, setAvgOrderValue] = useState(100);
  const [result, setResult] = useState<AnalysisResult | null>(null);
  const [email, setEmail] = useState("");
  const [name, setName] = useState("");
  const [phone, setPhone] = useState("");
  const [showLeadForm, setShowLeadForm] = useState(false);
  const [showTripwire, setShowTripwire] = useState(false);
  const [tripwireOffer, setTripwireOffer] = useState<any>(null);
  const [processingCheckout, setProcessingCheckout] = useState(false);
  const [isAnalyzing, setIsAnalyzing] = useState(false);

  const handleAnalyze = (e: React.FormEvent) => {
    e.preventDefault();

    setIsAnalyzing(true);

    // Calculate funnel stages with loading animation
    setTimeout(() => {
      const landingVisitors = visitors;
      const productVisitors = landingVisitors * (landingPageConv / 100);
      const checkoutVisitors = productVisitors * (productPageConv / 100);
      const completedOrders = checkoutVisitors * (checkoutConv / 100);

    const stages: FunnelStage[] = [
      {
        name: "Landing Page",
        visitors: landingVisitors,
        conversionRate: landingPageConv,
        dropOff: 100 - landingPageConv
      },
      {
        name: "Product Page",
        visitors: productVisitors,
        conversionRate: productPageConv,
        dropOff: 100 - productPageConv
      },
      {
        name: "Checkout",
        visitors: checkoutVisitors,
        conversionRate: checkoutConv,
        dropOff: 100 - checkoutConv
      },
      {
        name: "Completed Purchase",
        visitors: completedOrders,
        conversionRate: 100,
        dropOff: 0
      }
    ];

    const overallConversion = (completedOrders / landingVisitors) * 100;

    // Identify biggest leaks
    const biggestLeaks: string[] = [];
    if (landingPageConv < 30) biggestLeaks.push("Landing page has low engagement");
    if (productPageConv < 50) biggestLeaks.push("Product pages aren't converting");
    if (checkoutConv < 70) biggestLeaks.push("Cart abandonment is high");

    // Calculate improvement potential
    const improvements = [
      {
        stage: "Landing Page",
        potential: (landingVisitors * 0.10 * (productPageConv / 100) * (checkoutConv / 100)) * avgOrderValue
      },
      {
        stage: "Product Page",
        potential: (productVisitors * 0.15 * (checkoutConv / 100)) * avgOrderValue
      },
      {
        stage: "Checkout",
        potential: (checkoutVisitors * 0.20) * avgOrderValue
      }
    ];

    const potentialRevenue = improvements.reduce((sum, imp) => sum + imp.potential, 0);

    setResult({
      stages,
      overallConversion,
      biggestLeaks,
      improvements,
      potentialRevenue
    });
      setShowLeadForm(true);
      setIsAnalyzing(false);
    }, 4000);
  };

  const handleLeadSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!email || !name) {
      toast.error("Please enter your name and email");
      return;
    }
    
    try {
      const response = await fetch('/api/send-tool-results', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email,
          name,
          phone: phone || null,
          toolName: 'Conversion Analyzer',
          toolData: { visitors, landingPageConv, productPageConv, checkoutConv, avgOrderValue },
          results: result
        })
      });

      if (response.ok) {
        const data = await response.json();
        // Track lead conversion
        trackRedditLead(email);
        trackConversion('conversion_analyzer', undefined, 'USD', { email });
        
        setTripwireOffer(data.tripwireOffer);
        setShowTripwire(true);
        setShowLeadForm(false);
        toast.success("‚úÖ Your conversion optimization plan has been sent!");
      } else {
        toast.error("Failed to send plan. Please try again.");
      }
    } catch (error) {
      toast.error("Failed to send plan. Please try again.");
    }
  };

  const handleTripwireCheckout = async () => {
    if (!tripwireOffer) return;
    
    setProcessingCheckout(true);
    
    try {
      const response = await fetch("/api/create-tripwire-checkout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          offerName: tripwireOffer.offerName,
          amount: tripwireOffer.discountPrice,
          originalPrice: tripwireOffer.originalPrice,
          customerEmail: email,
          customerName: name,
        }),
      });

      if (response.ok) {
        const data = await response.json();
        if (data.url) {
          window.location.href = data.url;
        }
      } else {
        toast.error("Failed to create checkout session. Please try again.");
        setProcessingCheckout(false);
      }
    } catch (error) {
      console.error("Error creating checkout:", error);
      toast.error("Failed to create checkout session. Please try again.");
      setProcessingCheckout(false);
    }
  };


  const formatCurrency = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  const formatNumber = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      minimumFractionDigits: 0,
      maximumFractionDigits: value < 100 ? 1 : 0,
    }).format(value);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-charcoal via-primary to-charcoal">
      <FOMONotifications />
      {/* Hero Section */}
      <section className="pt-20 sm:pt-24 md:pt-32 pb-6 sm:pb-8 md:pb-12 relative overflow-hidden">
        <div className="absolute inset-0 opacity-5">
          <div className="absolute top-0 right-0 w-96 h-96 bg-indigo-500 rounded-full blur-[80px]"></div>
          <div className="absolute bottom-0 left-0 w-96 h-96 bg-blue-500 rounded-full blur-[80px]"></div>
        </div>

        <div className="section-container relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            className="text-center max-w-5xl mx-auto"
          >
            <div className="inline-flex items-center gap-2 bg-indigo-500/20 backdrop-blur-none sm:backdrop-blur-sm rounded-full px-6 py-2 mb-6">
              <BarChart3 className="h-5 w-5 text-indigo-400" />
              <span className="text-indigo-400 font-semibold">Funnel Optimization</span>
            </div>

            <h1 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-white mb-6 leading-tight">
              Where Are You
              <span className="block bg-gradient-to-r from-indigo-400 to-blue-400 bg-clip-text text-transparent">
                Losing Customers?
              </span>
            </h1>

            <p className="text-base sm:text-lg md:text-xl lg:text-2xl text-gray-300 mb-8 leading-relaxed font-semibold">
              Identify your biggest conversion leaks and discover exactly how much revenue you're losing every month.
            </p>

            <p className="text-xl text-gray-400 mb-12">
              Even small improvements in your funnel can add thousands in monthly revenue.
            </p>
          </motion.div>

          {/* Analyzer */}
          <div className="grid lg:grid-cols-2 gap-12 max-w-7xl mx-auto">
            {/* Input Form */}
            <motion.div
              initial={{ opacity: 0, x: -30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.8, delay: 0.2 }}
            >
              <Card className="bg-white shadow-2xl sticky top-24">
                <CardContent className="p-8">
                  <h3 className="text-2xl font-bold text-gray-900 mb-6">Your Funnel Metrics</h3>
                  <form onSubmit={handleAnalyze} className="space-y-6">
                    <div>
                      <Label className="text-gray-900 font-semibold mb-2 block">
                        Monthly Visitors
                      </Label>
                      <Input
                        type="number"
                        value={visitors}
                        onChange={(e) => setVisitors(Number(e.target.value))}
                        className="text-lg"
                        required
                      />
                    </div>

                    <div>
                      <Label className="text-gray-900 font-semibold mb-2 block">
                        Landing ‚Üí Product Page (%)
                      </Label>
                      <Input
                        type="number"
                        value={landingPageConv}
                        onChange={(e) => setLandingPageConv(Number(e.target.value))}
                        className="text-lg"
                        min="0"
                        max="100"
                        required
                      />
                    </div>

                    <div>
                      <Label className="text-gray-900 font-semibold mb-2 block">
                        Product Page ‚Üí Checkout (%)
                      </Label>
                      <Input
                        type="number"
                        value={productPageConv}
                        onChange={(e) => setProductPageConv(Number(e.target.value))}
                        className="text-lg"
                        min="0"
                        max="100"
                        required
                      />
                    </div>

                    <div>
                      <Label className="text-gray-900 font-semibold mb-2 block">
                        Checkout ‚Üí Purchase (%)
                      </Label>
                      <Input
                        type="number"
                        value={checkoutConv}
                        onChange={(e) => setCheckoutConv(Number(e.target.value))}
                        className="text-lg"
                        min="0"
                        max="100"
                        required
                      />
                    </div>

                    <div>
                      <Label className="text-gray-900 font-semibold mb-2 block">
                        Average Order Value ($)
                      </Label>
                      <Input
                        type="number"
                        value={avgOrderValue}
                        onChange={(e) => setAvgOrderValue(Number(e.target.value))}
                        className="text-lg"
                        required
                      />
                    </div>

                    <Button
                      type="submit"
                      className="w-full bg-gradient-to-r from-indigo-500 to-blue-500 hover:from-indigo-600 hover:to-blue-600 text-white font-bold py-3 sm:py-4 md:py-5 text-base sm:text-lg md:text-xl"
                    >
                      Analyze My Funnel
                      <BarChart3 className="ml-2 h-5 w-5" />
                    </Button>
                  </form>
                </CardContent>
              </Card>
            </motion.div>

            {/* Results */}
            <motion.div
              initial={{ opacity: 0, x: 30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.8, delay: 0.4 }}
              className="space-y-6"
            >
              {result ? (
                <>
                  {/* Overall Conversion */}
                  <Card className="bg-gradient-to-br from-indigo-500/10 to-blue-500/10 backdrop-blur-none sm:backdrop-blur-sm border-2 border-indigo-500/20">
                    <CardContent className="p-8 text-center">
                      <h3 className="text-2xl font-bold text-white mb-4">Overall Conversion Rate</h3>
                      <div className="text-6xl font-bold mb-2">
                        <span className={result.overallConversion >= 5 ? "text-green-500" : result.overallConversion >= 2 ? "text-yellow-500" : "text-red-500"}>
                          {result.overallConversion.toFixed(2)}%
                        </span>
                      </div>
                      <Progress value={result.overallConversion * 10} className="h-3 mb-4" />
                      <p className="text-gray-300 text-lg">
                        Industry average is 2-4%
                      </p>
                    </CardContent>
                  </Card>

                  {/* Funnel Stages */}
                  <Card className="bg-white/10 backdrop-blur-none sm:backdrop-blur-sm border-white/20">
                    <CardContent className="p-6">
                      <h3 className="text-xl font-bold text-white mb-4">Your Funnel Breakdown</h3>
                      <div className="space-y-4">
                        {result.stages.map((stage, index) => (
                          <div key={index} className="bg-white/5 rounded-lg p-4">
                            <div className="flex justify-between mb-2">
                              <span className="text-white font-semibold">{stage.name}</span>
                              <span className="text-gray-300">{formatNumber(stage.visitors)} visitors</span>
                            </div>
                            {index < result.stages.length - 1 && (
                              <>
                                <Progress value={stage.conversionRate} className="h-2 mb-1" />
                                <div className="flex justify-between text-sm">
                                  <span className="text-green-400">{stage.conversionRate}% convert</span>
                                  <span className="text-red-400">{stage.dropOff}% drop off</span>
                                </div>
                              </>
                            )}
                          </div>
                        ))}
                      </div>
                    </CardContent>
                  </Card>

                  {/* Potential Revenue */}
                  <Card className="bg-gradient-to-r from-indigo-500 to-blue-500">
                    <CardContent className="p-8 text-center">
                      <DollarSign className="h-12 w-12 text-white mx-auto mb-3" />
                      <h3 className="text-xl font-bold text-white mb-2">Potential Additional Revenue</h3>
                      <p className="text-5xl font-bold text-white mb-2">
                        {formatCurrency(result.potentialRevenue)}
                      </p>
                      <p className="text-white/80 text-lg">Per Month with optimizations</p>
                    </CardContent>
                  </Card>

                  {/* Biggest Leaks */}
                  {result.biggestLeaks.length > 0 && (
                    <Card className="bg-red-500/10 border-red-500/20">
                      <CardContent className="p-6">
                        <div className="flex items-center gap-2 mb-4">
                          <AlertCircle className="h-6 w-6 text-red-500" />
                          <h3 className="text-xl font-bold text-white">Biggest Issues</h3>
                        </div>
                        <ul className="space-y-2">
                          {result.biggestLeaks.map((leak, index) => (
                            <li key={index} className="flex items-start gap-2 text-gray-300">
                              <span className="text-red-500 mt-1">‚ö†</span>
                              <span>{leak}</span>
                            </li>
                          ))}
                        </ul>
                      </CardContent>
                    </Card>
                  )}

                  {/* Lead Capture */}
                  {showLeadForm && (
                    <motion.div
                      initial={{ opacity: 0, y: 30 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ duration: 0.5 }}
                      className="bg-white rounded-2xl p-8"
                    >
                      <div className="flex items-center gap-3 mb-4">
                        <Mail className="h-6 w-6 text-indigo-500" />
                        <h3 className="text-2xl font-bold text-gray-900">
                          Want a Detailed Optimization Plan?
                        </h3>
                      </div>
                      <p className="text-gray-600 mb-6">
                        Get specific recommendations for each stage of your funnel, plus proven tactics to increase conversions by 30-50%.
                      </p>
                      <form onSubmit={handleLeadSubmit} className="space-y-4">
                        <div className="grid sm:grid-cols-2 gap-4">
                          <Input
                            type="text"
                            placeholder="Your Name"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            required
                          />
                          <Input
                            type="email"
                            placeholder="Your Email"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            required
                          />
                        </div>
                        <Button
                          type="submit"
                          className="w-full bg-gradient-to-r from-indigo-500 to-blue-500 hover:from-indigo-600 hover:to-blue-600 text-white font-bold py-6 text-lg"
                        >
                          Send Me My Optimization Plan
                          <ArrowRight className="ml-2 h-5 w-5" />
                        </Button>
                      </form>
                    </motion.div>
                  )}
                </>
              ) : (
                <Card className="bg-white/5 backdrop-blur-none sm:backdrop-blur-sm border-white/10">
                  <CardContent className="p-12 text-center">
                    <Target className="h-16 w-16 text-indigo-400 mx-auto mb-4 opacity-50" />
                    <p className="text-gray-300 text-lg">
                      Enter your funnel metrics to see where you're losing customers
                    </p>
                  </CardContent>
                </Card>
              )}
            </motion.div>
          </div>
        </div>
      </section>

      {/* CTA */}
      <section className="py-8 sm:py-12 md:py-16">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="bg-gradient-to-r from-indigo-500 to-blue-500 rounded-2xl sm:rounded-3xl p-6 sm:p-8 md:p-12 text-center"
          >
            <h2 className="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-6">
              Ready to Plug the Leaks and Maximize Revenue?
            </h2>
            <p className="text-xl text-white/80 mb-8 max-w-3xl mx-auto">
              Our CRO experts specialize in turning traffic into customers. We've helped businesses increase conversions by an average of 47%.
            </p>
            <Button
              size="lg"
              className="bg-white hover:bg-gray-100 text-indigo-600 font-bold px-6 sm:px-8 py-4 sm:py-5 md:py-6 text-base sm:text-lg"
              asChild
            >
              <Link href="/contact">
                Get Professional CRO Help
                <ArrowRight className="ml-2 h-5 w-5" />
              </Link>
            </Button>
          </motion.div>
        </div>
      </section>
    </div>
  );
};

export default ConversionAnalyzerLanding;

// ==========================================
// File: components/tools/email-tester-landing.tsx
// ==========================================

"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { Mail, TrendingUp, AlertCircle, CheckCircle, Star, ArrowRight, Send, Target, Loader2 } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Card, CardContent } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { Badge } from "@/components/ui/badge";
import { toast } from "react-hot-toast";
import { trackRedditLead } from "@/lib/reddit-tracking";
import { trackConversion } from "@/lib/analytics";
import Link from "next/link";
import LoadingAnimation from "../loading-animation";
import FOMONotifications from "../fomo-notifications";

interface EmailResult {
  openRatePrediction: number;
  spamScore: number;
  characterCount: number;
  wordCount: number;
  hasEmoji: boolean;
  hasNumber: boolean;
  hasPersonalization: boolean;
  recommendations: string[];
  strengths: string[];
  warnings: string[];
}

const EmailTesterLanding = () => {
  const [subjectLine, setSubjectLine] = useState("");
  const [result, setResult] = useState<EmailResult | null>(null);
  const [email, setEmail] = useState("");
  const [name, setName] = useState("");
  const [phone, setPhone] = useState("");
  const [showLeadForm, setShowLeadForm] = useState(false);
  const [showTripwire, setShowTripwire] = useState(false);
  const [tripwireOffer, setTripwireOffer] = useState<any>(null);
  const [processingCheckout, setProcessingCheckout] = useState(false);
  const [isAnalyzing, setIsAnalyzing] = useState(false);

  const handleTest = (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!subjectLine) {
      toast.error("Please enter a subject line");
      return;
    }

    setIsAnalyzing(true);

    // Generate mock result with loading animation
    setTimeout(() => {
      const characterCount = subjectLine.length;
      const wordCount = subjectLine.split(" ").length;
      const hasEmoji = /[\u{1F600}-\u{1F64F}]/u.test(subjectLine);
      const hasNumber = /\d/.test(subjectLine);
      const hasPersonalization = /\{|\[|name|your|you\}/i.test(subjectLine);

      let openRate = 15;
      if (characterCount >= 30 && characterCount <= 50) openRate += 10;
      if (hasEmoji) openRate += 5;
      if (hasNumber) openRate += 8;
      if (hasPersonalization) openRate += 12;
      if (subjectLine.includes("free") || subjectLine.includes("!")) openRate -= 5;

      openRate = Math.max(10, Math.min(35, openRate));

      const mockResult: EmailResult = {
        openRatePrediction: openRate,
        spamScore: Math.random() > 0.7 ? 35 : 12,
        characterCount,
        wordCount,
        hasEmoji,
        hasNumber,
        hasPersonalization,
        recommendations: [
          characterCount < 30 ? "Increase length to 30-50 characters for better open rates" : null,
          characterCount > 60 ? "Shorten to under 60 characters" : null,
          !hasPersonalization ? "Add personalization like {First Name}" : null,
          !hasNumber ? "Consider adding a number for specificity" : null,
          subjectLine.includes("!!!") ? "Remove excessive punctuation" : null
        ].filter(Boolean) as string[],
        strengths: [
          characterCount >= 30 && characterCount <= 50 ? "Optimal length" : null,
          hasPersonalization ? "Includes personalization" : null,
          hasNumber ? "Includes specific numbers" : null,
          hasEmoji ? "Eye-catching emoji" : null
        ].filter(Boolean) as string[],
        warnings: [
          subjectLine.toLowerCase().includes("free") ? "Spam trigger word: 'free'" : null,
          subjectLine.includes("!!!") ? "Too many exclamation marks" : null,
          characterCount > 60 ? "Too long for mobile devices" : null
        ].filter(Boolean) as string[]
      };

      setResult(mockResult);
      setShowLeadForm(true);
      setIsAnalyzing(false);
    }, 3500);
  };

  const handleLeadSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!email || !name) {
      toast.error("Please enter your name and email");
      return;
    }
    
    try {
      const response = await fetch('/api/send-tool-results', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email,
          name,
          phone: phone || null,
          toolName: 'Email Subject Line Tester',
          toolData: { subjectLine },
          results: result
        })
      });

      if (response.ok) {
        const data = await response.json();
        // Track lead conversion
        trackRedditLead(email);
        trackConversion('email_tester', undefined, 'USD', { email });
        
        setTripwireOffer(data.tripwireOffer);
        setShowTripwire(true);
        setShowLeadForm(false);
        toast.success("‚úÖ Your email marketing tips have been sent!");
      } else {
        toast.error("Failed to send tips. Please try again.");
      }
    } catch (error) {
      toast.error("Failed to send tips. Please try again.");
    }
  };

  const handleTripwireCheckout = async () => {
    if (!tripwireOffer) return;
    
    setProcessingCheckout(true);
    
    try {
      const response = await fetch("/api/create-tripwire-checkout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          offerName: tripwireOffer.offerName,
          amount: tripwireOffer.discountPrice,
          originalPrice: tripwireOffer.originalPrice,
          customerEmail: email,
          customerName: name,
        }),
      });

      if (response.ok) {
        const data = await response.json();
        if (data.url) {
          window.location.href = data.url;
        }
      } else {
        toast.error("Failed to create checkout session. Please try again.");
        setProcessingCheckout(false);
      }
    } catch (error) {
      console.error("Error creating checkout:", error);
      toast.error("Failed to create checkout session. Please try again.");
      setProcessingCheckout(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-charcoal via-primary to-charcoal">
      <FOMONotifications />
      {isAnalyzing && (
        <LoadingAnimation
          toolName="Subject Line"
          duration={3500}
        />
      )}
      
      <section className="pt-20 sm:pt-24 md:pt-32 pb-6 sm:pb-8 md:pb-12 relative overflow-hidden">
        <div className="absolute inset-0 opacity-5">
          <div className="absolute top-0 right-0 w-96 h-96 bg-purple-500 rounded-full blur-[80px]"></div>
          <div className="absolute bottom-0 left-0 w-96 h-96 bg-pink-500 rounded-full blur-[80px]"></div>
        </div>

        <div className="section-container relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            className="text-center max-w-5xl mx-auto mb-12"
          >
            <div className="inline-flex items-center gap-2 bg-purple-500/20 backdrop-blur-none sm:backdrop-blur-sm rounded-full px-6 py-2 mb-6">
              <Mail className="h-5 w-5 text-purple-400" />
              <span className="text-purple-400 font-semibold">Boost Your Email Open Rates</span>
            </div>

            <h1 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-white mb-6 leading-tight">
              Will Anyone
              <span className="block bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                Open Your Email?
              </span>
            </h1>

            <p className="text-base sm:text-lg md:text-xl lg:text-2xl text-gray-300 mb-8 leading-relaxed font-semibold">
              Test your subject line and get an instant open rate prediction before you hit send.
            </p>
          </motion.div>

          {/* Tester Form */}
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8, delay: 0.2 }}
            className="max-w-4xl mx-auto"
          >
            <Card className="bg-white shadow-2xl">
              <CardContent className="p-8">
                <form onSubmit={handleTest} className="space-y-6">
                  <div>
                    <Label htmlFor="subject" className="text-gray-900 font-semibold text-lg mb-3 block">
                      Your Email Subject Line
                    </Label>
                    <Textarea
                      id="subject"
                      placeholder="e.g., {FirstName}, you won't believe what we just launched..."
                      value={subjectLine}
                      onChange={(e) => setSubjectLine(e.target.value)}
                      className="text-lg min-h-[100px]"
                      required
                    />
                    <p className="text-sm text-gray-500 mt-2">
                      üí° Tip: Use {"{FirstName}"} or {"{Name}"} for personalization
                    </p>
                  </div>

                  <Button
                    type="submit"
                    className="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 sm:py-4 md:py-5 text-base sm:text-lg md:text-xl"
                  >
                    Test My Subject Line
                    <Send className="ml-2 h-5 w-5" />
                  </Button>
                </form>
              </CardContent>
            </Card>
          </motion.div>
        </div>
      </section>

      {/* Results */}
      {result && (
        <section className="py-8 sm:py-12 md:py-16">
          <div className="section-container">
            <motion.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8 }}
              className="max-w-6xl mx-auto space-y-6 sm:space-y-8"
            >
              {/* Open Rate Prediction */}
              <Card className="bg-gradient-to-br from-purple-500/10 to-pink-500/10 backdrop-blur-none sm:backdrop-blur-sm border-2 border-purple-500/20">
                <CardContent className="p-8 text-center">
                  <h2 className="text-3xl font-bold text-white mb-4">Predicted Open Rate</h2>
                  <div className="text-8xl font-bold mb-4">
                    <span className={result.openRatePrediction >= 25 ? "text-green-500" : result.openRatePrediction >= 18 ? "text-yellow-500" : "text-red-500"}>
                      {result.openRatePrediction}%
                    </span>
                  </div>
                  <Progress value={result.openRatePrediction * 2} className="h-3 mb-4" />
                  <p className="text-base sm:text-lg md:text-xl text-gray-300">
                    Industry average is 21%. {result.openRatePrediction >= 21 ? "You're above average! üéâ" : "Let's improve this."}
                  </p>
                </CardContent>
              </Card>

              {/* Analysis Grid */}
              <div className="grid md:grid-cols-3 gap-8">
                <Card className="bg-green-500/10 border-green-500/20">
                  <CardContent className="p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <CheckCircle className="h-6 w-6 text-green-500" />
                      <h3 className="text-xl font-bold text-white">Strengths</h3>
                    </div>
                    <ul className="space-y-2">
                      {result.strengths.map((strength, index) => (
                        <li key={index} className="flex items-start gap-2 text-gray-300">
                          <span className="text-green-500">‚úì</span>
                          <span>{strength}</span>
                        </li>
                      ))}
                    </ul>
                  </CardContent>
                </Card>

                <Card className="bg-yellow-500/10 border-yellow-500/20">
                  <CardContent className="p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <AlertCircle className="h-6 w-6 text-yellow-500" />
                      <h3 className="text-xl font-bold text-white">Warnings</h3>
                    </div>
                    <ul className="space-y-2">
                      {result.warnings.length > 0 ? result.warnings.map((warning, index) => (
                        <li key={index} className="flex items-start gap-2 text-gray-300">
                          <span className="text-yellow-500">‚ö†</span>
                          <span>{warning}</span>
                        </li>
                      )) : (
                        <li className="text-gray-300">No warnings! üéâ</li>
                      )}
                    </ul>
                  </CardContent>
                </Card>

                <Card className="bg-blue-500/10 border-blue-500/20">
                  <CardContent className="p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <Target className="h-6 w-6 text-blue-400" />
                      <h3 className="text-xl font-bold text-white">Quick Stats</h3>
                    </div>
                    <div className="space-y-3">
                      <div>
                        <p className="text-gray-400 text-sm">Character Count</p>
                        <p className="text-2xl font-bold text-white">{result.characterCount}</p>
                      </div>
                      <div>
                        <p className="text-gray-400 text-sm">Spam Score</p>
                        <p className="text-2xl font-bold text-white">{result.spamScore}%</p>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Recommendations */}
              {result.recommendations.length > 0 && (
                <Card className="bg-white/10 border-white/20">
                  <CardContent className="p-6">
                    <h3 className="text-2xl font-bold text-white mb-4">How to Improve</h3>
                    <ul className="space-y-3">
                      {result.recommendations.map((rec, index) => (
                        <li key={index} className="flex items-start gap-3 text-gray-300">
                          <span className="text-purple-400 font-bold">{index + 1}.</span>
                          <span>{rec}</span>
                        </li>
                      ))}
                    </ul>
                  </CardContent>
                </Card>
              )}

              {/* Lead Capture */}
              {showLeadForm && (
                <motion.div
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.5 }}
                  className="bg-white rounded-2xl p-8 max-w-2xl mx-auto"
                >
                  <div className="flex items-center gap-3 mb-4">
                    <Mail className="h-6 w-6 text-purple-500" />
                    <h3 className="text-2xl font-bold text-gray-900">
                      Want 50 Proven Subject Line Templates?
                    </h3>
                  </div>
                  <p className="text-gray-600 mb-6">
                    Get our complete guide to writing subject lines that get 2-3x higher open rates. Plus, schedule a free email marketing consultation.
                  </p>
                  <form onSubmit={handleLeadSubmit} className="space-y-4">
                    <Input
                      type="text"
                      placeholder="Your Name *"
                      value={name}
                      onChange={(e) => setName(e.target.value)}
                      required
                      className="text-lg"
                    />
                    <Input
                      type="email"
                      placeholder="Your Email Address *"
                      value={email}
                      onChange={(e) => setEmail(e.target.value)}
                      required
                      className="text-lg"
                    />
                    <Input
                      type="tel"
                      placeholder="Phone Number (Optional)"
                      value={phone}
                      onChange={(e) => setPhone(e.target.value)}
                      className="text-lg"
                    />
                    <Button
                      type="submit"
                      className="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-6 text-lg"
                    >
                      Send Me the Templates
                      <ArrowRight className="ml-2 h-5 w-5" />
                    </Button>
                  </form>
                  <p className="text-xs text-gray-500 text-center mt-2">
                    Plus get a free 30-minute email marketing consultation ($500 value)
                  </p>
                </motion.div>
              )}

              {/* Tripwire Upsell */}
              {showTripwire && tripwireOffer && (
                <motion.div
                  initial={{ opacity: 0, scale: 0.95 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ duration: 0.5 }}
                  className="bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl p-8 text-white shadow-2xl"
                >
                  <div className="text-center mb-6">
                    <div className="inline-block bg-red-500 text-white font-bold text-sm px-4 py-2 rounded-full mb-4">
                      {tripwireOffer.urgency}
                    </div>
                    <h2 className="text-4xl font-bold mb-3">
                      üéâ Check Your Email!
                    </h2>
                    <p className="text-xl">
                      Your subject line templates are on their way. But before you go...
                    </p>
                  </div>

                  <div className="bg-white/20 backdrop-blur-sm rounded-xl p-6 mb-6">
                    <h3 className="text-3xl font-bold mb-3">{tripwireOffer.title}</h3>
                    <div className="flex items-center gap-4 mb-4">
                      <span className="text-5xl font-bold">${tripwireOffer.discountPrice}</span>
                      <div>
                        <span className="text-xl line-through opacity-75">${tripwireOffer.originalPrice}</span>
                        <span className="ml-2 bg-red-500 text-white text-sm font-bold px-2 py-1 rounded">
                          Save ${tripwireOffer.savings}
                        </span>
                      </div>
                    </div>
                    <ul className="space-y-2 mb-6">
                      {tripwireOffer.features.map((feature: string, index: number) => (
                        <li key={index} className="flex items-start gap-2">
                          <CheckCircle className="h-5 w-5 flex-shrink-0 mt-0.5" />
                          <span>{feature}</span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  <div className="grid sm:grid-cols-2 gap-4">
                    <Button
                      size="lg"
                      className="bg-white hover:bg-gray-100 text-purple-600 font-bold py-6 text-lg w-full"
                      onClick={handleTripwireCheckout}
                      disabled={processingCheckout}
                    >
                      {processingCheckout ? (
                        <>
                          <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                          Processing...
                        </>
                      ) : (
                        <>
                          {tripwireOffer.cta}
                          <ArrowRight className="ml-2 h-5 w-5" />
                        </>
                      )}
                    </Button>
                    <Button
                      size="lg"
                      variant="outline"
                      className="bg-transparent border-2 border-white text-white hover:bg-white/10 font-semibold py-6 text-lg w-full"
                      asChild
                    >
                      <Link href="/tools">
                        Maybe Later
                      </Link>
                    </Button>
                  </div>

                  <p className="text-center text-sm mt-4">
                    ‚ö° {tripwireOffer.urgency} ‚Ä¢ 60-Day Money-Back Guarantee
                  </p>
                </motion.div>
              )}
            </motion.div>
          </div>
        </section>
      )}

      {/* CTA */}
      <section className="py-8 sm:py-12 md:py-16">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl sm:rounded-3xl p-6 sm:p-8 md:p-12 text-center"
          >
            <h2 className="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-6">
              Ready for Email Campaigns That Convert?
            </h2>
            <p className="text-xl text-white/80 mb-8 max-w-3xl mx-auto">
              We've helped clients achieve 45%+ open rates and 12%+ click rates. Let us manage your email marketing.
            </p>
            <Button
              size="lg"
              className="bg-white hover:bg-gray-100 text-purple-600 font-bold px-6 sm:px-8 py-4 sm:py-5 md:py-6 text-base sm:text-lg"
              asChild
            >
              <Link href="/contact">
                Get Professional Email Marketing
                <ArrowRight className="ml-2 h-5 w-5" />
              </Link>
            </Button>
          </motion.div>
        </div>
      </section>
    </div>
  );
};

export default EmailTesterLanding;

// ==========================================
// File: components/tools/free-tools-hub.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import Link from "next/link";
import { 
  Calculator, 
  Search, 
  TrendingUp, 
  Mail, 
  DollarSign, 
  BarChart3,
  Sparkles,
  ArrowRight,
  CheckCircle,
  Globe,
  Target,
  Users,
  Zap,
  Shield
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";

interface Tool {
  id: string;
  title: string;
  description: string;
  icon: any;
  href: string;
  badge?: string;
  color: string;
  benefits: string[];
}

const tools: Tool[] = [
  {
    id: "roi-calculator",
    title: "ROI Calculator",
    description: "See exactly how much revenue you could generate with professional digital marketing services.",
    icon: Calculator,
    href: "/tools/roi-calculator",
    badge: "Most Popular",
    color: "from-accent to-secondary",
    benefits: [
      "Instant revenue projections",
      "Industry-standard benchmarks",
      "Conservative estimates",
      "12-month forecasting"
    ]
  },
  {
    id: "website-auditor",
    title: "Website Auditor",
    description: "Get a comprehensive analysis of your website's performance, SEO, security, and mobile optimization.",
    icon: Search,
    href: "/auditor",
    badge: "Featured",
    color: "from-blue-500 to-cyan-500",
    benefits: [
      "Full SEO analysis",
      "Performance scoring",
      "Mobile-friendly check",
      "Security assessment"
    ]
  },
  {
    id: "seo-checker",
    title: "SEO Health Checker",
    description: "Analyze your website's SEO performance and get actionable recommendations to rank higher.",
    icon: TrendingUp,
    href: "/tools/seo-checker",
    badge: "New",
    color: "from-green-500 to-emerald-500",
    benefits: [
      "Meta tag analysis",
      "Keyword optimization",
      "Backlink insights",
      "Technical SEO review"
    ]
  },
  {
    id: "email-tester",
    title: "Email Subject Line Tester",
    description: "Test your email subject lines and predict open rates before hitting send.",
    icon: Mail,
    href: "/tools/email-tester",
    color: "from-purple-500 to-pink-500",
    benefits: [
      "Open rate prediction",
      "Spam score check",
      "Character count",
      "Best practices tips"
    ]
  },
  {
    id: "budget-calculator",
    title: "Marketing Budget Calculator",
    description: "Plan your marketing budget effectively based on your revenue and growth goals.",
    icon: DollarSign,
    href: "/tools/budget-calculator",
    color: "from-orange-500 to-red-500",
    benefits: [
      "Revenue-based planning",
      "Channel allocation",
      "ROI expectations",
      "Industry benchmarks"
    ]
  },
  {
    id: "conversion-analyzer",
    title: "Conversion Rate Analyzer",
    description: "Understand your conversion funnel and identify opportunities to increase conversions.",
    icon: BarChart3,
    href: "/tools/conversion-analyzer",
    color: "from-indigo-500 to-blue-500",
    benefits: [
      "Funnel visualization",
      "Drop-off analysis",
      "Improvement suggestions",
      "Benchmark comparison"
    ]
  },
  {
    id: "website-need-checker",
    title: "Website Need Checker",
    description: "Find out if your business needs a website and calculate the ROI with our comprehensive assessment.",
    icon: Globe,
    href: "/tools/website-need-checker",
    badge: "New",
    color: "from-teal-500 to-green-500",
    benefits: [
      "Business assessment",
      "ROI calculation",
      "Personalized recommendations",
      "AI website builder access"
    ]
  }
];

const FreeToolsHub = () => {
  return (
    <div className="min-h-screen bg-gradient-to-br from-charcoal via-primary to-charcoal">
      {/* Hero Section */}
      <section className="pt-24 sm:pt-32 pb-12 sm:pb-20 relative overflow-hidden">
        <div className="absolute inset-0 opacity-5">
          <div className="absolute top-0 right-0 w-96 h-96 bg-accent rounded-full blur-[80px]"></div>
          <div className="absolute bottom-0 left-0 w-96 h-96 bg-secondary rounded-full blur-[80px]"></div>
        </div>

        <div className="section-container relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            className="text-center max-w-4xl mx-auto"
          >
            <div className="inline-flex items-center gap-2 bg-accent/20 backdrop-blur-none sm:backdrop-blur-sm rounded-full px-6 py-2 mb-6">
              <Sparkles className="h-5 w-5 text-accent" />
              <span className="text-accent font-semibold">100% Free Professional Tools</span>
            </div>

            <h1 className="text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold text-white mb-4 sm:mb-6 leading-tight px-4">
              Grow Your Business With
              <span className="block bg-gradient-to-r from-accent to-secondary bg-clip-text text-transparent mt-2">
                Free Marketing Tools
              </span>
            </h1>

            <p className="text-base sm:text-lg md:text-xl lg:text-2xl text-gray-200 mb-6 sm:mb-8 leading-relaxed px-4">
              Access the same professional-grade tools we use for Fortune 500 companies. 
              No credit card required. No hidden fees. Just powerful insights to help you grow.
            </p>

            <div className="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center items-stretch sm:items-center px-4">
              <Button
                size="lg"
                className="bg-accent hover:bg-accent/90 text-charcoal font-bold px-6 sm:px-8 py-4 sm:py-6 text-base sm:text-lg shadow-xl hover:shadow-2xl transition-all duration-300 btn-glow touch-target w-full sm:w-auto"
                asChild
              >
                <a href="#tools">
                  <span>Browse All Tools</span>
                  <ArrowRight className="ml-2 h-4 w-4 sm:h-5 sm:w-5" />
                </a>
              </Button>
              <Button
                size="lg"
                variant="outline"
                className="border-2 border-accent bg-white/10 text-white hover:bg-white hover:text-charcoal px-6 sm:px-8 py-4 sm:py-6 text-base sm:text-lg transition-all duration-300 touch-target w-full sm:w-auto"
                asChild
              >
                <Link href="/contact">
                  Talk to an Expert
                </Link>
              </Button>
            </div>
          </motion.div>

          {/* Trust Indicators */}
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8, delay: 0.2 }}
            className="mt-16 grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto"
          >
            {[
              { icon: Shield, label: "Built by Experts", value: "15+ Yrs" },
              { icon: Target, label: "Real Campaign Data", value: "50+ Industries" },
              { icon: Zap, label: "Quick Analysis", value: "Under 60s" },
              { icon: CheckCircle, label: "No Credit Card", value: "100% Free" }
            ].map((stat, index) => (
              <div key={index} className="bg-charcoal/90 backdrop-blur-sm rounded-xl p-6 text-center border border-accent/30 shadow-lg">
                <stat.icon className="h-8 w-8 text-accent mx-auto mb-2" />
                <p className="text-2xl font-bold text-white mb-1">{stat.value}</p>
                <p className="text-sm font-semibold text-gray-100">{stat.label}</p>
              </div>
            ))}
          </motion.div>
        </div>
      </section>

      {/* Tools Grid */}
      <section id="tools" className="py-8 sm:py-12 sm:py-20 relative">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="text-center mb-12"
          >
            <h2 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4">
              Choose Your Tool
            </h2>
            <p className="text-xl text-gray-300 max-w-3xl mx-auto">
              Each tool provides instant, actionable insights to help you make smarter marketing decisions.
            </p>
          </motion.div>

          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {tools.map((tool, index) => (
              <motion.div
                key={tool.id}
                initial={{ opacity: 0, y: 30 }}
                whileInView={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
                viewport={{ once: true }}
              >
                <Link href={tool.href}>
                  <Card className="h-full bg-white/5 backdrop-blur-none sm:backdrop-blur-sm border-white/10 hover:border-accent/50 transition-all duration-300 hover:transform hover:scale-105 cursor-pointer group">
                    <CardHeader>
                      <div className="flex items-start justify-between mb-4">
                        <div className={`bg-gradient-to-r ${tool.color} p-3 rounded-xl`}>
                          <tool.icon className="h-6 w-6 text-white" />
                        </div>
                        {tool.badge && (
                          <Badge className="bg-accent text-charcoal font-semibold">
                            {tool.badge}
                          </Badge>
                        )}
                      </div>
                      <CardTitle className="text-white text-2xl mb-2">
                        {tool.title}
                      </CardTitle>
                      <CardDescription className="text-gray-300 text-base">
                        {tool.description}
                      </CardDescription>
                    </CardHeader>
                    <CardContent>
                      <ul className="space-y-2 mb-6">
                        {tool.benefits.map((benefit, idx) => (
                          <li key={idx} className="flex items-center gap-2 text-gray-300 text-sm">
                            <CheckCircle className="h-4 w-4 text-accent flex-shrink-0" />
                            {benefit}
                          </li>
                        ))}
                      </ul>
                      <Button 
                        className={`w-full bg-gradient-to-r ${tool.color} hover:opacity-90 text-white font-bold shadow-lg hover:shadow-xl group-hover:translate-x-1 transition-all duration-300`}
                      >
                        Try It Free
                        <ArrowRight className="ml-2 h-4 w-4" />
                      </Button>
                    </CardContent>
                  </Card>
                </Link>
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* Why Use Our Tools Section */}
      <section className="py-8 sm:py-12 sm:py-20 bg-gradient-to-r from-accent/10 to-secondary/10 backdrop-blur-none sm:backdrop-blur-sm">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="text-center mb-16"
          >
            <h2 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4">
              Why Business Owners Trust Our Tools
            </h2>
            <p className="text-xl text-gray-300 max-w-3xl mx-auto">
              Built by marketing professionals with 15+ years of hands-on experience helping businesses grow.
            </p>
          </motion.div>

          <div className="grid md:grid-cols-3 gap-8">
            {[
              {
                icon: Shield,
                title: "Industry-Tested Methods",
                description: "Based on proven strategies and real-world campaign data from diverse industries."
              },
              {
                icon: Zap,
                title: "Quick Analysis",
                description: "Get actionable insights in under 60 seconds, helping you make faster decisions."
              },
              {
                icon: Globe,
                title: "Genuinely Free",
                description: "No credit card required. No hidden costs. We built these tools to help businesses succeed."
              }
            ].map((feature, index) => (
              <motion.div
                key={index}
                initial={{ opacity: 0, y: 30 }}
                whileInView={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
                viewport={{ once: true }}
                className="bg-white/5 backdrop-blur-none sm:backdrop-blur-sm rounded-xl p-8 text-center"
              >
                <div className="bg-gradient-to-r from-accent to-secondary p-4 rounded-xl w-fit mx-auto mb-6">
                  <feature.icon className="h-8 w-8 text-charcoal" />
                </div>
                <h3 className="text-2xl font-bold text-white mb-4">{feature.title}</h3>
                <p className="text-gray-300 leading-relaxed">{feature.description}</p>
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="py-8 sm:py-12 sm:py-20">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="bg-gradient-to-r from-accent to-secondary rounded-3xl p-12 text-center"
          >
            <h2 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-charcoal mb-6">
              Need Expert Help Implementing Your Results?
            </h2>
            <p className="text-xl text-charcoal/80 mb-8 max-w-3xl mx-auto">
              Our tools show you what's possible. Our team makes it happen. Let's turn these insights into real revenue growth.
            </p>
            <Button
              size="lg"
              className="bg-charcoal hover:bg-charcoal/90 text-accent font-bold px-8 py-6 text-lg btn-breathe"
              asChild
            >
              <Link href="/contact">
                Get a Free Strategy Session
                <ArrowRight className="ml-2 h-5 w-5" />
              </Link>
            </Button>
          </motion.div>
        </div>
      </section>
    </div>
  );
};

export default FreeToolsHub;

// ==========================================
// File: components/tools/roi-calculator-landing.tsx
// ==========================================


"use client";

import { motion, AnimatePresence } from "framer-motion";
import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Slider } from "@/components/ui/slider";
import { Calculator, TrendingUp, DollarSign, Users, ArrowRight, CheckCircle, Star, Award, Target, Zap, Mail, Loader2 } from "lucide-react";
import Link from "next/link";
import LoadingAnimation from "../loading-animation";
import FOMONotifications from "../fomo-notifications";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { trackRedditLead } from "@/lib/reddit-tracking";
import { trackConversion } from "@/lib/analytics";

const ROICalculatorLanding = () => {
  const [monthlyVisitors, setMonthlyVisitors] = useState(5000);
  const [conversionRate, setConversionRate] = useState(2);
  const [averageOrderValue, setAverageOrderValue] = useState(150);
  const [showResults, setShowResults] = useState(false);
  const [email, setEmail] = useState("");
  const [name, setName] = useState("");
  const [phone, setPhone] = useState("");
  const [showLeadForm, setShowLeadForm] = useState(false);
  const [showTripwire, setShowTripwire] = useState(false);
  const [tripwireOffer, setTripwireOffer] = useState<any>(null);
  const [processingCheckout, setProcessingCheckout] = useState(false);

  // Conservative improvement estimates
  const conversionImprovement = 1.5;
  const trafficImprovement = 1.3;

  // Current metrics
  const currentLeads = monthlyVisitors * (conversionRate / 100);
  const currentRevenue = currentLeads * averageOrderValue;

  // Projected metrics
  const projectedVisitors = monthlyVisitors * trafficImprovement;
  const projectedConversionRate = conversionRate * conversionImprovement;
  const projectedLeads = projectedVisitors * (projectedConversionRate / 100);
  const projectedRevenue = projectedLeads * averageOrderValue;

  // Growth metrics
  const additionalRevenue = projectedRevenue - currentRevenue;
  const yearlyAdditionalRevenue = additionalRevenue * 12;

  const handleCalculate = () => {
    setShowResults(true);
    setShowLeadForm(true);
  };

  const handleLeadSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!email || !name) {
      alert("Please enter your name and email");
      return;
    }
    
    try {
      const response = await fetch('/api/send-tool-results', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email,
          name,
          phone: phone || null,
          toolName: 'ROI Calculator',
          toolData: {
            monthlyVisitors,
            conversionRate,
            averageOrderValue
          },
          results: {
            traffic: monthlyVisitors,
            conversionRate,
            avgSale: averageOrderValue,
            currentRevenue,
            projectedRevenue,
            roi: Math.round(((projectedRevenue - currentRevenue) / currentRevenue) * 100),
            investment: Math.round(projectedRevenue * 0.15)
          }
        })
      });

      if (response.ok) {
        const data = await response.json();
        
        // Track lead conversion
        trackRedditLead(email);
        trackConversion('roi_calculator', undefined, 'USD', { email });
        
        setTripwireOffer(data.tripwireOffer);
        setShowTripwire(true);
        setShowLeadForm(false);
      } else {
        alert("Failed to send report. Please try again.");
      }
    } catch (error) {
      console.error('Error submitting lead:', error);
      alert("Failed to send report. Please try again.");
    }
  };

  const handleTripwireCheckout = async () => {
    if (!tripwireOffer) return;
    
    setProcessingCheckout(true);
    
    try {
      const response = await fetch('/api/create-tripwire-checkout', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          offerName: tripwireOffer.offerName,
          amount: tripwireOffer.discountPrice,
          originalPrice: tripwireOffer.originalPrice,
          customerEmail: email,
          customerName: name,
        }),
      });

      if (response.ok) {
        const data = await response.json();
        // Redirect to Stripe checkout
        if (data.url) {
          window.location.href = data.url;
        }
      } else {
        alert('Failed to create checkout session. Please try again.');
        setProcessingCheckout(false);
      }
    } catch (error) {
      console.error('Error creating checkout:', error);
      alert('Failed to create checkout session. Please try again.');
      setProcessingCheckout(false);
    }
  };

  const formatCurrency = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  const formatNumber = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(value);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-charcoal via-primary to-charcoal">
      <FOMONotifications />
      {/* Hero Section - Russell Brunson Style */}
      <section className="pt-20 sm:pt-24 md:pt-32 pb-6 sm:pb-8 md:pb-12 relative overflow-hidden">
        <div className="absolute inset-0 opacity-5">
          <div className="absolute top-0 right-0 w-64 h-64 sm:w-96 sm:h-96 bg-accent rounded-full blur-[80px]"></div>
          <div className="absolute bottom-0 left-0 w-64 h-64 sm:w-96 sm:h-96 bg-secondary rounded-full blur-[80px]"></div>
        </div>

        <div className="section-container relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            className="text-center max-w-5xl mx-auto px-4"
          >
            {/* Pre-headline */}
            <div className="inline-flex items-center gap-2 bg-accent/30 rounded-full px-4 sm:px-6 py-2 mb-3 sm:mb-4 md:mb-6">
              <Star className="h-4 w-4 sm:h-5 sm:w-5 text-accent flex-shrink-0" />
              <span className="text-accent font-semibold text-sm sm:text-base">Used by 10,000+ Business Owners</span>
            </div>

            {/* Main Headline - Problem/Promise */}
            <h1 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-white mb-3 sm:mb-4 md:mb-6 leading-tight">
              Discover How Much
              <span className="block bg-gradient-to-r from-accent to-secondary bg-clip-text text-transparent mt-1 sm:mt-2">
                Additional Revenue
              </span>
              You're Leaving on the Table
            </h1>

            {/* Sub-headline - Bridge */}
            <p className="text-base sm:text-lg md:text-xl lg:text-2xl text-gray-200 mb-3 sm:mb-4 md:mb-6 leading-relaxed font-semibold">
              In the next 60 seconds, you'll see exactly how much money you could be making with the right digital marketing strategy.
            </p>

            <p className="text-sm sm:text-base md:text-lg text-gray-300 mb-3 sm:mb-4 md:mb-6">
              This free calculator has helped business owners identify over <span className="text-accent font-bold">$247M in missed revenue opportunities</span>. What about yours?
            </p>

            {/* Social Proof */}
            <div className="flex flex-col sm:flex-row gap-3 sm:gap-6 justify-center items-center mb-4 sm:mb-6 md:mb-8">
              {[
                "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ 4.9/5 from 2,847 users",
                "Featured in Forbes & Entrepreneur",
                "Zero spam, 100% free forever"
              ].map((proof, index) => (
                <div key={index} className="flex items-center gap-2 text-gray-200">
                  <CheckCircle className="h-4 w-4 sm:h-5 sm:w-5 text-accent flex-shrink-0" />
                  <span className="text-sm sm:text-base">{proof}</span>
                </div>
              ))}
            </div>

            {/* Arrow Down Indicator */}
            <motion.div
              animate={{ y: [0, 10, 0] }}
              transition={{ duration: 2, repeat: Infinity }}
              className="text-accent"
            >
              <ArrowRight className="h-8 w-8 mx-auto rotate-90" />
            </motion.div>
          </motion.div>
        </div>
      </section>

      {/* Calculator Section */}
      <section className="py-6 sm:py-8 md:py-12 relative">
        <div className="section-container px-4">
          <div className="grid lg:grid-cols-2 gap-6 sm:gap-8 lg:gap-12 items-start max-w-7xl mx-auto">
            {/* Left Side - Calculator Input */}
            <motion.div
              initial={{ opacity: 0, x: -30 }}
              whileInView={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.8 }}
              viewport={{ once: true }}
              className="bg-white rounded-2xl p-4 sm:p-6 md:p-8 shadow-2xl lg:sticky lg:top-24"
            >
              <div className="flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4 md:mb-6">
                <div className="bg-gradient-to-r from-accent to-secondary p-2 rounded-xl flex-shrink-0">
                  <Calculator className="h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 text-charcoal" />
                </div>
                <div>
                  <h3 className="text-lg sm:text-xl md:text-2xl font-bold text-gray-900">Step 1: Enter Your Numbers</h3>
                  <p className="text-xs sm:text-sm md:text-base text-gray-600">Takes 30 seconds</p>
                </div>
              </div>
              
              <div className="space-y-6 sm:space-y-6 sm:space-y-8">
                {/* Monthly Visitors */}
                <div>
                  <Label htmlFor="visitors" className="text-gray-900 font-semibold mb-2 block text-sm sm:text-base md:text-lg">
                    Monthly Website Visitors
                  </Label>
                  <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 mb-2">
                    <Slider
                      id="visitors"
                      min={100}
                      max={100000}
                      step={100}
                      value={[monthlyVisitors]}
                      onValueChange={(value) => setMonthlyVisitors(value[0])}
                      className="flex-1 touch-target"
                    />
                    <Input
                      type="number"
                      value={monthlyVisitors}
                      onChange={(e) => setMonthlyVisitors(Number(e.target.value))}
                      className="w-full sm:w-32 text-sm sm:text-base md:text-lg font-bold h-10 sm:h-10 sm:h-12"
                    />
                  </div>
                  <p className="text-xs sm:text-sm text-gray-500">
                    üí° Check Google Analytics or estimate based on your industry
                  </p>
                </div>

                {/* Conversion Rate */}
                <div>
                  <Label htmlFor="conversion" className="text-gray-900 font-semibold mb-2 block text-sm sm:text-base md:text-lg">
                    Current Conversion Rate (%)
                  </Label>
                  <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 mb-2">
                    <Slider
                      id="conversion"
                      min={0.5}
                      max={10}
                      step={0.1}
                      value={[conversionRate]}
                      onValueChange={(value) => setConversionRate(value[0])}
                      className="flex-1 touch-target"
                    />
                    <Input
                      type="number"
                      value={conversionRate}
                      onChange={(e) => setConversionRate(Number(e.target.value))}
                      className="w-full sm:w-32 text-sm sm:text-base md:text-lg font-bold h-10 sm:h-10 sm:h-12"
                      step="0.1"
                    />
                  </div>
                  <p className="text-xs sm:text-sm text-gray-500">
                    üí° Industry average is 2-3% (visitors who become customers)
                  </p>
                </div>

                {/* Average Order Value */}
                <div>
                  <Label htmlFor="aov" className="text-gray-900 font-semibold mb-2 block text-sm sm:text-base md:text-lg">
                    Average Customer Value ($)
                  </Label>
                  <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 mb-2">
                    <Slider
                      id="aov"
                      min={50}
                      max={5000}
                      step={10}
                      value={[averageOrderValue]}
                      onValueChange={(value) => setAverageOrderValue(value[0])}
                      className="flex-1 touch-target"
                    />
                    <Input
                      type="number"
                      value={averageOrderValue}
                      onChange={(e) => setAverageOrderValue(Number(e.target.value))}
                      className="w-full sm:w-32 text-sm sm:text-base md:text-lg font-bold h-10 sm:h-10 sm:h-12"
                    />
                  </div>
                  <p className="text-xs sm:text-sm text-gray-500">
                    üí° Average revenue per customer or order value
                  </p>
                </div>

                <Button 
                  onClick={handleCalculate}
                  className="w-full bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold py-3 sm:py-4 md:py-5 text-base sm:text-lg md:text-xl btn-breathe btn-glow shadow-xl touch-target"
                >
                  <span>Show Me My Potential Revenue</span>
                  <ArrowRight className="ml-2 h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6" />
                </Button>

                <p className="text-center text-xs text-gray-500">
                  üîí Your information is safe. We never share or sell your data.
                </p>
              </div>
            </motion.div>

            {/* Right Side - Results & Benefits */}
            <div className="space-y-6 sm:space-y-8">
              {/* Results Section */}
              {showResults ? (
                <motion.div
                  initial={{ opacity: 0, x: 30 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ duration: 0.8 }}
                  className="bg-gradient-to-br from-accent/10 to-secondary/10 backdrop-blur-none sm:backdrop-blur-sm rounded-2xl p-8 border-2 border-accent/20"
                >
                  <div className="flex items-center gap-3 mb-6">
                    <div className="bg-gradient-to-r from-accent to-secondary p-3 rounded-xl">
                      <Target className="h-6 w-6 text-charcoal" />
                    </div>
                    <div>
                      <h3 className="text-2xl font-bold text-white">Your Revenue Potential</h3>
                      <p className="text-gray-300">Based on conservative estimates</p>
                    </div>
                  </div>
                  
                  {/* Big Number */}
                  <div className="bg-gradient-to-r from-accent to-secondary rounded-2xl p-8 mb-6 text-center">
                    <p className="text-charcoal text-lg font-semibold mb-2">You Could Generate An Additional</p>
                    <p className="text-5xl md:text-6xl font-bold text-charcoal mb-2">
                      {formatCurrency(yearlyAdditionalRevenue)}
                    </p>
                    <p className="text-charcoal text-xl font-semibold">Per Year With Professional Marketing</p>
                  </div>

                  {/* Breakdown */}
                  <div className="grid grid-cols-2 gap-4 mb-6">
                    <Card className="bg-white/10 border-white/20">
                      <CardContent className="p-6 text-center">
                        <DollarSign className="h-8 w-8 text-accent mx-auto mb-2" />
                        <p className="text-2xl font-bold text-white">{formatCurrency(additionalRevenue)}</p>
                        <p className="text-sm text-gray-300">Additional Monthly Revenue</p>
                      </CardContent>
                    </Card>
                    <Card className="bg-white/10 border-white/20">
                      <CardContent className="p-6 text-center">
                        <Users className="h-8 w-8 text-secondary mx-auto mb-2" />
                        <p className="text-2xl font-bold text-white">{formatNumber(projectedLeads - currentLeads)}</p>
                        <p className="text-sm text-gray-300">More Customers/Month</p>
                      </CardContent>
                    </Card>
                  </div>

                  {/* Lead Capture Form - Russell Brunson Style */}
                  {showLeadForm && (
                    <motion.div
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ duration: 0.5 }}
                      className="bg-white rounded-xl p-6 mt-6"
                    >
                      <div className="flex items-center gap-2 mb-4">
                        <Mail className="h-5 w-5 text-accent" />
                        <h4 className="text-xl font-bold text-gray-900">
                          Want a Detailed Roadmap to Achieve This?
                        </h4>
                      </div>
                      <p className="text-gray-600 mb-4">
                        Enter your email and we'll send you a personalized action plan showing exactly how to reach these numbers.
                      </p>
                      <form onSubmit={handleLeadSubmit} className="space-y-4">
                        <Input
                          type="text"
                          placeholder="Your Name *"
                          value={name}
                          onChange={(e) => setName(e.target.value)}
                          required
                          className="text-lg"
                        />
                        <Input
                          type="email"
                          placeholder="Your Email Address *"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                          required
                          className="text-lg"
                        />
                        <Input
                          type="tel"
                          placeholder="Phone Number (Optional)"
                          value={phone}
                          onChange={(e) => setPhone(e.target.value)}
                          className="text-lg"
                        />
                        <Button
                          type="submit"
                          className="w-full bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-charcoal font-bold py-6 text-lg"
                        >
                          Send Me My Custom Roadmap
                          <ArrowRight className="ml-2 h-5 w-5" />
                        </Button>
                      </form>
                      <p className="text-xs text-gray-500 text-center mt-2">
                        Plus get a free 30-minute strategy call ($500 value)
                      </p>
                    </motion.div>
                  )}

                  {/* Tripwire Offer */}
                  {showTripwire && tripwireOffer && (
                    <motion.div
                      initial={{ opacity: 0, scale: 0.95 }}
                      animate={{ opacity: 1, scale: 1 }}
                      transition={{ duration: 0.5 }}
                      className="bg-gradient-to-br from-accent to-secondary rounded-2xl p-8 text-charcoal shadow-2xl"
                    >
                      <div className="text-center mb-6">
                        <div className="inline-block bg-red-500 text-white font-bold text-sm px-4 py-2 rounded-full mb-4">
                          {tripwireOffer.urgency}
                        </div>
                        <h2 className="text-4xl font-bold mb-3">
                          üéâ Check Your Email!
                        </h2>
                        <p className="text-xl">
                          Your ROI report is on its way. But before you go...
                        </p>
                      </div>

                      <div className="bg-white/20 backdrop-blur-none sm:backdrop-blur-sm rounded-xl p-6 mb-6">
                        <h3 className="text-3xl font-bold mb-3">{tripwireOffer.title}</h3>
                        <div className="flex items-center gap-4 mb-4">
                          <span className="text-5xl font-bold">${tripwireOffer.discountPrice}</span>
                          <div>
                            <span className="text-xl line-through opacity-75">${tripwireOffer.originalPrice}</span>
                            <span className="ml-2 bg-red-500 text-white text-sm font-bold px-2 py-1 rounded">
                              Save ${tripwireOffer.savings}
                            </span>
                          </div>
                        </div>
                        <ul className="space-y-2 mb-6">
                          {tripwireOffer.features.map((feature: string, index: number) => (
                            <li key={index} className="flex items-start gap-2">
                              <CheckCircle className="h-5 w-5 flex-shrink-0 mt-0.5" />
                              <span>{feature}</span>
                            </li>
                          ))}
                        </ul>
                      </div>

                      <div className="grid sm:grid-cols-2 gap-4">
                        <Button
                          size="lg"
                          className="bg-charcoal hover:bg-charcoal/90 text-white font-bold py-6 text-lg w-full"
                          onClick={handleTripwireCheckout}
                          disabled={processingCheckout}
                        >
                          {processingCheckout ? (
                            <>
                              <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                              Processing...
                            </>
                          ) : (
                            <>
                              {tripwireOffer.cta}
                              <ArrowRight className="ml-2 h-5 w-5" />
                            </>
                          )}
                        </Button>
                        <Button
                          size="lg"
                          variant="outline"
                          className="bg-transparent border-2 border-charcoal text-charcoal hover:bg-charcoal/10 font-semibold py-6 text-lg w-full"
                          asChild
                        >
                          <Link href="/tools">
                            Maybe Later
                          </Link>
                        </Button>
                      </div>

                      <p className="text-center text-sm mt-4">
                        ‚ö° {tripwireOffer.urgency} ‚Ä¢ 60-Day Money-Back Guarantee
                      </p>
                    </motion.div>
                  )}
                </motion.div>
              ) : (
                <motion.div
                  initial={{ opacity: 0, x: 30 }}
                  whileInView={{ opacity: 1, x: 0 }}
                  transition={{ duration: 0.8 }}
                  viewport={{ once: true }}
                  className="bg-white/5 backdrop-blur-none sm:backdrop-blur-sm rounded-2xl p-12 border border-white/10 text-center"
                >
                  <Calculator className="h-16 w-16 text-accent mx-auto mb-4 opacity-50" />
                  <p className="text-gray-300 text-lg">
                    üëà Enter your numbers to see your potential
                  </p>
                </motion.div>
              )}

              {/* Why Trust Us */}
              <motion.div
                initial={{ opacity: 0, y: 30 }}
                whileInView={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.8 }}
                viewport={{ once: true }}
                className="bg-white/5 backdrop-blur-none sm:backdrop-blur-sm rounded-2xl p-8"
              >
                <h3 className="text-2xl font-bold text-white mb-6">Why These Numbers Are Accurate</h3>
                <div className="space-y-4">
                  {[
                    {
                      icon: Award,
                      title: "Based on Real Client Data",
                      description: "We've analyzed 1,000+ campaigns across 50+ industries"
                    },
                    {
                      icon: TrendingUp,
                      title: "Conservative Estimates",
                      description: "Our projections use industry benchmarks, not best-case scenarios"
                    },
                    {
                      icon: Zap,
                      title: "Proven System",
                      description: "The same strategies we use for Fortune 500 companies"
                    }
                  ].map((item, index) => (
                    <div key={index} className="flex gap-4">
                      <div className="bg-gradient-to-r from-accent to-secondary p-2 rounded-lg h-fit">
                        <item.icon className="h-5 w-5 text-charcoal" />
                      </div>
                      <div>
                        <h4 className="text-white font-semibold mb-1">{item.title}</h4>
                        <p className="text-gray-400 text-sm">{item.description}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </motion.div>
            </div>
          </div>
        </div>
      </section>

      {/* Social Proof Section */}
      <section className="py-8 sm:py-12 md:py-16 bg-white/5">
        <div className="section-container px-4">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="text-center mb-8 sm:mb-12"
          >
            <h2 className="text-base sm:text-lg md:text-xl lg:text-4xl font-bold text-white mb-3 sm:mb-4">
              Real Results From Real Businesses
            </h2>
            <p className="text-base sm:text-lg md:text-base sm:text-lg md:text-xl text-gray-300">
              These companies used this calculator, then hired us to make it happen
            </p>
          </motion.div>

          <div className="grid md:grid-cols-3 gap-8">
            {[
              {
                name: "Sarah M.",
                company: "E-commerce Store",
                result: "+847% ROI in 6 months",
                quote: "The calculator showed $180K potential. We hit $220K in added revenue."
              },
              {
                name: "Mike R.",
                company: "SaaS Company",
                result: "+340% Lead Growth",
                quote: "Skeptical at first, but the projections were actually conservative."
              },
              {
                name: "Jennifer L.",
                company: "Local Service Business",
                result: "+$94K in 4 months",
                quote: "This calculator opened my eyes to what's possible. Best decision ever."
              }
            ].map((testimonial, index) => (
              <motion.div
                key={index}
                initial={{ opacity: 0, y: 30 }}
                whileInView={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
                viewport={{ once: true }}
                className="bg-white/10 backdrop-blur-none sm:backdrop-blur-sm rounded-xl p-6"
              >
                <div className="flex gap-1 mb-4">
                  {[...Array(5)].map((_, i) => (
                    <Star key={i} className="h-5 w-5 fill-accent text-accent" />
                  ))}
                </div>
                <p className="text-white text-lg font-semibold mb-4">"{testimonial.quote}"</p>
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-white font-semibold">{testimonial.name}</p>
                    <p className="text-gray-400 text-sm">{testimonial.company}</p>
                  </div>
                  <div className="text-right">
                    <p className="text-accent font-bold text-lg">{testimonial.result}</p>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* Final CTA */}
      <section className="py-8 sm:py-12 md:py-16">
        <div className="section-container px-4">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="bg-gradient-to-r from-accent to-secondary rounded-2xl sm:rounded-3xl p-6 sm:p-8 md:p-12 text-center"
          >
            <h2 className="text-base sm:text-lg md:text-xl lg:text-4xl font-bold text-charcoal mb-3 sm:mb-4 md:mb-6">
              Ready to Turn These Numbers Into Reality?
            </h2>
            <p className="text-base sm:text-lg md:text-xl text-charcoal/80 mb-4 sm:mb-6 md:mb-8 max-w-3xl mx-auto">
              The calculator shows what's possible. Our team makes it happen. Book a free strategy session and let's build your roadmap to growth.
            </p>
            <div className="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
              <Button
                size="lg"
                className="bg-charcoal hover:bg-charcoal/90 text-accent font-bold px-6 sm:px-8 py-4 sm:py-5 md:py-6 text-base sm:text-lg"
                asChild
              >
                <Link href="/contact">
                  Get My Free Strategy Session
                  <ArrowRight className="ml-2 h-4 w-4 sm:h-5 sm:w-5" />
                </Link>
              </Button>
              <Button
                size="lg"
                variant="outline"
                className="border-2 border-charcoal text-charcoal hover:bg-charcoal hover:text-accent px-6 sm:px-8 py-4 sm:py-5 md:py-6 text-base sm:text-lg"
                asChild
              >
                <Link href="/tools">
                  Try Another Free Tool
                </Link>
              </Button>
            </div>
            <p className="text-charcoal/60 text-xs sm:text-sm mt-3 sm:mt-4">
              üí∞ First 50 signups this month get a free marketing audit ($2,500 value)
            </p>
          </motion.div>
        </div>
      </section>
    </div>
  );
};

export default ROICalculatorLanding;

// ==========================================
// File: components/tools/seo-checker-landing.tsx
// ==========================================

"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { TrendingUp, Search, ArrowRight, CheckCircle, Star, AlertCircle, Globe, FileText, Link as LinkIcon, Award, Target, Mail, Loader2 } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Card, CardContent } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { Badge } from "@/components/ui/badge";
import { toast } from "react-hot-toast";
import { trackRedditLead } from "@/lib/reddit-tracking";
import { trackConversion } from "@/lib/analytics";
import Link from "next/link";
import LoadingAnimation from "../loading-animation";
import FOMONotifications from "../fomo-notifications";

interface SEOResult {
  score: number;
  titleTag: { exists: boolean; length: number; optimized: boolean };
  metaDescription: { exists: boolean; length: number; optimized: boolean };
  headings: { h1Count: number; h2Count: number; optimized: boolean };
  keywords: { density: number; distribution: string };
  issues: string[];
  recommendations: string[];
}

const SEOCheckerLanding = () => {
  const [url, setUrl] = useState("");
  const [keyword, setKeyword] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [result, setResult] = useState<SEOResult | null>(null);
  const [email, setEmail] = useState("");
  const [name, setName] = useState("");
  const [phone, setPhone] = useState("");
  const [showLeadForm, setShowLeadForm] = useState(false);
  const [showTripwire, setShowTripwire] = useState(false);
  const [tripwireOffer, setTripwireOffer] = useState<any>(null);
  const [processingCheckout, setProcessingCheckout] = useState(false);

  const handleCheck = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!url || !keyword) {
      toast.error("Please enter both URL and target keyword");
      return;
    }

    setIsLoading(true);
    
    // Simulate SEO check with loading animation
    setTimeout(() => {
      const mockResult: SEOResult = {
        score: Math.floor(Math.random() * 40) + 50,
        titleTag: {
          exists: true,
          length: 58,
          optimized: Math.random() > 0.5
        },
        metaDescription: {
          exists: true,
          length: 142,
          optimized: Math.random() > 0.3
        },
        headings: {
          h1Count: 1,
          h2Count: 5,
          optimized: Math.random() > 0.4
        },
        keywords: {
          density: 2.5,
          distribution: "Good"
        },
        issues: [
          "Missing alt text on 3 images",
          "Page load time is 3.2s (should be under 2s)",
          "No schema markup found",
          "Internal linking structure needs improvement"
        ],
        recommendations: [
          "Add target keyword to H1 heading",
          "Optimize images for faster loading",
          "Create more internal links to this page",
          "Add FAQ schema markup",
          "Improve content length (current: 450 words, target: 1500+)"
        ]
      };
      
      setResult(mockResult);
      setShowLeadForm(true);
      setIsLoading(false);
    }, 4000);
  };

  const handleLeadSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!email || !name) {
      toast.error("Please enter your name and email");
      return;
    }
    
    try {
      const response = await fetch('/api/send-tool-results', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email,
          name,
          phone: phone || null, // Phone is optional
          toolName: 'SEO Checker',
          toolData: { url, keyword },
          results: result
        })
      });

      if (response.ok) {
        const data = await response.json();
        // Track lead conversion
        trackRedditLead(email);
        trackConversion('seo_checker', undefined, 'USD', { email });
        
        setTripwireOffer(data.tripwireOffer);
        setShowTripwire(true);
        setShowLeadForm(false);
        toast.success("‚úÖ Your detailed SEO report has been sent to your email!");
      } else {
        toast.error("Failed to send report. Please try again.");
      }
    } catch (error) {
      toast.error("Failed to send report. Please try again.");
    }
  };

  const handleTripwireCheckout = async () => {
    if (!tripwireOffer) return;
    
    setProcessingCheckout(true);
    
    try {
      const response = await fetch("/api/create-tripwire-checkout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          offerName: tripwireOffer.offerName,
          amount: tripwireOffer.discountPrice,
          originalPrice: tripwireOffer.originalPrice,
          customerEmail: email,
          customerName: name,
        }),
      });

      if (response.ok) {
        const data = await response.json();
        if (data.url) {
          window.location.href = data.url;
        }
      } else {
        toast.error("Failed to create checkout session. Please try again.");
        setProcessingCheckout(false);
      }
    } catch (error) {
      console.error("Error creating checkout:", error);
      toast.error("Failed to create checkout session. Please try again.");
      setProcessingCheckout(false);
    }
  };

  return (
    <>
      <AnimatePresence>
        {isLoading && (
          <LoadingAnimation 
            toolName="SEO Analysis"
            messages={[
              'üîç Scanning your website...',
              'üìä Analyzing SEO factors...',
              'üéØ Checking keyword optimization...',
              '‚ú® Generating recommendations...'
            ]}
            duration={4000}
          />
        )}
      </AnimatePresence>
      
      <div className="min-h-screen bg-gradient-to-br from-charcoal via-primary to-charcoal">
      <FOMONotifications />
        {/* Hero Section */}
        <section className="pt-24 md:pt-32 pb-8 md:pb-12 px-4 relative overflow-hidden">
        <div className="absolute inset-0 opacity-5">
          <div className="absolute top-0 right-0 w-96 h-96 bg-green-500 rounded-full blur-[80px]"></div>
          <div className="absolute bottom-0 left-0 w-96 h-96 bg-emerald-500 rounded-full blur-[80px]"></div>
        </div>

        <div className="section-container relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            className="text-center max-w-5xl mx-auto"
          >
            <div className="inline-flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-6 py-2 mb-6 border border-green-400/30">
              <TrendingUp className="h-5 w-5 text-white" />
              <span className="text-white font-semibold drop-shadow-lg">Rank Higher on Google</span>
            </div>

            <h1 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-white mb-4 md:mb-6 leading-tight px-2">
              Is Your Website
              <span className="block bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                Invisible to Google?
              </span>
            </h1>

            <p className="text-xl sm:text-base sm:text-lg md:text-xl lg:text-2xl text-gray-300 mb-6 md:mb-8 leading-relaxed font-semibold px-2">
              Find out in 30 seconds what's keeping you off page 1 and how to fix it.
            </p>

            <p className="text-base md:text-lg lg:text-xl text-gray-400 mb-6 md:mb-8 px-4">
              93% of online experiences start with a search engine. If you're not on page 1, you're invisible.
            </p>
          </motion.div>

          {/* SEO Check Form */}
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8, delay: 0.2 }}
            className="max-w-3xl mx-auto px-4"
          >
            <Card className="bg-white shadow-2xl">
              <CardContent className="p-6 md:p-8">
                <form onSubmit={handleCheck} className="space-y-6">
                  <div>
                    <Label htmlFor="url" className="text-gray-900 font-semibold text-lg mb-3 block">
                      Your Website URL
                    </Label>
                    <div className="relative">
                      <Globe className="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                      <Input
                        id="url"
                        type="url"
                        placeholder="https://yourwebsite.com"
                        value={url}
                        onChange={(e) => setUrl(e.target.value)}
                        className="pl-12 text-lg py-6"
                        required
                      />
                    </div>
                  </div>

                  <div>
                    <Label htmlFor="keyword" className="text-gray-900 font-semibold text-lg mb-3 block">
                      Target Keyword
                    </Label>
                    <div className="relative">
                      <Search className="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                      <Input
                        id="keyword"
                        type="text"
                        placeholder="e.g., digital marketing services"
                        value={keyword}
                        onChange={(e) => setKeyword(e.target.value)}
                        className="pl-12 text-lg py-6"
                        required
                      />
                    </div>
                  </div>

                  <Button
                    type="submit"
                    disabled={isLoading}
                    className="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold py-3 sm:py-4 md:py-5 text-base sm:text-lg md:text-xl"
                  >
                    {isLoading ? "Analyzing SEO..." : "Check My SEO"}
                    <Search className="ml-2 h-5 w-5" />
                  </Button>
                </form>
              </CardContent>
            </Card>
          </motion.div>
        </div>
      </section>

      {/* Results Section */}
      {result && (
        <section className="py-8 sm:py-12 md:py-16">
          <div className="section-container">
            <motion.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8 }}
              className="max-w-6xl mx-auto space-y-6 sm:space-y-8"
            >
              {/* Score Card */}
              <Card className="bg-gradient-to-br from-green-500/10 to-emerald-500/10 backdrop-blur-none sm:backdrop-blur-sm border-2 border-green-500/20">
                <CardContent className="p-8 text-center">
                  <h2 className="text-3xl font-bold text-white mb-4">Your SEO Score</h2>
                  <div className="text-8xl font-bold mb-4">
                    <span className={result.score >= 80 ? "text-green-500" : result.score >= 60 ? "text-yellow-500" : "text-red-500"}>
                      {result.score}
                    </span>
                    <span className="text-4xl text-gray-400">/100</span>
                  </div>
                  <Progress value={result.score} className="h-3 mb-4" />
                  <p className="text-base sm:text-lg md:text-xl text-gray-300">
                    {result.score >= 80 ? "Great! But there's still room for improvement." :
                     result.score >= 60 ? "Good start, but you're missing opportunities." :
                     "Your competitors are ranking higher. Let's fix this."}
                  </p>
                </CardContent>
              </Card>

              {/* Issues & Recommendations */}
              <div className="grid md:grid-cols-2 gap-8">
                <Card className="bg-red-500/10 border-red-500/20">
                  <CardContent className="p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <AlertCircle className="h-6 w-6 text-red-500" />
                      <h3 className="text-xl font-bold text-white">Issues Found</h3>
                    </div>
                    <ul className="space-y-3">
                      {result.issues.map((issue, index) => (
                        <li key={index} className="flex items-start gap-2 text-gray-300">
                          <span className="text-red-500 mt-1">‚úï</span>
                          <span>{issue}</span>
                        </li>
                      ))}
                    </ul>
                  </CardContent>
                </Card>

                <Card className="bg-green-500/10 border-green-500/20">
                  <CardContent className="p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <CheckCircle className="h-6 w-6 text-green-500" />
                      <h3 className="text-xl font-bold text-white">Quick Wins</h3>
                    </div>
                    <ul className="space-y-3">
                      {result.recommendations.slice(0, 4).map((rec, index) => (
                        <li key={index} className="flex items-start gap-2 text-gray-300">
                          <span className="text-green-500 mt-1">‚úì</span>
                          <span>{rec}</span>
                        </li>
                      ))}
                    </ul>
                  </CardContent>
                </Card>
              </div>

              {/* Lead Capture */}
              {showLeadForm && (
                <motion.div
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.5 }}
                  className="bg-white rounded-2xl p-8 max-w-2xl mx-auto"
                >
                  <div className="flex items-center gap-3 mb-4">
                    <Mail className="h-6 w-6 text-green-500" />
                    <h3 className="text-2xl font-bold text-gray-900">
                      Want a Step-by-Step SEO Roadmap?
                    </h3>
                  </div>
                  <p className="text-gray-600 mb-6">
                    Get a detailed PDF showing exactly how to fix every issue and outrank your competitors. Plus, schedule a free consultation with our SEO experts.
                  </p>
                  <form onSubmit={handleLeadSubmit} className="space-y-4">
                    <div className="space-y-4">
                      <Input
                        type="text"
                        placeholder="Your Name *"
                        value={name}
                        onChange={(e) => setName(e.target.value)}
                        required
                        className="text-lg"
                      />
                      <Input
                        type="email"
                        placeholder="Your Email *"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        required
                        className="text-lg"
                      />
                      <Input
                        type="tel"
                        placeholder="Phone Number (Optional)"
                        value={phone}
                        onChange={(e) => setPhone(e.target.value)}
                        className="text-lg"
                      />
                    </div>
                    <Button
                      type="submit"
                      className="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold py-6 text-lg"
                    >
                      Send Me My SEO Roadmap
                      <ArrowRight className="ml-2 h-5 w-5" />
                    </Button>
                  </form>
                  <p className="text-xs text-gray-500 text-center mt-3">
                    üéÅ Plus get a free competitor analysis ($750 value)
                  </p>
                </motion.div>
              )}

              {/* Tripwire Offer */}
              {showTripwire && tripwireOffer && (
                <motion.div
                  initial={{ opacity: 0, scale: 0.95 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ duration: 0.5 }}
                  className="bg-gradient-to-br from-green-500 to-emerald-500 rounded-2xl p-8 max-w-3xl mx-auto text-white shadow-2xl"
                >
                  <div className="text-center mb-6">
                    <Badge className="bg-white text-green-600 font-bold text-sm px-4 py-1 mb-4">
                      {tripwireOffer.urgency}
                    </Badge>
                    <h2 className="text-4xl font-bold mb-3">
                      üéâ Check Your Email!
                    </h2>
                    <p className="text-xl text-white/90">
                      Your SEO report is on its way. But before you go...
                    </p>
                  </div>

                  <div className="bg-white/10 backdrop-blur-none sm:backdrop-blur-sm rounded-xl p-6 mb-6">
                    <h3 className="text-3xl font-bold mb-3">{tripwireOffer.title}</h3>
                    <div className="flex items-center gap-4 mb-4">
                      <span className="text-5xl font-bold">${tripwireOffer.discountPrice}</span>
                      <div>
                        <span className="text-xl line-through opacity-75">${tripwireOffer.originalPrice}</span>
                        <Badge className="ml-2 bg-red-500 text-white">Save ${tripwireOffer.savings}</Badge>
                      </div>
                    </div>
                    <ul className="space-y-2 mb-6">
                      {tripwireOffer.features.map((feature: string, index: number) => (
                        <li key={index} className="flex items-start gap-2">
                          <CheckCircle className="h-5 w-5 text-white flex-shrink-0 mt-0.5" />
                          <span>{feature}</span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  <div className="grid sm:grid-cols-2 gap-4">
                    <Button
                      size="lg"
                      className="bg-white hover:bg-gray-100 text-green-600 font-bold py-6 text-lg w-full"
                      onClick={handleTripwireCheckout}
                      disabled={processingCheckout}
                    >
                      {processingCheckout ? (
                        <>
                          <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                          Processing...
                        </>
                      ) : (
                        <>
                          {tripwireOffer.cta}
                          <ArrowRight className="ml-2 h-5 w-5" />
                        </>
                      )}
                    </Button>
                    <Button
                      size="lg"
                      variant="outline"
                      className="bg-transparent border-2 border-white text-white hover:bg-white/10 font-semibold py-6 text-lg w-full"
                      asChild
                    >
                      <Link href="/tools">
                        Maybe Later
                      </Link>
                    </Button>
                  </div>

                  <p className="text-center text-sm text-white/80 mt-4">
                    ‚ö° {tripwireOffer.urgency} ‚Ä¢ 60-Day Money-Back Guarantee
                  </p>
                </motion.div>
              )}
            </motion.div>
          </div>
        </section>
      )}

      {/* CTA */}
      <section className="py-8 sm:py-12 md:py-16">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="bg-gradient-to-r from-green-500 to-emerald-500 rounded-2xl sm:rounded-3xl p-6 sm:p-8 md:p-12 text-center"
          >
            <h2 className="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-6">
              Ready to Dominate Page 1?
            </h2>
            <p className="text-xl text-white/80 mb-8 max-w-3xl mx-auto">
              Our SEO experts have helped 500+ businesses reach the top of Google. Let us do the same for you.
            </p>
            <Button
              size="lg"
              className="bg-white hover:bg-gray-100 text-green-600 font-bold px-6 sm:px-8 py-4 sm:py-5 md:py-6 text-base sm:text-lg"
              asChild
            >
              <Link href="/contact">
                Get Professional SEO Help
                <ArrowRight className="ml-2 h-5 w-5" />
              </Link>
            </Button>
          </motion.div>
        </div>
      </section>
    </div>
    </>
  );
};

export default SEOCheckerLanding;

// ==========================================
// File: components/tools/website-auditor-landing.tsx
// ==========================================


"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { useSession } from "next-auth/react";
import { 
  Search, 
  CheckCircle2, 
  XCircle, 
  AlertCircle, 
  TrendingUp, 
  Smartphone, 
  Shield, 
  Zap,
  Target,
  Mail,
  Globe,
  ArrowRight,
  Award,
  BarChart3,
  Star,
  Sparkles,
  Lock,
  RefreshCw
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Card, CardContent } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { Badge } from "@/components/ui/badge";
import { toast } from "react-hot-toast";
import Link from "next/link";
import LoadingAnimation from "../loading-animation";
import { trackRedditLead } from "@/lib/reddit-tracking";
import { trackConversion } from "@/lib/analytics";
import FOMONotifications from "../fomo-notifications";

interface AuditResult {
  overall_score: number;
  seo_score: number;
  performance_score: number;
  mobile_score: number;
  security_score: number;
  findings: {
    critical: string[];
    warnings: string[];
    good: string[];
  };
  recommendations: string[];
  explanations: {
    overall: string;
    seo: string;
    performance: string;
    mobile: string;
    security: string;
  };
}

const WebsiteAuditorLanding = () => {
  const { data: session } = useSession();
  const [url, setUrl] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [result, setResult] = useState<AuditResult | null>(null);
  const [email, setEmail] = useState("");
  const [name, setName] = useState("");
  const [showLeadForm, setShowLeadForm] = useState(false);

  const handleAudit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!url) {
      toast.error("Please enter a website URL");
      return;
    }

    setIsLoading(true);
    
    try {
      const response = await fetch('/api/audit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      });

      if (!response.ok) throw new Error('Audit failed');

      const data = await response.json();
      setResult(data);
      setShowLeadForm(true);
    } catch (error) {
      toast.error("Failed to audit website. Please check the URL and try again.");
    } finally {
      setIsLoading(false);
    }
  };

  const handleLeadSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    try {
      const response = await fetch('/api/leads', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email,
          name,
          source: 'Website Auditor',
          tags: ['website-auditor', 'free-tool'],
          notes: `Audited: ${url}, Overall Score: ${result?.overall_score}/100, Critical Issues: ${result?.findings.critical.length || 0}`
        })
      });

      if (response.ok) {
        // Track lead conversion - dual tracking (client-side + server-side)
        trackRedditLead(email);
        trackConversion('website_auditor', undefined, 'USD', {
          email,
          url,
          score: result?.overall_score,
        });
        
        toast.success("Report sent! Check your email for the full analysis.");
        window.location.href = '/contact';
      }
    } catch (error) {
      toast.error("Failed to send report. Please try again.");
    }
  };

  const getScoreColor = (score: number) => {
    if (score >= 80) return "text-green-500";
    if (score >= 60) return "text-yellow-500";
    return "text-red-500";
  };

  const getScoreBg = (score: number) => {
    if (score >= 80) return "bg-green-500";
    if (score >= 60) return "bg-yellow-500";
    return "bg-red-500";
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-charcoal via-primary to-charcoal">
      <FOMONotifications />
      {/* Hero Section */}
      <section className="pt-20 sm:pt-24 md:pt-32 pb-6 sm:pb-8 md:pb-12 relative overflow-hidden">
        <div className="absolute inset-0 opacity-5">
          <div className="absolute top-0 right-0 w-96 h-96 bg-blue-500 rounded-full blur-[80px]"></div>
          <div className="absolute bottom-0 left-0 w-96 h-96 bg-cyan-500 rounded-full blur-[80px]"></div>
        </div>

        <div className="section-container relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            className="text-center max-w-5xl mx-auto"
          >
            {/* Pre-headline */}
            <div className="inline-flex items-center gap-2 bg-blue-500/20 backdrop-blur-none sm:backdrop-blur-sm rounded-full px-6 py-2 mb-6">
              <Sparkles className="h-5 w-5 text-blue-400" />
              <span className="text-blue-400 font-semibold">Professional-Grade Website Analysis</span>
            </div>

            {/* Main Headline */}
            <h1 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-white mb-6 leading-tight">
              Is Your Website
              <span className="block bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                Costing You Customers?
              </span>
            </h1>

            {/* Sub-headline */}
            <p className="text-base sm:text-lg md:text-xl lg:text-2xl text-gray-300 mb-8 leading-relaxed font-semibold">
              Get a comprehensive website audit in 30 seconds and discover the hidden issues driving visitors away.
            </p>

            <p className="text-xl text-gray-400 mb-8">
              We've audited <span className="text-blue-400 font-bold">15,000+ websites</span> and found that 87% have critical issues they don't know about. Does yours?
            </p>

            {/* Social Proof */}
            <div className="flex flex-col sm:flex-row gap-6 justify-center items-center mb-12">
              {[
                "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ Rated 4.9/5",
                "15,000+ audits completed",
                "100% free, forever"
              ].map((proof, index) => (
                <div key={index} className="flex items-center gap-2 text-gray-300">
                  <CheckCircle2 className="h-5 w-5 text-blue-400" />
                  <span className="text-sm">{proof}</span>
                </div>
              ))}
            </div>
          </motion.div>

          {/* Audit Form */}
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8, delay: 0.2 }}
            className="max-w-3xl mx-auto"
          >
            <Card className="bg-white shadow-2xl">
              <CardContent className="p-8">
                <form onSubmit={handleAudit} className="space-y-6">
                  <div>
                    <Label htmlFor="url" className="text-gray-900 font-semibold text-lg mb-3 block">
                      Enter Your Website URL
                    </Label>
                    <div className="flex gap-4">
                      <div className="flex-1 relative">
                        <Globe className="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                        <Input
                          id="url"
                          type="url"
                          placeholder="https://yourwebsite.com"
                          value={url}
                          onChange={(e) => setUrl(e.target.value)}
                          className="pl-12 text-lg py-6"
                          required
                        />
                      </div>
                      <Button
                        type="submit"
                        disabled={isLoading}
                        className="bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-bold px-6 sm:px-8 py-4 sm:py-5 md:py-6 text-base sm:text-lg"
                      >
                        {isLoading ? (
                          <>
                            <RefreshCw className="mr-2 h-5 w-5 animate-spin" />
                            Analyzing...
                          </>
                        ) : (
                          <>
                            Audit My Site
                            <Search className="ml-2 h-5 w-5" />
                          </>
                        )}
                      </Button>
                    </div>
                  </div>
                  <div className="flex items-center gap-2 text-gray-600 text-sm">
                    <Lock className="h-4 w-4" />
                    <span>Your data is secure and will never be shared</span>
                  </div>
                </form>

                {/* What We Check */}
                <div className="mt-8 pt-8 border-t border-gray-200">
                  <h3 className="text-lg font-bold text-gray-900 mb-4">What We Analyze:</h3>
                  <div className="grid sm:grid-cols-2 gap-4">
                    {[
                      { icon: Search, label: "SEO Optimization" },
                      { icon: Zap, label: "Page Speed" },
                      { icon: Smartphone, label: "Mobile Friendliness" },
                      { icon: Shield, label: "Security Issues" },
                      { icon: Target, label: "Conversion Optimization" },
                      { icon: BarChart3, label: "Performance Metrics" }
                    ].map((item, index) => (
                      <div key={index} className="flex items-center gap-3">
                        <div className="bg-gradient-to-r from-blue-500 to-cyan-500 p-2 rounded-lg">
                          <item.icon className="h-4 w-4 text-white" />
                        </div>
                        <span className="text-gray-700 font-medium">{item.label}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </CardContent>
            </Card>
          </motion.div>
        </div>
      </section>

      {/* Results Section */}
      {result && (
        <section className="py-8 sm:py-12 md:py-16">
          <div className="section-container">
            <motion.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8 }}
              className="max-w-6xl mx-auto"
            >
              {/* Overall Score with Detailed Explanation */}
              <Card className="bg-gradient-to-br from-blue-500/10 to-cyan-500/10 backdrop-blur-none sm:backdrop-blur-sm border-2 border-blue-500/20 mb-8">
                <CardContent className="p-8">
                  <div className="text-center">
                    <h2 className="text-3xl font-bold text-white mb-4">Your Website Score</h2>
                    <div className="text-8xl font-bold mb-4">
                      <span className={getScoreColor(result.overall_score)}>
                        {result.overall_score}
                      </span>
                      <span className="text-4xl text-gray-400">/100</span>
                    </div>
                    <Progress value={result.overall_score} className="h-3 mb-6" />
                  </div>
                  
                  {/* Detailed Explanation */}
                  <div className="bg-white/5 rounded-lg p-6 mt-6">
                    <div className="flex items-start gap-3">
                      <AlertCircle className="h-6 w-6 text-blue-400 mt-1 flex-shrink-0" />
                      <div>
                        <h3 className="text-xl font-bold text-white mb-3">What This Score Means:</h3>
                        <p className="text-gray-300 leading-relaxed text-lg">
                          {result.explanations?.overall || "Your website's overall performance indicates areas for improvement."}
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* FOMO Element */}
                  {result.overall_score < 85 && (
                    <div className="bg-gradient-to-r from-orange-500/20 to-red-500/20 border border-orange-500/30 rounded-lg p-4 mt-6">
                      <div className="flex items-start gap-3">
                        <TrendingUp className="h-5 w-5 text-orange-400 mt-1" />
                        <div>
                          <p className="text-white font-semibold mb-1">‚ö†Ô∏è Your Competition is Ahead</p>
                          <p className="text-gray-300 text-sm">
                            While you read this, competitors with higher scores are capturing YOUR customers. 
                            Every day you wait costs you an estimated ${Math.floor((85 - result.overall_score) * 50)} in lost revenue.
                          </p>
                        </div>
                      </div>
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* Detailed Scores with Explanations */}
              <div className="grid md:grid-cols-2 gap-6 mb-8">
                {[
                  { label: "SEO", score: result.seo_score, icon: Search, key: "seo" },
                  { label: "Performance", score: result.performance_score, icon: Zap, key: "performance" },
                  { label: "Mobile", score: result.mobile_score, icon: Smartphone, key: "mobile" },
                  { label: "Security", score: result.security_score, icon: Shield, key: "security" }
                ].map((item, index) => (
                  <Card key={index} className="bg-white/10 backdrop-blur-none sm:backdrop-blur-sm border-white/20">
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-3">
                          <item.icon className={`h-8 w-8 ${getScoreColor(item.score)}`} />
                          <h3 className="text-xl font-bold text-white">{item.label}</h3>
                        </div>
                        <p className={`text-4xl font-bold ${getScoreColor(item.score)}`}>
                          {item.score}
                        </p>
                      </div>
                      <Progress value={item.score} className="h-2 mb-4" />
                      <p className="text-gray-300 text-sm leading-relaxed">
                        {result.explanations?.[item.key as keyof typeof result.explanations] || 
                         `Your ${item.label.toLowerCase()} score indicates room for optimization.`}
                      </p>
                    </CardContent>
                  </Card>
                ))}
              </div>

              {/* Findings */}
              <div className="grid md:grid-cols-3 gap-6 mb-8">
                {/* Critical Issues */}
                <Card className="bg-red-500/10 border-red-500/20">
                  <CardContent className="p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <XCircle className="h-6 w-6 text-red-500" />
                      <h3 className="text-xl font-bold text-white">Critical Issues</h3>
                    </div>
                    <Badge className="bg-red-500 mb-4">{result.findings.critical.length} Found</Badge>
                    <ul className="space-y-2">
                      {result.findings.critical.slice(0, 3).map((issue, index) => (
                        <li key={index} className="text-gray-300 text-sm flex items-start gap-2">
                          <span className="text-red-500 mt-1">‚Ä¢</span>
                          <span>{issue}</span>
                        </li>
                      ))}
                    </ul>
                  </CardContent>
                </Card>

                {/* Warnings */}
                <Card className="bg-yellow-500/10 border-yellow-500/20">
                  <CardContent className="p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <AlertCircle className="h-6 w-6 text-yellow-500" />
                      <h3 className="text-xl font-bold text-white">Warnings</h3>
                    </div>
                    <Badge className="bg-yellow-500 mb-4">{result.findings.warnings.length} Found</Badge>
                    <ul className="space-y-2">
                      {result.findings.warnings.slice(0, 3).map((warning, index) => (
                        <li key={index} className="text-gray-300 text-sm flex items-start gap-2">
                          <span className="text-yellow-500 mt-1">‚Ä¢</span>
                          <span>{warning}</span>
                        </li>
                      ))}
                    </ul>
                  </CardContent>
                </Card>

                {/* Good Practices */}
                <Card className="bg-green-500/10 border-green-500/20">
                  <CardContent className="p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <CheckCircle2 className="h-6 w-6 text-green-500" />
                      <h3 className="text-xl font-bold text-white">Good Practices</h3>
                    </div>
                    <Badge className="bg-green-500 mb-4">{result.findings.good.length} Found</Badge>
                    <ul className="space-y-2">
                      {result.findings.good.slice(0, 3).map((good, index) => (
                        <li key={index} className="text-gray-300 text-sm flex items-start gap-2">
                          <span className="text-green-500 mt-1">‚Ä¢</span>
                          <span>{good}</span>
                        </li>
                      ))}
                    </ul>
                  </CardContent>
                </Card>
              </div>

              {/* Lead Capture Form with Enhanced FOMO */}
              {showLeadForm && (
                <motion.div
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.5 }}
                  className="bg-gradient-to-br from-white to-blue-50 rounded-2xl p-8 max-w-3xl mx-auto shadow-2xl border-2 border-blue-200"
                >
                  {/* Urgency Banner */}
                  <div className="bg-gradient-to-r from-red-500 to-orange-500 text-white text-center py-3 rounded-lg mb-6 font-bold">
                    üî• LIMITED TIME: Free Detailed Report + Expert Consultation ($500 Value)
                  </div>

                  <div className="flex items-center gap-3 mb-4">
                    <Mail className="h-6 w-6 text-blue-500" />
                    <h3 className="text-2xl font-bold text-gray-900">
                      Get Your Complete Action Plan (FREE)
                    </h3>
                  </div>

                  {/* Value Proposition */}
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h4 className="font-bold text-gray-900 mb-3">Here's what you'll receive:</h4>
                    <div className="space-y-2">
                      {[
                        "‚úÖ Detailed 15-page PDF report with every issue explained",
                        "‚úÖ Step-by-step fix instructions (no technical knowledge needed)",
                        "‚úÖ Priority ranking: Fix high-impact issues first",
                        "‚úÖ ROI calculator: See potential revenue increase",
                        "‚úÖ 30-min consultation with digital marketing expert",
                        "‚úÖ Custom improvement roadmap for your business"
                      ].map((item, idx) => (
                        <p key={idx} className="text-gray-700 text-sm">{item}</p>
                      ))}
                    </div>
                  </div>

                  <form onSubmit={handleLeadSubmit} className="space-y-4">
                    <div className="grid sm:grid-cols-2 gap-4">
                      <Input
                        type="text"
                        placeholder="Your Name"
                        value={name}
                        onChange={(e) => setName(e.target.value)}
                        required
                        className="text-lg py-6"
                      />
                      <Input
                        type="email"
                        placeholder="Your Email"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        required
                        className="text-lg py-6"
                      />
                    </div>
                    <Button
                      type="submit"
                      className="w-full bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-bold py-6 text-lg shadow-lg hover:shadow-xl transition-all"
                    >
                      Get My Free Report + Consultation Now
                      <ArrowRight className="ml-2 h-5 w-5" />
                    </Button>
                  </form>

                  {/* Trust Indicators */}
                  <div className="mt-6 pt-6 border-t border-gray-200">
                    <div className="grid grid-cols-3 gap-4 text-center">
                      <div>
                        <p className="text-2xl font-bold text-blue-600">15,000+</p>
                        <p className="text-xs text-gray-600">Reports Sent</p>
                      </div>
                      <div>
                        <p className="text-2xl font-bold text-blue-600">4.9/5</p>
                        <p className="text-xs text-gray-600">Client Rating</p>
                      </div>
                      <div>
                        <p className="text-2xl font-bold text-blue-600">24hrs</p>
                        <p className="text-xs text-gray-600">Response Time</p>
                      </div>
                    </div>
                  </div>

                  <p className="text-xs text-gray-500 text-center mt-4">
                    üîí Your data is 100% secure. We never share or sell your information.
                  </p>

                  {/* Scarcity Element */}
                  <div className="bg-yellow-50 border border-yellow-300 rounded-lg p-3 mt-4 text-center">
                    <p className="text-sm text-yellow-800 font-semibold">
                      ‚ö° Only 8 consultation slots available this week - Claim yours now!
                    </p>
                  </div>
                </motion.div>
              )}
            </motion.div>
          </div>
        </section>
      )}

      {/* Benefits Section */}
      <section className="py-8 sm:py-12 md:py-16 bg-white/5">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="text-center mb-12"
          >
            <h2 className="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-4">
              Why Fix These Issues?
            </h2>
            <p className="text-base sm:text-lg md:text-xl text-gray-300">
              Every problem costs you money in lost customers and rankings
            </p>
          </motion.div>

          <div className="grid md:grid-cols-3 gap-8">
            {[
              {
                icon: TrendingUp,
                title: "Rank Higher on Google",
                description: "Fix SEO issues and watch your rankings climb. Our clients see an average 156% increase in organic traffic."
              },
              {
                icon: Zap,
                title: "Convert More Visitors",
                description: "A 1-second delay in page load can reduce conversions by 7%. Speed = Money."
              },
              {
                icon: Shield,
                title: "Protect Your Reputation",
                description: "Security vulnerabilities can destroy trust instantly. 84% won't return after a security warning."
              }
            ].map((benefit, index) => (
              <motion.div
                key={index}
                initial={{ opacity: 0, y: 30 }}
                whileInView={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
                viewport={{ once: true }}
                className="bg-white/10 backdrop-blur-none sm:backdrop-blur-sm rounded-xl p-8 text-center"
              >
                <div className="bg-gradient-to-r from-blue-500 to-cyan-500 p-4 rounded-xl w-fit mx-auto mb-6">
                  <benefit.icon className="h-8 w-8 text-white" />
                </div>
                <h3 className="text-2xl font-bold text-white mb-4">{benefit.title}</h3>
                <p className="text-gray-300 leading-relaxed">{benefit.description}</p>
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* Testimonials */}
      <section className="py-8 sm:py-12 md:py-16">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="text-center mb-12"
          >
            <h2 className="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-4">
              Companies Who Fixed Their Issues
            </h2>
          </motion.div>

          <div className="grid md:grid-cols-3 gap-8">
            {[
              {
                name: "David K.",
                company: "Tech Startup",
                result: "87% More Traffic",
                quote: "The audit revealed issues I didn't know existed. After fixing them, our traffic exploded."
              },
              {
                name: "Lisa M.",
                company: "E-commerce",
                result: "234% Revenue Increase",
                quote: "We were losing customers to slow load times. This audit saved our business."
              },
              {
                name: "Tom R.",
                company: "Service Business",
                result: "#1 Google Ranking",
                quote: "From page 3 to #1 in 4 months by following their recommendations."
              }
            ].map((testimonial, index) => (
              <motion.div
                key={index}
                initial={{ opacity: 0, y: 30 }}
                whileInView={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
                viewport={{ once: true }}
                className="bg-white/10 backdrop-blur-none sm:backdrop-blur-sm rounded-xl p-6"
              >
                <div className="flex gap-1 mb-4">
                  {[...Array(5)].map((_, i) => (
                    <Star key={i} className="h-5 w-5 fill-blue-400 text-blue-400" />
                  ))}
                </div>
                <p className="text-white text-lg font-semibold mb-4">"{testimonial.quote}"</p>
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-white font-semibold">{testimonial.name}</p>
                    <p className="text-gray-400 text-sm">{testimonial.company}</p>
                  </div>
                  <div className="text-right">
                    <p className="text-blue-400 font-bold text-lg">{testimonial.result}</p>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* Final CTA */}
      <section className="py-8 sm:py-12 md:py-16">
        <div className="section-container">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
            viewport={{ once: true }}
            className="bg-gradient-to-r from-blue-500 to-cyan-500 rounded-2xl sm:rounded-3xl p-6 sm:p-8 md:p-12 text-center"
          >
            <h2 className="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-6">
              Need Help Fixing Your Website?
            </h2>
            <p className="text-xl text-white/80 mb-8 max-w-3xl mx-auto">
              Don't let technical issues cost you customers. Our team will fix everything and optimize your site for maximum conversions.
            </p>
            <div className="flex flex-col sm:flex-row gap-4 justify-center">
              <Button
                size="lg"
                className="bg-white hover:bg-gray-100 text-blue-600 font-bold px-6 sm:px-8 py-4 sm:py-5 md:py-6 text-base sm:text-lg"
                asChild
              >
                <Link href="/contact">
                  Get Expert Help Now
                  <ArrowRight className="ml-2 h-5 w-5" />
                </Link>
              </Button>
              <Button
                size="lg"
                variant="outline"
                className="border-2 border-white text-white hover:bg-white hover:text-blue-600 px-6 sm:px-8 py-4 sm:py-5 md:py-6 text-base sm:text-lg"
                asChild
              >
                <Link href="/tools">
                  Try Another Tool
                </Link>
              </Button>
            </div>
          </motion.div>
        </div>
      </section>
    </div>
  );
};

export default WebsiteAuditorLanding;

// ==========================================
// File: components/tools/website-need-checker-landing.tsx
// ==========================================


'use client';

import { useState } from 'react';
import { motion } from 'framer-motion';
import { useRouter } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import {
  CheckCircle2,
  XCircle,
  AlertTriangle,
  TrendingUp,
  DollarSign,
  Users,
  Globe,
  Zap,
  Target,
  BarChart3,
  ArrowRight,
  Sparkles,
  Phone,
  Mail,
  Building2,
} from 'lucide-react';
import { toast } from 'sonner';
import { trackRedditLead } from "@/lib/reddit-tracking";
import { trackConversion } from "@/lib/analytics";
import { cn } from '@/lib/utils';
import Navigation from '@/components/navigation';
import Footer from '@/components/footer';

interface Assessment {
  hasWebsite: string;
  industry: string;
  businessAge: string;
  customerType: string;
  currentLeadGen: string;
  monthlyRevenue: string;
  competitors: string;
  goals: string[];
}

interface LeadInfo {
  name: string;
  email: string;
  phone: string;
  company: string;
}

export default function WebsiteNeedCheckerLanding() {
  const router = useRouter();
  const [step, setStep] = useState(1);
  const [assessment, setAssessment] = useState<Assessment>({
    hasWebsite: '',
    industry: '',
    businessAge: '',
    customerType: '',
    currentLeadGen: '',
    monthlyRevenue: '',
    competitors: '',
    goals: [],
  });
  const [leadInfo, setLeadInfo] = useState<LeadInfo>({
    name: '',
    email: '',
    phone: '',
    company: '',
  });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showResults, setShowResults] = useState(false);

  const totalSteps = 8;
  const progress = (step / totalSteps) * 100;

  const calculateScore = () => {
    let score = 0;
    let needLevel: 'critical' | 'high' | 'moderate' | 'low' = 'low';

    // Has website check
    if (assessment.hasWebsite === 'no') score += 30;
    else if (assessment.hasWebsite === 'outdated') score += 25;

    // Industry relevance
    if (['retail', 'professional-services', 'restaurant'].includes(assessment.industry)) {
      score += 15;
    }

    // Business age
    if (assessment.businessAge !== 'startup') score += 10;

    // Customer type
    if (assessment.customerType === 'b2c') score += 10;
    else if (assessment.customerType === 'both') score += 15;

    // Current lead generation
    if (['referrals', 'none'].includes(assessment.currentLeadGen)) {
      score += 15;
    }

    // Revenue impact
    if (assessment.monthlyRevenue === '10k+') score += 10;
    else if (assessment.monthlyRevenue === '5k-10k') score += 8;

    // Competitor pressure
    if (assessment.competitors === 'most') score += 10;
    else if (assessment.competitors === 'some') score += 5;

    // Goals alignment
    score += Math.min(assessment.goals.length * 3, 15);

    // Determine need level
    if (score >= 80) needLevel = 'critical';
    else if (score >= 60) needLevel = 'high';
    else if (score >= 40) needLevel = 'moderate';
    else needLevel = 'low';

    return { score, needLevel };
  };

  const calculateROI = () => {
    const revenueMap: { [key: string]: number } = {
      '0-1k': 500,
      '1k-5k': 3000,
      '5k-10k': 7500,
      '10k+': 15000,
    };

    const monthlyRevenue = revenueMap[assessment.monthlyRevenue] || 3000;
    
    // Conservative estimate: 20-30% revenue increase with professional website
    const conversionBoost = 0.25;
    const monthlyGain = monthlyRevenue * conversionBoost;
    const yearlyGain = monthlyGain * 12;
    
    // Website investment (CDM Suite builder)
    const websiteInvestment = 1500; // One-time
    const monthlyMaintenance = 99; // Monthly subscription
    const yearlyInvestment = websiteInvestment + (monthlyMaintenance * 12);
    
    const roi = ((yearlyGain - yearlyInvestment) / yearlyInvestment) * 100;

    return {
      monthlyGain: Math.round(monthlyGain),
      yearlyGain: Math.round(yearlyGain),
      investment: yearlyInvestment,
      roi: Math.round(roi),
      breakEvenMonths: Math.ceil(websiteInvestment / monthlyGain),
    };
  };

  const handleNext = () => {
    if (step < totalSteps) {
      setStep(step + 1);
    } else {
      handleSubmit();
    }
  };

  const handleBack = () => {
    if (step > 1) setStep(step - 1);
  };

  const handleSubmit = async () => {
    if (!leadInfo.name || !leadInfo.email) {
      toast.error('Please provide your name and email to see results');
      return;
    }

    setIsSubmitting(true);

    try {
      // Submit lead to public API endpoint
      const response = await fetch('/api/leads', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: leadInfo.name,
          email: leadInfo.email,
          phone: leadInfo.phone || null,
          company: leadInfo.company || null,
          source: 'website-need-checker',
          interest: 'AI Website Builder',
          notes: `Website Need Assessment Results:\n\nScore: ${calculateScore().score}/100\nNeed Level: ${calculateScore().needLevel.toUpperCase()}\n\nAssessment Details:\n${JSON.stringify(assessment, null, 2)}`,
        }),
      });

      const data = await response.json();

      if (response.ok && data.success) {
        // Track lead conversion
        trackRedditLead(leadInfo.email);
        trackConversion('website_need_checker', undefined, 'USD', { email: leadInfo.email });
        
        setShowResults(true);
        toast.success('Assessment complete! Scroll down to see your results.');
        
        // Smooth scroll to results
        setTimeout(() => {
          window.scrollTo({ top: 600, behavior: 'smooth' });
        }, 100);
      } else {
        console.error('API error:', data);
        toast.error(data.error || 'Something went wrong. Please try again.');
      }
    } catch (error) {
      console.error('Error submitting assessment:', error);
      toast.error('Failed to submit assessment. Please try again.');
    } finally {
      setIsSubmitting(false);
    }
  };

  const toggleGoal = (goal: string) => {
    setAssessment((prev) => ({
      ...prev,
      goals: prev.goals.includes(goal)
        ? prev.goals.filter((g) => g !== goal)
        : [...prev.goals, goal],
    }));
  };

  const renderStep = () => {
    switch (step) {
      case 1:
        return (
          <div className="space-y-4">
            <h3 className="text-xl font-semibold">Do you currently have a website?</h3>
            <RadioGroup
              value={assessment.hasWebsite}
              onValueChange={(value) => setAssessment({ ...assessment, hasWebsite: value })}
            >
              <div className="flex items-center space-x-2 p-4 border rounded-lg hover:border-primary cursor-pointer">
                <RadioGroupItem value="no" id="no" />
                <Label htmlFor="no" className="cursor-pointer flex-1">
                  No, I don't have a website
                </Label>
              </div>
              <div className="flex items-center space-x-2 p-4 border rounded-lg hover:border-primary cursor-pointer">
                <RadioGroupItem value="yes" id="yes" />
                <Label htmlFor="yes" className="cursor-pointer flex-1">
                  Yes, but it's outdated or not working well
                </Label>
              </div>
              <div className="flex items-center space-x-2 p-4 border rounded-lg hover:border-primary cursor-pointer">
                <RadioGroupItem value="modern" id="modern" />
                <Label htmlFor="modern" className="cursor-pointer flex-1">
                  Yes, I have a modern, functional website
                </Label>
              </div>
            </RadioGroup>
          </div>
        );

      case 2:
        return (
          <div className="space-y-4">
            <h3 className="text-xl font-semibold">What industry are you in?</h3>
            <RadioGroup
              value={assessment.industry}
              onValueChange={(value) => setAssessment({ ...assessment, industry: value })}
            >
              {[
                { value: 'retail', label: 'Retail / E-commerce' },
                { value: 'professional-services', label: 'Professional Services (Law, Consulting, etc.)' },
                { value: 'restaurant', label: 'Restaurant / Food Service' },
                { value: 'health', label: 'Healthcare / Wellness' },
                { value: 'construction', label: 'Construction / Home Services' },
                { value: 'other', label: 'Other' },
              ].map((option) => (
                <div
                  key={option.value}
                  className="flex items-center space-x-2 p-4 border rounded-lg hover:border-primary cursor-pointer"
                >
                  <RadioGroupItem value={option.value} id={option.value} />
                  <Label htmlFor={option.value} className="cursor-pointer flex-1">
                    {option.label}
                  </Label>
                </div>
              ))}
            </RadioGroup>
          </div>
        );

      case 3:
        return (
          <div className="space-y-4">
            <h3 className="text-xl font-semibold">How long have you been in business?</h3>
            <RadioGroup
              value={assessment.businessAge}
              onValueChange={(value) => setAssessment({ ...assessment, businessAge: value })}
            >
              {[
                { value: 'startup', label: 'Less than 1 year' },
                { value: '1-3', label: '1-3 years' },
                { value: '3-5', label: '3-5 years' },
                { value: '5+', label: 'More than 5 years' },
              ].map((option) => (
                <div
                  key={option.value}
                  className="flex items-center space-x-2 p-4 border rounded-lg hover:border-primary cursor-pointer"
                >
                  <RadioGroupItem value={option.value} id={option.value} />
                  <Label htmlFor={option.value} className="cursor-pointer flex-1">
                    {option.label}
                  </Label>
                </div>
              ))}
            </RadioGroup>
          </div>
        );

      case 4:
        return (
          <div className="space-y-4">
            <h3 className="text-xl font-semibold">Who are your primary customers?</h3>
            <RadioGroup
              value={assessment.customerType}
              onValueChange={(value) => setAssessment({ ...assessment, customerType: value })}
            >
              {[
                { value: 'b2c', label: 'Individual consumers (B2C)' },
                { value: 'b2b', label: 'Other businesses (B2B)' },
                { value: 'both', label: 'Both consumers and businesses' },
              ].map((option) => (
                <div
                  key={option.value}
                  className="flex items-center space-x-2 p-4 border rounded-lg hover:border-primary cursor-pointer"
                >
                  <RadioGroupItem value={option.value} id={option.value} />
                  <Label htmlFor={option.value} className="cursor-pointer flex-1">
                    {option.label}
                  </Label>
                </div>
              ))}
            </RadioGroup>
          </div>
        );

      case 5:
        return (
          <div className="space-y-4">
            <h3 className="text-xl font-semibold">How do you currently get new customers?</h3>
            <RadioGroup
              value={assessment.currentLeadGen}
              onValueChange={(value) => setAssessment({ ...assessment, currentLeadGen: value })}
            >
              {[
                { value: 'referrals', label: 'Word of mouth / Referrals only' },
                { value: 'social', label: 'Social media' },
                { value: 'ads', label: 'Paid advertising' },
                { value: 'mixed', label: 'Multiple channels' },
                { value: 'none', label: 'Struggling to get customers' },
              ].map((option) => (
                <div
                  key={option.value}
                  className="flex items-center space-x-2 p-4 border rounded-lg hover:border-primary cursor-pointer"
                >
                  <RadioGroupItem value={option.value} id={option.value} />
                  <Label htmlFor={option.value} className="cursor-pointer flex-1">
                    {option.label}
                  </Label>
                </div>
              ))}
            </RadioGroup>
          </div>
        );

      case 6:
        return (
          <div className="space-y-4">
            <h3 className="text-xl font-semibold">What's your approximate monthly revenue?</h3>
            <RadioGroup
              value={assessment.monthlyRevenue}
              onValueChange={(value) => setAssessment({ ...assessment, monthlyRevenue: value })}
            >
              {[
                { value: '0-1k', label: 'Less than $1,000' },
                { value: '1k-5k', label: '$1,000 - $5,000' },
                { value: '5k-10k', label: '$5,000 - $10,000' },
                { value: '10k+', label: 'More than $10,000' },
              ].map((option) => (
                <div
                  key={option.value}
                  className="flex items-center space-x-2 p-4 border rounded-lg hover:border-primary cursor-pointer"
                >
                  <RadioGroupItem value={option.value} id={option.value} />
                  <Label htmlFor={option.value} className="cursor-pointer flex-1">
                    {option.label}
                  </Label>
                </div>
              ))}
            </RadioGroup>
          </div>
        );

      case 7:
        return (
          <div className="space-y-4">
            <h3 className="text-xl font-semibold">Do your competitors have websites?</h3>
            <RadioGroup
              value={assessment.competitors}
              onValueChange={(value) => setAssessment({ ...assessment, competitors: value })}
            >
              {[
                { value: 'most', label: 'Yes, most of them do' },
                { value: 'some', label: 'Some of them do' },
                { value: 'few', label: 'Very few or none' },
                { value: 'unsure', label: 'Not sure' },
              ].map((option) => (
                <div
                  key={option.value}
                  className="flex items-center space-x-2 p-4 border rounded-lg hover:border-primary cursor-pointer"
                >
                  <RadioGroupItem value={option.value} id={option.value} />
                  <Label htmlFor={option.value} className="cursor-pointer flex-1">
                    {option.label}
                  </Label>
                </div>
              ))}
            </RadioGroup>
          </div>
        );

      case 8:
        return (
          <div className="space-y-6">
            <div>
              <h3 className="text-xl font-semibold mb-4">What are your main business goals?</h3>
              <p className="text-sm text-muted-foreground mb-4">(Select all that apply)</p>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                {[
                  { value: 'more-customers', label: 'Get more customers', icon: Users },
                  { value: 'increase-revenue', label: 'Increase revenue', icon: TrendingUp },
                  { value: 'build-credibility', label: 'Build credibility', icon: Target },
                  { value: 'online-presence', label: 'Establish online presence', icon: Globe },
                  { value: 'compete', label: 'Compete better', icon: BarChart3 },
                  { value: 'automate', label: 'Automate processes', icon: Zap },
                ].map(({ value, label, icon: Icon }) => (
                  <div
                    key={value}
                    onClick={() => toggleGoal(value)}
                    className={cn(
                      'flex items-center space-x-3 p-4 border rounded-lg cursor-pointer transition-all',
                      assessment.goals.includes(value)
                        ? 'border-primary bg-primary/5'
                        : 'hover:border-primary/50'
                    )}
                  >
                    <div
                      className={cn(
                        'w-5 h-5 rounded border flex items-center justify-center',
                        assessment.goals.includes(value)
                          ? 'bg-primary border-primary'
                          : 'border-gray-300'
                      )}
                    >
                      {assessment.goals.includes(value) && (
                        <CheckCircle2 className="w-4 h-4 text-white" />
                      )}
                    </div>
                    <Icon className="w-5 h-5 text-muted-foreground" />
                    <span className="flex-1 font-medium">{label}</span>
                  </div>
                ))}
              </div>
            </div>

            <div className="border-t pt-6">
              <h3 className="text-xl font-semibold mb-4">Get Your Personalized Results</h3>
              <div className="space-y-4">
                <div>
                  <Label htmlFor="name">Full Name *</Label>
                  <Input
                    id="name"
                    value={leadInfo.name}
                    onChange={(e) => setLeadInfo({ ...leadInfo, name: e.target.value })}
                    placeholder="John Doe"
                    className="mt-1"
                  />
                </div>
                <div>
                  <Label htmlFor="email">Email *</Label>
                  <Input
                    id="email"
                    type="email"
                    value={leadInfo.email}
                    onChange={(e) => setLeadInfo({ ...leadInfo, email: e.target.value })}
                    placeholder="john@example.com"
                    className="mt-1"
                  />
                </div>
                <div>
                  <Label htmlFor="phone">Phone</Label>
                  <Input
                    id="phone"
                    type="tel"
                    value={leadInfo.phone}
                    onChange={(e) => setLeadInfo({ ...leadInfo, phone: e.target.value })}
                    placeholder="+1 (555) 000-0000"
                    className="mt-1"
                  />
                </div>
                <div>
                  <Label htmlFor="company">Company Name</Label>
                  <Input
                    id="company"
                    value={leadInfo.company}
                    onChange={(e) => setLeadInfo({ ...leadInfo, company: e.target.value })}
                    placeholder="Acme Inc."
                    className="mt-1"
                  />
                </div>
              </div>
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  const { score, needLevel } = calculateScore();
  const roiData = calculateROI();

  const getNeedLevelInfo = () => {
    switch (needLevel) {
      case 'critical':
        return {
          icon: AlertTriangle,
          color: 'text-red-600',
          bg: 'bg-red-50',
          border: 'border-red-200',
          title: 'CRITICAL NEED',
          message: 'Your business urgently needs a professional website to remain competitive and capture growth opportunities.',
        };
      case 'high':
        return {
          icon: XCircle,
          color: 'text-orange-600',
          bg: 'bg-orange-50',
          border: 'border-orange-200',
          title: 'HIGH PRIORITY',
          message: 'A professional website would significantly benefit your business growth and customer acquisition.',
        };
      case 'moderate':
        return {
          icon: AlertTriangle,
          color: 'text-yellow-600',
          bg: 'bg-yellow-50',
          border: 'border-yellow-200',
          title: 'MODERATE NEED',
          message: 'A website could help improve your business visibility and streamline customer interactions.',
        };
      case 'low':
        return {
          icon: CheckCircle2,
          color: 'text-green-600',
          bg: 'bg-green-50',
          border: 'border-green-200',
          title: 'LOW PRIORITY',
          message: 'Your current setup seems adequate, but a modern website could still provide additional benefits.',
        };
    }
  };

  const needInfo = getNeedLevelInfo();
  const NeedIcon = needInfo.icon;

  return (
    <main>
      <Navigation />
      <div className="min-h-screen bg-gradient-to-b from-background to-muted/20">
        {/* Hero Section */}
        <section className="pt-32 pb-16 px-4">
          <div className="container mx-auto max-w-4xl text-center">
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6 }}
            >
              <Badge variant="secondary" className="mb-4">
                <Sparkles className="w-3 h-3 mr-1" />
                FREE Assessment Tool
              </Badge>
              <h1 className="text-4xl md:text-5xl font-bold mb-6">
                Does Your Business Need a Website?
              </h1>
              <p className="text-xl text-muted-foreground mb-8 max-w-2xl mx-auto">
                Take our 2-minute assessment to discover if a website could help you grow your business,
                plus calculate your potential ROI and get personalized recommendations.
              </p>
            </motion.div>
          </div>
        </section>

        {/* Assessment Card */}
        {!showResults && (
          <section className="pb-20 px-4">
            <div className="container mx-auto max-w-2xl">
              <Card>
                <CardHeader>
                  <div className="flex items-center justify-between mb-4">
                    <CardTitle>Website Need Assessment</CardTitle>
                    <Badge variant="outline">
                      Step {step} of {totalSteps}
                    </Badge>
                  </div>
                  <Progress value={progress} className="mb-2" />
                  <CardDescription>
                    {step < totalSteps
                      ? 'Answer honestly for the most accurate results'
                      : 'Final step - Enter your details to see personalized results'}
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  {renderStep()}

                  <div className="flex gap-3 mt-8">
                    {step > 1 && (
                      <Button variant="outline" onClick={handleBack} className="flex-1">
                        Back
                      </Button>
                    )}
                    <Button
                      onClick={handleNext}
                      disabled={
                        !assessment[
                          Object.keys(assessment)[step - 1] as keyof Assessment
                        ] ||
                        (step === totalSteps && (!leadInfo.name || !leadInfo.email)) ||
                        isSubmitting
                      }
                      className="flex-1"
                    >
                      {isSubmitting ? (
                        'Analyzing...'
                      ) : step === totalSteps ? (
                        <>
                          See My Results
                          <Sparkles className="ml-2 w-4 h-4" />
                        </>
                      ) : (
                        <>
                          Continue
                          <ArrowRight className="ml-2 w-4 h-4" />
                        </>
                      )}
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </section>
        )}

        {/* Results Section */}
        {showResults && (
          <section className="pb-20 px-4">
            <div className="container mx-auto max-w-5xl space-y-8">
              {/* Overall Score */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.6 }}
              >
                <Card className={cn('border-2', needInfo.border, needInfo.bg)}>
                  <CardContent className="pt-6">
                    <div className="flex items-start gap-4">
                      <div className={cn('p-3 rounded-full', needInfo.bg)}>
                        <NeedIcon className={cn('w-8 h-8', needInfo.color)} />
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center gap-3 mb-2">
                          <h2 className="text-2xl font-bold">{needInfo.title}</h2>
                          <Badge variant="secondary" className="text-lg px-3 py-1">
                            Score: {score}/100
                          </Badge>
                        </div>
                        <p className="text-lg text-muted-foreground">{needInfo.message}</p>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </motion.div>

              {/* ROI Calculation */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.6, delay: 0.1 }}
              >
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <DollarSign className="w-5 h-5" />
                      Potential ROI with a Professional Website
                    </CardTitle>
                    <CardDescription>
                      Based on your monthly revenue and industry benchmarks
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                      <div className="p-4 bg-muted rounded-lg">
                        <p className="text-sm text-muted-foreground mb-1">Monthly Gain</p>
                        <p className="text-2xl font-bold text-green-600">
                          +${roiData.monthlyGain.toLocaleString()}
                        </p>
                      </div>
                      <div className="p-4 bg-muted rounded-lg">
                        <p className="text-sm text-muted-foreground mb-1">Yearly Gain</p>
                        <p className="text-2xl font-bold text-green-600">
                          +${roiData.yearlyGain.toLocaleString()}
                        </p>
                      </div>
                      <div className="p-4 bg-muted rounded-lg">
                        <p className="text-sm text-muted-foreground mb-1">Total Investment</p>
                        <p className="text-2xl font-bold">${roiData.investment.toLocaleString()}</p>
                      </div>
                      <div className="p-4 bg-primary/10 rounded-lg">
                        <p className="text-sm text-muted-foreground mb-1">ROI</p>
                        <p className="text-2xl font-bold text-primary">{roiData.roi}%</p>
                      </div>
                    </div>
                    <p className="mt-4 text-sm text-muted-foreground">
                      <strong>Break-even in {roiData.breakEvenMonths} months.</strong> After that,
                      it's pure profit growth for your business.
                    </p>
                  </CardContent>
                </Card>
              </motion.div>

              {/* What You're Missing */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.6, delay: 0.2 }}
              >
                <Card>
                  <CardHeader>
                    <CardTitle>What You're Missing Without a Website</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {[
                        {
                          icon: Users,
                          title: '24/7 Lead Generation',
                          description: 'Capture customers even when you sleep',
                        },
                        {
                          icon: Target,
                          title: 'Professional Credibility',
                          description: '81% of consumers research online before buying',
                        },
                        {
                          icon: Globe,
                          title: 'Expanded Reach',
                          description: 'Get found by customers searching online',
                        },
                        {
                          icon: Zap,
                          title: 'Automated Sales',
                          description: 'Showcase services and close deals automatically',
                        },
                        {
                          icon: BarChart3,
                          title: 'Competitive Advantage',
                          description: 'Stand out from competitors without websites',
                        },
                        {
                          icon: DollarSign,
                          title: 'Lower Customer Acquisition Cost',
                          description: 'Organic traffic is cheaper than paid ads',
                        },
                      ].map((item, index) => (
                        <div key={index} className="flex gap-3 p-4 bg-muted rounded-lg">
                          <item.icon className="w-6 h-6 text-primary flex-shrink-0" />
                          <div>
                            <h4 className="font-semibold mb-1">{item.title}</h4>
                            <p className="text-sm text-muted-foreground">{item.description}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  </CardContent>
                </Card>
              </motion.div>

              {/* CTA Section - AI Website Builder */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.6, delay: 0.3 }}
              >
                <Card className="border-2 border-primary bg-gradient-to-br from-primary/5 to-purple-500/5">
                  <CardContent className="pt-6">
                    <div className="text-center space-y-6">
                      <div>
                        <Badge variant="secondary" className="mb-3">
                          <Sparkles className="w-3 h-3 mr-1" />
                          Recommended Solution
                        </Badge>
                        <h2 className="text-3xl font-bold mb-3">
                          Get Your Website Built in 24 Hours with AI
                        </h2>
                        <p className="text-lg text-muted-foreground max-w-2xl mx-auto">
                          Skip the 6-week wait and $5,000+ cost of traditional web development. Our AI
                          Website Builder creates a professional, custom website tailored to your
                          business in just one day.
                        </p>
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-3xl mx-auto">
                        <div className="p-4 bg-white rounded-lg border">
                          <Zap className="w-8 h-8 text-primary mx-auto mb-2" />
                          <h4 className="font-semibold mb-1">Lightning Fast</h4>
                          <p className="text-sm text-muted-foreground">
                            Live in 24 hours, not weeks
                          </p>
                        </div>
                        <div className="p-4 bg-white rounded-lg border">
                          <DollarSign className="w-8 h-8 text-primary mx-auto mb-2" />
                          <h4 className="font-semibold mb-1">Affordable</h4>
                          <p className="text-sm text-muted-foreground">
                            70% less than traditional dev
                          </p>
                        </div>
                        <div className="p-4 bg-white rounded-lg border">
                          <Sparkles className="w-8 h-8 text-primary mx-auto mb-2" />
                          <h4 className="font-semibold mb-1">AI-Powered</h4>
                          <p className="text-sm text-muted-foreground">
                            Custom design, not templates
                          </p>
                        </div>
                      </div>

                      <div className="flex flex-col sm:flex-row gap-4 justify-center">
                        <Button size="lg" onClick={() => router.push('/builder')} className="text-lg">
                          <Sparkles className="mr-2 w-5 h-5" />
                          Start Building My Website
                        </Button>
                        <Button
                          size="lg"
                          variant="outline"
                          onClick={() => router.push('/contact')}
                          className="text-lg"
                        >
                          <Phone className="mr-2 w-5 h-5" />
                          Talk to an Expert
                        </Button>
                      </div>

                      <p className="text-sm text-muted-foreground">
                        üéÅ <strong>Special Offer:</strong> Mention this assessment and get 20% off
                        your first month!
                      </p>
                    </div>
                  </CardContent>
                </Card>
              </motion.div>

              {/* Alternative: Custom Development */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.6, delay: 0.4 }}
              >
                <Card>
                  <CardContent className="pt-6">
                    <div className="text-center space-y-4">
                      <h3 className="text-xl font-semibold">
                        Need Something More Custom?
                      </h3>
                      <p className="text-muted-foreground max-w-2xl mx-auto">
                        If you need advanced features, custom integrations, or enterprise-level
                        functionality, our development team can build a fully custom solution.
                      </p>
                      <div className="flex flex-col sm:flex-row gap-3 justify-center">
                        <Button variant="outline" asChild>
                          <a href="/services/web-design">View Custom Development Services</a>
                        </Button>
                        <Button variant="outline" asChild>
                          <a href="/contact">Schedule a Consultation</a>
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </motion.div>

              {/* Social Proof */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.6, delay: 0.5 }}
              >
                <div className="text-center space-y-4">
                  <div className="flex items-center justify-center gap-2">
                    <div className="flex -space-x-2">
                      {[1, 2, 3, 4, 5].map((i) => (
                        <div
                          key={i}
                          className="w-10 h-10 rounded-full bg-gradient-to-br from-primary to-purple-500 border-2 border-background flex items-center justify-center text-white font-semibold"
                        >
                          {String.fromCharCode(64 + i)}
                        </div>
                      ))}
                    </div>
                    <p className="text-muted-foreground">
                      Join <strong>500+</strong> businesses we've helped grow online
                    </p>
                  </div>
                </div>
              </motion.div>
            </div>
          </section>
        )}

        {/* Benefits Section (for people who haven't started) */}
        {!showResults && (
          <section className="pb-20 px-4 bg-muted/50">
            <div className="container mx-auto max-w-6xl pt-16">
              <h2 className="text-3xl font-bold text-center mb-12">
                Why Thousands of Businesses Trust CDM Suite
              </h2>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                {[
                  {
                    icon: TrendingUp,
                    title: 'Proven Results',
                    description:
                      'Our clients see an average 40% increase in leads within the first 3 months',
                  },
                  {
                    icon: Zap,
                    title: 'Fast Deployment',
                    description:
                      'AI-powered website creation gets you online in 24 hours, not months',
                  },
                  {
                    icon: Target,
                    title: 'Full Support',
                    description:
                      'Dedicated account manager and 24/7 support to ensure your success',
                  },
                ].map((benefit, index) => (
                  <Card key={index}>
                    <CardContent className="pt-6 text-center">
                      <benefit.icon className="w-12 h-12 text-primary mx-auto mb-4" />
                      <h3 className="text-xl font-semibold mb-2">{benefit.title}</h3>
                      <p className="text-muted-foreground">{benefit.description}</p>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </div>
          </section>
        )}
      </div>
      <Footer />
    </main>
  );
}

// ==========================================
// File: components/tools-section.tsx
// ==========================================



"use client";

import Link from "next/link";
import { Sparkles, BarChart3, Zap, Shield, TrendingUp, ChevronRight, Mail, DollarSign, Globe } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";

const ToolsSection = () => {
  const tools = [
    {
      icon: <Sparkles className="w-8 h-8" />,
      title: "Website Auditor",
      description: "Get an instant, complete analysis of your website's SEO, performance, mobile friendliness, and security in under 60 seconds.",
      features: [
        "SEO Score & Recommendations",
        "Performance Analysis",
        "Mobile Responsiveness Check",
        "Security Vulnerabilities Scan"
      ],
      badge: "FEATURED",
      gradient: "from-primary to-secondary",
      bgGradient: "from-secondary/10 to-accent/10",
      href: "/auditor",
    },
    {
      icon: <BarChart3 className="w-8 h-8" />,
      title: "ROI Calculator",
      description: "Calculate the potential return on investment for your marketing campaigns and see exactly how much you can earn.",
      features: [
        "Monthly ROI Projections",
        "Investment Breakdown",
        "Profit Analysis",
        "Growth Forecasting"
      ],
      badge: "POPULAR",
      gradient: "from-accent to-secondary",
      bgGradient: "from-accent/10 to-secondary/10",
      href: "/tools/roi-calculator",
    },
    {
      icon: <TrendingUp className="w-8 h-8" />,
      title: "SEO Health Checker",
      description: "Comprehensive SEO analysis to identify issues and opportunities to improve your search rankings.",
      features: [
        "Keyword Analysis",
        "Meta Tags Review",
        "Content Optimization",
        "Technical SEO Check"
      ],
      badge: "FREE",
      gradient: "from-green-500 to-emerald-500",
      bgGradient: "from-green-50 to-emerald-50",
      href: "/tools/seo-checker",
    },
    {
      icon: <Shield className="w-8 h-8" />,
      title: "Conversion Analyzer",
      description: "Understand your conversion funnel and identify opportunities to increase conversions and sales.",
      features: [
        "Funnel Visualization",
        "Drop-off Analysis",
        "Improvement Suggestions",
        "Benchmark Comparison"
      ],
      badge: "FREE",
      gradient: "from-indigo-500 to-blue-500",
      bgGradient: "from-indigo-50 to-blue-50",
      href: "/tools/conversion-analyzer",
    },
    {
      icon: <Mail className="w-8 h-8" />,
      title: "Email Subject Tester",
      description: "Test your email subject lines and predict open rates before hitting send to maximize engagement.",
      features: [
        "Open Rate Prediction",
        "Spam Score Check",
        "Character Count",
        "Best Practices Tips"
      ],
      badge: "FREE",
      gradient: "from-purple-500 to-pink-500",
      bgGradient: "from-purple-50 to-pink-50",
      href: "/tools/email-tester",
    },
    {
      icon: <DollarSign className="w-8 h-8" />,
      title: "Budget Calculator",
      description: "Plan your marketing budget effectively based on your revenue and growth goals with industry benchmarks.",
      features: [
        "Revenue-Based Planning",
        "Channel Allocation",
        "ROI Expectations",
        "Industry Benchmarks"
      ],
      badge: "FREE",
      gradient: "from-orange-500 to-red-500",
      bgGradient: "from-orange-50 to-red-50",
      href: "/tools/budget-calculator",
    },
    {
      icon: <Globe className="w-8 h-8" />,
      title: "Website Need Checker",
      description: "Find out if your business needs a website and calculate the ROI with our comprehensive 8-step assessment.",
      features: [
        "Business Assessment",
        "ROI Calculation",
        "Personalized Recommendations",
        "AI Website Builder Access"
      ],
      badge: "NEW",
      gradient: "from-teal-500 to-green-500",
      bgGradient: "from-teal-50 to-green-50",
      href: "/tools/website-need-checker",
    },
  ];

  return (
    <section id="tools" className="py-20 lg:py-28 bg-gradient-to-br from-white via-secondary/5 to-accent/5 relative overflow-hidden">
      {/* Animated background shapes */}
      <div className="absolute inset-0 overflow-hidden opacity-40">
        <div className="absolute -top-24 -left-24 w-96 h-96 bg-gradient-to-br from-secondary to-accent rounded-full mix-blend-multiply filter blur-3xl animate-pulse"></div>
        <div className="absolute top-1/3 -right-24 w-96 h-96 bg-gradient-to-br from-primary to-secondary rounded-full mix-blend-multiply filter blur-3xl animate-pulse" style={{animationDelay: '1s'}}></div>
      </div>
      
      <div className="section-container relative z-10">
        {/* Header */}
        <div className="text-center mb-16">
          <div className="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-secondary/20 to-accent/20 rounded-full mb-6">
            <Zap className="w-5 h-5 text-primary" />
            <span className="text-sm font-semibold text-gray-700">Free Marketing Tools</span>
          </div>
          <h2 className="text-4xl lg:text-5xl font-bold text-gray-900 mb-4">
            7 Free Tools to <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">Grow Your Business</span>
          </h2>
          <p className="text-xl text-gray-600 max-w-2xl mx-auto">
            Access professional-grade marketing tools absolutely free. Get insights that typically cost thousands of dollars. No credit card required.
          </p>
        </div>

        {/* Featured Tools Grid */}
        <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
          {tools.map((tool, index) => (
            <Card key={index} className="group overflow-hidden border-2 border-gray-200 hover:border-primary transition-all duration-300 shadow-lg hover:shadow-2xl hover:-translate-y-2">
              <CardContent className="p-0">
                {/* Icon & Badge Header */}
                <div className={`bg-gradient-to-br ${tool.bgGradient} p-6 relative overflow-hidden`}>
                  <div className="absolute inset-0 bg-grid-pattern opacity-5"></div>
                  <div className="relative z-10 flex items-center justify-between">
                    <div className={`bg-gradient-to-r ${tool.gradient} text-white p-4 rounded-xl shadow-lg group-hover:scale-110 transition-transform`}>
                      {tool.icon}
                    </div>
                    {tool.badge && (
                      <span className="bg-accent text-charcoal text-xs font-bold px-3 py-1.5 rounded-full shadow-md">
                        {tool.badge}
                      </span>
                    )}
                  </div>
                </div>

                {/* Content */}
                <div className="p-6">
                  <h3 className="text-2xl font-bold text-gray-900 mb-3 group-hover:text-primary transition-colors">
                    {tool.title}
                  </h3>
                  
                  <p className="text-gray-600 mb-6 line-clamp-3 leading-relaxed">
                    {tool.description}
                  </p>

                  <div className="space-y-2 mb-6">
                    {tool.features.map((feature, idx) => (
                      <div key={idx} className="flex items-start gap-2">
                        <div className="w-5 h-5 rounded-full bg-accent/20 text-accent flex items-center justify-center flex-shrink-0 mt-0.5">
                          <span className="text-xs font-bold">‚úì</span>
                        </div>
                        <span className="text-sm text-gray-700">{feature}</span>
                      </div>
                    ))}
                  </div>

                  <Link href={tool.href} className="block">
                    <Button 
                      size="lg"
                      className={`w-full bg-gradient-to-r ${tool.gradient} hover:shadow-xl transition-all duration-200 group`}
                    >
                      Try It Now - Free
                      <ChevronRight className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
                    </Button>
                  </Link>

                  <p className="text-xs text-gray-500 mt-3 text-center">
                    ‚ö° Instant results ‚Ä¢ No signup required
                  </p>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>

        {/* View All Tools Button */}
        <div className="text-center mb-16">
          <Link href="/tools">
            <Button size="lg" variant="outline" className="bg-white hover:bg-gray-50 text-primary border-2 border-primary hover:border-secondary font-bold px-8 py-6 text-lg shadow-lg hover:shadow-xl transition-all duration-200 group">
              View All Free Tools
              <ChevronRight className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
            </Button>
          </Link>
        </div>

        {/* Bottom CTA */}
        <div className="mt-4 text-center bg-gradient-to-r from-primary to-secondary rounded-2xl p-12 text-white">
          <h3 className="text-3xl font-bold mb-4">Ready to Optimize Your Website?</h3>
          <p className="text-xl text-secondary/80 mb-8 max-w-2xl mx-auto">
            Join thousands of businesses using our free tools to improve their online presence and drive more conversions.
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center items-center">
            <Link href="/auditor">
              <Button size="lg" variant="secondary" className="bg-accent text-charcoal hover:bg-accent/90 font-bold shadow-xl hover:shadow-2xl transition-all duration-200 border-2 border-accent">
                Start Your Free Audit Now
                <ChevronRight className="w-5 h-5 ml-2" />
              </Button>
            </Link>
            <Link href="/contact">
              <Button size="lg" variant="outline" className="bg-white/10 text-white hover:bg-white hover:text-charcoal border-2 border-white font-bold shadow-xl hover:shadow-2xl transition-all duration-200">
                Talk to an Expert
              </Button>
            </Link>
          </div>
        </div>
      </div>
    </section>
  );
};

export default ToolsSection;

// ==========================================
// File: components/trial/feature-teaser.tsx
// ==========================================


"use client";

import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Lock, Sparkles, TrendingUp, Zap } from "lucide-react";
import Link from "next/link";

interface FeatureTeaserProps {
  title: string;
  description: string;
  requiredTier: "starter" | "growth" | "pro" | "enterprise";
  currentTier: string;
  icon?: React.ReactNode;
  features?: string[];
}

export function FeatureTeaser({
  title,
  description,
  requiredTier,
  currentTier,
  icon,
  features = [],
}: FeatureTeaserProps) {
  const tierOrder = ["free", "starter", "growth", "pro", "enterprise"];
  const isLocked =
    tierOrder.indexOf(currentTier) < tierOrder.indexOf(requiredTier);

  if (!isLocked) return null;

  return (
    <Card className="p-6 bg-gradient-to-br from-purple-50 to-blue-50 border-purple-200">
      <div className="flex items-start gap-4">
        <div className="w-12 h-12 rounded-full bg-purple-600 flex items-center justify-center flex-shrink-0">
          {icon || <Sparkles className="w-6 h-6 text-white" />}
        </div>
        <div className="flex-1">
          <div className="flex items-start justify-between mb-2">
            <div>
              <h3 className="font-bold text-lg mb-1">{title}</h3>
              <p className="text-sm text-muted-foreground mb-3">{description}</p>
            </div>
            <Badge variant="secondary" className="ml-2">
              <Lock className="w-3 h-3 mr-1" />
              {requiredTier} Plan
            </Badge>
          </div>

          {features.length > 0 && (
            <ul className="space-y-1 mb-4">
              {features.map((feature, index) => (
                <li key={index} className="text-sm flex items-center gap-2">
                  <Zap className="w-4 h-4 text-purple-600" />
                  {feature}
                </li>
              ))}
            </ul>
          )}

          <Button asChild size="sm">
            <Link href="/dashboard/billing">
              <TrendingUp className="w-4 h-4 mr-2" />
              Upgrade to Unlock
            </Link>
          </Button>
        </div>
      </div>
    </Card>
  );
}

// ==========================================
// File: components/trial/trial-countdown.tsx
// ==========================================


"use client";

import { useEffect, useState } from "react";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Clock, Zap, TrendingUp, CheckCircle } from "lucide-react";
import Link from "next/link";
import { Progress } from "@/components/ui/progress";

interface TrialCountdownProps {
  user: any;
}

export function TrialCountdown({ user }: TrialCountdownProps) {
  const [timeLeft, setTimeLeft] = useState<{
    days: number;
    hours: number;
    minutes: number;
    seconds: number;
    total: number;
  } | null>(null);

  useEffect(() => {
    if (!user.trialEndsAt) return;

    const calculateTimeLeft = () => {
      const now = new Date().getTime();
      const trialEnd = new Date(user.trialEndsAt).getTime();
      const difference = trialEnd - now;

      if (difference > 0) {
        return {
          days: Math.floor(difference / (1000 * 60 * 60 * 24)),
          hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
          minutes: Math.floor((difference / 1000 / 60) % 60),
          seconds: Math.floor((difference / 1000) % 60),
          total: difference,
        };
      }
      return null;
    };

    setTimeLeft(calculateTimeLeft());

    const timer = setInterval(() => {
      setTimeLeft(calculateTimeLeft());
    }, 1000);

    return () => clearInterval(timer);
  }, [user.trialEndsAt]);

  // Don't show if not on trial
  if (user.subscriptionStatus !== "trialing" || !timeLeft) {
    return null;
  }

  const isUrgent = timeLeft.days < 3;
  const percentComplete = ((7 - timeLeft.days) / 7) * 100;

  return (
    <Card
      className={`p-6 mb-6 border-2 ${
        isUrgent
          ? "bg-gradient-to-r from-red-50 to-orange-50 border-red-200"
          : "bg-gradient-to-r from-blue-50 to-purple-50 border-blue-200"
      }`}
    >
      <div className="flex items-start justify-between gap-4">
        <div className="flex-1">
          <div className="flex items-center gap-3 mb-3">
            <div
              className={`w-12 h-12 rounded-full flex items-center justify-center ${
                isUrgent ? "bg-red-500" : "bg-blue-600"
              }`}
            >
              <Clock className="w-6 h-6 text-white" />
            </div>
            <div>
              <div className="flex items-center gap-2">
                <h3 className="font-bold text-lg">
                  {isUrgent ? "‚ö° Trial Ending Soon!" : "Your Trial is Active"}
                </h3>
                <Badge variant={isUrgent ? "destructive" : "default"}>
                  {user.tier} Plan
                </Badge>
              </div>
              <p className="text-sm text-muted-foreground">
                {isUrgent
                  ? "Upgrade now to keep all your features!"
                  : "Enjoying your trial? Lock in this great rate!"}
              </p>
            </div>
          </div>

          {/* Countdown Timer */}
          <div className="grid grid-cols-4 gap-4 mb-4">
            <div className="text-center">
              <div
                className={`text-3xl font-bold ${
                  isUrgent ? "text-red-600" : "text-blue-600"
                }`}
              >
                {timeLeft.days}
              </div>
              <div className="text-xs text-muted-foreground uppercase">Days</div>
            </div>
            <div className="text-center">
              <div
                className={`text-3xl font-bold ${
                  isUrgent ? "text-red-600" : "text-blue-600"
                }`}
              >
                {timeLeft.hours}
              </div>
              <div className="text-xs text-muted-foreground uppercase">Hours</div>
            </div>
            <div className="text-center">
              <div
                className={`text-3xl font-bold ${
                  isUrgent ? "text-red-600" : "text-blue-600"
                }`}
              >
                {timeLeft.minutes}
              </div>
              <div className="text-xs text-muted-foreground uppercase">
                Minutes
              </div>
            </div>
            <div className="text-center">
              <div
                className={`text-3xl font-bold ${
                  isUrgent ? "text-red-600" : "text-blue-600"
                }`}
              >
                {timeLeft.seconds}
              </div>
              <div className="text-xs text-muted-foreground uppercase">
                Seconds
              </div>
            </div>
          </div>

          {/* Progress Bar */}
          <div className="mb-4">
            <Progress value={percentComplete} className="h-2" />
            <p className="text-xs text-muted-foreground mt-1">
              Day {Math.ceil(7 - timeLeft.days)} of 7-day trial
            </p>
          </div>

          {/* Value Prop */}
          <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
            <div className="flex items-center gap-2 text-sm">
              <CheckCircle className="w-4 h-4 text-green-600 flex-shrink-0" />
              <span>AI Website Builder</span>
            </div>
            <div className="flex items-center gap-2 text-sm">
              <CheckCircle className="w-4 h-4 text-green-600 flex-shrink-0" />
              <span>Visual Editor</span>
            </div>
            <div className="flex items-center gap-2 text-sm">
              <CheckCircle className="w-4 h-4 text-green-600 flex-shrink-0" />
              <span>SEO Optimization</span>
            </div>
            <div className="flex items-center gap-2 text-sm">
              <CheckCircle className="w-4 h-4 text-green-600 flex-shrink-0" />
              <span>Priority Support</span>
            </div>
          </div>
        </div>

        {/* CTA */}
        <div className="flex flex-col gap-2">
          <Button asChild size="lg" className="whitespace-nowrap">
            <Link href="/dashboard/billing">
              <Zap className="w-4 h-4 mr-2" />
              {isUrgent ? "Upgrade Now" : "Lock in Rate"}
            </Link>
          </Button>
          {isUrgent && (
            <p className="text-xs text-center text-red-600 font-semibold">
              Save 20% if you upgrade today!
            </p>
          )}
        </div>
      </div>
    </Card>
  );
}

// ==========================================
// File: components/trial/trial-progress-card.tsx
// ==========================================


"use client";

import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Progress } from "@/components/ui/progress";
import { Trophy, CheckCircle, Circle, Lock } from "lucide-react";
import Link from "next/link";

interface Milestone {
  title: string;
  description: string;
  completed: boolean;
  locked?: boolean;
}

interface TrialProgressCardProps {
  milestones: Milestone[];
  trialDaysLeft: number;
}

export function TrialProgressCard({
  milestones,
  trialDaysLeft,
}: TrialProgressCardProps) {
  const completedCount = milestones.filter((m) => m.completed).length;
  const progress = (completedCount / milestones.length) * 100;

  return (
    <Card className="p-6">
      <div className="flex items-start gap-4 mb-6">
        <div className="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
          <Trophy className="w-6 h-6 text-white" />
        </div>
        <div className="flex-1">
          <h3 className="font-bold text-lg mb-1">Your Trial Journey</h3>
          <p className="text-sm text-muted-foreground">
            {completedCount} of {milestones.length} milestones completed
          </p>
        </div>
        <div className="text-right">
          <div className="text-2xl font-bold text-blue-600">
            {trialDaysLeft}
          </div>
          <div className="text-xs text-muted-foreground">days left</div>
        </div>
      </div>

      <Progress value={progress} className="h-2 mb-6" />

      <div className="space-y-3 mb-6">
        {milestones.map((milestone, index) => (
          <div key={index} className="flex items-start gap-3">
            {milestone.completed ? (
              <CheckCircle className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
            ) : milestone.locked ? (
              <Lock className="w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5" />
            ) : (
              <Circle className="w-5 h-5 text-gray-300 flex-shrink-0 mt-0.5" />
            )}
            <div className="flex-1">
              <p
                className={`font-medium text-sm ${
                  milestone.completed
                    ? "text-gray-900"
                    : milestone.locked
                    ? "text-gray-400"
                    : "text-gray-600"
                }`}
              >
                {milestone.title}
              </p>
              <p className="text-xs text-muted-foreground">
                {milestone.description}
              </p>
            </div>
          </div>
        ))}
      </div>

      {progress < 100 && (
        <div className="p-4 bg-blue-50 rounded-lg text-center">
          <p className="text-sm font-medium mb-2">
            Complete your journey and get 15% off any plan!
          </p>
          <Button asChild size="sm" variant="outline">
            <Link href="/dashboard/billing">View Plans</Link>
          </Button>
        </div>
      )}
    </Card>
  );
}

// ==========================================
// File: components/trust-indicators.tsx
// ==========================================


"use client";

import { motion } from "framer-motion";
import { Award, Users, TrendingUp, Clock, Shield, Zap } from "lucide-react";

const TrustIndicators = () => {
  const indicators = [
    {
      icon: Users,
      metric: "50+",
      label: "Active Clients",
      description: "Businesses we currently serve",
    },
    {
      icon: TrendingUp,
      metric: "2-5x",
      label: "Growth Potential",
      description: "Expected revenue increase",
    },
    {
      icon: Clock,
      metric: "15+ Years",
      label: "Combined Experience",
      description: "Team expertise in marketing",
    },
    {
      icon: Award,
      metric: "90%",
      label: "Client Satisfaction",
      description: "Happy with our services",
    },
    {
      icon: Shield,
      metric: "100%",
      label: "Full Transparency",
      description: "Clear reporting & pricing",
    },
    {
      icon: Zap,
      metric: "24-48hr",
      label: "Typical Response",
      description: "We reply within 2 business days",
    },
  ];

  return (
    <section className="py-20 bg-gradient-to-br from-white via-gray-50 to-white">
      <div className="section-container">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
          className="text-center mb-16"
        >
          <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
            Trusted by Growing Businesses
          </h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            Numbers that demonstrate our commitment to delivering real, measurable results 
            for every client we partner with.
          </p>
        </motion.div>

        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
          {indicators.map((indicator, index) => (
            <motion.div
              key={index}
              initial={{ opacity: 0, y: 20 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: index * 0.1 }}
              viewport={{ once: true }}
              className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow border border-gray-100"
            >
              <div className="bg-gradient-to-br from-accent/10 to-secondary/10 rounded-full w-14 h-14 flex items-center justify-center mb-4 mx-auto">
                <indicator.icon className="h-7 w-7 text-primary" />
              </div>
              <div className="text-center">
                <p className="text-3xl font-bold text-primary mb-1">{indicator.metric}</p>
                <p className="font-semibold text-gray-900 mb-1">{indicator.label}</p>
                <p className="text-sm text-gray-500">{indicator.description}</p>
              </div>
            </motion.div>
          ))}
        </div>

        {/* Additional Trust Elements */}
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.6 }}
          viewport={{ once: true }}
          className="mt-16 bg-gradient-to-r from-primary/5 via-secondary/5 to-accent/5 rounded-2xl p-8 md:p-12"
        >
          <div className="grid md:grid-cols-3 gap-8 text-center">
            <div>
              <div className="text-4xl mb-3">üîí</div>
              <h3 className="font-bold text-gray-900 mb-2">No Long-Term Contracts</h3>
              <p className="text-gray-600 text-sm">
                We earn your business every month. Cancel anytime with 30 days notice.
              </p>
            </div>
            <div>
              <div className="text-4xl mb-3">üìä</div>
              <h3 className="font-bold text-gray-900 mb-2">Full Transparency</h3>
              <p className="text-gray-600 text-sm">
                Real-time dashboards showing exactly where your money goes and what it generates.
              </p>
            </div>
            <div>
              <div className="text-4xl mb-3">üéØ</div>
              <h3 className="font-bold text-gray-900 mb-2">Results-Focused</h3>
              <p className="text-gray-600 text-sm">
                We optimize for revenue and conversions, not vanity metrics that don't matter.
              </p>
            </div>
          </div>
        </motion.div>
      </div>
    </section>
  );
};

export default TrustIndicators;

// ==========================================
// File: components/ui/accordion.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as AccordionPrimitive from '@radix-ui/react-accordion';
import { ChevronDown } from 'lucide-react';

import { cn } from '@/lib/utils';

const Accordion = AccordionPrimitive.Root;

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn('border-b', className)}
    {...props}
  />
));
AccordionItem.displayName = 'AccordionItem';

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        'flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180',
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
));
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName;

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn('pb-4 pt-0', className)}>{children}</div>
  </AccordionPrimitive.Content>
));

AccordionContent.displayName = AccordionPrimitive.Content.displayName;

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent };

// ==========================================
// File: components/ui/alert-dialog.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as AlertDialogPrimitive from '@radix-ui/react-alert-dialog';

import { cn } from '@/lib/utils';
import { buttonVariants } from '@/components/ui/button';

const AlertDialog = AlertDialogPrimitive.Root;

const AlertDialogTrigger = AlertDialogPrimitive.Trigger;

const AlertDialogPortal = AlertDialogPrimitive.Portal;

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      'fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0',
      className
    )}
    {...props}
    ref={ref}
  />
));
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName;

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        'fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg',
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
));
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName;

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      'flex flex-col space-y-2 text-center sm:text-left',
      className
    )}
    {...props}
  />
);
AlertDialogHeader.displayName = 'AlertDialogHeader';

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      'flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2',
      className
    )}
    {...props}
  />
);
AlertDialogFooter.displayName = 'AlertDialogFooter';

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn('text-lg font-semibold', className)}
    {...props}
  />
));
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName;

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn('text-sm text-muted-foreground', className)}
    {...props}
  />
));
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName;

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
));
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName;

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: 'outline' }),
      'mt-2 sm:mt-0',
      className
    )}
    {...props}
  />
));
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName;

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
};

// ==========================================
// File: components/ui/alert.tsx
// ==========================================

import * as React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';

import { cn } from '@/lib/utils';

const alertVariants = cva(
  'relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground',
  {
    variants: {
      variant: {
        default: 'bg-background text-foreground',
        destructive:
          'border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  }
);

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
));
Alert.displayName = 'Alert';

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn('mb-1 font-medium leading-none tracking-tight', className)}
    {...props}
  />
));
AlertTitle.displayName = 'AlertTitle';

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn('text-sm [&_p]:leading-relaxed', className)}
    {...props}
  />
));
AlertDescription.displayName = 'AlertDescription';

export { Alert, AlertTitle, AlertDescription };

// ==========================================
// File: components/ui/aspect-ratio.tsx
// ==========================================

'use client';

import * as AspectRatioPrimitive from '@radix-ui/react-aspect-ratio';

const AspectRatio = AspectRatioPrimitive.Root;

export { AspectRatio };

// ==========================================
// File: components/ui/avatar.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as AvatarPrimitive from '@radix-ui/react-avatar';

import { cn } from '@/lib/utils';

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      'relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full',
      className
    )}
    {...props}
  />
));
Avatar.displayName = AvatarPrimitive.Root.displayName;

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn('aspect-square h-full w-full', className)}
    {...props}
  />
));
AvatarImage.displayName = AvatarPrimitive.Image.displayName;

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      'flex h-full w-full items-center justify-center rounded-full bg-muted',
      className
    )}
    {...props}
  />
));
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName;

export { Avatar, AvatarImage, AvatarFallback };

// ==========================================
// File: components/ui/badge.tsx
// ==========================================

import * as React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';

import { cn } from '@/lib/utils';

const badgeVariants = cva(
  'inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2',
  {
    variants: {
      variant: {
        default:
          'border-transparent bg-primary text-primary-foreground hover:bg-primary/80',
        secondary:
          'border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80',
        destructive:
          'border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80',
        outline: 'text-foreground',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  }
);

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  );
}

export { Badge, badgeVariants };

// ==========================================
// File: components/ui/breadcrumb.tsx
// ==========================================

import * as React from 'react';
import { Slot } from '@radix-ui/react-slot';
import { ChevronRight, MoreHorizontal } from 'lucide-react';

import { cn } from '@/lib/utils';

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<'nav'> & {
    separator?: React.ReactNode;
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />);
Breadcrumb.displayName = 'Breadcrumb';

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<'ol'>
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      'flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5',
      className
    )}
    {...props}
  />
));
BreadcrumbList.displayName = 'BreadcrumbList';

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<'li'>
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn('inline-flex items-center gap-1.5', className)}
    {...props}
  />
));
BreadcrumbItem.displayName = 'BreadcrumbItem';

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<'a'> & {
    asChild?: boolean;
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : 'a';

  return (
    <Comp
      ref={ref}
      className={cn('transition-colors hover:text-foreground', className)}
      {...props}
    />
  );
});
BreadcrumbLink.displayName = 'BreadcrumbLink';

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<'span'>
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn('font-normal text-foreground', className)}
    {...props}
  />
));
BreadcrumbPage.displayName = 'BreadcrumbPage';

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<'li'>) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn('[&>svg]:size-3.5', className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
);
BreadcrumbSeparator.displayName = 'BreadcrumbSeparator';

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<'span'>) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn('flex h-9 w-9 items-center justify-center', className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
);
BreadcrumbEllipsis.displayName = 'BreadcrumbElipssis';

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
};

// ==========================================
// File: components/ui/button.tsx
// ==========================================

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }
// ==========================================
// File: components/ui/calendar.tsx
// ==========================================

'use client';

import * as React from 'react';
import { ChevronLeft, ChevronRight } from 'lucide-react';
import { DayPicker } from 'react-day-picker';

import { cn } from '@/lib/utils';
import { buttonVariants } from '@/components/ui/button';

export type CalendarProps = React.ComponentProps<typeof DayPicker>;

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn('p-3', className)}
      classNames={{
        months: 'flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0',
        month: 'space-y-4',
        caption: 'flex justify-center pt-1 relative items-center',
        caption_label: 'text-sm font-medium',
        nav: 'space-x-1 flex items-center',
        nav_button: cn(
          buttonVariants({ variant: 'outline' }),
          'h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100'
        ),
        nav_button_previous: 'absolute left-1',
        nav_button_next: 'absolute right-1',
        table: 'w-full border-collapse space-y-1',
        head_row: 'flex',
        head_cell:
          'text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]',
        row: 'flex w-full mt-2',
        cell: 'h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20',
        day: cn(
          buttonVariants({ variant: 'ghost' }),
          'h-9 w-9 p-0 font-normal aria-selected:opacity-100'
        ),
        day_range_end: 'day-range-end',
        day_selected:
          'bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground',
        day_today: 'bg-accent text-accent-foreground',
        day_outside:
          'day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30',
        day_disabled: 'text-muted-foreground opacity-50',
        day_range_middle:
          'aria-selected:bg-accent aria-selected:text-accent-foreground',
        day_hidden: 'invisible',
        ...classNames,
      }}
      components={{
        IconLeft: ({ ...props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ...props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  );
}
Calendar.displayName = 'Calendar';

export { Calendar };

// ==========================================
// File: components/ui/card.tsx
// ==========================================

import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
// ==========================================
// File: components/ui/carousel.tsx
// ==========================================

'use client';

import * as React from 'react';
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from 'embla-carousel-react';
import { ArrowLeft, ArrowRight } from 'lucide-react';

import { cn } from '@/lib/utils';
import { Button } from '@/components/ui/button';

type CarouselApi = UseEmblaCarouselType[1];
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>;
type CarouselOptions = UseCarouselParameters[0];
type CarouselPlugin = UseCarouselParameters[1];

type CarouselProps = {
  opts?: CarouselOptions;
  plugins?: CarouselPlugin;
  orientation?: 'horizontal' | 'vertical';
  setApi?: (api: CarouselApi) => void;
};

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0];
  api: ReturnType<typeof useEmblaCarousel>[1];
  scrollPrev: () => void;
  scrollNext: () => void;
  canScrollPrev: boolean;
  canScrollNext: boolean;
} & CarouselProps;

const CarouselContext = React.createContext<CarouselContextProps | null>(null);

function useCarousel() {
  const context = React.useContext(CarouselContext);

  if (!context) {
    throw new Error('useCarousel must be used within a <Carousel />');
  }

  return context;
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = 'horizontal',
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === 'horizontal' ? 'x' : 'y',
      },
      plugins
    );
    const [canScrollPrev, setCanScrollPrev] = React.useState(false);
    const [canScrollNext, setCanScrollNext] = React.useState(false);

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return;
      }

      setCanScrollPrev(api.canScrollPrev());
      setCanScrollNext(api.canScrollNext());
    }, []);

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev();
    }, [api]);

    const scrollNext = React.useCallback(() => {
      api?.scrollNext();
    }, [api]);

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === 'ArrowLeft') {
          event.preventDefault();
          scrollPrev();
        } else if (event.key === 'ArrowRight') {
          event.preventDefault();
          scrollNext();
        }
      },
      [scrollPrev, scrollNext]
    );

    React.useEffect(() => {
      if (!api || !setApi) {
        return;
      }

      setApi(api);
    }, [api, setApi]);

    React.useEffect(() => {
      if (!api) {
        return;
      }

      onSelect(api);
      api.on('reInit', onSelect);
      api.on('select', onSelect);

      return () => {
        api?.off('select', onSelect);
      };
    }, [api, onSelect]);

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === 'y' ? 'vertical' : 'horizontal'),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn('relative', className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    );
  }
);
Carousel.displayName = 'Carousel';

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel();

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          'flex',
          orientation === 'horizontal' ? '-ml-4' : '-mt-4 flex-col',
          className
        )}
        {...props}
      />
    </div>
  );
});
CarouselContent.displayName = 'CarouselContent';

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel();

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        'min-w-0 shrink-0 grow-0 basis-full',
        orientation === 'horizontal' ? 'pl-4' : 'pt-4',
        className
      )}
      {...props}
    />
  );
});
CarouselItem.displayName = 'CarouselItem';

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = 'outline', size = 'icon', ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel();

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        'absolute  h-8 w-8 rounded-full',
        orientation === 'horizontal'
          ? '-left-12 top-1/2 -translate-y-1/2'
          : '-top-12 left-1/2 -translate-x-1/2 rotate-90',
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  );
});
CarouselPrevious.displayName = 'CarouselPrevious';

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = 'outline', size = 'icon', ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel();

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        'absolute h-8 w-8 rounded-full',
        orientation === 'horizontal'
          ? '-right-12 top-1/2 -translate-y-1/2'
          : '-bottom-12 left-1/2 -translate-x-1/2 rotate-90',
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  );
});
CarouselNext.displayName = 'CarouselNext';

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
};

// ==========================================
// File: components/ui/checkbox.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as CheckboxPrimitive from '@radix-ui/react-checkbox';
import { Check } from 'lucide-react';

import { cn } from '@/lib/utils';

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      'peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground',
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn('flex items-center justify-center text-current')}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
));
Checkbox.displayName = CheckboxPrimitive.Root.displayName;

export { Checkbox };

// ==========================================
// File: components/ui/collapsible.tsx
// ==========================================

'use client';

import * as CollapsiblePrimitive from '@radix-ui/react-collapsible';

const Collapsible = CollapsiblePrimitive.Root;

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger;

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent;

export { Collapsible, CollapsibleTrigger, CollapsibleContent };

// ==========================================
// File: components/ui/command.tsx
// ==========================================

'use client';

import * as React from 'react';
import { type DialogProps } from '@radix-ui/react-dialog';
import { Command as CommandPrimitive } from 'cmdk';
import { Search } from 'lucide-react';

import { cn } from '@/lib/utils';
import { Dialog, DialogContent } from '@/components/ui/dialog';

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      'flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground',
      className
    )}
    {...props}
  />
));
Command.displayName = CommandPrimitive.displayName;

interface CommandDialogProps extends DialogProps {}

const CommandDialog = ({ children, ...props }: CommandDialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  );
};

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        'flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50',
        className
      )}
      {...props}
    />
  </div>
));

CommandInput.displayName = CommandPrimitive.Input.displayName;

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn('max-h-[300px] overflow-y-auto overflow-x-hidden', className)}
    {...props}
  />
));

CommandList.displayName = CommandPrimitive.List.displayName;

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
));

CommandEmpty.displayName = CommandPrimitive.Empty.displayName;

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      'overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground',
      className
    )}
    {...props}
  />
));

CommandGroup.displayName = CommandPrimitive.Group.displayName;

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn('-mx-1 h-px bg-border', className)}
    {...props}
  />
));
CommandSeparator.displayName = CommandPrimitive.Separator.displayName;

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",
      className
    )}
    {...props}
  />
));

CommandItem.displayName = CommandPrimitive.Item.displayName;

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        'ml-auto text-xs tracking-widest text-muted-foreground',
        className
      )}
      {...props}
    />
  );
};
CommandShortcut.displayName = 'CommandShortcut';

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
};

// ==========================================
// File: components/ui/context-menu.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as ContextMenuPrimitive from '@radix-ui/react-context-menu';
import { Check, ChevronRight, Circle } from 'lucide-react';

import { cn } from '@/lib/utils';

const ContextMenu = ContextMenuPrimitive.Root;

const ContextMenuTrigger = ContextMenuPrimitive.Trigger;

const ContextMenuGroup = ContextMenuPrimitive.Group;

const ContextMenuPortal = ContextMenuPrimitive.Portal;

const ContextMenuSub = ContextMenuPrimitive.Sub;

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup;

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean;
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      'flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',
      inset && 'pl-8',
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
));
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName;

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      'z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
      className
    )}
    {...props}
  />
));
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName;

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        'z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
));
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName;

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      'relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      inset && 'pl-8',
      className
    )}
    {...props}
  />
));
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName;

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
));
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName;

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
));
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName;

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      'px-2 py-1.5 text-sm font-semibold text-foreground',
      inset && 'pl-8',
      className
    )}
    {...props}
  />
));
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName;

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn('-mx-1 my-1 h-px bg-border', className)}
    {...props}
  />
));
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName;

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        'ml-auto text-xs tracking-widest text-muted-foreground',
        className
      )}
      {...props}
    />
  );
};
ContextMenuShortcut.displayName = 'ContextMenuShortcut';

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
};

// ==========================================
// File: components/ui/date-range-picker.tsx
// ==========================================

import * as React from "react";
import { format } from "date-fns";
import { Calendar as CalendarIcon } from "lucide-react";
import { DateRange } from "react-day-picker";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Calendar } from "@/components/ui/calendar";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/components/ui/popover";

interface DateRangePickerProps {
  value: DateRange;
  onChange: (value: DateRange) => void;
  className?: string;
}

export function DateRangePicker({
  value,
  onChange,
  className,
}: DateRangePickerProps) {
  return (
    <div className={cn("grid gap-2", className)}>
      <Popover>
        <PopoverTrigger asChild>
          <Button
            id="date"
            variant={"outline"}
            className={cn(
              "w-[300px] justify-start text-left font-normal",
              !value && "text-muted-foreground"
            )}
          >
            <CalendarIcon className="mr-2 h-4 w-4" />
            {value?.from ? (
              value.to ? (
                <>
                  {format(value.from, "LLL dd, y")} -{" "}
                  {format(value.to, "LLL dd, y")}
                </>
              ) : (
                format(value.from, "LLL dd, y")
              )
            ) : (
              <span>Pick a date range</span>
            )}
          </Button>
        </PopoverTrigger>
        <PopoverContent className="w-auto p-0" align="start">
          <Calendar
            initialFocus
            mode="range"
            defaultMonth={value?.from}
            selected={value}
            onSelect={(value) => onChange(value as DateRange)}
            numberOfMonths={2}
          />
        </PopoverContent>
      </Popover>
    </div>
  );
}

// ==========================================
// File: components/ui/dialog.tsx
// ==========================================


"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}

// ==========================================
// File: components/ui/drawer.tsx
// ==========================================

'use client';

import * as React from 'react';
import { Drawer as DrawerPrimitive } from 'vaul';

import { cn } from '@/lib/utils';

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
);
Drawer.displayName = 'Drawer';

const DrawerTrigger = DrawerPrimitive.Trigger;

const DrawerPortal = DrawerPrimitive.Portal;

const DrawerClose = DrawerPrimitive.Close;

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn('fixed inset-0 z-50 bg-black/80', className)}
    {...props}
  />
));
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName;

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        'fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background',
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
));
DrawerContent.displayName = 'DrawerContent';

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn('grid gap-1.5 p-4 text-center sm:text-left', className)}
    {...props}
  />
);
DrawerHeader.displayName = 'DrawerHeader';

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn('mt-auto flex flex-col gap-2 p-4', className)}
    {...props}
  />
);
DrawerFooter.displayName = 'DrawerFooter';

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      'text-lg font-semibold leading-none tracking-tight',
      className
    )}
    {...props}
  />
));
DrawerTitle.displayName = DrawerPrimitive.Title.displayName;

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn('text-sm text-muted-foreground', className)}
    {...props}
  />
));
DrawerDescription.displayName = DrawerPrimitive.Description.displayName;

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
};

// ==========================================
// File: components/ui/dropdown-menu.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as DropdownMenuPrimitive from '@radix-ui/react-dropdown-menu';
import { Check, ChevronRight, Circle } from 'lucide-react';

import { cn } from '@/lib/utils';

const DropdownMenu = DropdownMenuPrimitive.Root;

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger;

const DropdownMenuGroup = DropdownMenuPrimitive.Group;

const DropdownMenuPortal = DropdownMenuPrimitive.Portal;

const DropdownMenuSub = DropdownMenuPrimitive.Sub;

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup;

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean;
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      'flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent',
      inset && 'pl-8',
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
));
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName;

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      'z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
      className
    )}
    {...props}
  />
));
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName;

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        'z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
));
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName;

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      'relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      inset && 'pl-8',
      className
    )}
    {...props}
  />
));
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName;

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
));
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName;

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
));
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName;

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      'px-2 py-1.5 text-sm font-semibold',
      inset && 'pl-8',
      className
    )}
    {...props}
  />
));
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName;

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn('-mx-1 my-1 h-px bg-muted', className)}
    {...props}
  />
));
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName;

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn('ml-auto text-xs tracking-widest opacity-60', className)}
      {...props}
    />
  );
};
DropdownMenuShortcut.displayName = 'DropdownMenuShortcut';

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
};

// ==========================================
// File: components/ui/form.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as LabelPrimitive from '@radix-ui/react-label';
import { Slot } from '@radix-ui/react-slot';
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from 'react-hook-form';

import { cn } from '@/lib/utils';
import { Label } from '@/components/ui/label';

const Form = FormProvider;

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName;
};

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
);

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  );
};

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext);
  const itemContext = React.useContext(FormItemContext);
  const { getFieldState, formState } = useFormContext();

  const fieldState = getFieldState(fieldContext.name, formState);

  if (!fieldContext) {
    throw new Error('useFormField should be used within <FormField>');
  }

  const { id } = itemContext;

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  };
};

type FormItemContextValue = {
  id: string;
};

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
);

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId();

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn('space-y-2', className)} {...props} />
    </FormItemContext.Provider>
  );
});
FormItem.displayName = 'FormItem';

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField();

  return (
    <Label
      ref={ref}
      className={cn(error && 'text-destructive', className)}
      htmlFor={formItemId}
      {...props}
    />
  );
});
FormLabel.displayName = 'FormLabel';

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } =
    useFormField();

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  );
});
FormControl.displayName = 'FormControl';

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField();

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn('text-sm text-muted-foreground', className)}
      {...props}
    />
  );
});
FormDescription.displayName = 'FormDescription';

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField();
  const body = error ? String(error?.message) : children;

  if (!body) {
    return null;
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn('text-sm font-medium text-destructive', className)}
      {...props}
    >
      {body}
    </p>
  );
});
FormMessage.displayName = 'FormMessage';

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
};

// ==========================================
// File: components/ui/hover-card.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as HoverCardPrimitive from '@radix-ui/react-hover-card';

import { cn } from '@/lib/utils';

const HoverCard = HoverCardPrimitive.Root;

const HoverCardTrigger = HoverCardPrimitive.Trigger;

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = 'center', sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      'z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
      className
    )}
    {...props}
  />
));
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName;

export { HoverCard, HoverCardTrigger, HoverCardContent };

// ==========================================
// File: components/ui/input-otp.tsx
// ==========================================

'use client';

import * as React from 'react';
import { OTPInput, OTPInputContext } from 'input-otp';
import { Dot } from 'lucide-react';

import { cn } from '@/lib/utils';

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      'flex items-center gap-2 has-[:disabled]:opacity-50',
      containerClassName
    )}
    className={cn('disabled:cursor-not-allowed', className)}
    {...props}
  />
));
InputOTP.displayName = 'InputOTP';

const InputOTPGroup = React.forwardRef<
  React.ElementRef<'div'>,
  React.ComponentPropsWithoutRef<'div'>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn('flex items-center', className)} {...props} />
));
InputOTPGroup.displayName = 'InputOTPGroup';

const InputOTPSlot = React.forwardRef<
  React.ElementRef<'div'>,
  React.ComponentPropsWithoutRef<'div'> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext);
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index];

  return (
    <div
      ref={ref}
      className={cn(
        'relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md',
        isActive && 'z-10 ring-2 ring-ring ring-offset-background',
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  );
});
InputOTPSlot.displayName = 'InputOTPSlot';

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<'div'>,
  React.ComponentPropsWithoutRef<'div'>
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
));
InputOTPSeparator.displayName = 'InputOTPSeparator';

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator };

// ==========================================
// File: components/ui/input.tsx
// ==========================================


import * as React from "react"

import { cn } from "@/lib/utils"

export interface InputProps
  extends React.InputHTMLAttributes<HTMLInputElement> {}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

// ==========================================
// File: components/ui/label.tsx
// ==========================================


"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }

// ==========================================
// File: components/ui/menubar.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as MenubarPrimitive from '@radix-ui/react-menubar';
import { Check, ChevronRight, Circle } from 'lucide-react';

import { cn } from '@/lib/utils';

const MenubarMenu = MenubarPrimitive.Menu;

const MenubarGroup = MenubarPrimitive.Group;

const MenubarPortal = MenubarPrimitive.Portal;

const MenubarSub = MenubarPrimitive.Sub;

const MenubarRadioGroup = MenubarPrimitive.RadioGroup;

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      'flex h-10 items-center space-x-1 rounded-md border bg-background p-1',
      className
    )}
    {...props}
  />
));
Menubar.displayName = MenubarPrimitive.Root.displayName;

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      'flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',
      className
    )}
    {...props}
  />
));
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName;

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean;
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      'flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',
      inset && 'pl-8',
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
));
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName;

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      'z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
      className
    )}
    {...props}
  />
));
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName;

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = 'start', alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          'z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
);
MenubarContent.displayName = MenubarPrimitive.Content.displayName;

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      'relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      inset && 'pl-8',
      className
    )}
    {...props}
  />
));
MenubarItem.displayName = MenubarPrimitive.Item.displayName;

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
));
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName;

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
));
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName;

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      'px-2 py-1.5 text-sm font-semibold',
      inset && 'pl-8',
      className
    )}
    {...props}
  />
));
MenubarLabel.displayName = MenubarPrimitive.Label.displayName;

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn('-mx-1 my-1 h-px bg-muted', className)}
    {...props}
  />
));
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName;

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        'ml-auto text-xs tracking-widest text-muted-foreground',
        className
      )}
      {...props}
    />
  );
};
MenubarShortcut.displayname = 'MenubarShortcut';

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
};

// ==========================================
// File: components/ui/navigation-menu.tsx
// ==========================================

import * as React from 'react';
import * as NavigationMenuPrimitive from '@radix-ui/react-navigation-menu';
import { cva } from 'class-variance-authority';
import { ChevronDown } from 'lucide-react';

import { cn } from '@/lib/utils';

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      'relative z-10 flex max-w-max flex-1 items-center justify-center',
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
));
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName;

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      'group flex flex-1 list-none items-center justify-center space-x-1',
      className
    )}
    {...props}
  />
));
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName;

const NavigationMenuItem = NavigationMenuPrimitive.Item;

const navigationMenuTriggerStyle = cva(
  'group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50'
);

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), 'group', className)}
    {...props}
  >
    {children}{' '}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
));
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName;

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      'left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ',
      className
    )}
    {...props}
  />
));
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName;

const NavigationMenuLink = NavigationMenuPrimitive.Link;

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn('absolute left-0 top-full flex justify-center')}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        'origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]',
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
));
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName;

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      'top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in',
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
));
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName;

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
};

// ==========================================
// File: components/ui/pagination.tsx
// ==========================================

import * as React from 'react';
import { ChevronLeft, ChevronRight, MoreHorizontal } from 'lucide-react';

import { cn } from '@/lib/utils';
import { ButtonProps, buttonVariants } from '@/components/ui/button';

const Pagination = ({ className, ...props }: React.ComponentProps<'nav'>) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn('mx-auto flex w-full justify-center', className)}
    {...props}
  />
);
Pagination.displayName = 'Pagination';

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<'ul'>
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn('flex flex-row items-center gap-1', className)}
    {...props}
  />
));
PaginationContent.displayName = 'PaginationContent';

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<'li'>
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn('', className)} {...props} />
));
PaginationItem.displayName = 'PaginationItem';

type PaginationLinkProps = {
  isActive?: boolean;
} & Pick<ButtonProps, 'size'> &
  React.ComponentProps<'a'>;

const PaginationLink = ({
  className,
  isActive,
  size = 'icon',
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? 'page' : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? 'outline' : 'ghost',
        size,
      }),
      className
    )}
    {...props}
  />
);
PaginationLink.displayName = 'PaginationLink';

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn('gap-1 pl-2.5', className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
);
PaginationPrevious.displayName = 'PaginationPrevious';

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn('gap-1 pr-2.5', className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
);
PaginationNext.displayName = 'PaginationNext';

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<'span'>) => (
  <span
    aria-hidden
    className={cn('flex h-9 w-9 items-center justify-center', className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
);
PaginationEllipsis.displayName = 'PaginationEllipsis';

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
};

// ==========================================
// File: components/ui/popover.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as PopoverPrimitive from '@radix-ui/react-popover';

import { cn } from '@/lib/utils';

const Popover = PopoverPrimitive.Root;

const PopoverTrigger = PopoverPrimitive.Trigger;

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = 'center', sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        'z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
));
PopoverContent.displayName = PopoverPrimitive.Content.displayName;

export { Popover, PopoverTrigger, PopoverContent };

// ==========================================
// File: components/ui/progress.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as ProgressPrimitive from '@radix-ui/react-progress';

import { cn } from '@/lib/utils';

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      'relative h-4 w-full overflow-hidden rounded-full bg-secondary',
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
));
Progress.displayName = ProgressPrimitive.Root.displayName;

export { Progress };

// ==========================================
// File: components/ui/radio-group.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as RadioGroupPrimitive from '@radix-ui/react-radio-group';
import { Circle } from 'lucide-react';

import { cn } from '@/lib/utils';

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn('grid gap-2', className)}
      {...props}
      ref={ref}
    />
  );
});
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName;

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        'aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50',
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  );
});
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName;

export { RadioGroup, RadioGroupItem };

// ==========================================
// File: components/ui/resizable.tsx
// ==========================================

'use client';

import { GripVertical } from 'lucide-react';
import * as ResizablePrimitive from 'react-resizable-panels';

import { cn } from '@/lib/utils';

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      'flex h-full w-full data-[panel-group-direction=vertical]:flex-col',
      className
    )}
    {...props}
  />
);

const ResizablePanel = ResizablePrimitive.Panel;

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean;
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      'relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90',
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
);

export { ResizablePanelGroup, ResizablePanel, ResizableHandle };

// ==========================================
// File: components/ui/scroll-area.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as ScrollAreaPrimitive from '@radix-ui/react-scroll-area';

import { cn } from '@/lib/utils';

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn('relative overflow-hidden', className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
));
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName;

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = 'vertical', ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      'flex touch-none select-none transition-colors',
      orientation === 'vertical' &&
        'h-full w-2.5 border-l border-l-transparent p-[1px]',
      orientation === 'horizontal' &&
        'h-2.5 flex-col border-t border-t-transparent p-[1px]',
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
));
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName;

export { ScrollArea, ScrollBar };

// ==========================================
// File: components/ui/select.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as SelectPrimitive from '@radix-ui/react-select';
import { Check, ChevronDown, ChevronUp } from 'lucide-react';

import { cn } from '@/lib/utils';

const Select = SelectPrimitive.Root;

const SelectGroup = SelectPrimitive.Group;

const SelectValue = SelectPrimitive.Value;

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      'flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1',
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
));
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName;

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      'flex cursor-default items-center justify-center py-1',
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
));
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName;

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      'flex cursor-default items-center justify-center py-1',
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
));
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName;

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = 'popper', ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        'relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
        position === 'popper' &&
          'data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1',
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          'p-1',
          position === 'popper' &&
            'h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]'
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
));
SelectContent.displayName = SelectPrimitive.Content.displayName;

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn('py-1.5 pl-8 pr-2 text-sm font-semibold', className)}
    {...props}
  />
));
SelectLabel.displayName = SelectPrimitive.Label.displayName;

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      'relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
));
SelectItem.displayName = SelectPrimitive.Item.displayName;

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn('-mx-1 my-1 h-px bg-muted', className)}
    {...props}
  />
));
SelectSeparator.displayName = SelectPrimitive.Separator.displayName;

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
};

// ==========================================
// File: components/ui/separator.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as SeparatorPrimitive from '@radix-ui/react-separator';

import { cn } from '@/lib/utils';

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = 'horizontal', decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        'shrink-0 bg-border',
        orientation === 'horizontal' ? 'h-[1px] w-full' : 'h-full w-[1px]',
        className
      )}
      {...props}
    />
  )
);
Separator.displayName = SeparatorPrimitive.Root.displayName;

export { Separator };

// ==========================================
// File: components/ui/sheet.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as SheetPrimitive from '@radix-ui/react-dialog';
import { cva, type VariantProps } from 'class-variance-authority';
import { X } from 'lucide-react';

import { cn } from '@/lib/utils';

const Sheet = SheetPrimitive.Root;

const SheetTrigger = SheetPrimitive.Trigger;

const SheetClose = SheetPrimitive.Close;

const SheetPortal = SheetPrimitive.Portal;

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      'fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0',
      className
    )}
    {...props}
    ref={ref}
  />
));
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName;

const sheetVariants = cva(
  'fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500',
  {
    variants: {
      side: {
        top: 'inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top',
        bottom:
          'inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom',
        left: 'inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm',
        right:
          'inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm',
      },
    },
    defaultVariants: {
      side: 'right',
    },
  }
);

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = 'right', className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
));
SheetContent.displayName = SheetPrimitive.Content.displayName;

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      'flex flex-col space-y-2 text-center sm:text-left',
      className
    )}
    {...props}
  />
);
SheetHeader.displayName = 'SheetHeader';

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      'flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2',
      className
    )}
    {...props}
  />
);
SheetFooter.displayName = 'SheetFooter';

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn('text-lg font-semibold text-foreground', className)}
    {...props}
  />
));
SheetTitle.displayName = SheetPrimitive.Title.displayName;

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn('text-sm text-muted-foreground', className)}
    {...props}
  />
));
SheetDescription.displayName = SheetPrimitive.Description.displayName;

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
};

// ==========================================
// File: components/ui/skeleton.tsx
// ==========================================

import { cn } from '@/lib/utils';

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn('animate-pulse rounded-md bg-muted', className)}
      {...props}
    />
  );
}

export { Skeleton };

// ==========================================
// File: components/ui/slider.tsx
// ==========================================


'use client';

import * as React from 'react';
import * as SliderPrimitive from '@radix-ui/react-slider';

import { cn } from '@/lib/utils';

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      'relative flex w-full touch-none select-none items-center',
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
));
Slider.displayName = SliderPrimitive.Root.displayName;

export { Slider };

// ==========================================
// File: components/ui/sonner.tsx
// ==========================================

'use client';

import { useTheme } from 'next-themes';
import { Toaster as Sonner } from 'sonner';

type ToasterProps = React.ComponentProps<typeof Sonner>;

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = 'system' } = useTheme();

  return (
    <Sonner
      theme={theme as ToasterProps['theme']}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            'group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg',
          description: 'group-[.toast]:text-muted-foreground',
          actionButton:
            'group-[.toast]:bg-primary group-[.toast]:text-primary-foreground',
          cancelButton:
            'group-[.toast]:bg-muted group-[.toast]:text-muted-foreground',
        },
      }}
      {...props}
    />
  );
};

export { Toaster };

// ==========================================
// File: components/ui/switch.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as SwitchPrimitives from '@radix-ui/react-switch';

import { cn } from '@/lib/utils';

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      'peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input',
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        'pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0'
      )}
    />
  </SwitchPrimitives.Root>
));
Switch.displayName = SwitchPrimitives.Root.displayName;

export { Switch };

// ==========================================
// File: components/ui/table.tsx
// ==========================================

import * as React from 'react';

import { cn } from '@/lib/utils';

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn('w-full caption-bottom text-sm', className)}
      {...props}
    />
  </div>
));
Table.displayName = 'Table';

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn('[&_tr]:border-b', className)} {...props} />
));
TableHeader.displayName = 'TableHeader';

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn('[&_tr:last-child]:border-0', className)}
    {...props}
  />
));
TableBody.displayName = 'TableBody';

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      'border-t bg-muted/50 font-medium [&>tr]:last:border-b-0',
      className
    )}
    {...props}
  />
));
TableFooter.displayName = 'TableFooter';

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      'border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted',
      className
    )}
    {...props}
  />
));
TableRow.displayName = 'TableRow';

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      'h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0',
      className
    )}
    {...props}
  />
));
TableHead.displayName = 'TableHead';

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn('p-4 align-middle [&:has([role=checkbox])]:pr-0', className)}
    {...props}
  />
));
TableCell.displayName = 'TableCell';

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn('mt-4 text-sm text-muted-foreground', className)}
    {...props}
  />
));
TableCaption.displayName = 'TableCaption';

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
};

// ==========================================
// File: components/ui/tabs.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as TabsPrimitive from '@radix-ui/react-tabs';

import { cn } from '@/lib/utils';

const Tabs = TabsPrimitive.Root;

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      'inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground',
      className
    )}
    {...props}
  />
));
TabsList.displayName = TabsPrimitive.List.displayName;

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      'inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm',
      className
    )}
    {...props}
  />
));
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName;

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      'mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2',
      className
    )}
    {...props}
  />
));
TabsContent.displayName = TabsPrimitive.Content.displayName;

export { Tabs, TabsList, TabsTrigger, TabsContent };

// ==========================================
// File: components/ui/task-card.tsx
// ==========================================

import { useState } from 'react'
import { Card, CardContent, CardHeader, CardTitle } from './card'
import { Badge } from './badge'
import { Checkbox } from './checkbox'
import { Button } from './button'
import { Pencil, Trash2 } from 'lucide-react'
import { motion } from 'framer-motion'

interface TaskCardProps {
  id: string
  title: string
  description?: string
  category: string
  completed: boolean
  onComplete: (id: string, completed: boolean) => void
  onDelete: (id: string) => void
  onEdit: (id: string) => void
}

export function TaskCard({
  id,
  title,
  description,
  category,
  completed,
  onComplete,
  onDelete,
  onEdit,
}: TaskCardProps) {
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -20 }}
      transition={{ duration: 0.2 }}
    >
      <Card className={`w-full ${completed ? 'opacity-60' : ''}`}>
        <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
          <div className="flex items-center space-x-2">
            <Checkbox
              checked={completed}
              onCheckedChange={(checked) => onComplete(id, checked as boolean)}
            />
            <CardTitle className={`text-lg ${completed ? 'line-through' : ''}`}>
              {title}
            </CardTitle>
          </div>
          <div className="flex space-x-2">
            <Button variant="ghost" size="icon" onClick={() => onEdit(id)}>
              <Pencil className="h-4 w-4" />
            </Button>
            <Button variant="ghost" size="icon" onClick={() => onDelete(id)}>
              <Trash2 className="h-4 w-4" />
            </Button>
          </div>
        </CardHeader>
        <CardContent>
          {description && <p className="text-sm text-muted-foreground">{description}</p>}
          <Badge variant="secondary" className="mt-2">
            {category}
          </Badge>
        </CardContent>
      </Card>
    </motion.div>
  )
}
// ==========================================
// File: components/ui/textarea.tsx
// ==========================================


import * as React from "react"

import { cn } from "@/lib/utils"

export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }

// ==========================================
// File: components/ui/toast.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as ToastPrimitives from '@radix-ui/react-toast';
import { cva, type VariantProps } from 'class-variance-authority';
import { X } from 'lucide-react';

import { cn } from '@/lib/utils';

const ToastProvider = ToastPrimitives.Provider;

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      'fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]',
      className
    )}
    {...props}
  />
));
ToastViewport.displayName = ToastPrimitives.Viewport.displayName;

const toastVariants = cva(
  'group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full',
  {
    variants: {
      variant: {
        default: 'border bg-background text-foreground',
        destructive:
          'destructive group border-destructive bg-destructive text-destructive-foreground',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  }
);

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  );
});
Toast.displayName = ToastPrimitives.Root.displayName;

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      'inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive',
      className
    )}
    {...props}
  />
));
ToastAction.displayName = ToastPrimitives.Action.displayName;

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      'absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600',
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
));
ToastClose.displayName = ToastPrimitives.Close.displayName;

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn('text-sm font-semibold', className)}
    {...props}
  />
));
ToastTitle.displayName = ToastPrimitives.Title.displayName;

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn('text-sm opacity-90', className)}
    {...props}
  />
));
ToastDescription.displayName = ToastPrimitives.Description.displayName;

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>;

type ToastActionElement = React.ReactElement<typeof ToastAction>;

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
};

// ==========================================
// File: components/ui/toaster.tsx
// ==========================================

'use client';

import { useToast } from '@/hooks/use-toast';
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from '@/components/ui/toast';

export function Toaster() {
  const { toasts } = useToast();

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        );
      })}
      <ToastViewport />
    </ToastProvider>
  );
}

// ==========================================
// File: components/ui/toggle-group.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as ToggleGroupPrimitive from '@radix-ui/react-toggle-group';
import { type VariantProps } from 'class-variance-authority';

import { cn } from '@/lib/utils';
import { toggleVariants } from '@/components/ui/toggle';

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: 'default',
  variant: 'default',
});

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn('flex items-center justify-center gap-1', className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
));

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName;

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext);

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  );
});

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName;

export { ToggleGroup, ToggleGroupItem };

// ==========================================
// File: components/ui/toggle.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as TogglePrimitive from '@radix-ui/react-toggle';
import { cva, type VariantProps } from 'class-variance-authority';

import { cn } from '@/lib/utils';

const toggleVariants = cva(
  'inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground',
  {
    variants: {
      variant: {
        default: 'bg-transparent',
        outline:
          'border border-input bg-transparent hover:bg-accent hover:text-accent-foreground',
      },
      size: {
        default: 'h-10 px-3',
        sm: 'h-9 px-2.5',
        lg: 'h-11 px-5',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  }
);

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
));

Toggle.displayName = TogglePrimitive.Root.displayName;

export { Toggle, toggleVariants };

// ==========================================
// File: components/ui/tooltip.tsx
// ==========================================

'use client';

import * as React from 'react';
import * as TooltipPrimitive from '@radix-ui/react-tooltip';

import { cn } from '@/lib/utils';

const TooltipProvider = TooltipPrimitive.Provider;

const Tooltip = TooltipPrimitive.Root;

const TooltipTrigger = TooltipPrimitive.Trigger;

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      'z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
      className
    )}
    {...props}
  />
));
TooltipContent.displayName = TooltipPrimitive.Content.displayName;

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };

// ==========================================
// File: components/ui/use-toast.ts
// ==========================================

'use client';

// Inspired by react-hot-toast library
import * as React from 'react';

import type { ToastActionElement, ToastProps } from '@/components/ui/toast';

const TOAST_LIMIT = 1;
const TOAST_REMOVE_DELAY = 1000000;

type ToasterToast = ToastProps & {
  id: string;
  title?: React.ReactNode;
  description?: React.ReactNode;
  action?: ToastActionElement;
};

const actionTypes = {
  ADD_TOAST: 'ADD_TOAST',
  UPDATE_TOAST: 'UPDATE_TOAST',
  DISMISS_TOAST: 'DISMISS_TOAST',
  REMOVE_TOAST: 'REMOVE_TOAST',
} as const;

let count = 0;

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER;
  return count.toString();
}

type ActionType = typeof actionTypes;

type Action =
  | {
      type: ActionType['ADD_TOAST'];
      toast: ToasterToast;
    }
  | {
      type: ActionType['UPDATE_TOAST'];
      toast: Partial<ToasterToast>;
    }
  | {
      type: ActionType['DISMISS_TOAST'];
      toastId?: ToasterToast['id'];
    }
  | {
      type: ActionType['REMOVE_TOAST'];
      toastId?: ToasterToast['id'];
    };

interface State {
  toasts: ToasterToast[];
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>();

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return;
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId);
    dispatch({
      type: 'REMOVE_TOAST',
      toastId: toastId,
    });
  }, TOAST_REMOVE_DELAY);

  toastTimeouts.set(toastId, timeout);
};

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case 'ADD_TOAST':
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      };

    case 'UPDATE_TOAST':
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      };

    case 'DISMISS_TOAST': {
      const { toastId } = action;

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId);
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id);
        });
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      };
    }
    case 'REMOVE_TOAST':
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        };
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      };
  }
};

const listeners: Array<(state: State) => void> = [];

let memoryState: State = { toasts: [] };

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action);
  listeners.forEach((listener) => {
    listener(memoryState);
  });
}

type Toast = Omit<ToasterToast, 'id'>;

function toast({ ...props }: Toast) {
  const id = genId();

  const update = (props: ToasterToast) =>
    dispatch({
      type: 'UPDATE_TOAST',
      toast: { ...props, id },
    });
  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id });

  dispatch({
    type: 'ADD_TOAST',
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss();
      },
    },
  });

  return {
    id: id,
    dismiss,
    update,
  };
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState);

  React.useEffect(() => {
    listeners.push(setState);
    return () => {
      const index = listeners.indexOf(setState);
      if (index > -1) {
        listeners.splice(index, 1);
      }
    };
  }, [state]);

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),
  };
}

export { useToast, toast };

// ==========================================
// File: components/welcome-popup.tsx
// ==========================================



'use client';

import { useState, useEffect } from 'react';
import { X, Gift, ArrowRight, Sparkles } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { useRouter } from 'next/navigation';

export function WelcomePopup() {
  const [isVisible, setIsVisible] = useState(false);
  const router = useRouter();

  useEffect(() => {
    // Check if user has already seen the popup
    const hasSeenPopup = localStorage.getItem('welcome_popup_seen');
    
    if (!hasSeenPopup) {
      // Show popup after 8 seconds (give users time to read the page)
      const timer = setTimeout(() => {
        setIsVisible(true);
      }, 8000);

      return () => clearTimeout(timer);
    }
  }, []);

  const handleClose = () => {
    setIsVisible(false);
    localStorage.setItem('welcome_popup_seen', 'true');
  };

  const handleGetAudit = () => {
    handleClose();
    router.push('/auditor');
  };

  if (!isVisible) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-300">
      <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-in zoom-in-95 duration-300">
        {/* Header with gradient */}
        <div className="bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white relative">
          <button
            onClick={handleClose}
            className="absolute top-4 right-4 hover:bg-white/20 rounded-full p-1 transition-colors"
            aria-label="Close popup"
          >
            <X className="w-5 h-5" />
          </button>
          
          <div className="flex items-center gap-3 mb-2">
            <div className="bg-white/20 backdrop-blur-sm rounded-full p-3">
              <Gift className="w-6 h-6" />
            </div>
            <h2 className="text-2xl font-bold">Welcome to CDM Suite! üéâ</h2>
          </div>
          <p className="text-blue-100">Get Your FREE Website Audit (Worth $500)</p>
        </div>

        {/* Content */}
        <div className="p-6">
          <div className="space-y-4 mb-6">
            <div className="flex items-start gap-3">
              <div className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-semibold flex-shrink-0 mt-0.5">
                ‚úì
              </div>
              <p className="text-gray-900 font-semibold">Instant SEO & performance analysis</p>
            </div>
            <div className="flex items-start gap-3">
              <div className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-semibold flex-shrink-0 mt-0.5">
                ‚úì
              </div>
              <p className="text-gray-900 font-semibold">Personalized recommendations to boost conversions</p>
            </div>
            <div className="flex items-start gap-3">
              <div className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-semibold flex-shrink-0 mt-0.5">
                ‚úì
              </div>
              <p className="text-gray-900 font-semibold">Mobile & security score included</p>
            </div>
            <div className="flex items-start gap-3">
              <div className="w-6 h-6 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-sm font-semibold flex-shrink-0 mt-0.5">
                <Sparkles className="w-3 h-3" />
              </div>
              <p className="text-gray-900 font-semibold">Results delivered instantly - No waiting!</p>
            </div>
          </div>

          <Button
            onClick={handleGetAudit}
            className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-6"
          >
            Get My Free Audit Now
            <ArrowRight className="w-4 h-4 ml-2" />
          </Button>

          <button 
            onClick={handleClose}
            className="w-full mt-3 text-sm text-gray-900 hover:text-gray-700 font-bold transition-colors"
          >
            No thanks, I'll check it out later
          </button>

          <p className="text-xs text-gray-900 font-bold text-center mt-4">
            Takes less than 60 seconds. No credit card required.
          </p>
        </div>
      </div>
    </div>
  );
}
